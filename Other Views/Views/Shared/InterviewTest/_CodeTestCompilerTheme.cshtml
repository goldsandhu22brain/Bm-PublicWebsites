@using Shared.Models.Exam;
@model TestRequestDetails
@{
	Layout = null;
	var testDetail = Model.TopicInfo.FirstOrDefault();
}
<meta charset="utf-8" />

<head>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<!--TODO: Move to CSS File below inline style-->
	<style type="text/css" media="screen">
		body {
			overflow: hidden;
		}

		#editor {
			min-width: 500px;
			min-height: 500px;
		}

		body {
			display: flex;
			flex-direction: column;
			align-items: center;
			font-family: sans-serif;
			color: black;
			margin-top: 50px;
		}

		#myselect {
			-webkit-appearance: none;
			-moz-appearance: none;
			appearance: none;
			width: 100%;
			max-width: 400px;
			padding: 6px 12px;
			border-radius: 4px;
			border: 1px solid #cbd1d8;
			font-size: 1rem;
			line-height: 1.5;
			background: #fff url(../img/down.svg) no-repeat center right 12px / 18px 18px;
			transition: all .2s ease-in-out;
		}

		.myselect::-ms-expand {
			display: none;
		}

		.myselect:focus {
			outline: 0;
			border-color: #7bbaff;
			box-shadow: 0 0 0 3px rgba(0, 121, 250, .3);
		}

		h1 {
			font-size: 1.5rem;
		}
	</style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
	<div style="height:100%">
		<h1>Code Editor</h1>
		<input type="text" value="@testDetail.TestName" disabled />
		<div id="editorContainer">
			<div class="container" style="margin-top: 30px">
				<div class="row">
					<div class="col">
						<pre id="editor">
      </pre>
					</div>
					<div class="col">
						<button class="btn btn-success" data-test-id="@testDetail.Id" onclick="submitCodeTest(this)">Execute</button>
						<br />
						<pre id="ans"></pre>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script>
        var langCode = @testDetail.Id;
	</script>
	<script>
		function codeEditor(lang_id) {
			var editor = ace.edit("editor");
			editor.setTheme("ace/theme/twilight");


			console.log("id" + lang_id)
			$(document).ready(function () {
				//$("button").click(function () {
				//    let code = editor.getValue();
				//    console.log(code);
				//    let data = {
				//        source_code: code,
				//        language_id: lang_id,
				//        number_of_runs: "1",
				//        stdin: "Judge0",
				//        expected_output: null,
				//        cpu_time_limit: "2",
				//        cpu_extra_time: "0.5",
				//        wall_time_limit: "5",
				//        memory_limit: "128000",
				//        stack_limit: "64000",
				//        max_processes_and_or_threads: "60",
				//        enable_per_process_and_thread_time_limit: false,
				//        enable_per_process_and_thread_memory_limit: false,
				//        max_file_size: "1024",
				//    };
				//    console.log(data)
				//    let request = $.ajax({
				//        url: BASE_URL,
				//        type: "post",
				//        data: data,
				//    });

				//    const delay = (ms) => new Promise((res) => setTimeout(res, ms));
				//    // Callback handler that will be called on success
				//    request.done(async function (response, textStatus, jqXHR) {
				//        // Log a message to the console
				//        console.log("Hooray, it worked!");
				//        let token = response.token;
				//        await new Promise((resolve) => setTimeout(resolve, 5000)); // 5 sec
				//        let second_request = $.ajax({
				//            url: BASE_URL + "/" + token,
				//            type: "get",
				//        });
				//        second_request.done(function (response) {
				//            console.log(response.stdout);
				//            $("#ans").html(response.stdout);
				//        });
				//    });
				//});
			});
			if (lang_id == 500)
				editor.setValue("def execute(): \n\t for i in range(10):\n\t\t print i \nexecute()")
			//java
			if (lang_id == 400) {

				let javacode = `public class Main{
							  public static void main(String args[]){
								System.out.println("hello");
							  }
						}`;
				editor.setValue(javacode)

			} if (lang_id == 200) {
				let cppcode = `#include <iostream>
						using namespace std;
							  int main() {
								  cout<<"Hello World"; \n
						}`;
				editor.setValue(cppcode)
			}
			if (lang_id == 100) {
				let csharpcode = `using System;
						public class HelloWorld
						{
							public static void Main(string[] args)
							{
								Console.WriteLine ("Hello World");
							}
						}`;
				editor.setValue(csharpcode)
			}
		}
	</script>
	<script>
		window.onload = function () {
			codeEditor(langCode);
		};
	</script>
</body>