parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"mkVv":[function(require,module,exports) {
"use strict";function e(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(e){return"'"+e+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function t(e){return!!e&&!!e[Q]}function r(e){var t;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===Z}(e)||Array.isArray(e)||!!e[L]||!!(null===(t=e.constructor)||void 0===t?void 0:t[L])||s(e)||l(e))}function n(r){return t(r)||e(23,r),r[Q].t}function o(e,t,r){void 0===r&&(r=!1),0===i(e)?(r?Object.keys:ee)(e).forEach(function(n){r&&"symbol"==typeof n||t(n,e[n],e)}):e.forEach(function(r,n){return t(n,r,e)})}function i(e){var t=e[Q];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:s(e)?2:l(e)?3:0}function a(e,t){return 2===i(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function u(e,t){return 2===i(e)?e.get(t):e[t]}function c(e,t,r){var n=i(e);2===n?e.set(t,r):3===n?e.add(r):e[t]=r}function f(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function s(e){return X&&e instanceof Map}function l(e){return q&&e instanceof Set}function p(e){return e.o||e.t}function h(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=te(e);delete t[Q];for(var r=ee(t),n=0;n<r.length;n++){var o=r[n],i=t[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),t)}function v(e,n){return void 0===n&&(n=!1),y(e)||t(e)||!r(e)||(i(e)>1&&(e.set=e.add=e.clear=e.delete=d),Object.freeze(e),n&&o(e,function(e,t){return v(t,!0)},!0)),e}function d(){e(2)}function y(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function b(t){var r=re[t];return r||e(18,t),r}function g(e,t){re[e]||(re[e]=t)}function m(){return J}function P(e,t){t&&(b("Patches"),e.u=[],e.s=[],e.v=t)}function O(e){x(e),e.p.forEach(j),e.p=null}function x(e){e===J&&(J=e.l)}function w(e){return J={p:[],l:J,h:e,m:!0,_:0}}function j(e){var t=e[Q];0===t.i||1===t.i?t.j():t.g=!0}function A(t,n){n._=n.p.length;var o=n.p[0],i=void 0!==t&&t!==o;return n.h.O||b("ES5").S(n,t,i),i?(o[Q].P&&(O(n),e(4)),r(t)&&(t=S(n,t),n.l||D(n,t)),n.u&&b("Patches").M(o[Q].t,t,n.u,n.s)):t=S(n,o,[]),O(n),n.u&&n.v(n.u,n.s),t!==H?t:void 0}function S(e,t,r){if(y(t))return t;var n=t[Q];if(!n)return o(t,function(o,i){return _(e,n,t,o,i,r)},!0),t;if(n.A!==e)return t;if(!n.P)return D(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var i=4===n.i||5===n.i?n.o=h(n.k):n.o,a=i,u=!1;3===n.i&&(a=new Set(i),i.clear(),u=!0),o(a,function(t,o){return _(e,n,i,t,o,r,u)}),D(e,i,!1),r&&e.u&&b("Patches").N(n,r,e.u,e.s)}return n.o}function _(e,n,o,i,u,f,s){if(t(u)){var l=S(e,u,f&&n&&3!==n.i&&!a(n.R,i)?f.concat(i):void 0);if(c(o,i,l),!t(l))return;e.m=!1}else s&&o.add(u);if(r(u)&&!y(u)){if(!e.h.D&&e._<1)return;S(e,u),n&&n.A.l||D(e,u)}}function D(e,t,r){void 0===r&&(r=!1),!e.l&&e.h.D&&e.m&&v(t,r)}function R(e,t){var r=e[Q];return(r?p(r):e)[t]}function k(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function I(e){e.P||(e.P=!0,e.l&&I(e.l))}function z(e){e.o||(e.o=h(e.t))}function E(e,t,r){var n=s(t)?b("MapSet").F(t,r):l(t)?b("MapSet").T(t,r):e.O?function(e,t){var r=Array.isArray(e),n={i:r?1:0,A:t?t.A:m(),P:!1,I:!1,R:{},l:t,t:e,k:null,o:null,j:null,C:!1},o=n,i=ne;r&&(o=[n],i=oe);var a=Proxy.revocable(o,i),u=a.revoke,c=a.proxy;return n.k=c,n.j=u,c}(t,r):b("ES5").J(t,r);return(r?r.A:m()).p.push(n),n}function M(n){return t(n)||e(22,n),function e(t){if(!r(t))return t;var n,a=t[Q],f=i(t);if(a){if(!a.P&&(a.i<4||!b("ES5").K(a)))return a.t;a.I=!0,n=F(t,f),a.I=!1}else n=F(t,f);return o(n,function(t,r){a&&u(a.t,t)===r||c(n,t,e(r))}),3===f?new Set(n):n}(n)}function F(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return h(e)}function N(){function e(e,t){var r=u[e];return r?r.enumerable=t:u[e]=r={configurable:!0,enumerable:t,get:function(){var t=this[Q];return ne.get(t,e)},set:function(t){var r=this[Q];ne.set(r,e,t)}},r}function r(e){for(var t=e.length-1;t>=0;t--){var r=e[t][Q];if(!r.P)switch(r.i){case 5:i(r)&&I(r);break;case 4:n(r)&&I(r)}}}function n(e){for(var t=e.t,r=e.k,n=ee(r),o=n.length-1;o>=0;o--){var i=n[o];if(i!==Q){var u=t[i];if(void 0===u&&!a(t,i))return!0;var c=r[i],s=c&&c[Q];if(s?s.t!==u:!f(c,u))return!0}}var l=!!t[Q];return n.length!==ee(t).length+(l?0:1)}function i(e){var t=e.k;if(t.length!==e.t.length)return!0;var r=Object.getOwnPropertyDescriptor(t,t.length-1);if(r&&!r.get)return!0;for(var n=0;n<t.length;n++)if(!t.hasOwnProperty(n))return!0;return!1}var u={};g("ES5",{J:function(t,r){var n=Array.isArray(t),o=function(t,r){if(t){for(var n=Array(r.length),o=0;o<r.length;o++)Object.defineProperty(n,""+o,e(o,!0));return n}var i=te(r);delete i[Q];for(var a=ee(i),u=0;u<a.length;u++){var c=a[u];i[c]=e(c,t||!!i[c].enumerable)}return Object.create(Object.getPrototypeOf(r),i)}(n,t),i={i:n?5:4,A:r?r.A:m(),P:!1,I:!1,R:{},l:r,t:t,k:o,o:null,g:!1,C:!1};return Object.defineProperty(o,Q,{value:i,writable:!0}),o},S:function(e,n,u){u?t(n)&&n[Q].A===e&&r(e.p):(e.u&&function e(t){if(t&&"object"==typeof t){var r=t[Q];if(r){var n=r.t,u=r.k,c=r.R,f=r.i;if(4===f)o(u,function(t){t!==Q&&(void 0!==n[t]||a(n,t)?c[t]||e(u[t]):(c[t]=!0,I(r)))}),o(n,function(e){void 0!==u[e]||a(u,e)||(c[e]=!1,I(r))});else if(5===f){if(i(r)&&(I(r),c.length=!0),u.length<n.length)for(var s=u.length;s<n.length;s++)c[s]=!1;else for(var l=n.length;l<u.length;l++)c[l]=!0;for(var p=Math.min(u.length,n.length),h=0;h<p;h++)u.hasOwnProperty(h)||(c[h]=!0),void 0===c[h]&&e(u[h])}}}}(e.p[0]),r(e.p))},K:function(e){return 4===e.i?n(e):i(e)}})}function C(){function n(e){if(!r(e))return e;if(Array.isArray(e))return e.map(n);if(s(e))return new Map(Array.from(e.entries()).map(function(e){return[e[0],n(e[1])]}));if(l(e))return new Set(Array.from(e).map(n));var t=Object.create(Object.getPrototypeOf(e));for(var o in e)t[o]=n(e[o]);return a(e,L)&&(t[L]=e[L]),t}function c(e){return t(e)?n(e):e}var f="add";g("Patches",{$:function(t,r){return r.forEach(function(r){for(var o=r.path,a=r.op,c=t,s=0;s<o.length-1;s++){var l=i(c),p=o[s];"string"!=typeof p&&"number"!=typeof p&&(p=""+p),0!==l&&1!==l||"__proto__"!==p&&"constructor"!==p||e(24),"function"==typeof c&&"prototype"===p&&e(24),"object"!=typeof(c=u(c,p))&&e(15,o.join("/"))}var h=i(c),v=n(r.value),d=o[o.length-1];switch(a){case"replace":switch(h){case 2:return c.set(d,v);case 3:e(16);default:return c[d]=v}case f:switch(h){case 1:return"-"===d?c.push(v):c.splice(d,0,v);case 2:return c.set(d,v);case 3:return c.add(v);default:return c[d]=v}case"remove":switch(h){case 1:return c.splice(d,1);case 2:return c.delete(d);case 3:return c.delete(r.value);default:return delete c[d]}default:e(17,a)}}),t},N:function(e,t,r,n){switch(e.i){case 0:case 4:case 2:return function(e,t,r,n){var i=e.t,s=e.o;o(e.R,function(e,o){var l=u(i,e),p=u(s,e),h=o?a(i,e)?"replace":f:"remove";if(l!==p||"replace"!==h){var v=t.concat(e);r.push("remove"===h?{op:h,path:v}:{op:h,path:v,value:p}),n.push(h===f?{op:"remove",path:v}:"remove"===h?{op:f,path:v,value:c(l)}:{op:"replace",path:v,value:c(l)})}})}(e,t,r,n);case 5:case 1:return function(e,t,r,n){var o=e.t,i=e.R,a=e.o;if(a.length<o.length){var u=[a,o];o=u[0],a=u[1];var s=[n,r];r=s[0],n=s[1]}for(var l=0;l<o.length;l++)if(i[l]&&a[l]!==o[l]){var p=t.concat([l]);r.push({op:"replace",path:p,value:c(a[l])}),n.push({op:"replace",path:p,value:c(o[l])})}for(var h=o.length;h<a.length;h++){var v=t.concat([h]);r.push({op:f,path:v,value:c(a[h])})}o.length<a.length&&n.push({op:"replace",path:t.concat(["length"]),value:o.length})}(e,t,r,n);case 3:return function(e,t,r,n){var o=e.t,i=e.o,a=0;o.forEach(function(e){if(!i.has(e)){var o=t.concat([a]);r.push({op:"remove",path:o,value:e}),n.unshift({op:f,path:o,value:e})}a++}),a=0,i.forEach(function(e){if(!o.has(e)){var i=t.concat([a]);r.push({op:f,path:i,value:e}),n.unshift({op:"remove",path:i,value:e})}a++})}(e,t,r,n)}},M:function(e,t,r,n){r.push({op:"replace",path:[],value:t===H?void 0:t}),n.push({op:"replace",path:[],value:e})}})}function T(){function t(e,t){function r(){this.constructor=e}u(e,t),e.prototype=(r.prototype=t.prototype,new r)}function n(e){e.o||(e.R=new Map,e.o=new Map(e.t))}function i(e){e.o||(e.o=new Set,e.t.forEach(function(t){if(r(t)){var n=E(e.A.h,t,e);e.p.set(t,n),e.o.add(n)}else e.o.add(t)}))}function a(t){t.g&&e(3,JSON.stringify(p(t)))}var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},c=function(){function e(e,t){return this[Q]={i:2,l:t,A:t?t.A:m(),P:!1,I:!1,o:void 0,R:void 0,t:e,k:this,C:!1,g:!1},this}t(e,Map);var i=e.prototype;return Object.defineProperty(i,"size",{get:function(){return p(this[Q]).size}}),i.has=function(e){return p(this[Q]).has(e)},i.set=function(e,t){var r=this[Q];return a(r),p(r).has(e)&&p(r).get(e)===t||(n(r),I(r),r.R.set(e,!0),r.o.set(e,t),r.R.set(e,!0)),this},i.delete=function(e){if(!this.has(e))return!1;var t=this[Q];return a(t),n(t),I(t),t.t.has(e)?t.R.set(e,!1):t.R.delete(e),t.o.delete(e),!0},i.clear=function(){var e=this[Q];a(e),p(e).size&&(n(e),I(e),e.R=new Map,o(e.t,function(t){e.R.set(t,!1)}),e.o.clear())},i.forEach=function(e,t){var r=this;p(this[Q]).forEach(function(n,o){e.call(t,r.get(o),o,r)})},i.get=function(e){var t=this[Q];a(t);var o=p(t).get(e);if(t.I||!r(o))return o;if(o!==t.t.get(e))return o;var i=E(t.A.h,o,t);return n(t),t.o.set(e,i),i},i.keys=function(){return p(this[Q]).keys()},i.values=function(){var e,t=this,r=this.keys();return(e={})[V]=function(){return t.values()},e.next=function(){var e=r.next();return e.done?e:{done:!1,value:t.get(e.value)}},e},i.entries=function(){var e,t=this,r=this.keys();return(e={})[V]=function(){return t.entries()},e.next=function(){var e=r.next();if(e.done)return e;var n=t.get(e.value);return{done:!1,value:[e.value,n]}},e},i[V]=function(){return this.entries()},e}(),f=function(){function e(e,t){return this[Q]={i:3,l:t,A:t?t.A:m(),P:!1,I:!1,o:void 0,t:e,k:this,p:new Map,g:!1,C:!1},this}t(e,Set);var r=e.prototype;return Object.defineProperty(r,"size",{get:function(){return p(this[Q]).size}}),r.has=function(e){var t=this[Q];return a(t),t.o?!!t.o.has(e)||!(!t.p.has(e)||!t.o.has(t.p.get(e))):t.t.has(e)},r.add=function(e){var t=this[Q];return a(t),this.has(e)||(i(t),I(t),t.o.add(e)),this},r.delete=function(e){if(!this.has(e))return!1;var t=this[Q];return a(t),i(t),I(t),t.o.delete(e)||!!t.p.has(e)&&t.o.delete(t.p.get(e))},r.clear=function(){var e=this[Q];a(e),p(e).size&&(i(e),I(e),e.o.clear())},r.values=function(){var e=this[Q];return a(e),i(e),e.o.values()},r.entries=function(){var e=this[Q];return a(e),i(e),e.o.entries()},r.keys=function(){return this.values()},r[V]=function(){return this.values()},r.forEach=function(e,t){for(var r=this.values(),n=r.next();!n.done;)e.call(t,n.value,n.value,this),n=r.next()},e}();g("MapSet",{F:function(e,t){return new c(e,t)},T:function(e,t){return new f(e,t)}})}function K(){N(),T(),C()}function U(e){return e}function W(e){return e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.applyPatches=exports.Immer=void 0,exports.castDraft=U,exports.castImmutable=W,exports.createDraft=void 0,exports.current=M,exports.default=void 0,exports.enableAllPlugins=K,exports.enableES5=N,exports.enableMapSet=T,exports.enablePatches=C,exports.finishDraft=void 0,exports.freeze=v,exports.immerable=void 0,exports.isDraft=t,exports.isDraftable=r,exports.nothing=void 0,exports.original=n,exports.setUseProxies=exports.setAutoFreeze=exports.produceWithPatches=exports.produce=void 0;var $,J,G="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),X="undefined"!=typeof Map,q="undefined"!=typeof Set,B="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,H=G?Symbol.for("immer-nothing"):(($={})["immer-nothing"]=!0,$),L=G?Symbol.for("immer-draftable"):"__$immer_draftable",Q=G?Symbol.for("immer-state"):"__$immer_state",V="undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator",Y={0:"Illegal state",1:"Immer drafts cannot have computed properties",2:"This object has been frozen and should not be mutated",3:function(e){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+e},4:"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.",5:"Immer forbids circular references",6:"The first or second argument to `produce` must be a function",7:"The third argument to `produce` must be a function or undefined",8:"First argument to `createDraft` must be a plain object, an array, or an immerable object",9:"First argument to `finishDraft` must be a draft returned by `createDraft`",10:"The given draft is already finalized",11:"Object.defineProperty() cannot be used on an Immer draft",12:"Object.setPrototypeOf() cannot be used on an Immer draft",13:"Immer only supports deleting array indices",14:"Immer only supports setting array indices and the 'length' property",15:function(e){return"Cannot apply patch, path doesn't resolve: "+e},16:'Sets cannot have "replace" patches.',17:function(e){return"Unsupported patch operation: "+e},18:function(e){return"The plugin for '"+e+"' has not been loaded into Immer. To enable the plugin, import and call `enable"+e+"()` when initializing your application."},20:"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available",21:function(e){return"produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '"+e+"'"},22:function(e){return"'current' expects a draft, got: "+e},23:function(e){return"'original' expects a draft, got: "+e},24:"Patching reserved attributes like __proto__, prototype and constructor is not allowed"},Z=""+Object.prototype.constructor,ee="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,te=Object.getOwnPropertyDescriptors||function(e){var t={};return ee(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},re={},ne={get:function(e,t){if(t===Q)return e;var n=p(e);if(!a(n,t))return function(e,t,r){var n,o=k(t,r);return o?"value"in o?o.value:null===(n=o.get)||void 0===n?void 0:n.call(e.k):void 0}(e,n,t);var o=n[t];return e.I||!r(o)?o:o===R(e.t,t)?(z(e),e.o[t]=E(e.A.h,o,e)):o},has:function(e,t){return t in p(e)},ownKeys:function(e){return Reflect.ownKeys(p(e))},set:function(e,t,r){var n=k(p(e),t);if(null==n?void 0:n.set)return n.set.call(e.k,r),!0;if(!e.P){var o=R(p(e),t),i=null==o?void 0:o[Q];if(i&&i.t===r)return e.o[t]=r,e.R[t]=!1,!0;if(f(r,o)&&(void 0!==r||a(e.t,t)))return!0;z(e),I(e)}return e.o[t]===r&&(void 0!==r||t in e.o)||Number.isNaN(r)&&Number.isNaN(e.o[t])||(e.o[t]=r,e.R[t]=!0),!0},deleteProperty:function(e,t){return void 0!==R(e.t,t)||t in e.t?(e.R[t]=!1,z(e),I(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=p(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:n.enumerable,value:r[t]}:n},defineProperty:function(){e(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){e(12)}},oe={};exports.immerable=L,exports.nothing=H,o(ne,function(e,t){oe[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),oe.deleteProperty=function(e,t){return oe.set.call(this,e,t,void 0)},oe.set=function(e,t,r){return ne.set.call(this,e[0],t,r,e[0])};var ie=function(){function n(t){var n=this;this.O=B,this.D=!0,this.produce=function(t,o,i){if("function"==typeof t&&"function"!=typeof o){var a=o;o=t;var u=n;return function(e){var t=this;void 0===e&&(e=a);for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return u.produce(e,function(e){var r;return(r=o).call.apply(r,[t,e].concat(n))})}}var c;if("function"!=typeof o&&e(6),void 0!==i&&"function"!=typeof i&&e(7),r(t)){var f=w(n),s=E(n,t,void 0),l=!0;try{c=o(s),l=!1}finally{l?O(f):x(f)}return"undefined"!=typeof Promise&&c instanceof Promise?c.then(function(e){return P(f,i),A(e,f)},function(e){throw O(f),e}):(P(f,i),A(c,f))}if(!t||"object"!=typeof t){if(void 0===(c=o(t))&&(c=t),c===H&&(c=void 0),n.D&&v(c,!0),i){var p=[],h=[];b("Patches").M(t,c,p,h),i(p,h)}return c}e(21,t)},this.produceWithPatches=function(e,t){if("function"==typeof e)return function(t){for(var r=arguments.length,o=Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return n.produceWithPatches(t,function(t){return e.apply(void 0,[t].concat(o))})};var r,o,i=n.produce(e,t,function(e,t){r=e,o=t});return"undefined"!=typeof Promise&&i instanceof Promise?i.then(function(e){return[e,r,o]}):[i,r,o]},"boolean"==typeof(null==t?void 0:t.useProxies)&&this.setUseProxies(t.useProxies),"boolean"==typeof(null==t?void 0:t.autoFreeze)&&this.setAutoFreeze(t.autoFreeze)}var o=n.prototype;return o.createDraft=function(n){r(n)||e(8),t(n)&&(n=M(n));var o=w(this),i=E(this,n,void 0);return i[Q].C=!0,x(o),i},o.finishDraft=function(e,t){var r=e&&e[Q],n=r.A;return P(n,t),A(void 0,n)},o.setAutoFreeze=function(e){this.D=e},o.setUseProxies=function(t){t&&!B&&e(20),this.O=t},o.applyPatches=function(e,r){var n;for(n=r.length-1;n>=0;n--){var o=r[n];if(0===o.path.length&&"replace"===o.op){e=o.value;break}}n>-1&&(r=r.slice(n+1));var i=b("Patches").$;return t(e)?i(e,r):this.produce(e,function(e){return i(e,r)})},n}(),ae=new ie,ue=ae.produce,ce=ae.produceWithPatches.bind(ae),fe=ae.setAutoFreeze.bind(ae),se=ae.setUseProxies.bind(ae),le=ae.applyPatches.bind(ae),pe=ae.createDraft.bind(ae),he=ae.finishDraft.bind(ae);exports.finishDraft=he,exports.createDraft=pe,exports.applyPatches=le,exports.setUseProxies=se,exports.setAutoFreeze=fe,exports.produceWithPatches=ce,exports.produce=ue,exports.Immer=ie;var ve=ue;exports.default=ve;
},{}],"J5wV":[function(require,module,exports) {
"use strict";function e(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var r=Object.keys(e);if(r.length!==Object.keys(t).length)return!1;for(var n=0;n<r.length;n++)if(!Object.prototype.hasOwnProperty.call(t,r[n])||!Object.is(e[r[n]],t[r[n]]))return!1;return!0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"UWKb":[function(require,module,exports) {
"use strict";function t(t){var e,n=new Set,r=function(t,r){var u="function"==typeof t?t(e):t;if(u!==e){var i=e;e=r?u:Object.assign({},e,u),n.forEach(function(t){return t(e,i)})}},u=function(){return e},i={setState:r,getState:u,subscribe:function(t,r,i){return r||i?function(t,r,i){void 0===r&&(r=u),void 0===i&&(i=Object.is);var o=r(e);function c(){var n=r(e);if(!i(o,n)){var u=o;t(o=n,u)}}return n.add(c),function(){return n.delete(c)}}(t,r,i):(n.add(t),function(){return n.delete(t)})},destroy:function(){return n.clear()}};return e=t(r,u,i),i}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;
},{}],"RsyN":[function(require,module,exports) {
"use strict";function e(e,n,r){return(n=t(n))in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function t(e){var t=n(e,"string");return"symbol"===r(t)?t:String(t)}function n(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.compactObject=v,exports.deprecated=f,exports.detectBrowser=l,exports.disableLog=u,exports.disableWarnings=p,exports.extractVersion=s,exports.filterStats=h,exports.log=c,exports.walkStats=b,exports.wrapPeerConnectionEvent=a;var o=!0,i=!0;function s(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function a(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return o.apply(this,arguments);var i=function(e){var t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,i),o.apply(this,[e,i])};var i=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(n))return i.apply(this,arguments);var r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function u(e){return"boolean"!=typeof e?new Error("Argument type: "+r(e)+". Please use a boolean."):(o=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function p(e){return"boolean"!=typeof e?new Error("Argument type: "+r(e)+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function c(){if("object"===("undefined"==typeof window?"undefined":r(window))){if(o)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function f(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")}function l(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=s(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=s(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=s(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function d(e){return"[object Object]"===Object.prototype.toString.call(e)}function v(t){return d(t)?Object.keys(t).reduce(function(n,r){var o=d(t[r]),i=o?v(t[r]):t[r],s=o&&!Object.keys(i).length;return void 0===i||s?n:Object.assign(n,e({},r,i))},{}):t}function b(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(function(r){r.endsWith("Id")?b(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(function(t){b(e,e.get(t),n)})}))}function h(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;var i=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)}),i.forEach(function(t){e.forEach(function(n){n.type===r&&n.trackId===t.id&&b(e,n,o)})}),o}
},{}],"RmTL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetUserMedia=i;var e=t(require("../utils.js"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(r=function(e){return e?o:t})(e)}function t(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=r(t);if(o&&o.has(e))return o.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var c=i?Object.getOwnPropertyDescriptor(e,a):null;c&&(c.get||c.set)?Object.defineProperty(n,a,c):n[a]=e[a]}return n.default=e,o&&o.set(e,n),n}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=e.log;function i(e,r){var t=e&&e.navigator;if(t.mediaDevices){var i=function(e){if("object"!==o(e)||e.mandatory||e.optional)return e;var r={};return Object.keys(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var n="object"===o(e[t])?e[t]:{ideal:e[t]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,r){return e?e+r.charAt(0).toUpperCase()+r.slice(1):"deviceId"===r?"sourceId":r};if(void 0!==n.ideal){r.optional=r.optional||[];var a={};"number"==typeof n.ideal?(a[i("min",t)]=n.ideal,r.optional.push(a),(a={})[i("max",t)]=n.ideal,r.optional.push(a)):(a[i("",t)]=n.ideal,r.optional.push(a))}void 0!==n.exact&&"number"!=typeof n.exact?(r.mandatory=r.mandatory||{},r.mandatory[i("",t)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(r.mandatory=r.mandatory||{},r.mandatory[i(e,t)]=n[e])})}}),e.advanced&&(r.optional=(r.optional||[]).concat(e.advanced)),r},a=function(e,a){if(r.version>=61)return a(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===o(e.audio)){var c=function(e,r,t){r in e&&!(t in e)&&(e[t]=e[r],delete e[r])};c((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),c(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"===o(e.video)){var d=e.video.facingMode;d=d&&("object"===o(d)?d:{ideal:d});var u,s=r.version<66;if(d&&("user"===d.exact||"environment"===d.exact||"user"===d.ideal||"environment"===d.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||s))if(delete e.video.facingMode,"environment"===d.exact||"environment"===d.ideal?u=["back","rear"]:"user"!==d.exact&&"user"!==d.ideal||(u=["front"]),u)return t.mediaDevices.enumerateDevices().then(function(r){var t=(r=r.filter(function(e){return"videoinput"===e.kind})).find(function(e){return u.some(function(r){return e.label.toLowerCase().includes(r)})});return!t&&r.length&&u.includes("back")&&(t=r[r.length-1]),t&&(e.video.deviceId=d.exact?{exact:t.deviceId}:{ideal:t.deviceId}),e.video=i(e.video),n("chrome: "+JSON.stringify(e)),a(e)});e.video=i(e.video)}return n("chrome: "+JSON.stringify(e)),a(e)},c=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,r,o){a(e,function(e){t.webkitGetUserMedia(e,r,function(e){o&&o(c(e))})})}.bind(t),t.mediaDevices.getUserMedia){var d=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e,function(e){return d(e).then(function(r){if(e.audio&&!r.getAudioTracks().length||e.video&&!r.getVideoTracks().length)throw r.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return r},function(e){return Promise.reject(c(e))})})}}}}
},{"../utils.js":"RsyN"}],"yjjI":[function(require,module,exports) {
"use strict";function e(e,i){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof i?e.navigator.mediaDevices.getDisplayMedia=function(a){return i(a).then(function(i){var t=a.video&&a.video.width,o=a.video&&a.video.height,d=a.video&&a.video.frameRate;return a.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:d||3}},t&&(a.video.mandatory.maxWidth=t),o&&(a.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(a)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=e;
},{}],"RNlo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fixNegotiationNeeded=C,exports.shimAddTrackRemoveTrack=l,exports.shimAddTrackRemoveTrackWithNative=m,Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}}),exports.shimGetSendersWithDtmf=h,exports.shimGetStats=f,Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return t.shimGetUserMedia}}),exports.shimMediaStream=p,exports.shimOnTrack=d,exports.shimPeerConnection=v,exports.shimSenderReceiverGetStats=u;var e=i(require("../utils.js")),t=require("./getusermedia"),r=require("./getdisplaymedia");function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var i={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&Object.prototype.hasOwnProperty.call(e,s)){var a=o?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(i,s,a):i[s]=e[s]}return i.default=e,r&&r.set(e,i),i}function o(e,t,r){return(t=s(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e){var t=a(e,"string");return"symbol"===c(t)?t:String(t)}function a(e,t){if("object"!==c(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function d(t){if("object"!==c(t)||!t.RTCPeerConnection||"ontrack"in t.RTCPeerConnection.prototype)e.wrapPeerConnectionEvent(t,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._ontrackpoly||(this._ontrackpoly=function(r){r.stream.addEventListener("addtrack",function(n){var i;i=t.RTCPeerConnection.prototype.getReceivers?e.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],e.dispatchEvent(o)}),r.stream.getTracks().forEach(function(n){var i;i=t.RTCPeerConnection.prototype.getReceivers?e.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],e.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}}function h(e){if("object"===c(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"===c(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function f(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,[r,n,i]=arguments;if(arguments.length>0&&"function"==typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof r))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return t.apply(this,[function(e){n(s(o(e)))},r])}return new Promise(function(r,n){t.apply(e,[function(e){r(s(o(e)))},n])}).then(n,i)}}}function u(t){if("object"===c(t)&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver){if(!("getStats"in t.RTCRtpSender.prototype)){var r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=r.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t});var n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),t.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(r){return e.filterStats(r,t.track,!0)})}}if(!("getStats"in t.RTCRtpReceiver.prototype)){var i=t.RTCPeerConnection.prototype.getReceivers;i&&(t.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),e.wrapPeerConnectionEvent(t,"track",function(e){return e.receiver._pc=e.srcElement,e}),t.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(r){return e.filterStats(r,t.track,!1)})}}if("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype){var o=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){var e,r,n,i=arguments[0];return this.getSenders().forEach(function(t){t.track===i&&(e?n=!0:e=t)}),this.getReceivers().forEach(function(e){return e.track===i&&(r?n=!0:r=e),e.track===i}),n||e&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}}function m(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter(function(e){return-1===n.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]}),i.apply(this,arguments)}}function l(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return m(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(function(e){if(r.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var s=new e.MediaStream([t]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=o({},t,function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(r){var n=c(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then(function(t){return c(e,t)})});e.RTCPeerConnection.prototype[t]=n[t]});var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(e=this,t=arguments[0],r=t.sdp,Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})),s.apply(this,arguments)):s.apply(this,arguments);var e,t,r};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:c(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach(function(n){r._streams[n].getTracks().find(function(t){return e.track===t})&&(t=r._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function c(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}}function v(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=o({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]})}function C(t,r){e.wrapPeerConnectionEvent(t,"negotiationneeded",function(e){var t=e.target;if(!(r.version<72||t.getConfiguration&&"plan-b"===t.getConfiguration().sdpSemantics)||"stable"===t.signalingState)return e})}
},{"../utils.js":"RsyN","./getusermedia":"RmTL","./getdisplaymedia":"yjjI"}],"OQLX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetUserMedia=n;var e=o(require("../utils"));function t(e){if("function"!=typeof WeakMap)return null;var o=new WeakMap,r=new WeakMap;return(t=function(e){return e?r:o})(e)}function o(e,o){if(!o&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=t(o);if(r&&r.has(e))return r.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(n,a,s):n[a]=e[a]}return n.default=e,r&&r.set(e,n),n}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(t,o){var n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(t,o,r){e.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(t).then(o,r)},!(o.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var a=function(e,t,o){t in e&&!(o in e)&&(e[o]=e[t],delete e[t])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===r(e)&&"object"===r(e.audio)&&(e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","mozAutoGainControl"),a(e.audio,"noiseSuppression","mozNoiseSuppression")),s(e)},i&&i.prototype.getSettings){var p=i.prototype.getSettings;i.prototype.getSettings=function(){var e=p.apply(this,arguments);return a(e,"mozAutoGainControl","autoGainControl"),a(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var u=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===r(e)&&(e=JSON.parse(JSON.stringify(e)),a(e,"autoGainControl","mozAutoGainControl"),a(e,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[e])}}}}
},{"../utils":"RsyN"}],"Hsc4":[function(require,module,exports) {
"use strict";function e(e,i){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(a){if(!a||!a.video){var t=new DOMException("getDisplayMedia without video constraints is undefined");return t.name="NotFoundError",t.code=8,Promise.reject(t)}return!0===a.video?a.video={mediaSource:i}:a.video.mediaSource=i,e.navigator.mediaDevices.getUserMedia(a)})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimGetDisplayMedia=e;
},{}],"vPl0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimAddTransceiver=T,exports.shimCreateAnswer=S,exports.shimCreateOffer=b,Object.defineProperty(exports,"shimGetDisplayMedia",{enumerable:!0,get:function(){return r.shimGetDisplayMedia}}),exports.shimGetParameters=g,Object.defineProperty(exports,"shimGetUserMedia",{enumerable:!0,get:function(){return t.shimGetUserMedia}}),exports.shimOnTrack=m,exports.shimPeerConnection=C,exports.shimRTCDataChannel=P,exports.shimReceiverGetStats=v,exports.shimRemoveStream=R,exports.shimSenderGetStats=h;var e=o(require("../utils")),t=require("./getusermedia"),r=require("./getdisplaymedia");function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var o={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var c=i?Object.getOwnPropertyDescriptor(e,a):null;c&&(c.get||c.set)?Object.defineProperty(o,a,c):o[a]=e[a]}return o.default=e,r&&r.set(e,o),o}function i(e){return p(e)||s(e)||c(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}function s(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function p(e){if(Array.isArray(e))return u(e)}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function f(e,t,r){return(t=l(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){var t=d(e,"string");return"symbol"===y(t)?t:String(t)}function d(e,t){if("object"!==y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e){"object"===y(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function C(e,t){if("object"===y(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t],n=f({},t,function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)});e.RTCPeerConnection.prototype[t]=n[t]});var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var[e,o,i]=arguments;return n.apply(this,[e||null]).then(function(e){if(t.version<53&&!o)try{e.forEach(function(e){e.type=r[e.type]||e.type})}catch(n){if("TypeError"!==n.name)throw n;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))})}return e}).then(o,i)}}}function h(e){if("object"===y(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach(function(t){return t._pc=e}),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function v(t){if("object"===y(t)&&t.RTCPeerConnection&&t.RTCRtpSender&&!(t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)){var r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=r.apply(this,[]);return t.forEach(function(t){return t._pc=e}),t}),e.wrapPeerConnectionEvent(t,"track",function(e){return e.receiver._pc=e.srcElement,e}),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function R(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){var r=this;e.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(e){e.track&&t.getTracks().includes(e.track)&&r.removeTrack(e)})})}function P(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function T(e){if("object"===y(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var r=(e=i(e)).length>0;r&&e.forEach(function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var n=t.apply(this,arguments);if(r){var{sender:o}=n,a=o.getParameters();"encodings"in a&&(1!==a.encodings.length||0!==Object.keys(a.encodings[0]).length)||(a.encodings=e,o.sendEncodings=e,this.setParametersPromises.push(o.setParameters(a).then(function(){delete o.sendEncodings}).catch(function(){delete o.sendEncodings})))}return n})}}function g(e){if("object"===y(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function b(e){if("object"===y(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(r,e)}).finally(function(){r.setParametersPromises=[]}):t.apply(this,arguments)}}}function S(e){if("object"===y(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return t.apply(r,e)}).finally(function(){r.setParametersPromises=[]}):t.apply(this,arguments)}}}
},{"../utils":"RsyN","./getusermedia":"OQLX","./getdisplaymedia":"Hsc4"}],"aXmZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shimAudioContext=p,exports.shimCallbacksAPI=a,exports.shimConstraints=s,exports.shimCreateOfferLegacy=u,exports.shimGetUserMedia=c,exports.shimLocalStreamsAPI=n,exports.shimRTCIceServerUrls=d,exports.shimRemoteStreamsAPI=i,exports.shimTrackEventTransceiver=f;var e=r(require("../utils"));function t(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,o=new WeakMap;return(t=function(e){return e?o:r})(e)}function r(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=t(r);if(o&&o.has(e))return o.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var c=i?Object.getOwnPropertyDescriptor(e,a):null;c&&(c.get||c.set)?Object.defineProperty(n,a,c):n[a]=e[a]}return n.default=e,o&&o.set(e,n),n}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){if("object"===o(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(o){return t.call(r,o,e)}),e.getVideoTracks().forEach(function(o){return t.call(r,o,e)})},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=this,o=arguments.length,n=new Array(o>1?o-1:0),i=1;i<o;i++)n[i-1]=arguments[i];return n&&n.forEach(function(e){r._localStreams?r._localStreams.includes(e)||r._localStreams.push(e):r._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var o=e.getTracks();this.getSenders().forEach(function(e){o.includes(e.track)&&t.removeTrack(e)})}})}}function i(e){if("object"===o(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}})}),t.apply(e,arguments)}}}function a(e){if("object"===o(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,a=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(e,t){var o=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[o]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o};var s=function(e,t,r){var o=i.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o};t.setLocalDescription=s,s=function(e,t,r){var o=a.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o},t.setRemoteDescription=s,s=function(e,t,r){var o=c.apply(this,[e]);return r?(o.then(t,r),Promise.resolve()):o},t.addIceCandidate=s}}function c(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,o=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return o(s(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,o){t.mediaDevices.getUserMedia(e).then(r,o)}.bind(t))}function s(t){return t&&void 0!==t.video?Object.assign({},t,{video:e.compactObject(t.video)}):t}function d(t){if(t.RTCPeerConnection){var r=t.RTCPeerConnection;t.RTCPeerConnection=function(t,o){if(t&&t.iceServers){for(var n=[],i=0;i<t.iceServers.length;i++){var a=t.iceServers[i];void 0===a.urls&&a.url?(e.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,n.push(a)):n.push(t.iceServers[i])}t.iceServers=n}return new r(t,o)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}}function f(e){"object"===o(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function u(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var o=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&o?"sendrecv"===o.direction?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":"recvonly"===o.direction&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):!0!==e.offerToReceiveVideo||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function p(e){"object"!==o(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}
},{"../utils":"RsyN"}],"jIWI":[function(require,module,exports) {
"use strict";const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},e.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(e=>0===e.indexOf(r))},e.parseCandidate=function(e){let t;const r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:void 0===r[t[n]]&&(r[t[n]]=t[n+1])}return r},e.writeCandidate=function(e){const t=[];t.push(e.foundation);const r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},e.parseIceOptions=function(e){return e.substring(14).split(" ")},e.parseRtpMap=function(e){let t=e.substring(9).split(" ");const r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},e.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},e.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},e.parseFmtp=function(e){const t={};let r;const n=e.substring(e.indexOf(" ")+1).split(";");for(let s=0;s<n.length;s++)t[(r=n[s].trim().split("="))[0].trim()]=r[1];return t},e.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach(t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)}),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},e.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},e.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},e.parseSsrcMedia=function(e){const t=e.indexOf(" "),r={ssrc:parseInt(e.substring(7,t),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substring(t+1,n),r.value=e.substring(n+1)):r.attribute=e.substring(t+1),r},e.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},e.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+("object"==typeof t.keyParams?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+"\r\n"},e.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const n=e.matchPrefix(t+r,"a=ice-ufrag:")[0],s=e.matchPrefix(t+r,"a=ice-pwd:")[0];return n&&s?{usernameFragment:n.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=e.splitLines(t)[0].split(" ");r.profile=n[2];for(let a=3;a<n.length;a++){const s=n[a],i=e.matchPrefix(t,"a=rtpmap:"+s+" ")[0];if(i){const n=e.parseRtpMap(i),a=e.matchPrefix(t,"a=fmtp:"+s+" ");switch(n.parameters=a.length?e.parseFmtp(a[0]):{},n.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+s+" ").map(e.parseRtcpFb),r.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(n.name.toUpperCase())}}}e.matchPrefix(t,"a=extmap:").forEach(t=>{r.headerExtensions.push(e.parseExtmap(t))});const s=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(e=>{s.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),r},e.writeRtpDescription=function(t,r){let n="";n+="m="+t+" ",n+=r.codecs.length>0?"9":"0",n+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=r.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach(t=>{n+=e.writeRtpMap(t),n+=e.writeFmtp(t),n+=e.writeRtcpFb(t)});let s=0;return r.codecs.forEach(e=>{e.maxptime>s&&(s=e.maxptime)}),s>0&&(n+="a=maxptime:"+s+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach(t=>{n+=e.writeExtmap(t)}),n},e.parseRtpEncodingParameters=function(t){const r=[],n=e.parseRtpParameters(t),s=-1!==n.fecMechanisms.indexOf("RED"),a=-1!==n.fecMechanisms.indexOf("ULPFEC"),i=e.matchPrefix(t,"a=ssrc:").map(t=>e.parseSsrcMedia(t)).filter(e=>"cname"===e.attribute),p=i.length>0&&i[0].ssrc;let c;const o=e.matchPrefix(t,"a=ssrc-group:FID").map(e=>{return e.substring(17).split(" ").map(e=>parseInt(e,10))});o.length>0&&o[0].length>1&&o[0][0]===p&&(c=o[0][1]),n.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:p,codecPayloadType:parseInt(e.parameters.apt,10)};p&&c&&(t.rtx={ssrc:c}),r.push(t),s&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:p,mechanism:a?"red+ulpfec":"red"},r.push(t))}}),0===r.length&&p&&r.push({ssrc:p});let u=e.matchPrefix(t,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,r.forEach(e=>{e.maxBitrate=u})),r},e.parseRtcpParameters=function(t){const r={},n=e.matchPrefix(t,"a=ssrc:").map(t=>e.parseSsrcMedia(t)).filter(e=>"cname"===e.attribute)[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const s=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=0===s.length;const a=e.matchPrefix(t,"a=rtcp-mux");return r.mux=a.length>0,r},e.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},e.parseMsid=function(t){let r;const n=e.matchPrefix(t,"a=msid:");if(1===n.length)return{stream:(r=n[0].substring(7).split(" "))[0],track:r[1]};const s=e.matchPrefix(t,"a=ssrc:").map(t=>e.parseSsrcMedia(t)).filter(e=>"msid"===e.attribute);return s.length>0?{stream:(r=s[0].value.split(" "))[0],track:r[1]}:void 0},e.parseSctpDescription=function(t){const r=e.parseMLine(t),n=e.matchPrefix(t,"a=max-message-size:");let s;n.length>0&&(s=parseInt(n[0].substring(19),10)),isNaN(s)&&(s=65536);const a=e.matchPrefix(t,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const i=e.matchPrefix(t,"a=sctpmap:");if(i.length>0){const e=i[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:s}}},e.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,n){let s;const a=void 0!==r?r:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(s=t||e.generateSessionId())+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},e.getDirection=function(t,r){const n=e.splitLines(t);for(let e=0;e<n.length;e++)switch(n[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[e].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(e){return"0"===e.split(" ",2)[1]},e.parseMLine=function(t){const r=e.splitLines(t)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(t){const r=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(t){if("string"!=typeof t||0===t.length)return!1;const r=e.splitLines(t);for(let e=0;e<r.length;e++)if(r[e].length<2||"="!==r[e].charAt(1))return!1;return!0},"object"==typeof module&&(module.exports=e);
},{}],"WlzA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.removeExtmapAllowMixed=f,exports.shimAddIceCandidateNullOrEmpty=u,exports.shimConnectionState=d,exports.shimMaxMessageSize=s,exports.shimParameterlessSetLocalDescription=l,exports.shimRTCIceCandidate=a,exports.shimRTCIceCandidateRelayProtocol=c,exports.shimSendThrowTypeError=p;var e=r(require("sdp")),t=o(require("./utils"));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(n=function(e){return e?o:t})(e)}function o(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var o=n(t);if(o&&o.has(e))return o.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var c=i?Object.getOwnPropertyDescriptor(e,a):null;c&&(c.get||c.set)?Object.defineProperty(r,a,c):r[a]=e[a]}return r.default=e,o&&o.set(e,r),r}function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(n){if(n.RTCIceCandidate&&!(n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)){var o=n.RTCIceCandidate;n.RTCIceCandidate=function(t){if("object"===i(t)&&t.candidate&&0===t.candidate.indexOf("a=")&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substring(2)),t.candidate&&t.candidate.length){var n=new o(t),r=e.default.parseCandidate(t.candidate);for(var a in r)a in n||Object.defineProperty(n,a,{value:r[a]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new o(t)},n.RTCIceCandidate.prototype=o.prototype,t.wrapPeerConnectionEvent(n,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new n.RTCIceCandidate(e.candidate),writable:"false"}),e})}}function c(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||t.wrapPeerConnectionEvent(n,"icecandidate",function(t){if(t.candidate){var n=e.default.parseCandidate(t.candidate.candidate);"relay"===n.type&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function s(t,n){if(t.RTCPeerConnection){"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===n.browser&&n.version>=76){var{sdpSemantics:t}=this.getConfiguration();"plan-b"===t&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(t){if(!t||!t.sdp)return!1;var n=e.default.splitSections(t.sdp);return n.shift(),n.some(function(t){var n=e.default.parseMLine(t);return n&&"application"===n.kind&&-1!==n.protocol.indexOf("SCTP")})}(arguments[0])){var r,i=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),a=(p=i,d=65536,"firefox"===n.browser&&(d=n.version<57?-1===p?16384:2147483637:n.version<60?57===n.version?65535:65536:2147483637),d),c=function(t,o){var r=65536;"firefox"===n.browser&&57===n.version&&(r=65535);var i=e.default.matchPrefix(t.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substring(19),10):"firefox"===n.browser&&-1!==o&&(r=2147483637),r}(arguments[0],i);r=0===a&&0===c?Number.POSITIVE_INFINITY:0===a||0===c?Math.max(a,c):Math.min(a,c);var s={};Object.defineProperty(s,"maxMessageSize",{get:function(){return r}}),this._sctp=s}var p,d;return o.apply(this,arguments)}}}function p(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=n.apply(this,arguments);return o(e,this),e},t.wrapPeerConnectionEvent(e,"datachannel",function(e){return o(e.channel,e.target),e})}function o(e,t){var n=e.send;e.send=function(){var o=arguments[0],r=o.length||o.size||o.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}function d(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}}function f(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var o=t.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:o}):t.sdp=o}return n.apply(this,arguments)}}}function u(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}function l(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!==i(t)||t.type&&t.sdp)return n.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?n.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then(function(t){return n.apply(e,[t])})})}}
},{"sdp":"jIWI","./utils":"RsyN"}],"elb5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.adapterFactory=m;var e=o(require("./utils")),r=o(require("./chrome/chrome_shim")),i=o(require("./firefox/firefox_shim")),s=o(require("./safari/safari_shim")),t=o(require("./common_shim")),a=o(require("sdp"));function n(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,i=new WeakMap;return(n=function(e){return e?i:r})(e)}function o(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=n(r);if(i&&i.has(e))return i.get(e);var s={},t=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=t?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(s,a,o):s[a]=e[a]}return s.default=e,i&&i.set(e,s),s}function m(){var{window:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},m=e.log,h=e.detectBrowser(n),d={browserDetails:h,commonShim:t,extractVersion:e.extractVersion,disableLog:e.disableLog,disableWarnings:e.disableWarnings,sdp:a};switch(h.browser){case"chrome":if(!r||!r.shimPeerConnection||!o.shimChrome)return m("Chrome shim is not included in this adapter release."),d;if(null===h.version)return m("Chrome shim can not determine version, not shimming."),d;m("adapter.js shimming chrome."),d.browserShim=r,t.shimAddIceCandidateNullOrEmpty(n,h),t.shimParameterlessSetLocalDescription(n,h),r.shimGetUserMedia(n,h),r.shimMediaStream(n,h),r.shimPeerConnection(n,h),r.shimOnTrack(n,h),r.shimAddTrackRemoveTrack(n,h),r.shimGetSendersWithDtmf(n,h),r.shimGetStats(n,h),r.shimSenderReceiverGetStats(n,h),r.fixNegotiationNeeded(n,h),t.shimRTCIceCandidate(n,h),t.shimRTCIceCandidateRelayProtocol(n,h),t.shimConnectionState(n,h),t.shimMaxMessageSize(n,h),t.shimSendThrowTypeError(n,h),t.removeExtmapAllowMixed(n,h);break;case"firefox":if(!i||!i.shimPeerConnection||!o.shimFirefox)return m("Firefox shim is not included in this adapter release."),d;m("adapter.js shimming firefox."),d.browserShim=i,t.shimAddIceCandidateNullOrEmpty(n,h),t.shimParameterlessSetLocalDescription(n,h),i.shimGetUserMedia(n,h),i.shimPeerConnection(n,h),i.shimOnTrack(n,h),i.shimRemoveStream(n,h),i.shimSenderGetStats(n,h),i.shimReceiverGetStats(n,h),i.shimRTCDataChannel(n,h),i.shimAddTransceiver(n,h),i.shimGetParameters(n,h),i.shimCreateOffer(n,h),i.shimCreateAnswer(n,h),t.shimRTCIceCandidate(n,h),t.shimConnectionState(n,h),t.shimMaxMessageSize(n,h),t.shimSendThrowTypeError(n,h);break;case"safari":if(!s||!o.shimSafari)return m("Safari shim is not included in this adapter release."),d;m("adapter.js shimming safari."),d.browserShim=s,t.shimAddIceCandidateNullOrEmpty(n,h),t.shimParameterlessSetLocalDescription(n,h),s.shimRTCIceServerUrls(n,h),s.shimCreateOfferLegacy(n,h),s.shimCallbacksAPI(n,h),s.shimLocalStreamsAPI(n,h),s.shimRemoteStreamsAPI(n,h),s.shimTrackEventTransceiver(n,h),s.shimGetUserMedia(n,h),s.shimAudioContext(n,h),t.shimRTCIceCandidate(n,h),t.shimRTCIceCandidateRelayProtocol(n,h),t.shimMaxMessageSize(n,h),t.shimSendThrowTypeError(n,h),t.removeExtmapAllowMixed(n,h);break;default:m("Unsupported browser!")}return d}
},{"./utils":"RsyN","./chrome/chrome_shim":"RNlo","./firefox/firefox_shim":"vPl0","./safari/safari_shim":"aXmZ","./common_shim":"WlzA","sdp":"jIWI"}],"WzOL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("./adapter_factory.js"),t=(0,e.adapterFactory)({window:"undefined"==typeof window?void 0:window}),d=t;exports.default=d;
},{"./adapter_factory.js":"elb5"}],"Godu":[function(require,module,exports) {
var define;
var i;!function(e,o){"use strict";var a="model",r="name",t="type",n="vendor",s="version",b="mobile",w="tablet",d="smarttv",l=function(i){for(var e={},o=0;o<i.length;o++)e[i[o].toUpperCase()]=i[o];return e},c=function(i,e){return"string"==typeof i&&-1!==u(e).indexOf(u(i))},u=function(i){return i.toLowerCase()},m=function(i,e){if("string"==typeof i)return i=i.replace(/^\s\s*/,""),void 0===e?i:i.substring(0,350)},p=function(i,e){for(var o,a,r,t,n,s,b=0;b<e.length&&!n;){var w=e[b],d=e[b+1];for(o=a=0;o<w.length&&!n&&w[o];)if(n=w[o++].exec(i))for(r=0;r<d.length;r++)s=n[++a],"object"==typeof(t=d[r])&&t.length>0?2===t.length?"function"==typeof t[1]?this[t[0]]=t[1].call(this,s):this[t[0]]=t[1]:3===t.length?"function"!=typeof t[1]||t[1].exec&&t[1].test?this[t[0]]=s?s.replace(t[1],t[2]):void 0:this[t[0]]=s?t[1].call(this,s,t[2]):void 0:4===t.length&&(this[t[0]]=s?t[3].call(this,s.replace(t[1],t[2])):void 0):this[t]=s||void 0;b+=2}},h=function(i,e){for(var o in e)if("object"==typeof e[o]&&e[o].length>0){for(var a=0;a<e[o].length;a++)if(c(e[o][a],i))return"?"===o?void 0:o}else if(c(e[o],i))return"?"===o?void 0:o;return i},v={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},f={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[s,[r,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[s,[r,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[r,s],[/opios[\/ ]+([\w\.]+)/i],[s,[r,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[s,[r,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[r,s],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[s,[r,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[s,[r,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[s,[r,"WeChat"]],[/konqueror\/([\w\.]+)/i],[s,[r,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[s,[r,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[s,[r,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[r,/(.+)/,"$1 Secure Browser"],s],[/\bfocus\/([\w\.]+)/i],[s,[r,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[s,[r,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[s,[r,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[s,[r,"Dolphin"]],[/coast\/([\w\.]+)/i],[s,[r,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[s,[r,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[s,[r,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[r,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[r,/(.+)/,"$1 Browser"],s],[/(comodo_dragon)\/([\w\.]+)/i],[[r,/_/g," "],s],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[r,s],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[r],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[r,"Facebook"],s],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[r,s],[/\bgsa\/([\w\.]+) .*safari\//i],[s,[r,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[s,[r,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[s,[r,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[r,"Chrome WebView"],s],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[s,[r,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[r,s],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[s,[r,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[s,r],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[r,[s,h,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[r,s],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[r,"Netscape"],s],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[s,[r,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[r,s],[/(cobalt)\/([\w\.]+)/i],[r,[s,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",u]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[["architecture","arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/windows (ce|mobile); ppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[["architecture",/ower/,"",u]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[["architecture",u]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a,[n,"Samsung"],[t,w]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[a,[n,"Samsung"],[t,b]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[a,[n,"Apple"],[t,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a,[n,"Apple"],[t,w]],[/(macintosh);/i],[a,[n,"Apple"]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a,[n,"Sharp"],[t,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[a,[n,"Huawei"],[t,w]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a,[n,"Huawei"],[t,b]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[a,/_/g," "],[n,"Xiaomi"],[t,b]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[a,/_/g," "],[n,"Xiaomi"],[t,w]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a,[n,"OPPO"],[t,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a,[n,"Vivo"],[t,b]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[a,[n,"Realme"],[t,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a,[n,"Motorola"],[t,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a,[n,"Motorola"],[t,w]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a,[n,"LG"],[t,w]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[a,[n,"LG"],[t,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[a,[n,"Lenovo"],[t,w]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[a,/_/g," "],[n,"Nokia"],[t,b]],[/(pixel c)\b/i],[a,[n,"Google"],[t,w]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a,[n,"Google"],[t,b]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a,[n,"Sony"],[t,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a,"Xperia Tablet"],[n,"Sony"],[t,w]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a,[n,"OnePlus"],[t,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a,[n,"Amazon"],[t,w]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a,/(.+)/g,"Fire Phone $1"],[n,"Amazon"],[t,b]],[/(playbook);[-\w\),; ]+(rim)/i],[a,n,[t,w]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a,[n,"BlackBerry"],[t,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a,[n,"ASUS"],[t,w]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a,[n,"ASUS"],[t,b]],[/(nexus 9)/i],[a,[n,"HTC"],[t,w]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[n,[a,/_/g," "],[t,b]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a,[n,"Acer"],[t,w]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a,[n,"Meizu"],[t,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[n,a,[t,b]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[n,a,[t,w]],[/(surface duo)/i],[a,[n,"Microsoft"],[t,w]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a,[n,"Fairphone"],[t,b]],[/(u304aa)/i],[a,[n,"AT&T"],[t,b]],[/\bsie-(\w*)/i],[a,[n,"Siemens"],[t,b]],[/\b(rct\w+) b/i],[a,[n,"RCA"],[t,w]],[/\b(venue[\d ]{2,7}) b/i],[a,[n,"Dell"],[t,w]],[/\b(q(?:mv|ta)\w+) b/i],[a,[n,"Verizon"],[t,w]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a,[n,"Barnes & Noble"],[t,w]],[/\b(tm\d{3}\w+) b/i],[a,[n,"NuVision"],[t,w]],[/\b(k88) b/i],[a,[n,"ZTE"],[t,w]],[/\b(nx\d{3}j) b/i],[a,[n,"ZTE"],[t,b]],[/\b(gen\d{3}) b.+49h/i],[a,[n,"Swiss"],[t,b]],[/\b(zur\d{3}) b/i],[a,[n,"Swiss"],[t,w]],[/\b((zeki)?tb.*\b) b/i],[a,[n,"Zeki"],[t,w]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[n,"Dragon Touch"],a,[t,w]],[/\b(ns-?\w{0,9}) b/i],[a,[n,"Insignia"],[t,w]],[/\b((nxa|next)-?\w{0,9}) b/i],[a,[n,"NextBook"],[t,w]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[n,"Voice"],a,[t,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[n,"LvTel"],a,[t,b]],[/\b(ph-1) /i],[a,[n,"Essential"],[t,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a,[n,"Envizen"],[t,w]],[/\b(trio[-\w\. ]+) b/i],[a,[n,"MachSpeed"],[t,w]],[/\btu_(1491) b/i],[a,[n,"Rotor"],[t,w]],[/(shield[\w ]+) b/i],[a,[n,"Nvidia"],[t,w]],[/(sprint) (\w+)/i],[n,a,[t,b]],[/(kin\.[onetw]{3})/i],[[a,/\./g," "],[n,"Microsoft"],[t,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a,[n,"Zebra"],[t,w]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a,[n,"Zebra"],[t,b]],[/smart-tv.+(samsung)/i],[n,[t,d]],[/hbbtv.+maple;(\d+)/i],[[a,/^/,"SmartTV"],[n,"Samsung"],[t,d]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[n,"LG"],[t,d]],[/(apple) ?tv/i],[n,[a,"Apple TV"],[t,d]],[/crkey/i],[[a,"Chromecast"],[n,"Google"],[t,d]],[/droid.+aft(\w)( bui|\))/i],[a,[n,"Amazon"],[t,d]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a,[n,"Sharp"],[t,d]],[/(bravia[\w ]+)( bui|\))/i],[a,[n,"Sony"],[t,d]],[/(mitv-\w{5}) bui/i],[a,[n,"Xiaomi"],[t,d]],[/Hbbtv.*(technisat) (.*);/i],[n,a,[t,d]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[n,m],[a,m],[t,d]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[t,d]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[n,a,[t,"console"]],[/droid.+; (shield) bui/i],[a,[n,"Nvidia"],[t,"console"]],[/(playstation [345portablevi]+)/i],[a,[n,"Sony"],[t,"console"]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a,[n,"Microsoft"],[t,"console"]],[/((pebble))app/i],[n,a,[t,"wearable"]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a,[n,"Apple"],[t,"wearable"]],[/droid.+; (glass) \d/i],[a,[n,"Google"],[t,"wearable"]],[/droid.+; (wt63?0{2,3})\)/i],[a,[n,"Zebra"],[t,"wearable"]],[/(quest( 2| pro)?)/i],[a,[n,"Facebook"],[t,"wearable"]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[n,[t,"embedded"]],[/(aeobc)\b/i],[a,[n,"Amazon"],[t,"embedded"]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[a,[t,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a,[t,w]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[t,w]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[t,b]],[/(android[-\w\. ]{0,9});.+buil/i],[a,[n,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[s,[r,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[s,[r,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[r,s],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[s,r]],os:[[/microsoft (windows) (vista|xp)/i],[r,s],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[r,[s,h,v]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[r,"Windows"],[s,h,v]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[s,/_/g,"."],[r,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[r,"Mac OS"],[s,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[s,r],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[r,s],[/\(bb(10);/i],[s,[r,"BlackBerry"]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[s,[r,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[s,[r,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[s,[r,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[s,[r,"watchOS"]],[/crkey\/([\d\.]+)/i],[s,[r,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[r,"Chromium OS"],s],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[r,s],[/(sunos) ?([\w\.\d]*)/i],[[r,"Solaris"],s],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[r,s]]},g=function(i,o){if("object"==typeof i&&(o=i,i=void 0),!(this instanceof g))return new g(i,o).getResult();var a=void 0!==e&&e.navigator?e.navigator:void 0,r=i||(a&&a.userAgent?a.userAgent:""),t=a&&a.userAgentData?a.userAgentData:void 0,n=o?function(i,e){var o={};for(var a in i)e[a]&&e[a].length%2==0?o[a]=e[a].concat(i[a]):o[a]=i[a];return o}(f,o):f,s=a&&a.userAgent==r;return this.getBrowser=function(){var i,e={};return e.name=void 0,e.version=void 0,p.call(e,r,n.browser),e.major="string"==typeof(i=e.version)?i.replace(/[^\d\.]/g,"").split(".")[0]:void 0,s&&a&&a.brave&&"function"==typeof a.brave.isBrave&&(e.name="Brave"),e},this.getCPU=function(){var i={architecture:void 0};return p.call(i,r,n.cpu),i},this.getDevice=function(){var i={vendor:void 0,model:void 0,type:void 0};return p.call(i,r,n.device),s&&!i.type&&t&&t.mobile&&(i.type=b),s&&"Macintosh"==i.model&&a&&void 0!==a.standalone&&a.maxTouchPoints&&a.maxTouchPoints>2&&(i.model="iPad",i.type=w),i},this.getEngine=function(){var i={name:void 0,version:void 0};return p.call(i,r,n.engine),i},this.getOS=function(){var i={name:void 0,version:void 0};return p.call(i,r,n.os),s&&!i.name&&t&&"Unknown"!=t.platform&&(i.name=t.platform.replace(/chrome os/i,"Chromium OS").replace(/macos/i,"Mac OS")),i},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(i){return r="string"==typeof i&&i.length>350?m(i,350):i,this},this.setUA(r),this};g.VERSION="1.0.35",g.BROWSER=l([r,s,"major"]),g.CPU=l(["architecture"]),g.DEVICE=l([a,n,t,"console",b,d,w,"wearable","embedded"]),g.ENGINE=g.OS=l([r,s]),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=g),exports.UAParser=g):"function"==typeof i&&i.amd?i(function(){return g}):void 0!==e&&(e.UAParser=g);var x=void 0!==e&&(e.jQuery||e.Zepto);if(x&&!x.ua){var k=new g;x.ua=k.getResult(),x.ua.get=function(){return k.getUA()},x.ua.set=function(i){k.setUA(i);var e=k.getResult();for(var o in e)x.ua[o]=e[o]}}}("object"==typeof window?window:this);
},{}],"gKk3":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=o;var t=new Uint8Array(16);function o(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(t)}
},{}],"Wq06":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;exports.default=e;
},{}],"p9l8":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./regex.js"));function t(e){return e&&e.__esModule?e:{default:e}}function r(t){return"string"==typeof t&&e.default.test(t)}var u=r;exports.default=u;
},{"./regex.js":"Wq06"}],"vDjk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./validate.js"));function r(e){return e&&e.__esModule?e:{default:e}}for(var t=[],i=0;i<256;++i)t.push((i+256).toString(16).substr(1));function o(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=(t[r[i+0]]+t[r[i+1]]+t[r[i+2]]+t[r[i+3]]+"-"+t[r[i+4]]+t[r[i+5]]+"-"+t[r[i+6]]+t[r[i+7]]+"-"+t[r[i+8]]+t[r[i+9]]+"-"+t[r[i+10]]+t[r[i+11]]+t[r[i+12]]+t[r[i+13]]+t[r[i+14]]+t[r[i+15]]).toLowerCase();if(!(0,e.default)(o))throw TypeError("Stringified UUID is invalid");return o}var u=o;exports.default=u;
},{"./validate.js":"p9l8"}],"qgnI":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e,r,s=o(require("./rng.js")),n=o(require("./stringify.js"));function o(e){return e&&e.__esModule?e:{default:e}}var u=0,t=0;function a(o,a,l){var d=a&&l||0,i=a||new Array(16),c=(o=o||{}).node||e,v=void 0!==o.clockseq?o.clockseq:r;if(null==c||null==v){var f=o.random||(o.rng||s.default)();null==c&&(c=e=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==v&&(v=r=16383&(f[6]<<8|f[7]))}var q=void 0!==o.msecs?o.msecs:Date.now(),m=void 0!==o.nsecs?o.nsecs:t+1,p=q-u+(m-t)/1e4;if(p<0&&void 0===o.clockseq&&(v=v+1&16383),(p<0||q>u)&&void 0===o.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=q,t=m,r=v;var w=(1e4*(268435455&(q+=122192928e5))+m)%4294967296;i[d++]=w>>>24&255,i[d++]=w>>>16&255,i[d++]=w>>>8&255,i[d++]=255&w;var _=q/4294967296*1e4&268435455;i[d++]=_>>>8&255,i[d++]=255&_,i[d++]=_>>>24&15|16,i[d++]=_>>>16&255,i[d++]=v>>>8|128,i[d++]=255&v;for(var g=0;g<6;++g)i[d+g]=c[g];return a||(0,n.default)(i)}var l=a;exports.default=l;
},{"./rng.js":"gKk3","./stringify.js":"vDjk"}],"rtKa":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./validate.js"));function r(e){return e&&e.__esModule?e:{default:e}}function t(r){if(!(0,e.default)(r))throw TypeError("Invalid UUID");var t,s=new Uint8Array(16);return s[0]=(t=parseInt(r.slice(0,8),16))>>>24,s[1]=t>>>16&255,s[2]=t>>>8&255,s[3]=255&t,s[4]=(t=parseInt(r.slice(9,13),16))>>>8,s[5]=255&t,s[6]=(t=parseInt(r.slice(14,18),16))>>>8,s[7]=255&t,s[8]=(t=parseInt(r.slice(19,23),16))>>>8,s[9]=255&t,s[10]=(t=parseInt(r.slice(24,36),16))/1099511627776&255,s[11]=t/4294967296&255,s[12]=t>>>24&255,s[13]=t>>>16&255,s[14]=t>>>8&255,s[15]=255&t,s}var s=t;exports.default=s;
},{"./validate.js":"p9l8"}],"Y6ie":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.URL=exports.DNS=void 0,exports.default=s;var e=t(require("./stringify.js")),r=t(require("./parse.js"));function t(e){return e&&e.__esModule?e:{default:e}}function n(e){e=unescape(encodeURIComponent(e));for(var r=[],t=0;t<e.length;++t)r.push(e.charCodeAt(t));return r}var a="6ba7b810-9dad-11d1-80b4-00c04fd430c8";exports.DNS=a;var o="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function s(t,s,u){function i(t,a,o,i){if("string"==typeof t&&(t=n(t)),"string"==typeof a&&(a=(0,r.default)(a)),16!==a.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var d=new Uint8Array(16+t.length);if(d.set(a),d.set(t,a.length),(d=u(d))[6]=15&d[6]|s,d[8]=63&d[8]|128,o){i=i||0;for(var f=0;f<16;++f)o[i+f]=d[f];return o}return(0,e.default)(d)}try{i.name=t}catch(d){}return i.DNS=a,i.URL=o,i}exports.URL=o;
},{"./stringify.js":"vDjk","./parse.js":"rtKa"}],"bGV3":[function(require,module,exports) {
"use strict";function n(n){if("string"==typeof n){var t=unescape(encodeURIComponent(n));n=new Uint8Array(t.length);for(var o=0;o<t.length;++o)n[o]=t.charCodeAt(o)}return r(e(u(n),8*n.length))}function r(n){for(var r=[],t=32*n.length,e=0;e<t;e+=8){var u=n[e>>5]>>>e%32&255,o=parseInt("0123456789abcdef".charAt(u>>>4&15)+"0123456789abcdef".charAt(15&u),16);r.push(o)}return r}function t(n){return 14+(n+64>>>9<<4)+1}function e(n,r){n[r>>5]|=128<<r%32,n[t(r)-1]=r;for(var e=1732584193,u=-271733879,f=-1732584194,a=271733878,v=0;v<n.length;v+=16){var s=e,d=u,p=f,g=a;e=c(e,u,f,a,n[v],7,-680876936),a=c(a,e,u,f,n[v+1],12,-389564586),f=c(f,a,e,u,n[v+2],17,606105819),u=c(u,f,a,e,n[v+3],22,-1044525330),e=c(e,u,f,a,n[v+4],7,-176418897),a=c(a,e,u,f,n[v+5],12,1200080426),f=c(f,a,e,u,n[v+6],17,-1473231341),u=c(u,f,a,e,n[v+7],22,-45705983),e=c(e,u,f,a,n[v+8],7,1770035416),a=c(a,e,u,f,n[v+9],12,-1958414417),f=c(f,a,e,u,n[v+10],17,-42063),u=c(u,f,a,e,n[v+11],22,-1990404162),e=c(e,u,f,a,n[v+12],7,1804603682),a=c(a,e,u,f,n[v+13],12,-40341101),f=c(f,a,e,u,n[v+14],17,-1502002290),e=i(e,u=c(u,f,a,e,n[v+15],22,1236535329),f,a,n[v+1],5,-165796510),a=i(a,e,u,f,n[v+6],9,-1069501632),f=i(f,a,e,u,n[v+11],14,643717713),u=i(u,f,a,e,n[v],20,-373897302),e=i(e,u,f,a,n[v+5],5,-701558691),a=i(a,e,u,f,n[v+10],9,38016083),f=i(f,a,e,u,n[v+15],14,-660478335),u=i(u,f,a,e,n[v+4],20,-405537848),e=i(e,u,f,a,n[v+9],5,568446438),a=i(a,e,u,f,n[v+14],9,-1019803690),f=i(f,a,e,u,n[v+3],14,-187363961),u=i(u,f,a,e,n[v+8],20,1163531501),e=i(e,u,f,a,n[v+13],5,-1444681467),a=i(a,e,u,f,n[v+2],9,-51403784),f=i(f,a,e,u,n[v+7],14,1735328473),e=h(e,u=i(u,f,a,e,n[v+12],20,-1926607734),f,a,n[v+5],4,-378558),a=h(a,e,u,f,n[v+8],11,-2022574463),f=h(f,a,e,u,n[v+11],16,1839030562),u=h(u,f,a,e,n[v+14],23,-35309556),e=h(e,u,f,a,n[v+1],4,-1530992060),a=h(a,e,u,f,n[v+4],11,1272893353),f=h(f,a,e,u,n[v+7],16,-155497632),u=h(u,f,a,e,n[v+10],23,-1094730640),e=h(e,u,f,a,n[v+13],4,681279174),a=h(a,e,u,f,n[v],11,-358537222),f=h(f,a,e,u,n[v+3],16,-722521979),u=h(u,f,a,e,n[v+6],23,76029189),e=h(e,u,f,a,n[v+9],4,-640364487),a=h(a,e,u,f,n[v+12],11,-421815835),f=h(f,a,e,u,n[v+15],16,530742520),e=l(e,u=h(u,f,a,e,n[v+2],23,-995338651),f,a,n[v],6,-198630844),a=l(a,e,u,f,n[v+7],10,1126891415),f=l(f,a,e,u,n[v+14],15,-1416354905),u=l(u,f,a,e,n[v+5],21,-57434055),e=l(e,u,f,a,n[v+12],6,1700485571),a=l(a,e,u,f,n[v+3],10,-1894986606),f=l(f,a,e,u,n[v+10],15,-1051523),u=l(u,f,a,e,n[v+1],21,-2054922799),e=l(e,u,f,a,n[v+8],6,1873313359),a=l(a,e,u,f,n[v+15],10,-30611744),f=l(f,a,e,u,n[v+6],15,-1560198380),u=l(u,f,a,e,n[v+13],21,1309151649),e=l(e,u,f,a,n[v+4],6,-145523070),a=l(a,e,u,f,n[v+11],10,-1120210379),f=l(f,a,e,u,n[v+2],15,718787259),u=l(u,f,a,e,n[v+9],21,-343485551),e=o(e,s),u=o(u,d),f=o(f,p),a=o(a,g)}return[e,u,f,a]}function u(n){if(0===n.length)return[];for(var r=8*n.length,e=new Uint32Array(t(r)),u=0;u<r;u+=8)e[u>>5]|=(255&n[u/8])<<u%32;return e}function o(n,r){var t=(65535&n)+(65535&r);return(n>>16)+(r>>16)+(t>>16)<<16|65535&t}function f(n,r){return n<<r|n>>>32-r}function a(n,r,t,e,u,a){return o(f(o(o(r,n),o(e,a)),u),t)}function c(n,r,t,e,u,o,f){return a(r&t|~r&e,n,r,u,o,f)}function i(n,r,t,e,u,o,f){return a(r&e|t&~e,n,r,u,o,f)}function h(n,r,t,e,u,o,f){return a(r^t^e,n,r,u,o,f)}function l(n,r,t,e,u,o,f){return a(t^(r|~e),n,r,u,o,f)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var v=n;exports.default=v;
},{}],"vJdu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./v35.js")),r=t(require("./md5.js"));function t(e){return e&&e.__esModule?e:{default:e}}var u=(0,e.default)("v3",48,r.default),d=u;exports.default=d;
},{"./v35.js":"Y6ie","./md5.js":"bGV3"}],"K7Zs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./rng.js")),r=t(require("./stringify.js"));function t(e){return e&&e.__esModule?e:{default:e}}function u(t,u,n){var a=(t=t||{}).random||(t.rng||e.default)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,u){n=n||0;for(var f=0;f<16;++f)u[n+f]=a[f];return u}return(0,r.default)(a)}var n=u;exports.default=n;
},{"./rng.js":"gKk3","./stringify.js":"vDjk"}],"MvYZ":[function(require,module,exports) {
"use strict";function r(r,e,t,a){switch(r){case 0:return e&t^~e&a;case 1:return e^t^a;case 2:return e&t^e&a^t&a;case 3:return e^t^a}}function e(r,e){return r<<e|r>>>32-e}function t(t){var a=[1518500249,1859775393,2400959708,3395469782],o=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){var n=unescape(encodeURIComponent(t));t=[];for(var s=0;s<n.length;++s)t.push(n.charCodeAt(s))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var f=t.length/4+2,u=Math.ceil(f/16),c=new Array(u),l=0;l<u;++l){for(var i=new Uint32Array(16),v=0;v<16;++v)i[v]=t[64*l+4*v]<<24|t[64*l+4*v+1]<<16|t[64*l+4*v+2]<<8|t[64*l+4*v+3];c[l]=i}c[u-1][14]=8*(t.length-1)/Math.pow(2,32),c[u-1][14]=Math.floor(c[u-1][14]),c[u-1][15]=8*(t.length-1)&4294967295;for(var h=0;h<u;++h){for(var p=new Uint32Array(80),y=0;y<16;++y)p[y]=c[h][y];for(var d=16;d<80;++d)p[d]=e(p[d-3]^p[d-8]^p[d-14]^p[d-16],1);for(var A=o[0],g=o[1],w=o[2],M=o[3],x=o[4],U=0;U<80;++U){var C=Math.floor(U/20),_=e(A,5)+r(C,g,w,M)+x+a[C]+p[U]>>>0;x=M,M=w,w=e(g,30)>>>0,g=A,A=_}o[0]=o[0]+A>>>0,o[1]=o[1]+g>>>0,o[2]=o[2]+w>>>0,o[3]=o[3]+M>>>0,o[4]=o[4]+x>>>0}return[o[0]>>24&255,o[0]>>16&255,o[0]>>8&255,255&o[0],o[1]>>24&255,o[1]>>16&255,o[1]>>8&255,255&o[1],o[2]>>24&255,o[2]>>16&255,o[2]>>8&255,255&o[2],o[3]>>24&255,o[3]>>16&255,o[3]>>8&255,255&o[3],o[4]>>24&255,o[4]>>16&255,o[4]>>8&255,255&o[4]]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var a=t;exports.default=a;
},{}],"K2oB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./v35.js")),r=t(require("./sha1.js"));function t(e){return e&&e.__esModule?e:{default:e}}var u=(0,e.default)("v5",80,r.default),s=u;exports.default=s;
},{"./v35.js":"Y6ie","./sha1.js":"MvYZ"}],"loGb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e="00000000-0000-0000-0000-000000000000";exports.default=e;
},{}],"GRom":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./validate.js"));function r(e){return e&&e.__esModule?e:{default:e}}function t(r){if(!(0,e.default)(r))throw TypeError("Invalid UUID");return parseInt(r.substr(14,1),16)}var u=t;exports.default=u;
},{"./validate.js":"p9l8"}],"UeUD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"NIL",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(exports,"parse",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(exports,"stringify",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(exports,"v1",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(exports,"v3",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(exports,"v4",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(exports,"v5",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(exports,"validate",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(exports,"version",{enumerable:!0,get:function(){return i.default}});var e=a(require("./v1.js")),r=a(require("./v3.js")),t=a(require("./v4.js")),n=a(require("./v5.js")),u=a(require("./nil.js")),i=a(require("./version.js")),o=a(require("./validate.js")),f=a(require("./stringify.js")),s=a(require("./parse.js"));function a(e){return e&&e.__esModule?e:{default:e}}
},{"./v1.js":"qgnI","./v3.js":"vJdu","./v4.js":"K7Zs","./v5.js":"K2oB","./nil.js":"loGb","./version.js":"GRom","./validate.js":"p9l8","./stringify.js":"vDjk","./parse.js":"rtKa"}],"g5IB":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"x3aR":[function(require,module,exports) {
var process = require("process");
var define;
var e,t=require("process");!function(r){var n=Object.hasOwnProperty,i=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},s="object"==typeof t&&"function"==typeof t.nextTick,o="function"==typeof Symbol,l="object"==typeof Reflect,a="function"==typeof setImmediate?setImmediate:setTimeout,f=o?l&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function h(){this._events={},this._conf&&c.call(this,this._conf)}function c(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),e.maxListeners!==r&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function u(e,r){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+r+"."),void 0!==t&&t.emitWarning){var i=new Error(n);i.name="MaxListenersExceededWarning",i.emitter=this,i.count=e,t.emitWarning(i)}else console.error(n),console.trace&&console.trace()}var p=function(e,t,r){var n=arguments.length;switch(n){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,r];default:for(var i=new Array(n);n--;)i[n]=arguments[n];return i}};function v(e,t){for(var n={},i=e.length,s=t?t.length:0,o=0;o<i;o++)n[e[o]]=o<s?t[o]:r;return n}function y(e,t,r){var n,i;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(r.on||r.off)&&(n=r.on,i=r.off),t.addEventListener?(n=t.addEventListener,i=t.removeEventListener):t.addListener?(n=t.addListener,i=t.removeListener):t.on&&(n=t.on,i=t.off),!n&&!i)throw Error("target does not implement any known event API");if("function"!=typeof n)throw TypeError("on method must be a function");if("function"!=typeof i)throw TypeError("off method must be a function");this._on=n,this._off=i;var s=e._observers;s?s.push(this):e._observers=[this]}function _(e,t,i,s){var o=Object.assign({},t);if(!e)return o;if("object"!=typeof e)throw TypeError("options must be an object");var l,a,f,h=Object.keys(e),c=h.length;function u(e){throw Error('Invalid "'+l+'" option value'+(e?". Reason: "+e:""))}for(var p=0;p<c;p++){if(l=h[p],!s&&!n.call(t,l))throw Error('Unknown "'+l+'" option');(a=e[l])!==r&&(f=i[l],o[l]=f?f(a,u):a)}return o}function m(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function d(e){var t="value must be type of "+e.join("|"),r=e.length,n=e[0],i=e[1];return 1===r?function(e,r){if(typeof e===n)return e;r(t)}:2===r?function(e,r){var s=typeof e;if(s===n||s===i)return e;r(t)}:function(n,i){for(var s=typeof n,o=r;o-- >0;)if(s===e[o])return n;i(t)}}Object.assign(y.prototype,{subscribe:function(e,t,r){var n=this,i=this._target,s=this._emitter,o=this._listeners,l=function(){var n=p.apply(null,arguments),o={data:n,name:t,original:e};r?!1!==r.call(i,o)&&s.emit.apply(s,[o.name].concat(n)):s.emit.apply(s,[t].concat(n))};if(o[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,s._newListener&&s._removeListener&&!n._onNewListener?(this._onNewListener=function(r){r===t&&null===o[e]&&(o[e]=l,n._on.call(i,e,l))},s.on("newListener",this._onNewListener),this._onRemoveListener=function(r){r===t&&!s.hasListeners(r)&&o[e]&&(o[e]=null,n._off.call(i,e,l))},o[e]=null,s.on("removeListener",this._onRemoveListener)):(o[e]=l,n._on.call(i,e,l))},unsubscribe:function(e){var t,r,n,i=this,s=this._listeners,o=this._emitter,l=this._off,a=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function h(){i._onNewListener&&(o.off("newListener",i._onNewListener),o.off("removeListener",i._onRemoveListener),i._onNewListener=null,i._onRemoveListener=null);var e=L.call(o,i);o._observers.splice(e,1)}if(e){if(!(t=s[e]))return;l.call(a,e,t),delete s[e],--this._listenersCount||h()}else{for(n=(r=f(s)).length;n-- >0;)e=r[n],l.call(a,e,s[e]);this._listeners={},this._listenersCount=0,h()}}});var b=d(["function"]),w=d(["object","function"]);function g(e,t,r){var n,i,s,o=0,l=new e(function(a,f,h){function c(){i&&(i=null),o&&(clearTimeout(o),o=0)}r=_(r,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),n=!r.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof h;var u=function(e){c(),a(e)},p=function(e){c(),f(e)};n?t(u,p,h):(i=[function(e){p(e||Error("canceled"))}],t(u,p,function(e){if(s)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");i.push(e)}),s=!0),r.timeout>0&&(o=setTimeout(function(){var e=Error("timeout");e.code="ETIMEDOUT",o=0,l.cancel(e),f(e)},r.timeout))});return n||(l.cancel=function(e){if(i){for(var t=i.length,r=1;r<t;r++)i[r](e);i[0](e),i=null}}),l}function L(e){var t=this._observers;if(!t)return-1;for(var r=t.length,n=0;n<r;n++)if(t[n]._target===e)return n;return-1}function E(e,t,r,n,i){if(!r)return null;if(0===n){var s=typeof t;if("string"===s){var o,l,a=0,h=0,c=this.delimiter,u=c.length;if(-1!==(l=t.indexOf(c))){o=new Array(5);do{o[a++]=t.slice(h,l),h=l+u}while(-1!==(l=t.indexOf(c,h)));o[a++]=t.slice(h),t=o,i=a}else t=[t],i=1}else"object"===s?i=t.length:(t=[t],i=1)}var p,v,y,_,m,d,b,w=null,g=t[n],L=t[n+1];if(n===i)r._listeners&&("function"==typeof r._listeners?(e&&e.push(r._listeners),w=[r]):(e&&e.push.apply(e,r._listeners),w=[r]));else{if("*"===g){for(l=(d=f(r)).length;l-- >0;)"_listeners"!==(p=d[l])&&(b=E(e,t,r[p],n+1,i))&&(w?w.push.apply(w,b):w=b);return w}if("**"===g){for((m=n+1===i||n+2===i&&"*"===L)&&r._listeners&&(w=E(e,t,r,i,i)),l=(d=f(r)).length;l-- >0;)"_listeners"!==(p=d[l])&&("*"===p||"**"===p?(r[p]._listeners&&!m&&(b=E(e,t,r[p],i,i))&&(w?w.push.apply(w,b):w=b),b=E(e,t,r[p],n,i)):b=E(e,t,r[p],p===L?n+2:n,i),b&&(w?w.push.apply(w,b):w=b));return w}r[g]&&(w=E(e,t,r[g],n+1,i))}if((v=r["*"])&&E(e,t,v,n+1,i),y=r["**"])if(n<i)for(y._listeners&&E(e,t,y,i,i),l=(d=f(y)).length;l-- >0;)"_listeners"!==(p=d[l])&&(p===L?E(e,t,y[p],n+2,i):p===g?E(e,t,y[p],n+1,i):((_={})[p]=y[p],E(e,t,{"**":_},n+1,i)));else y._listeners?E(e,t,y,i,i):y["*"]&&y["*"]._listeners&&E(e,t,y["*"],i,i);return w}function k(e){for(var t,r,n,i=f(e),s=i.length;s-- >0;)(t=e[r=i[s]])&&(n=!0,"_listeners"===r||k(t)||delete e[r]);return n}function j(e,t,r){this.emitter=e,this.event=t,this.listener=r}function T(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,c.call(this,e)}j.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},T.EventEmitter2=T,T.prototype.listenTo=function(e,t,n){if("object"!=typeof e)throw TypeError("target musts be an object");var s=this;function o(t){if("object"!=typeof t)throw TypeError("events must be an object");var r,i=n.reducers,o=L.call(s,e);r=-1===o?new y(s,e,n):s._observers[o];for(var l,a=f(t),h=a.length,c="function"==typeof i,u=0;u<h;u++)l=a[u],r.subscribe(l,t[l]||l,c?i:i&&i[l])}return n=_(n,{on:r,off:r,reducers:r},{on:b,off:b,reducers:w}),i(t)?o(v(t)):o("string"==typeof t?v(t.split(/\s+/)):t),this},T.prototype.stopListeningTo=function(e,t){var r=this._observers;if(!r)return!1;var n,i=r.length,s=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;i-- >0;)n=r[i],e&&n._target!==e||(n.unsubscribe(t),s=!0);return s},T.prototype.delimiter=".",T.prototype.setMaxListeners=function(e){e!==r&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},T.prototype.getMaxListeners=function(){return this._maxListeners},T.prototype.event="",T.prototype.once=function(e,t,r){return this._once(e,t,!1,r)},T.prototype.prependOnceListener=function(e,t,r){return this._once(e,t,!0,r)},T.prototype._once=function(e,t,r,n){return this._many(e,1,t,r,n)},T.prototype.many=function(e,t,r,n){return this._many(e,t,r,!1,n)},T.prototype.prependMany=function(e,t,r,n){return this._many(e,t,r,!0,n)},T.prototype._many=function(e,t,r,n,i){var s=this;if("function"!=typeof r)throw new Error("many only accepts instances of Function");function o(){return 0==--t&&s.off(e,o),r.apply(this,arguments)}return o._origin=r,this._on(e,o,n,i)},T.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,r,n,i,s,l=arguments[0],a=this.wildcard;if("newListener"===l&&!this._newListener&&!this._events.newListener)return!1;if(a&&(e=l,"newListener"!==l&&"removeListener"!==l&&"object"==typeof l)){if(r=l.length,o)for(n=0;n<r;n++)if("symbol"==typeof l[n]){s=!0;break}s||(l=l.join(this.delimiter))}var f,c=arguments.length;if(this._all&&this._all.length)for(n=0,r=(f=this._all.slice()).length;n<r;n++)switch(this.event=l,c){case 1:f[n].call(this,l);break;case 2:f[n].call(this,l,arguments[1]);break;case 3:f[n].call(this,l,arguments[1],arguments[2]);break;default:f[n].apply(this,arguments)}if(a)f=[],E.call(this,f,e,this.listenerTree,0,r);else{if("function"==typeof(f=this._events[l])){switch(this.event=l,c){case 1:f.call(this);break;case 2:f.call(this,arguments[1]);break;case 3:f.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(c-1),i=1;i<c;i++)t[i-1]=arguments[i];f.apply(this,t)}return!0}f&&(f=f.slice())}if(f&&f.length){if(c>3)for(t=new Array(c-1),i=1;i<c;i++)t[i-1]=arguments[i];for(n=0,r=f.length;n<r;n++)switch(this.event=l,c){case 1:f[n].call(this);break;case 2:f[n].call(this,arguments[1]);break;case 3:f[n].call(this,arguments[1],arguments[2]);break;default:f[n].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===l)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},T.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||h.call(this);var e,t,r,n,i,s,l=arguments[0],a=this.wildcard;if("newListener"===l&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(a&&(e=l,"newListener"!==l&&"removeListener"!==l&&"object"==typeof l)){if(n=l.length,o)for(i=0;i<n;i++)if("symbol"==typeof l[i]){t=!0;break}t||(l=l.join(this.delimiter))}var f,c=[],u=arguments.length;if(this._all)for(i=0,n=this._all.length;i<n;i++)switch(this.event=l,u){case 1:c.push(this._all[i].call(this,l));break;case 2:c.push(this._all[i].call(this,l,arguments[1]));break;case 3:c.push(this._all[i].call(this,l,arguments[1],arguments[2]));break;default:c.push(this._all[i].apply(this,arguments))}if(a?(f=[],E.call(this,f,e,this.listenerTree,0)):f=this._events[l],"function"==typeof f)switch(this.event=l,u){case 1:c.push(f.call(this));break;case 2:c.push(f.call(this,arguments[1]));break;case 3:c.push(f.call(this,arguments[1],arguments[2]));break;default:for(r=new Array(u-1),s=1;s<u;s++)r[s-1]=arguments[s];c.push(f.apply(this,r))}else if(f&&f.length){if(f=f.slice(),u>3)for(r=new Array(u-1),s=1;s<u;s++)r[s-1]=arguments[s];for(i=0,n=f.length;i<n;i++)switch(this.event=l,u){case 1:c.push(f[i].call(this));break;case 2:c.push(f[i].call(this,arguments[1]));break;case 3:c.push(f[i].call(this,arguments[1],arguments[2]));break;default:c.push(f[i].apply(this,r))}}else if(!this.ignoreErrors&&!this._all&&"error"===l)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(c)},T.prototype.on=function(e,t,r){return this._on(e,t,!1,r)},T.prototype.prependListener=function(e,t,r){return this._on(e,t,!0,r)},T.prototype.onAny=function(e){return this._onAny(e,!1)},T.prototype.prependAny=function(e){return this._onAny(e,!0)},T.prototype.addListener=T.prototype.on,T.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},T.prototype._on=function(e,n,i,o){if("function"==typeof e)return this._onAny(e,n),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");this._events||h.call(this);var l,f=this;return o!==r&&(l=function(e,n,i){if(!0===i)l=!0;else if(!1===i)o=!0;else{if(!i||"object"!=typeof i)throw TypeError("options should be an object or true");var o=i.async,l=i.promisify,f=i.nextTick,h=i.objectify}if(o||f||l){var c=n,u=n._origin||n;if(f&&!s)throw Error("process.nextTick is not supported");l===r&&(l="AsyncFunction"===n.constructor.name),(n=function(){var e=arguments,r=this,n=this.event;return l?f?Promise.resolve():new Promise(function(e){a(e)}).then(function(){return r.event=n,c.apply(r,e)}):(f?t.nextTick:a)(function(){r.event=n,c.apply(r,e)})})._async=!0,n._origin=u}return[n,h?new j(this,e,n):this]}.call(this,e,n,o),n=l[0],f=l[1]),this._newListener&&this.emit("newListener",e,n),this.wildcard?(function(e,t,r){var n,i,s=0,o=0,l=this.delimiter,a=l.length;if("string"==typeof e)if(-1!==(n=e.indexOf(l))){i=new Array(5);do{i[s++]=e.slice(o,n),o=n+a}while(-1!==(n=e.indexOf(l,o)));i[s++]=e.slice(o)}else i=[e],s=1;else i=e,s=e.length;if(s>1)for(n=0;n+1<s;n++)if("**"===i[n]&&"**"===i[n+1])return;var f,h=this.listenerTree;for(n=0;n<s;n++)if(h=h[f=i[n]]||(h[f]={}),n===s-1)return h._listeners?("function"==typeof h._listeners&&(h._listeners=[h._listeners]),r?h._listeners.unshift(t):h._listeners.push(t),!h._listeners.warned&&this._maxListeners>0&&h._listeners.length>this._maxListeners&&(h._listeners.warned=!0,u.call(this,h._listeners.length,f))):h._listeners=t,!0;return!0}.call(this,e,n,i),f):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),i?this._events[e].unshift(n):this._events[e].push(n),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,u.call(this,this._events[e].length,e))):this._events[e]=n,f)},T.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var r,n=[];if(this.wildcard){var s="string"==typeof e?e.split(this.delimiter):e.slice();if(!(n=E.call(this,null,s,this.listenerTree,0)))return this}else{if(!this._events[e])return this;r=this._events[e],n.push({_listeners:r})}for(var o=0;o<n.length;o++){var l=n[o];if(r=l._listeners,i(r)){for(var a=-1,f=0,h=r.length;f<h;f++)if(r[f]===t||r[f].listener&&r[f].listener===t||r[f]._origin&&r[f]._origin===t){a=f;break}if(a<0)continue;return this.wildcard?l._listeners.splice(a,1):this._events[e].splice(a,1),0===r.length&&(this.wildcard?delete l._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(r===t||r.listener&&r.listener===t||r._origin&&r._origin===t)&&(this.wildcard?delete l._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&k(this.listenerTree),this},T.prototype.offAny=function(e){var t,r=0,n=0;if(e&&this._all&&this._all.length>0){for(r=0,n=(t=this._all).length;r<n;r++)if(e===t[r])return t.splice(r,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(r=0,n=t.length;r<n;r++)this.emit("removeListenerAny",t[r]);this._all=[]}return this},T.prototype.removeListener=T.prototype.off,T.prototype.removeAllListeners=function(e){if(e===r)return!this._events||h.call(this),this;if(this.wildcard){var t,n=E.call(this,null,e,this.listenerTree,0);if(!n)return this;for(t=0;t<n.length;t++)n[t]._listeners=null;this.listenerTree&&k(this.listenerTree)}else this._events&&(this._events[e]=null);return this},T.prototype.listeners=function(e){var t,n,i,s,o,l=this._events;if(e===r){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!l)return[];for(s=(t=f(l)).length,i=[];s-- >0;)"function"==typeof(n=l[t[s]])?i.push(n):i.push.apply(i,n);return i}if(this.wildcard){if(!(o=this.listenerTree))return[];var a=[],h="string"==typeof e?e.split(this.delimiter):e.slice();return E.call(this,a,h,o,0),a}return l&&(n=l[e])?"function"==typeof n?[n]:n:[]},T.prototype.eventNames=function(e){var t=this._events;return this.wildcard?function e(t,r,n,i){for(var s,o,l,a,h=f(t),c=h.length,u=t._listeners;c-- >0;)s=t[o=h[c]],l="_listeners"===o?n:n?n.concat(o):[o],a=i||"symbol"==typeof o,u&&r.push(a?l:l.join(this.delimiter)),"object"==typeof s&&e.call(this,s,r,l,a);return r}.call(this,this.listenerTree,[],null,e):t?f(t):[]},T.prototype.listenerCount=function(e){return this.listeners(e).length},T.prototype.hasListeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return E.call(this,t,n,this.listenerTree,0),t.length>0}var i=this._events,s=this._all;return!!(s&&s.length||i&&(e===r?f(i).length:i[e]))},T.prototype.listenersAny=function(){return this._all?this._all:[]},T.prototype.waitFor=function(e,t){var n=this,i=typeof t;return"number"===i?t={timeout:t}:"function"===i&&(t={filter:t}),g((t=_(t,{timeout:0,filter:r,handleError:!1,Promise:Promise,overload:!1},{filter:b,Promise:m})).Promise,function(r,i,s){function o(){var s=t.filter;if(!s||s.apply(n,arguments))if(n.off(e,o),t.handleError){var l=arguments[0];l?i(l):r(p.apply(null,arguments).slice(1))}else r(p.apply(null,arguments))}s(function(){n.off(e,o)}),n._on(e,o,!1)},{timeout:t.timeout,overload:t.overload})};var x=T.prototype;if(Object.defineProperties(T,{defaultMaxListeners:{get:function(){return x._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");x._maxListeners=e},enumerable:!0},once:{value:function(e,t,r){return g((r=_(r,{Promise:Promise,timeout:0,overload:!1},{Promise:m})).Promise,function(r,n,i){var s;if("function"==typeof e.addEventListener)return s=function(){r(p.apply(null,arguments))},i(function(){e.removeEventListener(t,s)}),void e.addEventListener(t,s,{once:!0});var o,l=function(){o&&e.removeListener("error",o),r(p.apply(null,arguments))};"error"!==t&&(o=function(r){e.removeListener(t,l),n(r)},e.once("error",o)),i(function(){o&&e.removeListener("error",o),e.removeListener(t,l)}),e.once(t,l)},{timeout:r.timeout,overload:r.overload})},writable:!0,configurable:!0}}),Object.defineProperties(x,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),"function"==typeof e&&e.amd)e(function(){return T});else if("object"==typeof exports)module.exports=T;else{new Function("","return this")().EventEmitter2=T}}();
},{"process":"g5IB"}],"VF80":[function(require,module,exports) {
var e=module.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var r="candidate:%s %d %s %d %s %d typ %s";return r+=null!=e.raddr?" raddr %s rport %d":"%v%v",r+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(r+=" generation %d"),r+=null!=e["network-id"]?" network-id %d":"%v",r+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var r="ssrc:%d";return null!=e.attribute&&(r+=" %s",null!=e.value&&(r+=":%s")),r}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var r="mediaclk:";return r+=null!=e.id?"id=%s %s":"%v%s",r+=null!=e.mediaClockValue?"=%s":"",r+=null!=e.rateNumerator?" rate=%s":"",r+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(e).forEach(function(r){e[r].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})});
},{}],"pJ4u":[function(require,module,exports) {
var r=function(r){return String(Number(r))===r?Number(r):r},t=function(t,e,n,s){if(s&&!n)e[s]=r(t[1]);else for(var a=0;a<n.length;a+=1)null!=t[a+1]&&(e[n[a]]=r(t[a+1]))},e=function(r,e,n){var s=r.name&&r.names;r.push&&!e[r.push]?e[r.push]=[]:s&&!e[r.name]&&(e[r.name]={});var a=r.push?{}:s?e[r.name]:e;t(n.match(r.reg),a,r.names,r.name),r.push&&e[r.push].push(a)},n=require("./grammar"),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);exports.parse=function(r){var t={},a=[],p=t;return r.split(/(\r\n|\r|\n)/).filter(s).forEach(function(r){var t=r[0],s=r.slice(2);"m"===t&&(a.push({rtp:[],fmtp:[]}),p=a[a.length-1]);for(var u=0;u<(n[t]||[]).length;u+=1){var i=n[t][u];if(i.reg.test(s))return e(i,p,s)}}),t.media=a,t};var a=function(t,e){var n=e.split(/=(.+)/,2);return 2===n.length?t[n[0]]=r(n[1]):1===n.length&&e.length>1&&(t[n[0]]=void 0),t};exports.parseParams=function(r){return r.split(/;\s?/).reduce(a,{})},exports.parseFmtpConfig=exports.parseParams,exports.parsePayloads=function(r){return r.toString().split(" ").map(Number)},exports.parseRemoteCandidates=function(t){for(var e=[],n=t.split(" ").map(r),s=0;s<n.length;s+=3)e.push({component:n[s],ip:n[s+1],port:n[s+2]});return e},exports.parseImageAttributes=function(r){return r.split(" ").map(function(r){return r.substring(1,r.length-1).split(",").reduce(a,{})})},exports.parseSimulcastStreamList=function(t){return t.split(";").map(function(t){return t.split(",").map(function(t){var e,n=!1;return"~"!==t[0]?e=r(t):(e=r(t.substring(1,t.length)),n=!0),{scid:e,paused:n}})})};
},{"./grammar":"VF80"}],"dFSN":[function(require,module,exports) {
var n=require("./grammar"),r=/%[sdv%]/g,a=function(n){var a=1,u=arguments,e=u.length;return n.replace(r,function(n){if(a>=e)return n;var r=u[a];switch(a+=1,n){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}})},u=function(n,r,u){var e=[n+"="+(r.format instanceof Function?r.format(r.push?u:u[r.name]):r.format)];if(r.names)for(var o=0;o<r.names.length;o+=1){var s=r.names[o];r.name?e.push(u[r.name][s]):e.push(u[r.names[o]])}else e.push(u[r.name]);return a.apply(null,e)},e=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];module.exports=function(r,a){a=a||{},null==r.version&&(r.version=0),null==r.name&&(r.name=" "),r.media.forEach(function(n){null==n.payloads&&(n.payloads="")});var s=a.outerOrder||e,t=a.innerOrder||o,i=[];return s.forEach(function(a){n[a].forEach(function(n){n.name in r&&null!=r[n.name]?i.push(u(a,n,r)):n.push in r&&null!=r[n.push]&&r[n.push].forEach(function(r){i.push(u(a,n,r))})})}),r.media.forEach(function(r){i.push(u("m",n.m[0],r)),t.forEach(function(a){n[a].forEach(function(n){n.name in r&&null!=r[n.name]?i.push(u(a,n,r)):n.push in r&&null!=r[n.push]&&r[n.push].forEach(function(r){i.push(u(a,n,r))})})})}),i.join("\r\n")+"\r\n"};
},{"./grammar":"VF80"}],"CfIM":[function(require,module,exports) {
var e=require("./parser"),r=require("./writer");exports.write=r,exports.parse=e.parse,exports.parseParams=e.parseParams,exports.parseFmtpConfig=e.parseFmtpConfig,exports.parsePayloads=e.parsePayloads,exports.parseRemoteCandidates=e.parseRemoteCandidates,exports.parseImageAttributes=e.parseImageAttributes,exports.parseSimulcastStreamList=e.parseSimulcastStreamList;
},{"./parser":"pJ4u","./writer":"dFSN"}],"ZYu2":[function(require,module,exports) {
var define;
var process = require("process");
var e,t=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getAnalyticsDeviceId=exports.HMSWebrtcStats=exports.HMSWebrtcInternals=exports.HMSVideoTrack=exports.HMSVideoPluginsManager=exports.HMSVideoPluginType=exports.HMSVideoPluginCanvasContextType=exports.HMSVideoCodec=exports.HMSTrackUpdate=exports.HMSTrackType=exports.HMSTrack=exports.HMSSimulcastLayer=exports.HMSSdk=exports.HMSRoomUpdate=exports.HMSRemoteVideoTrack=exports.HMSRemoteAudioTrack=exports.HMSPluginUnsupportedTypes=exports.HMSPlaylistType=exports.HMSPeerUpdate=exports.HMSLogLevel=exports.HMSLocalVideoTrack=exports.HMSLocalAudioTrack=exports.HMSFacingMode=exports.HMSException=exports.HMSAudioTrack=exports.HMSAudioPluginsManager=exports.HMSAudioPluginType=exports.HMSAudioContextHandler=exports.HMSAudioCodec=exports.ENV=exports.DeviceType=void 0,exports.getLocalDevices=Ot,exports.getLocalScreen=_t,exports.getLocalStream=Rt,exports.simulcastMapping=exports.parsedUserAgent=exports.isSupported=exports.isPageHidden=exports.isNode=exports.isMobile=exports.isIOS=exports.isBrowser=void 0,exports.validateDeviceAV=ai;var n,r,i=d(require("webrtc-adapter")),a=require("ua-parser-js"),s=require("uuid"),o=l(require("eventemitter2")),c=require("sdp-transform");function u(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(u=function(e){return e?n:t})(e)}function l(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var n=u(t);if(n&&n.has(e))return n.get(e);var r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=i?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(r,a,s):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function d(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){return k(e)||f(e,t)||V(e,t)||p()}function p(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,s,o=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(o.push(r.value),o.length!==t);c=!0);}catch(l){u=!0,i=l}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw i}}return o}}function k(e){if(Array.isArray(e))return e}function g(e){return y(e)||T(e)||V(e)||m()}function m(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function y(e){if(Array.isArray(e))return H(e)}function b(){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=E(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(this,arguments)}function E(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=N(e)););return e}function w(){"use strict";w=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(R){c=function(e,t,n){return e[t]=n}}function u(e,t,n,i){var a=t&&t.prototype instanceof v?t:v,s=Object.create(a.prototype),o=new I(i||[]);return r(s,"_invoke",{value:E(e,n,o)}),s}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(R){return{type:"throw",arg:R}}}e.wrap=u;var d={};function v(){}function p(){}function f(){}var k={};c(k,a,function(){return this});var g=Object.getPrototypeOf,m=g&&g(g(C([])));m&&m!==t&&n.call(m,a)&&(k=m);var T=f.prototype=v.prototype=Object.create(k);function y(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function b(e,t){var i;r(this,"_invoke",{value:function(r,a){function s(){return new t(function(i,s){!function r(i,a,s,o){var c=l(e[i],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==h(d)&&n.call(d,"__await")?t.resolve(d.__await).then(function(e){r("next",e,s,o)},function(e){r("throw",e,s,o)}):t.resolve(d).then(function(e){u.value=e,s(u)},function(e){return r("throw",e,s,o)})}o(c.arg)}(r,a,i,s)})}return i=i?i.then(s,s):s()}})}function E(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return P()}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var o=S(s,n);if(o){if(o===d)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function S(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=l(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:P}}function P(){return{value:void 0,done:!0}}return p.prototype=f,r(T,"constructor",{value:f,configurable:!0}),r(f,"constructor",{value:p,configurable:!0}),p.displayName=c(f,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,o,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},y(b.prototype),c(b.prototype,s,function(){return this}),e.AsyncIterator=b,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var s=new b(u(t,n,r,i),a);return e.isGeneratorFunction(n)?s:s.next().then(function(e){return e.done?e.value:s.next()})},y(T),c(T,o,"Generator"),c(T,a,function(){return this}),c(T,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=C,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var o=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(o&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function S(e,t,n){return(t=U(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e){var t="function"==typeof Map?new Map:void 0;return(x=function(e){if(null===e||!I(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return A(e,arguments,N(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),P(n,e)})(e)}function A(e,t,n){return(A=D()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&P(i,n.prototype),i}).apply(null,arguments)}function I(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&P(e,t)}function P(e,t){return(P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function R(e){var t=D();return function(){var n,r=N(e);if(t){var i=N(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _(this,n)}}function _(e,t){if(t&&("object"===h(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return O(e)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,U(r.key),r)}}function G(e,t,n){return t&&L(e.prototype,t),n&&L(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function U(e){var t=F(e,"string");return"symbol"===h(t)?t:String(t)}function F(e,t){if("object"!==h(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function B(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=V(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw a}}}}function V(e,t){if(e){if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,t):void 0}}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var W,j,K=Object.defineProperty,J=Object.defineProperties,q=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,Y=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable,Z=function(e,t,n){return t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},X=function(e,t){for(var n in t||(t={}))Y.call(t,n)&&Z(e,n,t[n]);if(z){var r,i=B(z(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Q.call(t,n)&&Z(e,n,t[n])}}catch(a){i.e(a)}finally{i.f()}}return e},$=function(e,t){return J(e,q(t))},ee=function(e,t){var n={};for(var r in e)Y.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&z){var i,a=B(z(e));try{for(a.s();!(i=a.n()).done;){r=i.value;t.indexOf(r)<0&&Q.call(e,r)&&(n[r]=e[r])}}catch(s){a.e(s)}finally{a.f()}}return n},te=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},ne=function(e,t,n){return new Promise(function(r,i){var a=function(e){try{o(n.next(e))}catch(t){i(t)}},s=function(e){try{o(n.throw(e))}catch(t){i(t)}},o=function(e){return e.done?r(e.value):Promise.resolve(e.value).then(a,s)};o((n=n.apply(e,t)).next())})},re=te(function(e,t){t.exports={name:"@100mslive/hms-video",version:"0.9.2",license:"MIT",main:"dist/index.cjs.js",typings:"dist/index.d.ts",module:"dist/index.js",files:["dist","src"],engines:{node:">=10"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",test:"jest --maxWorkers=1",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",format:"prettier --write src/**/*.ts"},author:"100ms <tech-common@100ms.live>",devDependencies:{"@types/dom-screen-wake-lock":"^1.0.1","@types/sdp-transform":"^2.4.4","@types/ua-parser-js":"^0.7.36","@types/uuid":"^8.3.0","jest-canvas-mock":"^2.3.1",tslib:"^2.2.0"},dependencies:{eventemitter2:"^6.4.7","sdp-transform":"^2.14.1","ua-parser-js":"^1.0.1",uuid:"^8.3.2","webrtc-adapter":"^8.0.0"},gitHead:"4e000fbf8980a6815e2b0c50e0b287472ee22fd5"}}),ie=function(){function e(t){M(this,e),this.key=t,this.storage=null}return G(e,[{key:"getStorage",value:function(){return oe&&!this.storage&&(ke(),this.storage=window.localStorage),this.storage}},{key:"get",value:function(){var e,t=null==(e=this.getStorage())?void 0:e.getItem(this.key);return t?JSON.parse(t):void 0}},{key:"set",value:function(e){var t,n=JSON.stringify(e);null==(t=this.getStorage())||t.setItem(this.key,n)}},{key:"clear",value:function(){var e;null==(e=this.getStorage())||e.removeItem(this.key)}}]),e}(),ae=new a.UAParser,se="undefined"==typeof window&&!(null==(W=ae.getBrowser().name)?void 0:W.toLowerCase().includes("electron")),oe="undefined"!=typeof window;exports.ENV=j,exports.isBrowser=oe,exports.isNode=se,exports.parsedUserAgent=ae,function(e){e.PROD="prod",e.QA="qa",e.DEV="dev"}(j||(exports.ENV=j={}));var ce=function(){return!se},ue=ce(),le=function(){return"mobile"===ae.getDevice().type},de=function(){var e,t=new ie("hms-analytics-deviceId"),n=t.get();return n?e=n:(e=(0,s.v4)(),t.set(e)),e},he=function(){return"undefined"!=typeof document&&document.hidden},ve=function(){var e;return"ios"===(null==(e=ae.getOS().name)?void 0:e.toLowerCase())};exports.isIOS=ve,exports.isPageHidden=he,exports.getAnalyticsDeviceId=de,exports.isMobile=le,exports.isSupported=ue;var pe,fe=function(){function e(){M(this,e),this.valuesMap=new Map}return G(e,[{key:"getItem",value:function(e){return this.valuesMap.has(e)?String(this.valuesMap.get(e)):null}},{key:"setItem",value:function(e,t){this.valuesMap.set(e,t)}},{key:"removeItem",value:function(e){this.valuesMap.delete(e)}},{key:"clear",value:function(){this.valuesMap.clear()}},{key:"key",value:function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.");return Array.from(this.valuesMap.keys())[e]}},{key:"length",get:function(){return this.valuesMap.size}}]),e}(),ke=function(){oe&&!localStorage&&(window.localStorage=new fe)};exports.HMSLogLevel=pe,function(e){e[e.VERBOSE=0]="VERBOSE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.TIME=4]="TIME",e[e.TIMEEND=5]="TIMEEND",e[e.ERROR=6]="ERROR",e[e.NONE=7]="NONE"}(pe||(exports.HMSLogLevel=pe={}));var ge="undefined"!=typeof window&&void 0!==window.expect,me=function(){function e(){M(this,e)}return G(e,null,[{key:"v",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[0,e].concat(n))}},{key:"d",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[1,e].concat(n))}},{key:"i",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[2,e].concat(n))}},{key:"w",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[3,e].concat(n))}},{key:"e",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.log.apply(this,[6,e].concat(n))}},{key:"time",value:function(e){this.log(4,"[HMSPerformanceTiming]",e)}},{key:"timeEnd",value:function(e){this.log(5,"[HMSPerformanceTiming]",e,e)}},{key:"cleanUp",value:function(){performance.clearMarks(),performance.clearMeasures()}},{key:"log",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(!(this.level.valueOf()>e.valueOf()))switch(e){case 0:var a;(a=console).log.apply(a,[t].concat(r));break;case 1:var s;(s=console).debug.apply(s,[t].concat(r));break;case 2:var o;(o=console).info.apply(o,[t].concat(r));break;case 3:var c;(c=console).warn.apply(c,[t].concat(r));break;case 6:var u;(u=console).error.apply(u,[t].concat(r));break;case 4:performance.mark(r[0]);break;case 5:var l=r[0];try{var d=performance.measure(l,l);this.log(1,t,l,null==d?void 0:d.duration),performance.clearMarks(l),performance.clearMeasures(l)}catch(d){this.log(1,t,l,d)}}}}]),e}();me.level=ge?7:0;var Te=function(){function e(t){var n=t.sender,r=t.message,i=t.type,a=void 0===i?"chat":i,s=t.recipientPeer,o=t.recipientRoles,c=t.time;M(this,e),this.sender=n,this.message=r,this.type=a,this.recipientPeer=s,this.recipientRoles=o,this.time=c}return G(e,[{key:"toSignalParams",value:function(){var e,t,n=null==(e=this.recipientRoles)?void 0:e.map(function(e){return e.name}),r=null==(t=this.recipientPeer)?void 0:t.peerId,i={info:{message:this.message,type:this.type}};return(null==n?void 0:n.length)&&(i.roles=n),r&&(i.peer_id=r),i}},{key:"toString",value:function(){var e;return"{\n      sender: ".concat(this.sender,";\n      recipientPeer: ").concat(this.recipientPeer,";\n      recipientRoles: ").concat(null==(e=this.recipientRoles)?void 0:e.map(function(e){return e.name}),";\n      message: ").concat(this.message,";\n      time: ").concat(this.time,";\n      type: ").concat(this.type,";\n    }")}}]),e}(),ye=function(){function e(t,n){M(this,e),this.id=t,this.store=n,this.recording={server:{running:!1},browser:{running:!1},hls:{running:!1}},this.rtmp={running:!1},this.hls={running:!1,variants:[]}}return G(e,[{key:"localPeer",get:function(){return this.store.getLocalPeer()}},{key:"peers",get:function(){return this.store.getPeers()}}]),e}(),be=function(){function e(t){var n=t.peerId,r=t.name,i=t.isLocal,a=t.customerUserId,s=t.metadata,o=t.role,c=t.joinedAt;M(this,e),this.customerUserId="",this.metadata="",this.auxiliaryTracks=[],this.name=r,this.peerId=n,this.isLocal=i,this.customerUserId=a,this.metadata=s,this.joinedAt=c,o&&(this.role=o)}return G(e,[{key:"updateRole",value:function(e){this.role=e}},{key:"updateName",value:function(e){this.name=e}},{key:"updateMetadata",value:function(e){this.metadata=e}},{key:"toString",value:function(){var e,t,n;return"{\n      name: ".concat(this.name,";\n      role: ").concat(null==(e=this.role)?void 0:e.name,";\n      peerId: ").concat(this.peerId,";\n      customerUserId: ").concat(this.customerUserId,";\n      ").concat(this.audioTrack?"audioTrack: ".concat(null==(t=this.audioTrack)?void 0:t.trackId,";"):"","\n      ").concat(this.videoTrack?"videoTrack: ".concat(null==(n=this.videoTrack)?void 0:n.trackId,";"):"","\n    }")}}]),e}(),Ee=G(function e(){M(this,e)});Ee.makePeerId=function(){return(0,s.v4)()};var we,Se=function(e){C(n,be);var t=R(n);function n(e){var r;return M(this,n),(r=t.call(this,$(X({},e),{peerId:Ee.makePeerId(),isLocal:!0}))).isLocal=!0,r.auxiliaryTracks=[],r.asRole=e.asRole,r}return G(n,[{key:"isInPreview",value:function(){return!!this.asRole}},{key:"toString",value:function(){var e,t,n;return"{\n      name: ".concat(this.name,";\n      role: ").concat(null==(e=this.role)?void 0:e.name,";\n      peerId: ").concat(this.peerId,";\n      customerUserId: ").concat(this.customerUserId,";\n      ").concat(this.asRole?"asRole: ".concat(this.asRole.name,";"):"","\n      ").concat(this.audioTrack?"audioTrack: ".concat(null==(t=this.audioTrack)?void 0:t.trackId,";"):"","\n      ").concat(this.videoTrack?"videoTrack: ".concat(null==(n=this.videoTrack)?void 0:n.trackId,";"):"","\n    }")}}]),n}(),xe=function(e){C(n,be);var t=R(n);function n(e){var r;return M(this,n),(r=t.call(this,$(X({},e),{isLocal:!1}))).isLocal=!1,r.auxiliaryTracks=[],r.fromRoomState=!1,r.fromRoomState=!!e.fromRoomState,r}return G(n)}();function Ae(){if(oe&&window){var e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?we.LOCAL:e.includes("app.100ms.live")?we.HMS:we.CUSTOM}return we.CUSTOM}!function(e){e.CUSTOM="CUSTOM",e.LOCAL="LOCAL",e.HMS="HMS"}(we||(we={}));var Ie=Ae(),Ce=re().version;function Pe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j.PROD,n=arguments.length>1?arguments[1]:void 0,r=Ie!==we.LOCAL&&e===j.PROD?"prod":"debug";if(se)return De({os:"web_nodejs",os_version:t.version,sdk:"web",sdk_version:Ce,env:r,domain:Ie,framework:"node",framework_version:t.version,framework_sdk_version:null==n?void 0:n.sdkVersion});var i=ae.getOS(),a=ae.getDevice(),s=ae.getBrowser(),o=Re("web_".concat(i.name)),c=i.version||"",u=Re("".concat(s.name,"_").concat(s.version)),l=u;return a.type&&(l="".concat(Re("".concat(a.vendor,"_").concat(a.type)),"/").concat(u)),De({os:o,os_version:c,sdk:"web",sdk_version:Ce,device_model:l,env:r,domain:Ie,framework:null==n?void 0:n.type,framework_version:null==n?void 0:n.version,framework_sdk_version:null==n?void 0:n.sdkVersion})}function Re(e){return e.replace(/ /g,"_")}var _e,Oe,De=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",";return Object.keys(e).filter(function(t){return!!e[t]}).map(function(t){return"".concat(t,":").concat(e[t])}).join(t)},Ne=function(){function e(t){var n=t.name,r=t.level,i=t.properties,a=t.includesPII,o=t.timestamp;M(this,e),this.metadata={peer:{},userAgent:Pe()},this.name=n,this.level=r,this.includesPII=a||!1,this.properties=i||{},this.timestamp=o||(new Date).getTime(),this.event_id=(0,s.v4)(),this.device_id=de()}return G(e,[{key:"toSignalParams",value:function(){return{name:this.name,info:$(X({},this.properties),{timestamp:this.timestamp,domain:Ie}),timestamp:(new Date).getTime()}}}]),e}();!function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"}(_e||(_e={})),function(e){e[e.VERBOSE=0]="VERBOSE",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.OFF=3]="OFF"}(Oe||(Oe={}));var Me=function(e){C(n,x(Error));var t=R(n);function n(e,r,i,a,s){var o,c=arguments.length>5&&void 0!==arguments[5]&&arguments[5];return M(this,n),(o=t.call(this,a)).code=e,o.name=r,o.message=a,o.description=s,o.isTerminal=c,Object.setPrototypeOf(O(o),n.prototype),o.action=i.toString(),o}return G(n,[{key:"toAnalyticsProperties",value:function(){return{error_name:this.name,error_code:this.code,error_message:this.message,error_description:this.description,action:this.action,is_terminal:this.isTerminal}}},{key:"addNativeError",value:function(e){this.nativeError=e}},{key:"toString",value:function(){var e;return"{\n      code: ".concat(this.code,";\n      name: ").concat(this.name,";\n      action: ").concat(this.action,";\n      message: ").concat(this.message,";\n      description: ").concat(this.description,";\n      isTerminal: ").concat(this.isTerminal,";\n      nativeError: ").concat(null==(e=this.nativeError)?void 0:e.message,";\n    }")}}]),n}();exports.HMSException=Me;var Le,Ge=function(){function e(){M(this,e)}return G(e,null,[{key:"connect",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Date,a=arguments.length>4?arguments[4]:void 0,s=this.eventNameFor("connect",void 0===e),o=e?Oe.ERROR:Oe.INFO,c=this.getPropertiesWithError($(X({},t),(S(n={},this.KEY_REQUESTED_AT,null==r?void 0:r.getTime()),S(n,this.KEY_RESPONDED_AT,null==i?void 0:i.getTime()),S(n,"endpoint",a),n)),e);return new Ne({name:s,level:o,properties:c})}},{key:"disconnect",value:function(e,t){var n=e?Oe.ERROR:Oe.INFO,r=this.getPropertiesWithError(t,e);return new Ne({name:"disconnected",level:n,properties:r})}},{key:"preview",value:function(e){var t=e,n=t.error,r=ee(t,["error"]),i=this.eventNameFor("preview",void 0===n),a=n?Oe.ERROR:Oe.INFO,s=this.getPropertiesWithError(r,n);return new Ne({name:i,level:a,properties:s})}},{key:"join",value:function(e){var t=e,n=t.error,r=ee(t,["error"]),i=this.eventNameFor("join",void 0===n),a=n?Oe.ERROR:Oe.INFO,s=this.getPropertiesWithError($(X({},r),{is_preview_called:!!r.is_preview_called}),n);return new Ne({name:i,level:a,properties:s})}},{key:"publish",value:function(e){var t=e.devices,n=e.settings,r=e.error,i=this.eventNameFor("publish",void 0===r),a=r?Oe.ERROR:Oe.INFO,s=this.getPropertiesWithError({devices:t,audio:null==n?void 0:n.audio,video:null==n?void 0:n.video},r);return new Ne({name:i,level:a,properties:s})}},{key:"hlsPlayerError",value:function(e){return new Ne({name:"hlsPlayerError",level:Oe.ERROR,properties:this.getErrorProperties(e)})}},{key:"subscribeFail",value:function(e){var t=this.eventNameFor("subscribe",!1),n=Oe.ERROR,r=this.getErrorProperties(e);return new Ne({name:t,level:n,properties:r})}},{key:"leave",value:function(){return new Ne({name:"leave",level:Oe.INFO})}},{key:"autoplayError",value:function(){return new Ne({name:"autoplayError",level:Oe.ERROR})}},{key:"audioPlaybackError",value:function(e){return new Ne({name:"audioPlaybackError",level:Oe.ERROR,properties:this.getErrorProperties(e)})}},{key:"deviceChange",value:function(e){var t=e.selection,n=e.type,r=e.devices,i=e.error,a=this.eventNameFor(i?"publish":"device.".concat(n),void 0===i),s=i?Oe.ERROR:Oe.INFO,o=this.getPropertiesWithError({selection:t,devices:r},i);return new Ne({name:a,level:s,properties:o})}},{key:"performance",value:function(e){var t=Oe.INFO,n=e.toAnalyticsProperties();return new Ne({name:"perf.stats",level:t,properties:n})}},{key:"rtcStats",value:function(e){var t=Oe.INFO,n=e.toAnalyticsProperties();return new Ne({name:"rtc.stats",level:t,properties:n})}},{key:"degradationStats",value:function(e,t){var n=Oe.INFO,r={degradedAt:e.degradedAt,trackId:e.trackId};if(!t&&e.degradedAt instanceof Date){var i=new Date,a=i.valueOf()-e.degradedAt.valueOf();r=$(X({},r),{duration:a,restoredAt:i})}return new Ne({name:"video.degradation.stats",level:n,properties:r})}},{key:"audioDetectionFail",value:function(e,t){var n=this.getPropertiesWithError({device:t},e),r=Oe.ERROR;return new Ne({name:"audiopresence.failed",level:r,properties:n})}},{key:"previewNetworkQuality",value:function(e){return new Ne({name:"perf.networkquality.preview",level:e.error?Oe.ERROR:Oe.INFO,properties:e})}},{key:"eventNameFor",value:function(e,t){return"".concat(e,".").concat(t?"success":"failed")}},{key:"getPropertiesWithError",value:function(e,t){var n=this.getErrorProperties(t);return e=X(X({},n),e)}},{key:"getErrorProperties",value:function(e){return e?e instanceof Me?e.toAnalyticsProperties():{error_name:e.name,error_message:e.message,error_description:e.cause}:{}}}]),e}();Ge.KEY_REQUESTED_AT="requested_at",Ge.KEY_RESPONDED_AT="responded_at",function(e){e.INIT="init_response_time",e.WEBSOCKET_CONNECT="ws_connect_time",e.ON_POLICY_CHANGE="on_policy_change_time",e.LOCAL_AUDIO_TRACK="local_audio_track_time",e.LOCAL_VIDEO_TRACK="local_video_track_time",e.JOIN="join_time",e.PREVIEW="preview_time",e.PEER_LIST="peer_list_time",e.ROOM_STATE="room_state_time",e.JOIN_RESPONSE="join_response_time",e.GET_TOKEN="GET_TOKEN"}(Le||(Le={}));var Ue,Fe,Be=[Le.INIT,Le.WEBSOCKET_CONNECT,Le.ON_POLICY_CHANGE,Le.LOCAL_AUDIO_TRACK,Le.LOCAL_VIDEO_TRACK,Le.PEER_LIST,Le.ROOM_STATE,Le.JOIN_RESPONSE],Ve=function(){function e(){M(this,e),this.eventPerformanceMeasures={}}return G(e,[{key:"start",value:function(e){performance.mark(e)}},{key:"end",value:function(e){var t;try{this.eventPerformanceMeasures[e]=performance.measure(e,e),me.d("[HMSPerformanceTiming]",e,null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration)}catch(n){me.w("[AnalyticsTimer]","Error in measuring performance for event ".concat(e),{error:n})}}},{key:"getTimeTaken",value:function(e){var t;return null==(t=this.eventPerformanceMeasures[e])?void 0:t.duration}},{key:"getTimes",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return[].concat(Be,n).reduce(function(t,n){return $(X({},t),S({},n,e.getTimeTaken(n)))},{})}},{key:"cleanUp",value:function(){this.eventPerformanceMeasures={}}}]),e}(),He={WebSocketConnectionErrors:{FAILED_TO_CONNECT:1e3,WEBSOCKET_CONNECTION_LOST:1003,ABNORMAL_CLOSE:1006},APIErrors:{SERVER_ERRORS:2e3,INIT_CONFIG_NOT_AVAILABLE:2002,ENDPOINT_UNREACHABLE:2003,INVALID_TOKEN_FORMAT:2004},TracksErrors:{GENERIC_TRACK:3e3,CANT_ACCESS_CAPTURE_DEVICE:3001,DEVICE_NOT_AVAILABLE:3002,DEVICE_IN_USE:3003,DEVICE_LOST_MIDWAY:3008,NOTHING_TO_RETURN:3005,INVALID_VIDEO_SETTINGS:3006,CODEC_CHANGE_NOT_PERMITTED:3007,AUTOPLAY_ERROR:3008,OVER_CONSTRAINED:3009,NO_AUDIO_DETECTED:3010,SYSTEM_DENIED_PERMISSION:3011,CURRENT_TAB_NOT_SHARED:3012,AUDIO_PLAYBACK_ERROR:3013},WebrtcErrors:{CREATE_OFFER_FAILED:4001,CREATE_ANSWER_FAILED:4002,SET_LOCAL_DESCRIPTION_FAILED:4003,SET_REMOTE_DESCRIPTION_FAILED:4004,ICE_FAILURE:4005,ICE_DISCONNECTED:4006},WebsocketMethodErrors:{SERVER_ERRORS:5e3,ALREADY_JOINED:5001,CANNOT_JOIN_PREVIEW_IN_PROGRESS:5002},GenericErrors:{NOT_CONNECTED:6e3,SIGNALLING:6001,UNKNOWN:6002,NOT_READY:6003,JSON_PARSING_FAILED:6004,TRACK_METADATA_MISSING:6005,RTC_TRACK_MISSING:6006,PEER_METADATA_MISSING:6007,INVALID_ROLE:6008,PREVIEW_IN_PROGRESS:6009,MISSING_MEDIADEVICES:6010,MISSING_RTCPEERCONNECTION:6011},PlaylistErrors:{NO_ENTRY_TO_PLAY:8001,NO_ENTRY_IS_PLAYING:8002}};function We(e){switch(e){case Ue.JOIN:return Fe.JOIN;case Ue.OFFER:return Fe.PUBLISH;case Ue.ANSWER:return Fe.SUBSCRIBE;case Ue.TRACK_UPDATE:return Fe.TRACK;default:return Fe.NONE}}!function(e){e.JOIN="join",e.OFFER="offer",e.ANSWER="answer",e.TRICKLE="trickle",e.TRACK_UPDATE="track-update",e.BROADCAST="broadcast",e.ANALYTICS="analytics",e.SERVER_ERROR="on-error",e.SERVER_WARNING="on-warning",e.SDK_NOTIFICATION="sdk-notification",e.LEAVE="leave",e.END_ROOM="end-room",e.PING="ping",e.ROLE_CHANGE_REQUEST="role-change-request",e.ROLE_CHANGE="role-change",e.TRACK_UPDATE_REQUEST="track-update-request",e.PEER_LEAVE_REQUEST="peer-leave-request",e.CHANGE_TRACK_MUTE_STATE_REQUEST="change-track-mute-state-request",e.START_RTMP_OR_RECORDING_REQUEST="rtmp-start",e.STOP_RTMP_AND_RECORDING_REQUEST="rtmp-stop",e.UPDATE_PEER_METADATA="peer-update",e.START_HLS_STREAMING="hls-start",e.STOP_HLS_STREAMING="hls-stop",e.HLS_TIMED_METADATA="hls-timed-metadata",e.SET_METADATA="set-metadata",e.GET_METADATA="get-metadata",e.LISTEN_METADATA_CHANGE="listen-metadata-change"}(Ue||(Ue={})),function(e){e.NONE="NONE",e.TRACK="TRACK",e.INIT="INIT",e.GET_TOKEN="GET_TOKEN",e.PUBLISH="PUBLISH",e.UNPUBLISH="UNPUBLISH",e.JOIN="JOIN",e.SUBSCRIBE="SUBSCRIBE",e.DATA_CHANNEL_SEND="DATA_CHANNEL_SEND",e.RESTART_ICE="RESTART_ICE",e.VIDEO_PLUGINS="VIDEO_PLUGINS",e.AUDIO_PLUGINS="AUDIO_PLUGINS",e.AUTOPLAY="AUTOPLAY",e.RECONNECT_SIGNAL="RECONNECT_SIGNAL",e.VALIDATION="VALIDATION",e.PLAYLIST="PLAYLIST",e.PREVIEW="PREVIEW"}(Fe||(Fe={}));var je,Ke,Je,qe,ze,Ye=[Ue.JOIN,Ue.OFFER,Ue.ANSWER,Ue.TRICKLE,Fe.JOIN],Qe={WebSocketConnectionErrors:{FailedToConnect:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.WebSocketConnectionErrors.FAILED_TO_CONNECT,"WebsocketFailedToConnect",e,"[WS]: ".concat(t),"[WS]: ".concat(t))},WebSocketConnectionLost:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,"WebSocketConnectionLost",e,"Network connection lost ",t)},AbnormalClose:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.WebSocketConnectionErrors.ABNORMAL_CLOSE,"WebSocketAbnormalClose",e,"Websocket closed abnormally",t)}},APIErrors:{ServerErrors:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new Me(e,"ServerErrors",t,"[".concat(t,"]: Server error ").concat(n),n,r)},EndpointUnreachable:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.APIErrors.ENDPOINT_UNREACHABLE,"EndpointUnreachable",e,"Endpoint is not reachable - ".concat(t),t)},InvalidTokenFormat:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.APIErrors.INVALID_TOKEN_FORMAT,"InvalidTokenFormat",e,"Token is not in proper JWT format - ".concat(t),t,!0)},InitConfigNotAvailable:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.APIErrors.INIT_CONFIG_NOT_AVAILABLE,"InitError",e,"[INIT]: ".concat(t),"[INIT]: ".concat(t))}},TracksErrors:{GenericTrack:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.TracksErrors.GENERIC_TRACK,"GenericTrack",e,"[TRACK]: ".concat(t),"[TRACK]: ".concat(t))},CantAccessCaptureDevice:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Me(He.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,"CantAccessCaptureDevice",e,"User denied permission to access capture device - ".concat(t),n)},DeviceNotAvailable:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Me(He.TracksErrors.DEVICE_NOT_AVAILABLE,"DeviceNotAvailable",e,"[TRACK]: Capture device is no longer available - ".concat(t),n)},DeviceInUse:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Me(He.TracksErrors.DEVICE_IN_USE,"DeviceInUse",e,"[TRACK]: Capture device is in use by another application - ".concat(t),n)},DeviceLostMidway:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Me(He.TracksErrors.DEVICE_LOST_MIDWAY,"DeviceLostMidway",e,"Lost access to capture device midway - ".concat(t),n)},NothingToReturn:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"There is no media to return. Please select either video or audio or both.";return new Me(He.TracksErrors.NOTHING_TO_RETURN,"NothingToReturn",e,n,t)},InvalidVideoSettings:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.TracksErrors.INVALID_VIDEO_SETTINGS,"InvalidVideoSettings",e,"Cannot enable simulcast when no video settings are provided",t)},AutoplayBlocked:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.TracksErrors.AUTOPLAY_ERROR,"AutoplayBlocked",e,"Autoplay blocked because the user didn't interact with the document first",t)},CodecChangeNotPermitted:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.TracksErrors.CODEC_CHANGE_NOT_PERMITTED,"CodecChangeNotPermitted",e,"Codec can't be changed mid call.",t)},OverConstrained:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Me(He.TracksErrors.OVER_CONSTRAINED,"OverConstrained",e,"[TRACK]: Requested constraints cannot be satisfied with the device hardware - ".concat(t),n)},NoAudioDetected:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Please check the mic or use another audio input";return new Me(He.TracksErrors.NO_AUDIO_DETECTED,"NoAudioDetected",e,"No audio input detected from microphone",t)},SystemDeniedPermission:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Me(He.TracksErrors.SYSTEM_DENIED_PERMISSION,"SystemDeniedPermission",e,"Operating System denied permission to access capture device - ".concat(t),n)},CurrentTabNotShared:function(){return new Me(He.TracksErrors.CURRENT_TAB_NOT_SHARED,"CurrentTabNotShared",Fe.TRACK,"The app requires you to share the current tab","You must screen share the current tab in order to proceed")},AudioPlaybackError:function(e){return new Me(He.TracksErrors.AUDIO_PLAYBACK_ERROR,"Audio playback error",Fe.TRACK,e,e)}},WebrtcErrors:{CreateOfferFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.WebrtcErrors.CREATE_OFFER_FAILED,"CreateOfferFailed",e,"[".concat(e.toString(),"]: Failed to create offer. "),t)},CreateAnswerFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.WebrtcErrors.CREATE_ANSWER_FAILED,"CreateAnswerFailed",e,"[".concat(e.toString(),"]: Failed to create answer. "),t)},SetLocalDescriptionFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.WebrtcErrors.SET_LOCAL_DESCRIPTION_FAILED,"SetLocalDescriptionFailed",e,"[".concat(e.toString(),"]: Failed to set offer. "),t)},SetRemoteDescriptionFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.WebrtcErrors.SET_REMOTE_DESCRIPTION_FAILED,"SetRemoteDescriptionFailed",e,"[".concat(e.toString(),"]: Failed to set answer. "),t,!0)},ICEFailure:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.WebrtcErrors.ICE_FAILURE,"ICEFailure",e,"[".concat(e.toString(),"]: Ice connection state FAILED"),t)},ICEDisconnected:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.WebrtcErrors.ICE_DISCONNECTED,"ICEDisconnected",e,"[".concat(e.toString(),"]: Ice connection state DISCONNECTED"),t)}},WebsocketMethodErrors:{ServerErrors:function(e,t,n){return new Me(e,"ServerErrors",t,n,n,Ye.includes(t))},AlreadyJoined:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.WebsocketMethodErrors.ALREADY_JOINED,"AlreadyJoined",e,"[JOIN]: You have already joined this room.",t)},CannotJoinPreviewInProgress:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.WebsocketMethodErrors.CANNOT_JOIN_PREVIEW_IN_PROGRESS,"CannotJoinPreviewInProgress",e,"[JOIN]: Cannot join if preview is in progress",t)}},GenericErrors:{NotConnected:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.GenericErrors.NOT_CONNECTED,"NotConnected",e,"Client is not connected",t)},Signalling:function(e,t){return new Me(He.GenericErrors.SIGNALLING,"Signalling",e,"Unknown signalling error: ".concat(e.toString()," ").concat(t," "),t)},Unknown:function(e,t){return new Me(He.GenericErrors.UNKNOWN,"Unknown",e,"Unknown exception: ".concat(t),t)},NotReady:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.GenericErrors.NOT_READY,"NotReady",e,t,t)},JsonParsingFailed:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Me(He.GenericErrors.JSON_PARSING_FAILED,"JsonParsingFailed",e,"Failed to parse JSON message - ".concat(t),n)},TrackMetadataMissing:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.GenericErrors.TRACK_METADATA_MISSING,"TrackMetadataMissing",e,"Track Metadata Missing",t)},RTCTrackMissing:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.GenericErrors.RTC_TRACK_MISSING,"RTCTrackMissing",e,"RTC Track missing",t)},PeerMetadataMissing:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.GenericErrors.PEER_METADATA_MISSING,"PeerMetadataMissing",e,"Peer Metadata Missing",t)},ValidationFailed:function(e,t){return new Me(He.GenericErrors.INVALID_ROLE,"ValidationFailed",Fe.VALIDATION,e,t?JSON.stringify(t):"")},InvalidRole:function(e,t){return new Me(He.GenericErrors.INVALID_ROLE,"InvalidRole",e,"Invalid role. Join with valid role",t,!0)},PreviewAlreadyInProgress:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(He.GenericErrors.PREVIEW_IN_PROGRESS,"PreviewAlreadyInProgress",e,"[Preview]: Cannot join if preview is in progress",t)},MissingMediaDevices:function(){return new Me(He.GenericErrors.MISSING_MEDIADEVICES,"MissingMediaDevices",Fe.JOIN,"navigator.mediaDevices is undefined. 100ms SDK won't work on this website as WebRTC is not supported on HTTP endpoints(missing navigator.mediaDevices). Please ensure you're using the SDK either on localhost or a valid HTTPS endpoint.","",!0)},MissingRTCPeerConnection:function(){return new Me(He.GenericErrors.MISSING_RTCPEERCONNECTION,"MissingRTCPeerConnection",Fe.JOIN,"RTCPeerConnection which is a core requirement for WebRTC call was not found, this could be due to an unsupported browser or browser extensions blocking WebRTC","",!0)}},MediaPluginErrors:{PlatformNotSupported:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(7001,"PlatformNotSupported",e,"Check HMS Docs to see the list of supported platforms",t)},InitFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(7002,"InitFailed",e,"Plugin init failed",t)},ProcessingFailed:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(7003,"ProcessingFailed",e,"Plugin processing failed",t)},AddAlreadyInProgress:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(7004,"AddAlreadyInProgress",e,"Plugin add already in progress",t)},DeviceNotSupported:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Me(7005,"DeviceNotSupported",e,"Check HMS Docs to see the list of supported devices",t)}},PlaylistErrors:{NoEntryToPlay:function(e,t){return new Me(He.PlaylistErrors.NO_ENTRY_TO_PLAY,"NoEntryToPlay",e,"Reached end of playlist",t)},NoEntryPlaying:function(e,t){return new Me(He.PlaylistErrors.NO_ENTRY_IS_PLAYING,"NoEntryIsPlaying",e,"No entry is playing at this time",t)}}};function Ze(e,t){var n=e.toLowerCase();return n.includes("device not found")?Qe.TracksErrors.DeviceNotAvailable(Fe.TRACK,t,e):n.includes("permission denied")?Qe.TracksErrors.CantAccessCaptureDevice(Fe.TRACK,t,e):Qe.TracksErrors.GenericTrack(Fe.TRACK,e)}function Xe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if("chrome"===i.default.browserDetails.browser&&"NotAllowedError"===e.name&&e.message.includes("denied by system"))return Qe.TracksErrors.SystemDeniedPermission(Fe.TRACK,t,e.message);if("firefox"===i.default.browserDetails.browser&&"NotFoundError"===e.name){var n=Qe.TracksErrors.SystemDeniedPermission(Fe.TRACK,t,e.message);return n.description="Capture device is either blocked at Operating System level or not available - ".concat(t),n}switch(e.name){case"OverconstrainedError":return Qe.TracksErrors.OverConstrained(Fe.TRACK,t,e.constraint);case"NotAllowedError":return Qe.TracksErrors.CantAccessCaptureDevice(Fe.TRACK,t,e.message);case"NotFoundError":return Qe.TracksErrors.DeviceNotAvailable(Fe.TRACK,t,e.message);case"NotReadableError":return Qe.TracksErrors.DeviceInUse(Fe.TRACK,t,e.message);case"TypeError":return Qe.TracksErrors.NothingToReturn(Fe.TRACK,e.message);default:return Ze(e.message,t)}}function $e(e,t){var n=Xe(e,t);return n.addNativeError(e),n}!function(e){e.UNKNOWN="unknown(video or audio)",e.AUDIO="audio",e.VIDEO="video",e.AV="audio, video",e.SCREEN="screen"}(je||(je={})),exports.HMSRoomUpdate=Ke,function(e){e.RECORDING_STATE_UPDATED="RECORDING_STATE_UPDATED",e.BROWSER_RECORDING_STATE_UPDATED="BROWSER_RECORDING_STATE_UPDATED",e.SERVER_RECORDING_STATE_UPDATED="SERVER_RECORDING_STATE_UPDATED",e.RTMP_STREAMING_STATE_UPDATED="RTMP_STREAMING_STATE_UPDATED",e.HLS_STREAMING_STATE_UPDATED="HLS_STREAMING_STATE_UPDATED"}(Ke||(exports.HMSRoomUpdate=Ke={})),exports.HMSPeerUpdate=Je,function(e){e[e.PEER_JOINED=0]="PEER_JOINED",e[e.PEER_LEFT=1]="PEER_LEFT",e[e.AUDIO_TOGGLED=2]="AUDIO_TOGGLED",e[e.VIDEO_TOGGLED=3]="VIDEO_TOGGLED",e[e.BECAME_DOMINANT_SPEAKER=4]="BECAME_DOMINANT_SPEAKER",e[e.RESIGNED_DOMINANT_SPEAKER=5]="RESIGNED_DOMINANT_SPEAKER",e[e.STARTED_SPEAKING=6]="STARTED_SPEAKING",e[e.STOPPED_SPEAKING=7]="STOPPED_SPEAKING",e[e.ROLE_UPDATED=8]="ROLE_UPDATED",e[e.PEER_LIST=9]="PEER_LIST",e[e.NAME_UPDATED=10]="NAME_UPDATED",e[e.METADATA_UPDATED=11]="METADATA_UPDATED"}(Je||(exports.HMSPeerUpdate=Je={})),exports.HMSTrackUpdate=qe,function(e){e[e.TRACK_ADDED=0]="TRACK_ADDED",e[e.TRACK_REMOVED=1]="TRACK_REMOVED",e[e.TRACK_MUTED=2]="TRACK_MUTED",e[e.TRACK_UNMUTED=3]="TRACK_UNMUTED",e[e.TRACK_DESCRIPTION_CHANGED=4]="TRACK_DESCRIPTION_CHANGED",e[e.TRACK_DEGRADED=5]="TRACK_DEGRADED",e[e.TRACK_RESTORED=6]="TRACK_RESTORED"}(qe||(exports.HMSTrackUpdate=qe={})),exports.HMSSimulcastLayer=ze,function(e){e.NONE="none",e.LOW="low",e.MEDIUM="medium",e.HIGH="high"}(ze||(exports.HMSSimulcastLayer=ze={}));var et,tt,nt,rt,it,at={f:ze.HIGH,h:ze.MEDIUM,q:ze.LOW};exports.simulcastMapping=at,exports.HMSVideoCodec=et,function(e){e.VP8="vp8",e.VP9="vp9",e.H264="h264"}(et||(exports.HMSVideoCodec=et={})),exports.HMSAudioCodec=tt,(tt||(exports.HMSAudioCodec=tt={})).OPUS="opus",exports.HMSFacingMode=nt,function(e){e.USER="user",e.ENVIRONMENT="environment",e.LEFT="left",e.RIGHT="right"}(nt||(exports.HMSFacingMode=nt={})),exports.DeviceType=rt,function(e){e.videoInput="videoInput",e.audioInput="audioInput",e.audioOutput="audioOutput"}(rt||(exports.DeviceType=rt={})),exports.HMSPlaylistType=it,function(e){e.audio="audio",e.video="video"}(it||(exports.HMSPlaylistType=it={}));var st,ot=function(){function e(){M(this,e),this._volume=1,this._codec=tt.OPUS,this._maxBitrate=32,this._deviceId="default",this._advanced=[{googEchoCancellation:{exact:!0}},{googExperimentalEchoCancellation:{exact:!0}},{autoGainControl:{exact:!0}},{noiseSuppression:{exact:!0}},{googHighpassFilter:{exact:!0}},{googAudioMirroring:{exact:!0}}]}return G(e,[{key:"volume",value:function(e){if(!(0<=e&&e<=1))throw Error("volume can only be in range [0.0, 1.0]");return this._volume=e,this}},{key:"codec",value:function(e){return this._codec=e,this}},{key:"maxBitrate",value:function(e){if(e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,this}},{key:"deviceId",value:function(e){return this._deviceId=e,this}},{key:"advanced",value:function(e){return this._advanced=e,this}},{key:"build",value:function(){return new ct(this._volume,this._codec,this._maxBitrate,this._deviceId,this._advanced)}}]),e}(),ct=function(){function e(t,n,r,i,a){M(this,e),this.volume=t,this.codec=n,this.maxBitrate=r,this.deviceId=i,this.advanced=a}return G(e,[{key:"toConstraints",value:function(){return{deviceId:this.deviceId,advanced:this.advanced}}},{key:"toAnalyticsProperties",value:function(){return{audio_bitrate:this.maxBitrate,audio_codec:this.codec}}}]),e}(),ut=function(){function e(){M(this,e),this._width=320,this._height=180,this._codec=et.VP8,this._maxFramerate=30,this._maxBitrate=150,this._advanced=[]}return G(e,[{key:"setWidth",value:function(e){return this._width=e,this}},{key:"setHeight",value:function(e){return this._height=e,this}},{key:"codec",value:function(e){return this._codec=e,this}},{key:"maxFramerate",value:function(e){if(e&&e<=0)throw Error("maxFramerate should be >= 1");return this._maxFramerate=e,this}},{key:"maxBitrate",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("number"==typeof e&&e<=0)throw Error("maxBitrate should be >= 1");return this._maxBitrate=e,!this._maxBitrate&&t&&(this._maxBitrate=15e4),this}},{key:"deviceId",value:function(e){return this._deviceId=e,this}},{key:"advanced",value:function(e){return this._advanced=e,this}},{key:"facingMode",value:function(e){return this._facingMode=e,this}},{key:"build",value:function(){return new lt(this._width,this._height,this._codec,this._maxFramerate,this._deviceId,this._advanced,this._maxBitrate,this._facingMode)}}]),e}(),lt=function(){function e(t,n,r,i,a,s,o,c){M(this,e),this.width=t,this.height=n,this.codec=r,this.maxFramerate=i,this.maxBitrate=o,this.deviceId=a,this.advanced=s,this.facingMode=c}return G(e,[{key:"toConstraints",value:function(e){var t="ideal";return e&&(t="max"),{width:S({},t,this.width),height:S({},t,this.height),frameRate:this.maxFramerate,deviceId:this.deviceId,facingMode:this.facingMode}}},{key:"toAnalyticsProperties",value:function(){return{width:this.width,height:this.height,video_bitrate:this.maxBitrate,framerate:this.maxFramerate,video_codec:this.codec,facingMode:this.facingMode}}}]),e}(),dt=function(){function e(){M(this,e),this._video=(new ut).build(),this._audio=(new ot).build(),this._screen=(new ut).build(),this._simulcast=!1}return G(e,[{key:"video",value:function(e){return this._video=e,this}},{key:"audio",value:function(e){return this._audio=e,this}},{key:"screen",value:function(e){return this._screen=e,this}},{key:"simulcast",value:function(e){return this._simulcast=e,this}},{key:"build",value:function(){if(null===this._audio&&null===this._video)throw Qe.TracksErrors.NothingToReturn(Fe.TRACK);if(null===this._video&&this._simulcast)throw Qe.TracksErrors.InvalidVideoSettings(Fe.TRACK,"Cannot enable simulcast when no video settings are provided");return new ht(this._video,this._audio,this._simulcast,this._screen||void 0)}}]),e}(),ht=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;M(this,e),this.video=t,this.audio=n,this.simulcast=r,this.screen=i}return G(e,[{key:"toAnalyticsProperties",value:function(){var e={audio_enabled:null!==this.audio,video_enabled:null!==this.video};return this.audio&&(e=X(X({},this.audio.toAnalyticsProperties()),e)),this.video&&(e=X(X({},this.video.toAnalyticsProperties()),e)),e}}]),e}(),vt=G(function e(t){M(this,e),this.tracks=new Array,this.nativeStream=t,this.id=t.id}),pt=function(e){return e?"{\n    trackId: ".concat(e.id,";\n    kind: ").concat(e.kind,";\n    enabled: ").concat(e.enabled,";\n    muted: ").concat(e.muted,";\n    readyState: ").concat(e.readyState,";\n  }"):""},ft=function(){function e(t,n,r){M(this,e),this.logIdentifier="",this.stream=t,this.nativeTrack=n,this.source=r}return G(e,[{key:"enabled",get:function(){return this.nativeTrack.enabled}},{key:"trackId",get:function(){return this.firstTrackId||this.sdpTrackId||this.nativeTrack.id}},{key:"getMediaTrackSettings",value:function(){return this.nativeTrack.getSettings()}},{key:"setEnabled",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.nativeTrack.enabled=e;case 1:case"end":return t.stop()}},t,this)}))}},{key:"setSdpTrackId",value:function(e){this.sdpTrackId=e}},{key:"setFirstTrackId",value:function(e){this.firstTrackId=e}},{key:"cleanup",value:function(){var e;me.d("[HMSTrack]","Stopping track",this.toString()),null==(e=this.nativeTrack)||e.stop()}},{key:"toString",value:function(){var e;return"{\n      streamId: ".concat(this.stream.id,";\n      peerId: ").concat(this.peerId,";\n      trackId: ").concat(this.trackId,";\n      mid: ").concat((null==(e=this.transceiver)?void 0:e.mid)||"-",";\n      logIdentifier: ").concat(this.logIdentifier,";\n      source: ").concat(this.source,";\n      enabled: ").concat(this.enabled,";\n      nativeTrack: ").concat(pt(this.nativeTrack),";\n    }")}}]),e}();exports.HMSTrack=ft,exports.HMSTrackType=st,function(e){e.AUDIO="audio",e.VIDEO="video"}(st||(exports.HMSTrackType=st={}));var kt=function(e){C(n,vt);var t=R(n);function n(e,r){var i;return M(this,n),(i=t.call(this,e)).audio=!0,i.video=ze.NONE,i.connection=r,i}return G(n,[{key:"setAudio",value:function(e,t,n){return ne(this,null,w().mark(function r(){return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=this.audio!==e,!r.t0){r.next=6;break}return this.audio=e,me.d("[Remote stream] ".concat(n||""," \n    streamId=").concat(this.id,"\n    trackId=").concat(t,"\n    subscribing audio - ").concat(this.audio)),r.next=6,this.connection.sendOverApiDataChannelWithResponse({params:{subscribed:this.audio,track_id:t},method:"prefer-audio-track-state"});case 6:case"end":return r.stop()}},r,this)}))}},{key:"setVideoLayerLocally",value:function(e,t,n){this.video=e,me.d("[Remote stream] ".concat(t,"\n    streamId=").concat(this.id,"\n    source: ").concat(n,"\n    Setting layer field to=").concat(e))}},{key:"setVideoLayer",value:function(e,t,n,r){return me.d("[Remote stream] ".concat(n," \n      streamId=").concat(this.id,"\n      trackId=").concat(t," \n      source: ").concat(r," request ").concat(e," layer")),this.setVideoLayerLocally(e,n,r),this.connection.sendOverApiDataChannelWithResponse({params:{max_spatial_layer:this.video,track_id:t},method:"prefer-video-track-state"})}},{key:"getSimulcastLayer",value:function(){return this.video}},{key:"getVideoLayer",value:function(){return this.video}},{key:"isAudioSubscribed",value:function(){return this.audio}}]),n}(),gt=function(e){C(n,ft);var t=R(n);function n(e,r,i){var a;if(M(this,n),(a=t.call(this,e,r,i)).type=st.AUDIO,a.audioElement=null,"audio"!==r.kind)throw new Error("Expected 'track' kind = 'audio'");return a}return G(n,[{key:"getVolume",value:function(){return this.audioElement?100*this.audioElement.volume:null}},{key:"setVolume",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e<0||e>100)){t.next=2;break}throw Error("Please pass a valid number between 0-100");case 2:return t.next=4,this.subscribeToAudio(0!==e&&this.enabled);case 4:this.audioElement&&(this.audioElement.volume=e/100);case 5:case"end":return t.stop()}},t,this)}))}},{key:"setAudioElement",value:function(e){me.d("[HMSAudioTrack]",this.logIdentifier,"adding audio element","".concat(this),e),this.audioElement=e}},{key:"getAudioElement",value:function(){return this.audioElement}},{key:"getOutputDevice",value:function(){return this.outputDevice}},{key:"cleanup",value:function(){b(N(n.prototype),"cleanup",this).call(this),this.audioElement&&(this.audioElement.srcObject=null,this.audioElement.remove(),this.audioElement=null)}},{key:"setOutputDevice",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return me.d("[HMSAudioTrack]",this.logIdentifier,"device is null","".concat(this)),t.abrupt("return");case 3:if(this.audioElement){t.next=6;break}return me.d("[HMSAudioTrack]",this.logIdentifier,"no audio element to set output","".concat(this)),this.outputDevice=e,t.abrupt("return");case 6:if(t.prev=6,t.t0="function"==typeof this.audioElement.setSinkId,!t.t0){t.next=12;break}return t.next=11,null==(n=this.audioElement)?void 0:n.setSinkId(e.deviceId);case 11:this.outputDevice=e;case 12:t.next=17;break;case 14:t.prev=14,t.t1=t.catch(6),me.d("[HMSAudioTrack]","error in setSinkId",t.t1);case 17:case"end":return t.stop()}},t,this,[[6,14]])}))}},{key:"subscribeToAudio",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.stream instanceof kt,!t.t0){t.next=4;break}return t.next=4,this.stream.setAudio(e,this.trackId,this.logIdentifier);case 4:case"end":return t.stop()}},t,this)}))}}]),n}();exports.HMSAudioTrack=gt;var mt,Tt,yt=function(){function e(){M(this,e),this.storage=new ie("hms-device-selection"),this.remember=!1,this.TAG="[HMSDeviceStorage]"}return G(e,[{key:"setDevices",value:function(e){this.devices=e}},{key:"rememberDevices",value:function(e){this.remember=e}},{key:"updateSelection",value:function(e,t){var n=this,r=t.deviceId,i=t.groupId;if(this.devices&&this.remember){var a=this.devices[e].find(function(e){return n.isSame({deviceId:r,groupId:i},e)});if(a){var s=this.storage.get()||{};s[e]=a,this.storage.set(s)}else me.w(this.TAG,"Could not find device with deviceId: ".concat(r,", groupId: ").concat(i))}}},{key:"getSelection",value:function(){if(this.remember)return this.storage.get()}},{key:"cleanup",value:function(){this.remember=!1,this.devices=void 0}},{key:"isSame",value:function(e,t){return e.deviceId===t.deviceId&&(e.groupId===t.groupId||!e.groupId)}}]),e}(),bt=new yt;exports.HMSAudioPluginType=mt,function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"}(mt||(exports.HMSAudioPluginType=mt={})),exports.HMSPluginUnsupportedTypes=Tt,function(e){e.PLATFORM_NOT_SUPPORTED="PLATFORM_NOT_SUPPORTED",e.DEVICE_NOT_SUPPORTED="DEVICE_NOT_SUPPORTED"}(Tt||(exports.HMSPluginUnsupportedTypes=Tt={}));var Et=function(){function e(){M(this,e)}return G(e,null,[{key:"failure",value:function(e,t){var n=Oe.ERROR,r=X({plugin_name:e},t.toAnalyticsProperties());return new Ne({name:"mediaPlugin.failed",level:n,properties:r})}},{key:"audioPluginFailure",value:function(e,t,n){var r=Oe.ERROR,i=X({plugin_name:e,sampleRate:t},n.toAnalyticsProperties());return new Ne({name:"mediaPlugin.failed",level:r,properties:i})}},{key:"audioPluginStats",value:function(e){var t=e.pluginName,n=e.duration,r=e.loadTime,i=e.sampleRate,a=Oe.INFO;return new Ne({name:"mediaPlugin.stats",level:a,properties:{plugin_name:t,duration:n,load_time:r,sampleRate:i}})}},{key:"stats",value:function(e){var t=e.pluginName,n=e.duration,r=e.loadTime,i=e.avgPreProcessingTime,a=e.avgProcessingTime,s=e.inputFrameRate,o=e.pluginFrameRate,c=Oe.INFO;return new Ne({name:"mediaPlugin.stats",level:c,properties:{plugin_name:t,duration:n,load_time:r,avg_preprocessing_time:i,avg_processing_time:a,input_frame_rate:s,plugin_frame_rate:o}})}}]),e}(),wt=function(){function e(t){M(this,e),this.eventBus=t,this.TAG="[AudioPluginsAnalytics]",this.initTime={},this.addedTimestamps={},this.pluginAdded={},this.pluginSampleRate={}}return G(e,[{key:"added",value:function(e,t){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.pluginSampleRate[e]=t}},{key:"removed",value:function(e){if(this.pluginAdded[e]){var t={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],sampleRate:this.pluginSampleRate[e]};this.eventBus.analytics.publish(Et.audioPluginStats(t)),this.clean(e)}}},{key:"failure",value:function(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(Et.audioPluginFailure(e,this.pluginSampleRate[e],t)),this.clean(e))}},{key:"initWithTime",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.initTime[e]){n.next=3;break}return me.i(this.TAG,"Plugin Already loaded ".concat(e,", time it took: ").concat(this.initTime[e])),n.abrupt("return");case 3:return n.prev=3,n.next=6,this.timeInMs(t);case 6:r=n.sent,me.i(this.TAG,"Time taken for Plugin ".concat(e," initialization : ").concat(r)),n.next=14;break;case 10:throw n.prev=10,n.t0=n.catch(3),i=Qe.MediaPluginErrors.InitFailed(Fe.AUDIO_PLUGINS,"failed during initialization of plugin".concat(n.t0.message||n.t0)),me.e(this.TAG,i),this.failure(e,i),i;case 14:r&&(this.initTime[e]=r);case 15:case"end":return n.stop()}},n,this,[[3,10]])}))}},{key:"timeInMs",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e();case 3:return t.abrupt("return",Math.floor(Date.now()-n));case 4:case"end":return t.stop()}},t)}))}},{key:"clean",value:function(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.pluginAdded[e],delete this.pluginSampleRate[e]}}]),e}(),St=48e3,xt=function(){return-1!==navigator.userAgent.indexOf("Firefox")},At=function(){function e(t,n){M(this,e),this.TAG="[AudioPluginsManager]",this.pluginAddInProgress=!1,this.hmsTrack=t,this.pluginsMap=new Map,this.analytics=new wt(n),this.createAudioContext()}return G(e,[{key:"getPlugins",value:function(){return Array.from(this.pluginsMap.keys())}},{key:"addPlugin",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null==(n=e.getName)?void 0:n.call(e)){t.next=4;break}return me.w("no name provided by the plugin"),t.abrupt("return");case 4:if(!this.pluginAddInProgress){t.next=7;break}throw i=Qe.MediaPluginErrors.AddAlreadyInProgress(Fe.AUDIO_PLUGINS,"Add Plugin is already in Progress"),this.analytics.added(r,this.audioContext.sampleRate),this.analytics.failure(r,i),me.w("can't add another plugin when previous add is in progress"),i;case 7:return this.pluginAddInProgress=!0,t.prev=8,t.next=11,this.addPluginInternal(e);case 11:return t.prev=11,this.pluginAddInProgress=!1,t.finish(11);case 14:case"end":return t.stop()}},t,this,[[8,,11,14]])}))}},{key:"addPluginInternal",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null==(n=e.getName)?void 0:n.call(e),!this.pluginsMap.get(r)){t.next=4;break}return me.w(this.TAG,"plugin - ".concat(r," already added.")),t.abrupt("return");case 4:return t.next=6,this.validateAndThrow(r,e);case 6:if(t.prev=6,0!==this.pluginsMap.size){t.next=12;break}return t.next=10,this.initAudioNodes();case 10:t.next=13;break;case 12:this.prevAudioNode&&this.prevAudioNode.disconnect();case 13:return this.analytics.added(r,this.audioContext.sampleRate),t.next=16,this.analytics.initWithTime(r,function(){return ne(i,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.init());case 1:case"end":return t.stop()}},t)}))});case 16:return this.pluginsMap.set(r,e),t.next=19,this.processPlugin(e);case 19:return t.next=21,this.connectToDestination();case 21:t.next=26;break;case 23:throw t.prev=23,t.t0=t.catch(6),me.e(this.TAG,"failed to add plugin",t.t0),t.t0;case 26:case"end":return t.stop()}},t,this,[[6,23]])}))}},{key:"validatePlugin",value:function(e){return e.checkSupport(this.audioContext)}},{key:"validateAndThrow",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(r=this.validatePlugin(t)).isSupported){n.next=5;break}me.i(this.TAG,"plugin is supported,- ".concat(t.getName())),n.next=19;break;case 5:if(this.analytics.added(e,this.audioContext.sampleRate),r.errType!==Tt.PLATFORM_NOT_SUPPORTED){n.next=13;break}return i=Qe.MediaPluginErrors.PlatformNotSupported(Fe.AUDIO_PLUGINS,"platform not supported, see docs"),this.analytics.failure(e,i),n.next=10,this.cleanup();case 10:throw i;case 13:if(r.errType!==Tt.DEVICE_NOT_SUPPORTED){n.next=19;break}return a=Qe.MediaPluginErrors.DeviceNotSupported(Fe.AUDIO_PLUGINS,"audio device not supported, see docs"),this.analytics.failure(e,a),n.next=18,this.cleanup();case 18:throw a;case 19:case"end":return n.stop()}},n,this)}))}},{key:"removePlugin",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.removePluginInternal(e);case 2:if(0!==this.pluginsMap.size){t.next=10;break}return t.next=5,this.cleanup();case 5:return me.i(this.TAG,"No plugins left, stopping plugins loop"),t.next=8,this.hmsTrack.setProcessedTrack(void 0);case 8:t.next=12;break;case 10:return t.next=12,this.reprocessPlugins();case 12:case"end":return t.stop()}},t,this)}))}},{key:"cleanup",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i,a,s;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=B(this.pluginsMap.values()),e.prev=1,i.s();case 3:if((a=i.n()).done){e.next=9;break}return s=a.value,e.next=7,this.removePluginInternal(s);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),i.e(e.t0);case 14:return e.prev=14,i.f(),e.finish(14);case 17:return e.next=19,this.hmsTrack.setProcessedTrack(void 0);case 19:null==(t=this.sourceNode)||t.disconnect(),null==(n=this.prevAudioNode)||n.disconnect(),null==(r=this.outputTrack)||r.stop(),this.sourceNode=void 0,this.destinationNode=void 0,this.prevAudioNode=void 0,this.outputTrack=void 0;case 26:case"end":return e.stop()}},e,this,[[1,11,14,17]])}))}},{key:"closeContext",value:function(){return ne(this,null,w().mark(function e(){var t;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:null==(t=this.audioContext)||t.close(),this.audioContext=void 0;case 1:case"end":return e.stop()}},e,this)}))}},{key:"reprocessPlugins",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.pluginsMap.size&&this.sourceNode){e.next=2;break}return e.abrupt("return");case 2:return t=Array.from(this.pluginsMap.values()),e.next=5,this.cleanup();case 5:return e.next=7,this.initAudioNodes();case 7:n=0,r=t;case 8:if(!(n<r.length)){e.next=15;break}return i=r[n],e.next=12,this.addPlugin(i);case 12:n++,e.next=8;break;case 15:case"end":return e.stop()}},e,this)}))}},{key:"initAudioNodes",value:function(){return ne(this,null,w().mark(function e(){var t;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.audioContext){e.next=12;break}if(this.sourceNode||(t=new MediaStream([this.hmsTrack.nativeTrack]),this.sourceNode=this.audioContext.createMediaStreamSource(t)),this.destinationNode){e.next=12;break}return this.destinationNode=this.audioContext.createMediaStreamDestination(),this.outputTrack=this.destinationNode.stream.getAudioTracks()[0],e.prev=4,e.next=7,this.hmsTrack.setProcessedTrack(this.outputTrack);case 7:e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(4),me.e(this.TAG,"error in setting processed track",e.t0),e.t0;case 12:case"end":return e.stop()}},e,this,[[4,9]])}))}},{key:"processPlugin",value:function(e){return ne(this,null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.processAudioTrack(this.audioContext,this.prevAudioNode||this.sourceNode);case 3:n=t.sent,this.prevAudioNode&&this.prevAudioNode.connect(n),this.prevAudioNode=n,t.next=13;break;case 7:return t.prev=7,t.t0=t.catch(0),r=e.getName(),me.e(this.TAG,"error in processing plugin ".concat(r),t.t0),t.next=13,this.removePluginInternal(e);case 13:case"end":return t.stop()}},t,this,[[0,7]])}))}},{key:"connectToDestination",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{this.prevAudioNode&&this.destinationNode&&this.prevAudioNode.context===this.destinationNode.context&&this.prevAudioNode.connect(this.destinationNode)}catch(t){me.e(this.TAG,"error in connecting to destination node",t)}case 1:case"end":return e.stop()}},e,this)}))}},{key:"removePluginInternal",value:function(e){return ne(this,null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null==(n=e.getName)?void 0:n.call(e),this.pluginsMap.get(r)){t.next=4;break}return me.w(this.TAG,"plugin - ".concat(r," not found to remove.")),t.abrupt("return");case 4:me.i(this.TAG,"removing plugin ".concat(r)),this.pluginsMap.delete(r),e.stop(),this.analytics.removed(r);case 5:case"end":return t.stop()}},t,this)}))}},{key:"createAudioContext",value:function(){this.audioContext||(xt()?this.audioContext=new AudioContext:this.audioContext=new AudioContext({sampleRate:St}))}}]),e}();function It(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({audio:!!e&&e.toConstraints()});case 3:return t.abrupt("return",t.sent.getAudioTracks()[0]);case 6:throw t.prev=6,t.t0=t.catch(0),$e(t.t0,je.AUDIO);case 9:case"end":return t.stop()}},t,null,[[0,6]])}))}function Ct(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({video:!!e&&e.toConstraints()});case 3:return t.abrupt("return",t.sent.getVideoTracks()[0]);case 6:throw t.prev=6,t.t0=t.catch(0),$e(t.t0,je.VIDEO);case 9:case"end":return t.stop()}},t,null,[[0,6]])}))}function Pt(e){return"canvas"in e||"MediaStreamAudioDestinationNode"===e.label||""===e.label}function Rt(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia(e);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),$e(t.t0,je.AV);case 9:case"end":return t.stop()}},t,null,[[0,6]])}))}function _t(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getDisplayMedia({video:e,audio:!1});case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),$e(t.t0,je.SCREEN);case 9:case"end":return t.stop()}},t,null,[[0,6]])}))}function Ot(){return ne(this,null,w().mark(function e(){var t,n;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,n={audioinput:[],audiooutput:[],videoinput:[]},e.abrupt("return",(t.forEach(function(e){return n[e.kind].push(e)}),n));case 8:throw e.prev=8,e.t0=e.catch(0),$e(e.t0,je.AV);case 11:case"end":return e.stop()}},e,null,[[0,8]])}))}exports.HMSAudioPluginsManager=At;var Dt={audioContext:null,getAudioContext:function(){return this.audioContext||(this.audioContext=new AudioContext),this.audioContext},resumeContext:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getAudioContext().resume();case 3:return e.abrupt("return",e.sent);case 6:e.prev=6,e.t0=e.catch(0),me.e("AudioContext",e.t0);case 9:case"end":return e.stop()}},e,this,[[0,6]])}))}};exports.HMSAudioContextHandler=Dt;var Nt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0;M(this,e),this.capacity=t,this.storage=[]}return G(e,[{key:"size",value:function(){return this.storage.length}},{key:"toList",value:function(){return this.storage.slice(0)}},{key:"enqueue",value:function(e){this.size()===this.capacity&&this.dequeue(),this.storage.push(e)}},{key:"dequeue",value:function(){return this.storage.shift()}},{key:"aggregate",value:function(e){return e(this.storage)}}]),e}();function Mt(e){if(e<0)throw Error("`ms` should be a positive integer");return new Promise(function(t){return setTimeout(t,e)})}function Lt(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];clearTimeout(t),t=void 0;var s=this;t=setTimeout(function(){e.apply(s,i)},n)}}var Gt=35,Ut=5,Ft=function(){function e(t,n,r){var i=this;M(this,e),this.track=t,this.audioLevelEvent=n,this.silenceEvent=r,this.TAG="[TrackAudioLevelMonitor]",this.audioLevel=0,this.isMonitored=!1,this.interval=100,this.historyInterval=700,this.history=new Nt(this.historyInterval/this.interval),this.detectSilence=function(){return ne(i,null,w().mark(function e(){var t,n,r;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=20,n=50,r=0;case 1:if(!this.isMonitored){e.next=14;break}if(!this.track.enabled){e.next=10;break}if(!this.isSilentThisInstant()){e.next=9;break}if(!(++r>n)){e.next=7;break}return this.silenceEvent.publish({track:this.track}),e.abrupt("break",14);case 7:e.next=10;break;case 9:return e.abrupt("break",14);case 10:return e.next=12,Mt(t);case 12:e.next=1;break;case 14:case"end":return e.stop()}},e,this)}))};try{var a=new MediaStream([this.track.nativeTrack]);this.analyserNode=this.createAnalyserNodeForStream(a)}catch(a){me.w(this.TAG,"Unable to initialize AudioContext",a)}}return G(e,[{key:"start",value:function(){var e=this;this.stop(),this.isMonitored=!0,me.d(this.TAG,"Starting track Monitor","".concat(this.track)),this.loop().then(function(){return me.d(e.TAG,"Stopping track Monitor","".concat(e.track))})}},{key:"stop",value:function(){this.analyserNode?(this.sendAudioLevel(0),this.isMonitored=!1):me.d(this.TAG,"AudioContext not initialized")}},{key:"loop",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMonitored){e.next=6;break}return this.sendAudioLevel(this.getMaxAudioLevelOverPeriod()),e.next=4,Mt(this.interval);case 4:e.next=0;break;case 6:case"end":return e.stop()}},e,this)}))}},{key:"sendAudioLevel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e=e>Gt?e:0,Math.abs(this.audioLevel-e)>Ut){this.audioLevel=e;var t={track:this.track,audioLevel:this.audioLevel};this.audioLevelEvent.publish(t)}}},{key:"getMaxAudioLevelOverPeriod",value:function(){if(this.analyserNode){var e=this.calculateAudioLevel();return void 0!==e&&this.history.enqueue(e),this.history.aggregate(function(e){return Math.max.apply(Math,g(e))})}me.d(this.TAG,"AudioContext not initialized")}},{key:"calculateAudioLevel",value:function(){if(this.analyserNode){var e=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(e);var t,n=.009,r=n,i=B(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;r=Math.max(r,(a-128)/128)}}catch(o){i.e(o)}finally{i.f()}var s=(Math.log(n)-Math.log(r))/Math.log(n);return Math.ceil(Math.min(Math.max(100*s,0),100))}me.d(this.TAG,"AudioContext not initialized")}},{key:"isSilentThisInstant",value:function(){if(this.analyserNode){var e=new Uint8Array(this.analyserNode.fftSize);return this.analyserNode.getByteTimeDomainData(e),!e.some(function(e){return 128!==e&&0!==e})}me.d(this.TAG,"AudioContext not initialized")}},{key:"createAnalyserNodeForStream",value:function(e){var t=Dt.getAudioContext(),n=t.createAnalyser();return t.createMediaStreamSource(e).connect(n),n}}]),e}();function Bt(e,t){return function(n){return n in e&&e[n]!==t[n]}}var Vt=function(e){C(n,gt);var t=R(n);function n(e,r,i,a){var s,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(new ot).build();return M(this,n),(s=t.call(this,e,r,i)).eventBus=a,s.TAG="[HMSLocalAudioTrack]",s.isPublished=!1,s.handleVisibilityChange=function(){return ne(O(s),null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="visible"===document.visibilityState,!e.t0){e.next=4;break}return e.next=4,this.replaceTrackWith(this.settings);case 4:case"end":return e.stop()}},e,this)}))},s.handleSettingsChange=function(e){return ne(O(s),null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.stream,r=Bt(e,this.settings),t.t0=r("maxBitrate")&&e.maxBitrate,!t.t0){t.next=5;break}return t.next=5,n.setMaxBitrateAndFramerate(this);case 5:if(t.t1=r("advanced"),!t.t1){t.next=9;break}return t.next=9,this.replaceTrackWith(e);case 9:case"end":return t.stop()}},t,this)}))},s.handleDeviceChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return ne(O(s),null,w().mark(function n(){return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=Bt(e,this.settings)("deviceId"),!n.t0){n.next=5;break}return n.next=4,this.replaceTrackWith(e);case 4:t||bt.updateSelection("audioInput",{deviceId:e.deviceId,groupId:this.nativeTrack.getSettings().groupId});case 5:case"end":return n.stop()}},n,this)}))},e.tracks.push(O(s)),s.settings=o,o.deviceId!==r.getSettings().deviceId&&!Pt(r)&&(s.settings=s.buildNewSettings({deviceId:r.getSettings().deviceId})),s.pluginsManager=new At(O(s),a),s.setFirstTrackId(r.id),ve()&&oe&&document.addEventListener("visibilitychange",s.handleVisibilityChange),s}return G(n,[{key:"replaceTrackWith",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i,a;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return null==(n=this.nativeTrack)||n.stop(),r=Boolean(this.audioLevelMonitor),t.next=5,It(e);case 5:return(i=t.sent).enabled=this.enabled,me.d(this.TAG,"replaceTrack, Previous track stopped",n,"newTrack",i),a=this.stream,t.next=10,a.replaceSenderTrack(n,this.processedTrack||i);case 10:return t.next=12,a.replaceStreamTrack(n,i);case 12:return this.nativeTrack=i,r&&this.initAudioLevelMonitor(),t.prev=14,t.next=17,this.pluginsManager.reprocessPlugins();case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(14),this.eventBus.audioPluginFailed.publish(t.t0);case 22:case"end":return t.stop()}},t,this,[[14,19]])}))}},{key:"setEnabled",value:function(e){var t=this;return ne(this,null,w().mark(function r(){return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=e!==this.enabled,!r.t0){r.next=10;break}if(r.t1=e&&Pt(this.nativeTrack),!r.t1){r.next=6;break}return r.next=6,this.replaceTrackWith(this.settings);case 6:return r.next=8,(i="setEnabled",b(N(n.prototype),i,t)).call(this,e);case 8:e&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),this.eventBus.localAudioEnabled.publish({enabled:e,track:this});case 10:case"end":return r.stop()}var i},r,this)}))}},{key:"isPublishedTrackId",value:function(e){return this.publishedTrackId===e}},{key:"setSettings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.buildNewSettings(e),!Pt(this.nativeTrack)){n.next=4;break}return this.settings=r,n.abrupt("return");case 4:return n.next=6,this.handleDeviceChange(r,t);case 6:return n.next=8,this.handleSettingsChange(r);case 8:this.settings=r;case 9:case"end":return n.stop()}},n,this)}))}},{key:"getPlugins",value:function(){return this.pluginsManager.getPlugins()}},{key:"addPlugin",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.pluginsManager.addPlugin(e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"removePlugin",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.pluginsManager.removePlugin(e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"validatePlugin",value:function(e){return this.pluginsManager.validatePlugin(e)}},{key:"setProcessedTrack",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=7;break}if(t.t0=this.processedTrack,!t.t0){t.next=5;break}return t.next=5,this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack);case 5:return this.processedTrack=void 0,t.abrupt("return");case 7:if(t.t1=e!==this.processedTrack,!t.t1){t.next=17;break}if(!this.processedTrack){t.next=14;break}return t.next=12,this.stream.replaceSenderTrack(this.processedTrack,e);case 12:t.next=16;break;case 14:return t.next=16,this.stream.replaceSenderTrack(this.nativeTrack,e);case 16:this.processedTrack=e;case 17:case"end":return t.stop()}},t,this)}))}},{key:"initAudioLevelMonitor",value:function(){this.audioLevelMonitor&&this.destroyAudioLevelMonitor(),me.d(this.TAG,"Monitor Audio Level for",this,this.getMediaTrackSettings().deviceId),this.audioLevelMonitor=new Ft(this,this.eventBus.trackAudioLevelUpdate,this.eventBus.localAudioSilence),this.audioLevelMonitor.start(),this.audioLevelMonitor.detectSilence()}},{key:"destroyAudioLevelMonitor",value:function(){var e;null==(e=this.audioLevelMonitor)||e.stop(),this.audioLevelMonitor=void 0}},{key:"cleanup",value:function(){var e=this;return ne(this,null,w().mark(function t(){var r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(i="cleanup",b(N(n.prototype),i,e)).call(this),t.next=3,this.pluginsManager.cleanup();case 3:return t.next=5,this.pluginsManager.closeContext();case 5:this.transceiver=void 0,null==(r=this.processedTrack)||r.stop(),this.isPublished=!1,this.destroyAudioLevelMonitor(),ve()&&oe&&document.removeEventListener("visibilitychange",this.handleVisibilityChange);case 10:case"end":return t.stop()}var i},t,this)}))}},{key:"getTrackIDBeingSent",value:function(){return this.processedTrack?this.processedTrack.id:this.nativeTrack.id}},{key:"getTrackBeingSent",value:function(){return this.processedTrack||this.nativeTrack}},{key:"buildNewSettings",value:function(e){var t=X(X({},this.settings),e),n=t.volume,r=t.codec,i=t.maxBitrate,a=t.deviceId,s=t.advanced;return new ct(n,r,i,a,s)}}]),n}();exports.HMSLocalAudioTrack=Vt;var Ht=function(e){C(n,gt);var t=R(n);function n(){return M(this,n),t.apply(this,arguments)}return G(n,[{key:"setEnabled",value:function(e){var t=this;return ne(this,null,w().mark(function r(){return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=e!==this.enabled,!r.t0){r.next=6;break}return r.next=4,(i="setEnabled",b(N(n.prototype),i,t)).call(this,e);case 4:return r.next=6,this.subscribeToAudio(e);case 6:case"end":return r.stop()}var i},r,this)}))}}]),n}();exports.HMSRemoteAudioTrack=Ht;var Wt=function(e){C(n,ft);var t=R(n);function n(e,r,i){var a;if(M(this,n),(a=t.call(this,e,r,i)).type=st.VIDEO,a.sinkCount=0,"video"!==r.kind)throw new Error("Expected 'track' kind = 'video'");return a}return G(n,[{key:"setVideoHandler",value:function(e){this.videoHandler=e}},{key:"hasSinks",value:function(){return this.sinkCount>0}},{key:"getSinks",value:function(){return this.videoHandler.getVideoElements()||[]}},{key:"attach",value:function(e){this.videoHandler.addVideoElement(e)}},{key:"detach",value:function(e){this.videoHandler.removeVideoElement(e)}},{key:"addSink",value:function(e){this.addSinkInternal(e,this.nativeTrack)}},{key:"removeSink",value:function(e){me.d("[HMSVideoTrack] removing sink video element - ".concat(e)),null!==e.srcObject&&(e.srcObject=null,this.sinkCount>0&&this.sinkCount--)}},{key:"cleanup",value:function(){b(N(n.prototype),"cleanup",this).call(this),this.videoHandler.cleanup()}},{key:"addSinkInternal",value:function(e,t){var n;me.d("[HMSVideoTrack] adding sink internal video - ".concat(e," track - ").concat(t));var r=e.srcObject;null!==r&&r instanceof MediaStream&&(null==(n=r.getVideoTracks()[0])?void 0:n.id)===t.id||(e.srcObject=new MediaStream([t]),this.sinkCount++)}}]),n}();exports.HMSVideoTrack=Wt;var jt,Kt,Jt=(S(n={},ze.NONE,-1),S(n,ze.LOW,0),S(n,ze.MEDIUM,1),S(n,ze.HIGH,2),n),qt=.5,zt=function(e,t){for(var n=ze.HIGH,r=t.width>t.height?"width":"height",i=g(e).sort(function(e,t){return Jt[e.layer]-Jt[t.layer]}),a=t[r]*((null==window?void 0:window.devicePixelRatio)||1),s=0;s<i.length;s++){var o=i[s],c=o.resolution,u=o.layer,l=c[r];if(a<=l){n=u;break}var d=i[s+1];if((a-l)/((d?d.resolution[r]:Number.POSITIVE_INFINITY)-l)<qt){n=u;break}}return n},Yt=function(){function e(){var t=this;M(this,e),this.TAG="[HMSIntersectionObserverWrapper]",this.listeners=new Map,this.observe=function(e,n){var r;t.createObserver(),t.unobserve(e),null==(r=t.intersectionObserver)||r.observe(e),t.listeners.set(e,n)},this.unobserve=function(e){var n;null==(n=t.intersectionObserver)||n.unobserve(e),t.listeners.has(e)&&t.listeners.delete(e)},this.createObserver=function(){t.isSupported()&&!t.intersectionObserver&&(t.intersectionObserver=new IntersectionObserver(t.handleIntersection))},this.handleIntersection=function(e){var n,r,i=B(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;t.listeners.has(a.target)&&(null==(n=t.listeners.get(a.target))||n(a))}}catch(s){i.e(s)}finally{i.f()}},this.createObserver()}return G(e,[{key:"isSupported",value:function(){var e=oe&&void 0!==window.IntersectionObserver;return e||me.w(this.TAG,"IntersectionObserver is not supported, fallback will be used instead"),e}}]),e}(),Qt=new Yt,Zt=function(){function e(){var t=this;M(this,e),this.TAG="[HMSResizeObserverWrapper]",this.listeners=new Map,this.observe=function(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{box:"border-box"};t.createObserver(),t.unobserve(e),null==(r=t.resizeObserver)||r.observe(e,i),t.listeners.set(e,n)},this.unobserve=function(e){var n;null==(n=t.resizeObserver)||n.unobserve(e),t.listeners.has(e)&&t.listeners.delete(e)},this.createObserver=function(){t.isSupported()&&!t.resizeObserver&&(t.resizeObserver=new ResizeObserver(Lt(t.handleResize,300)))},this.handleResize=function(e){var n,r,i=B(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;t.listeners.has(a.target)&&(null==(n=t.listeners.get(a.target))||n(a))}}catch(s){i.e(s)}finally{i.f()}},this.createObserver()}return G(e,[{key:"isSupported",value:function(){var e=oe&&void 0!==window.ResizeObserver;return e||me.w(this.TAG,"Resize Observer is not supported"),e}}]),e}(),Xt=new Zt,$t=function(){function e(t){var n=this;M(this,e),this.track=t,this.TAG="[VideoElementManager]",this.videoElements=new Set,this.entries=new Map,this.handleIntersection=function(e){return ne(n,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n="visible"===getComputedStyle(e.target).visibility,!this.track.enabled||!(e.isIntersecting&&n||!document.contains(e.target))){t.next=7;break}return me.d(this.TAG,"add sink intersection",this.track,this.id),t.next=5,this.track.addSink(e.target);case 5:t.next=10;break;case 7:return me.d(this.TAG,"remove sink intersection",this.track,this.id),t.next=10,this.track.removeSink(e.target);case 10:return this.entries.set(e.target,e.boundingClientRect),t.next=13,this.selectMaxLayer();case 13:case"end":return t.stop()}},t,this)}))},this.handleResize=function(e){return ne(n,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=!(this.track.enabled&&this.track instanceof An),t.t0){t.next=5;break}return this.entries.set(e.target,e.contentRect),t.next=5,this.selectMaxLayer();case 5:case"end":return t.stop()}},t,this)}))},this.cleanup=function(){n.videoElements.forEach(function(e){var t,r;e.srcObject=null,null==(t=n.resizeObserver)||t.unobserve(e),null==(r=n.intersectionObserver)||r.unobserve(e)}),n.videoElements.clear(),n.resizeObserver=void 0,n.intersectionObserver=void 0},this.init(),this.id=(0,s.v4)()}return G(e,[{key:"updateSinks",value:function(){var e,t=B(this.videoElements);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.track.enabled?this.track.addSink(n):this.track.removeSink(n)}}catch(r){t.e(r)}finally{t.f()}}},{key:"addVideoElement",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.videoElements.has(e),t.t0){t.next=15;break}if(this.init(),me.d(this.TAG,"Adding video element: ".concat(e," for ").concat(this.track),this.id),this.videoElements.add(e),this.videoElements.size>=10&&me.w(this.TAG,"".concat(this.track),"the track is added to ".concat(this.videoElements.size," video elements, while this may be intentional, it's likely that there is a bug leading to unnecessary creation of video elements in the UI")),(null==(n=this.intersectionObserver)?void 0:n.isSupported())?this.intersectionObserver.observe(e,this.handleIntersection):oe&&(this.isElementInViewport(e)?this.track.addSink(e):this.track.removeSink(e)),!this.resizeObserver){t.next=11;break}this.resizeObserver.observe(e,this.handleResize),t.next=15;break;case 11:if(t.t1=this.track instanceof An,!t.t1){t.next=15;break}return t.next=15,this.track.setPreferredLayer(this.track.getPreferredLayer());case 15:case"end":return t.stop()}},t,this)}))}},{key:"removeVideoElement",value:function(e){var t,n;this.track.removeSink(e),this.videoElements.delete(e),this.entries.delete(e),null==(t=this.resizeObserver)||t.unobserve(e),null==(n=this.intersectionObserver)||n.unobserve(e),me.d(this.TAG,"Removing video element: ".concat(e," for ").concat(this.track))}},{key:"getVideoElements",value:function(){return Array.from(this.videoElements)}},{key:"init",value:function(){oe&&(this.resizeObserver=Xt,this.intersectionObserver=Qt)}},{key:"isElementInViewport",value:function(e){for(var t=e.offsetTop,n=e.offsetLeft,r=e.offsetWidth,i=e.offsetHeight,a=e.hidden,s=getComputedStyle(e),o=s.opacity,c=s.display;e.offsetParent;)t+=(e=e.offsetParent).offsetTop,n+=e.offsetLeft;return t<window.pageYOffset+window.innerHeight&&n<window.pageXOffset+window.innerWidth&&t+i>window.pageYOffset&&n+r>window.pageXOffset&&!a&&(""===o||parseFloat(o)>0)&&"none"!==c}},{key:"selectMaxLayer",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i,a,s,o;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.track instanceof An)){e.next=6;break}n=B(this.entries.values());try{for(n.s();!(r=n.n()).done;)i=r.value,a=i.width,s=i.height,o=zt(this.track.getSimulcastDefinitions(),{width:a,height:s}),t=t?Jt[o]>Jt[t]?o:t:o}catch(c){n.e(c)}finally{n.f()}return me.d(this.TAG,"selecting max layer ".concat(t," for the track"),"".concat(this.track)),e.next=6,this.track.setPreferredLayer(t);case 6:case"end":return e.stop()}},e,this)}))}}]),e}();exports.HMSVideoPluginType=jt,function(e){e.TRANSFORM="TRANSFORM",e.ANALYZE="ANALYZE"}(jt||(exports.HMSVideoPluginType=jt={})),exports.HMSVideoPluginCanvasContextType=Kt,function(e){e["2D"]="2d",e.WEBGL="webgl",e.WEBGL2="webgl2"}(Kt||(exports.HMSVideoPluginCanvasContextType=Kt={}));var en=function(){function e(){M(this,e),this.total=0,this.count=0}return G(e,[{key:"add",value:function(e){this.count++,this.total+=e}},{key:"getAvg",value:function(){return Math.floor(this.total/this.count)}},{key:"reset",value:function(){this.total=0,this.count=0}}]),e}(),tn=function(){function e(t){M(this,e),this.eventBus=t,this.TAG="[VideoPluginsAnalytics]",this.initTime={},this.preProcessingAvgs=new en,this.addedTimestamps={},this.processingAvgs={},this.pluginAdded={},this.pluginInputFrameRate={},this.pluginFrameRate={}}return G(e,[{key:"added",value:function(e,t,n){this.pluginAdded[e]=!0,this.addedTimestamps[e]=Date.now(),this.initTime[e]=0,this.processingAvgs[e]=new en,this.pluginInputFrameRate[e]=t,this.pluginFrameRate[e]=n||t}},{key:"removed",value:function(e){var t;if(this.pluginAdded[e]){var n={pluginName:e,duration:Math.floor((Date.now()-this.addedTimestamps[e])/1e3),loadTime:this.initTime[e],avgPreProcessingTime:this.preProcessingAvgs.getAvg(),avgProcessingTime:null==(t=this.processingAvgs[e])?void 0:t.getAvg(),inputFrameRate:this.pluginInputFrameRate[e],pluginFrameRate:this.pluginFrameRate[e]};this.eventBus.analytics.publish(Et.stats(n)),this.clean(e)}}},{key:"failure",value:function(e,t){this.pluginAdded[e]&&(this.eventBus.analytics.publish(Et.failure(e,t)),this.clean(e))}},{key:"initWithTime",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.initTime[e]){n.next=3;break}return me.i(this.TAG,"Plugin Already loaded ".concat(e,", time it took: ").concat(this.initTime[e])),n.abrupt("return");case 3:return n.prev=3,n.next=6,this.timeInMs(t);case 6:r=n.sent,me.i(this.TAG,"Time taken for Plugin ".concat(e," initialization : ").concat(r)),n.next=14;break;case 10:throw n.prev=10,n.t0=n.catch(3),i=Qe.MediaPluginErrors.InitFailed(Fe.VIDEO_PLUGINS,"failed during initialization of plugin".concat(n.t0.message||n.t0)),me.e(this.TAG,i),this.failure(e,i),i;case 14:r&&(this.initTime[e]=r);case 15:case"end":return n.stop()}},n,this,[[3,10]])}))}},{key:"preProcessWithTime",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.timeInMs(e);case 2:n=t.sent,this.preProcessingAvgs.add(n);case 4:case"end":return t.stop()}},t,this)}))}},{key:"processWithTime",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.timeInMs(t);case 3:i=n.sent,n.next=10;break;case 6:throw n.prev=6,n.t0=n.catch(0),a=Qe.MediaPluginErrors.ProcessingFailed(Fe.VIDEO_PLUGINS,"Failed during processing of plugin".concat(n.t0.message||n.t0)),me.e(this.TAG,a),this.failure(e,a),a;case 10:i&&(null==(r=this.processingAvgs[e])||r.add(i));case 11:case"end":return n.stop()}},n,this,[[0,6]])}))}},{key:"timeInMs",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=Date.now(),t.next=3,e();case 3:return t.abrupt("return",Math.floor(Date.now()-n));case 4:case"end":return t.stop()}},t)}))}},{key:"clean",value:function(e){delete this.addedTimestamps[e],delete this.initTime[e],delete this.processingAvgs[e],delete this.pluginAdded[e],delete this.pluginInputFrameRate[e],delete this.pluginFrameRate[e]}}]),e}(),nn=24,rn=320,an=240,sn=function(){function e(t,n){M(this,e),this.TAG="[VideoPluginsManager]",this.pluginsLoopRunning=!1,this.pluginsLoopState="paused",this.pluginAddInProgress=!1,this.hmsTrack=t,this.pluginsMap=new Map,this.pluginNumFramesToSkip={},this.pluginNumFramesSkipped={},this.analytics=new tn(n),this.canvases=new Array}return G(e,[{key:"getPlugins",value:function(){return Array.from(this.pluginsMap.keys())}},{key:"addPlugin",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.pluginAddInProgress){n.next=7;break}if((i=null==(r=e.getName)?void 0:r.call(e))&&""!==i){n.next=5;break}return me.w("no name provided by the plugin"),n.abrupt("return");case 5:throw a=Qe.MediaPluginErrors.AddAlreadyInProgress(Fe.VIDEO_PLUGINS,"Add Plugin is already in Progress"),this.analytics.failure(i,a),me.w("can't add another plugin when previous add is in progress"),a;case 7:return this.pluginAddInProgress=!0,n.prev=8,n.next=11,this.addPluginInternal(e,t);case 11:return n.prev=11,this.pluginAddInProgress=!1,n.finish(11);case 14:case"end":return n.stop()}},n,this,[[8,,11,14]])}))}},{key:"addPluginInternal",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a,s,o,c,u=this;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if((a=null==(r=e.getName)?void 0:r.call(e))&&""!==a){n.next=4;break}return me.w("no name provided by the plugin"),n.abrupt("return");case 4:if(!this.pluginsMap.has(a)){n.next=7;break}return me.w(this.TAG,"plugin - ".concat(e.getName()," already added.")),n.abrupt("return");case 7:return s=this.hmsTrack.getMediaTrackSettings().frameRate||nn,o=0,t&&t>0?(me.i(this.TAG,"adding plugin ".concat(e.getName()," with framerate ").concat(t)),t<s&&(o=Math.ceil(s/t)-1),this.analytics.added(a,s,t)):(me.i(this.TAG,"adding plugin ".concat(e.getName())),this.analytics.added(a,s)),me.i(this.TAG,"numFrames to skip processing",o),this.pluginNumFramesToSkip[a]=o,this.pluginNumFramesSkipped[a]=o,this.validateAndThrow(a,e),n.prev=9,n.next=12,this.analytics.initWithTime(a,function(){return ne(u,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.init();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)}))});case 12:if(this.pluginsMap.set(a,e),!(this.pluginsMap.size+1>this.canvases.length)){n.next=15;break}for(c=this.canvases.length;c<=this.pluginsMap.size;c++)this.canvases[c]=document.createElement("canvas");case 15:return n.next=17,this.startPluginsLoop(null==(i=e.getContextType)?void 0:i.call(e));case 17:n.next=25;break;case 19:return n.prev=19,n.t0=n.catch(9),me.e(this.TAG,"failed to add plugin",n.t0),n.next=24,this.removePlugin(e);case 24:throw n.t0;case 25:case"end":return n.stop()}},n,this,[[9,19]])}))}},{key:"validatePlugin",value:function(e){return e.checkSupport()}},{key:"validateAndThrow",value:function(e,t){var n,r=this.validatePlugin(t);if(r.isSupported)me.i(this.TAG,"plugin is supported,- ".concat(t.getName()));else switch(r.errType){case Tt.PLATFORM_NOT_SUPPORTED:throw n=Qe.MediaPluginErrors.PlatformNotSupported(Fe.VIDEO_PLUGINS,"platform not supported, see docs"),this.analytics.failure(e,n),n;case Tt.DEVICE_NOT_SUPPORTED:throw n=Qe.MediaPluginErrors.DeviceNotSupported(Fe.VIDEO_PLUGINS,"video device not supported, see docs"),this.analytics.failure(e,n),n}}},{key:"removePlugin",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.getName(),this.pluginsMap.get(n)){t.next=4;break}return me.w(this.TAG,"plugin - ".concat(n," not found to remove.")),t.abrupt("return");case 4:if(me.i(this.TAG,"removing plugin ".concat(n)),this.removePluginEntry(n),t.t0=0===this.pluginsMap.size,!t.t0){t.next=11;break}return me.i(this.TAG,"No plugins left, stopping plugins loop"),t.next=11,this.stopPluginsLoop();case 11:e.stop(),this.analytics.removed(n);case 13:case"end":return t.stop()}},t,this)}))}},{key:"removePluginEntry",value:function(e){this.pluginsMap.delete(e),this.pluginNumFramesToSkip[e]&&delete this.pluginNumFramesToSkip[e],this.pluginNumFramesSkipped[e]&&delete this.pluginNumFramesSkipped[e]}},{key:"waitForRestart",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pluginsLoopRunning||"running"===this.pluginsLoopState){e.next=6;break}case 1:if("paused"!==this.pluginsLoopState){e.next=6;break}return e.next=4,Mt(100);case 4:e.next=1;break;case 6:case"end":return e.stop()}},e,this)}))}},{key:"cleanup",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=B(this.pluginsMap.values()),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,this.removePlugin(i);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:null==(t=this.outputTrack)||t.stop();case 18:case"end":return e.stop()}},e,this,[[1,11,14,17]])}))}},{key:"initElementsAndStream",value:function(e){this.inputCanvas||(this.inputCanvas=document.createElement("canvas")),this.outputCanvas=document.createElement("canvas"),this.inputVideo||(this.inputVideo=document.createElement("video")),this.inputCanvas.getContext("2d"),this.outputCanvas.getContext(e||Kt["2D"]);var t=this.outputCanvas.captureStream();this.outputTrack=t.getVideoTracks()[0]}},{key:"startPluginsLoop",value:function(e){return ne(this,null,w().mark(function t(){var n=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.pluginsLoopRunning){t.next=11;break}return this.initElementsAndStream(e),this.pluginsLoopRunning=!0,t.prev=2,t.next=5,this.hmsTrack.setProcessedTrack(this.outputTrack);case 5:t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(2),this.pluginsLoopRunning=!1,me.e(this.TAG,"error in setting processed track",t.t0),t.t0;case 10:this.pluginsLoop().then(function(){me.d(n.TAG,"processLoop stopped")});case 11:case"end":return t.stop()}},t,this,[[2,7]])}))}},{key:"stopPluginsLoop",value:function(){return ne(this,null,w().mark(function e(){var t;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.pluginsLoopRunning=!1,e.next=3,this.hmsTrack.setProcessedTrack(void 0);case 3:this.resetCanvases(),null==(t=this.outputTrack)||t.stop(),this.inputVideo&&(this.inputVideo.srcObject=null,this.inputVideo=void 0);case 6:case"end":return e.stop()}},e,this)}))}},{key:"pluginsLoop",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i,a=this;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pluginsLoopRunning){e.next=27;break}if(t=this.hmsTrack.getMediaTrackSettings().frameRate||nn,n=Math.floor(1e3/t),this.hmsTrack.enabled&&"ended"!==this.hmsTrack.nativeTrack.readyState){e.next=8;break}return"running"===this.pluginsLoopState&&this.resetCanvases(),this.pluginsLoopState="paused",e.next=7,Mt(n);case 7:return e.abrupt("continue",25);case 8:return r=0,e.prev=9,e.next=12,this.analytics.preProcessWithTime(function(){return ne(a,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.doPreProcessing();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))});case 12:return i=Date.now(),e.next=15,this.processFramesThroughPlugins();case 15:(r=Math.floor(Date.now()-i))>n&&(r=n),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(9),me.e(this.TAG,"error in plugins loop",e.t0);case 22:return this.pluginsLoopState="running",e.next=25,Mt(n-r);case 25:e.next=0;break;case 27:case"end":return e.stop()}},e,this,[[9,19]])}))}},{key:"doPreProcessing",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.addTrackToVideo();case 2:return e.next=4,this.updateInputCanvas();case 4:case"end":return e.stop()}},e,this)}))}},{key:"processFramesThroughPlugins",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i,a=this;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.canvases[0]=this.inputCanvas,t=0,n=B(this.pluginsMap.values()),e.prev=3,i=w().mark(function e(){var n,i,s,o,c,u;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.value,i=n.getName(),!n){e.next=39;break}if(e.prev=3,s=a.checkIfSkipRequired(i),n.getPluginType()!==jt.TRANSFORM){e.next=27;break}if(o=function(e,t){return ne(a,null,w().mark(function r(){return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n.processVideoFrame(e,t,s);case 3:r.next=8;break;case 5:r.prev=5,r.t0=r.catch(0),me.e(this.TAG,"error in processing plugin ".concat(i),r.t0);case 8:case"end":return r.stop()}},r,this,[[0,5]])}))},!s){e.next=17;break}if(t!==a.pluginsMap.size-1){e.next=13;break}return e.next=11,o(a.canvases[t],a.outputCanvas);case 11:e.next=15;break;case 13:return e.next=15,o(a.canvases[t],a.canvases[t+1]);case 15:e.next=25;break;case 17:if(c=a.canvases[t],u=a.canvases[t+1],t!==a.pluginsMap.size-1){e.next=23;break}return e.next=21,a.analytics.processWithTime(i,function(){return ne(a,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o(c,this.outputCanvas));case 1:case"end":return e.stop()}},e,this)}))});case 21:e.next=25;break;case 23:return e.next=25,a.analytics.processWithTime(i,function(){return ne(a,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o(c,u));case 1:case"end":return e.stop()}},e)}))});case 25:e.next=31;break;case 27:if(e.t0=n.getPluginType()===jt.ANALYZE&&!s,!e.t0){e.next=31;break}return e.next=31,a.analytics.processWithTime(i,function(){return ne(a,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.processVideoFrame(this.inputCanvas);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))});case 31:e.next=38;break;case 33:return e.prev=33,e.t1=e.catch(3),me.e(a.TAG,"error in processing plugin ".concat(i),e.t1),e.next=38,a.removePlugin(n);case 38:t++;case 39:case"end":return e.stop()}},e,null,[[3,33]])}),n.s();case 6:if((r=n.n()).done){e.next=10;break}return e.delegateYield(i(),"t0",8);case 8:e.next=6;break;case 10:e.next=15;break;case 12:e.prev=12,e.t1=e.catch(3),n.e(e.t1);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}},e,this,[[3,12,15,18]])}))}},{key:"addTrackToVideo",value:function(){return ne(this,null,w().mark(function e(){var t,n;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputVideo){e.next=2;break}return e.abrupt("return");case 2:if(n=this.inputVideo.srcObject,e.t0=null!==n&&n instanceof MediaStream&&(null==(t=n.getVideoTracks()[0])?void 0:t.id)===this.hmsTrack.nativeTrack.id,e.t0){e.next=11;break}return this.inputVideo.pause(),this.inputVideo.srcObject=new MediaStream([this.hmsTrack.nativeTrack]),this.inputVideo.muted=!0,this.inputVideo.playsInline=!0,e.next=11,this.inputVideo.play();case 11:case"end":return e.stop()}},e,this)}))}},{key:"updateInputCanvas",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i,a;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.inputCanvas&&this.inputVideo){e.next=2;break}return e.abrupt("return");case 2:t=this.hmsTrack.getMediaTrackSettings(),n=t.width,r=void 0===n?rn:n,i=t.height,a=void 0===i?an:i,this.inputCanvas.height!==a&&(this.inputCanvas.height=a),this.inputCanvas.width!==r&&(this.inputCanvas.width=r),this.inputCanvas.getContext("2d").drawImage(this.inputVideo,0,0,r,a);case 4:case"end":return e.stop()}},e,this)}))}},{key:"resetCanvases",value:function(){if(this.outputCanvas&&this.inputCanvas){var e=this.inputCanvas.getContext("2d");e&&(e.fillStyle="rgb(0, 0, 0)",e.fillRect(0,0,this.outputCanvas.width,this.outputCanvas.height)),this.canvases=[]}}},{key:"checkIfSkipRequired",value:function(e){var t=!1;return this.pluginNumFramesSkipped[e]<this.pluginNumFramesToSkip[e]?(this.pluginNumFramesSkipped[e]++,t=!0):(t=!1,this.pluginNumFramesSkipped[e]=0),t}}]),e}();function on(e,t){return function(n){return n in e&&e[n]!==t[n]}}exports.HMSVideoPluginsManager=sn;var cn=function(e){C(n,Wt);var t=R(n);function n(e,r,i,a){var s,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(new ut).build();return M(this,n),(s=t.call(this,e,r,i)).eventBus=a,s._layerDefinitions=[],s.TAG="[HMSLocalVideoTrack]",s.isCurrentTab=!1,s.isPublished=!1,s.buildNewSettings=function(e){var t=X(X({},s.settings),e),n=t.width,r=t.height,i=t.codec,a=t.maxFramerate,o=t.maxBitrate,c=t.deviceId,u=t.advanced,l=t.facingMode;return new lt(n,r,i,a,c,u,o,l)},s.handleSettingsChange=function(e){return ne(O(s),null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.stream,r=on(e,this.settings),t.t0=r("maxBitrate")&&e.maxBitrate,!t.t0){t.next=5;break}return t.next=5,n.setMaxBitrateAndFramerate(this);case 5:if(t.t1=r("width")||r("height")||r("advanced"),!t.t1){t.next=9;break}return t.next=9,this.nativeTrack.applyConstraints(e.toConstraints());case 9:case"end":return t.stop()}},t,this)}))},s.handleDeviceChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return ne(O(s),null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!on(e,this.settings)("deviceId")||"regular"!==this.source){n.next=11;break}if(!this.enabled){n.next=10;break}return delete e.facingMode,n.next=5,this.replaceTrackWith(e);case 5:return r=n.sent,n.next=8,this.replaceSender(r,this.enabled);case 8:this.nativeTrack=r,this.videoHandler.updateSinks();case 10:t||bt.updateSelection("videoInput",{deviceId:e.deviceId,groupId:this.nativeTrack.getSettings().groupId});case 11:case"end":return n.stop()}},n,this)}))},s.removeOrReplaceProcessedTrack=function(e){return ne(O(s),null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=13;break}if(t.t0=e!==this.processedTrack,!t.t0){t.next=11;break}if(!this.processedTrack){t.next=8;break}return t.next=6,this.stream.replaceSenderTrack(this.processedTrack,e);case 6:t.next=10;break;case 8:return t.next=10,this.stream.replaceSenderTrack(this.nativeTrack,e);case 10:this.processedTrack=e;case 11:t.next=18;break;case 13:if(t.t1=this.processedTrack,!t.t1){t.next=17;break}return t.next=17,this.stream.replaceSenderTrack(this.processedTrack,this.nativeTrack);case 17:this.processedTrack=void 0;case 18:case"end":return t.stop()}},t,this)}))},e.tracks.push(O(s)),s.setVideoHandler(new $t(O(s))),s.settings=o,o.deviceId!==r.getSettings().deviceId&&r.enabled&&(s.settings=s.buildNewSettings({deviceId:r.getSettings().deviceId})),s.pluginsManager=new sn(O(s),a),s.setFirstTrackId(s.trackId),s}return G(n,[{key:"setSimulcastDefinitons",value:function(e){this._layerDefinitions=e}},{key:"getSimulcastDefinitions",value:function(){return this._layerDefinitions}},{key:"setEnabled",value:function(e){var t=this;return ne(this,null,w().mark(function r(){var i,a;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e===this.enabled){r.next=22;break}if((s="setEnabled",b(N(n.prototype),s,t)).call(this,e),"regular"!==this.source){r.next=21;break}if(!e){r.next=8;break}return r.next=5,this.replaceTrackWith(this.settings);case 5:a=r.sent,r.next=11;break;case 8:return r.next=10,this.replaceTrackWithBlank();case 10:a=r.sent;case 11:return r.next=13,this.replaceSender(a,e);case 13:if(null==(i=this.nativeTrack)||i.stop(),this.nativeTrack=a,r.t0=e,!r.t0){r.next=20;break}return r.next=19,this.pluginsManager.waitForRestart();case 19:this.settings=this.buildNewSettings({deviceId:a.getSettings().deviceId});case 20:this.videoHandler.updateSinks();case 21:this.eventBus.localVideoEnabled.publish({enabled:e,track:this});case 22:case"end":return r.stop()}var s},r,this)}))}},{key:"isPublishedTrackId",value:function(e){return this.publishedTrackId===e}},{key:"addSink",value:function(e){this.addSinkInternal(e,this.processedTrack||this.nativeTrack)}},{key:"setSettings",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.buildNewSettings(e),n.next=3,this.handleDeviceChange(r,t);case 3:if(this.enabled){n.next=6;break}return this.settings=r,n.abrupt("return");case 6:return n.next=8,this.handleSettingsChange(r);case 8:this.settings=r;case 9:case"end":return n.stop()}},n,this)}))}},{key:"getPlugins",value:function(){return this.pluginsManager.getPlugins()}},{key:"addPlugin",value:function(e,t){return ne(this,null,w().mark(function n(){return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.pluginsManager.addPlugin(e,t));case 1:case"end":return n.stop()}},n,this)}))}},{key:"removePlugin",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.pluginsManager.removePlugin(e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"validatePlugin",value:function(e){return this.pluginsManager.validatePlugin(e)}},{key:"cleanup",value:function(){var e=this;return ne(this,null,w().mark(function t(){var r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(i="cleanup",b(N(n.prototype),i,e)).call(this),this.transceiver=void 0,t.next=4,this.pluginsManager.cleanup();case 4:null==(r=this.processedTrack)||r.stop(),this.isPublished=!1;case 6:case"end":return t.stop()}var i},t,this)}))}},{key:"cropTo",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e||"screen"!==this.source){t.next=11;break}if(t.prev=1,t.t0=this.nativeTrack.cropTo,!t.t0){t.next=6;break}return t.next=6,this.nativeTrack.cropTo(e);case 6:t.next=11;break;case 8:throw t.prev=8,t.t1=t.catch(1),me.e(this.TAG,"failed to crop screenshare capture - ",t.t1),Qe.TracksErrors.GenericTrack(Fe.TRACK,"failed to crop screenshare capture");case 11:case"end":return t.stop()}},t,this,[[1,8]])}))}},{key:"getCaptureHandle",value:function(){if(this.nativeTrack.getCaptureHandle)return this.nativeTrack.getCaptureHandle()}},{key:"setProcessedTrack",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.nativeTrack.enabled){t.next=3;break}return this.processedTrack=e,t.abrupt("return");case 3:return t.next=5,this.removeOrReplaceProcessedTrack(e);case 5:this.videoHandler.updateSinks();case 6:case"end":return t.stop()}},t,this)}))}},{key:"getTrackIDBeingSent",value:function(){return this.getTrackBeingSent().id}},{key:"getTrackBeingSent",value:function(){return this.enabled&&this.processedTrack||this.nativeTrack}},{key:"switchCamera",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.getMediaTrackSettings().facingMode)&&"regular"===this.source){e.next=4;break}return me.d(this.TAG,"facingMode not supported"),e.abrupt("return");case 4:return r=n===nt.ENVIRONMENT?nt.USER:nt.ENVIRONMENT,null==(t=this.nativeTrack)||t.stop(),e.next=8,this.replaceTrackWith(this.buildNewSettings({facingMode:r,deviceId:void 0}));case 8:return i=e.sent,e.next=11,this.replaceSender(i,this.enabled);case 11:this.nativeTrack=i,this.videoHandler.updateSinks(),this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId,facingMode:r}),bt.updateSelection("videoInput",{deviceId:this.settings.deviceId,groupId:this.nativeTrack.getSettings().groupId});case 15:case"end":return e.stop()}},e,this)}))}},{key:"replaceTrackWith",value:function(e){return ne(this,null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return null==(n=this.nativeTrack)||n.stop(),t.next=4,Ct(e);case 4:return r=t.sent,t.abrupt("return",(me.d(this.TAG,"replaceTrack, Previous track stopped",n,"newTrack",r),"default"===this.settings.deviceId&&(this.settings=this.buildNewSettings({deviceId:this.nativeTrack.getSettings().deviceId})),r));case 6:case"end":return t.stop()}},t,this)}))}},{key:"replaceTrackWithBlank",value:function(){return ne(this,null,w().mark(function e(){var t,n;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.nativeTrack,n=On.getEmptyVideoTrack(t),e.abrupt("return",(null==t||t.stop(),me.d(this.TAG,"replaceTrackWithBlank, Previous track stopped",t,"newTrack",n),n));case 2:case"end":return e.stop()}},e,this)}))}},{key:"replaceSender",value:function(e,t){return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.stream,!t){n.next=6;break}return n.next=4,r.replaceSenderTrack(this.nativeTrack,this.processedTrack||e);case 4:n.next=8;break;case 6:return n.next=8,r.replaceSenderTrack(this.processedTrack||this.nativeTrack,e);case 8:return n.next=10,r.replaceStreamTrack(this.nativeTrack,e);case 10:case"end":return n.stop()}},n,this)}))}}]),n}();exports.HMSLocalVideoTrack=cn;var un="renegotiation-callback-id",ln="ion-sfu",dn=100,hn=5,vn=60,pn=12e3,fn=1e3,kn=5,gn="SUBSCRIBE_ICE_CONNECTION_CALLBACK_ID",mn=6e4,Tn=5e3,yn=1e3,bn=!1,En="https://event.100ms.live/v2/client/report",wn="https://event-nonprod.100ms.live/v2/client/report",Sn=100,xn={DEVICE_CHANGE:"device-change",LOCAL_AUDIO_ENABLED:"local-audio-enabled",LOCAL_VIDEO_ENABLED:"local-video-enabled",STATS_UPDATE:"stats-update",RTC_STATS_UPDATE:"rtc-stats-update",TRACK_DEGRADED:"track-degraded",TRACK_RESTORED:"track-restored",TRACK_AUDIO_LEVEL_UPDATE:"track-audio-level-update",LOCAL_AUDIO_SILENCE:"local-audio-silence",ANALYTICS:"analytics",AUDIO_PLUGIN_FAILED:"audio-plugin-failed",POLICY_CHANGE:"policy-change",LOCAL_ROLE_UPDATE:"local-role-update",AUDIO_TRACK_UPDATE:"audio-track-update",AUDIO_TRACK_ADDED:"audio-track-added",AUDIO_TRACK_REMOVED:"audio-track-removed",AUTOPLAY_ERROR:"autoplay-error",LEAVE:"leave"},An=function(e){C(n,Wt);var t=R(n);function n(e,r,i){var a;return M(this,n),(a=t.call(this,e,r,i))._degraded=!1,a._degradedAt=null,a._layerDefinitions=[],a.history=new In,a.preferredLayer=ze.HIGH,a.setVideoHandler(new $t(O(a))),a}return G(n,[{key:"degraded",get:function(){return this._degraded}},{key:"degradedAt",get:function(){return this._degradedAt}},{key:"setEnabled",value:function(e){var t=this;return ne(this,null,w().mark(function r(){return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e!==this.enabled&&((i="setEnabled",b(N(n.prototype),i,t)).call(this,e),this.videoHandler.updateSinks());case 1:case"end":return r.stop()}var i},r,this)}))}},{key:"setPreferredLayer",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e!==ze.NONE){t.next=3;break}return me.w("layer ".concat(ze.NONE," will be ignored")),t.abrupt("return");case 3:if(this.preferredLayer=e,!this.shouldSendVideoLayer(e,"preferLayer")){t.next=10;break}if(this.hasSinks()){t.next=7;break}return me.d("[Remote Track] ".concat(this.logIdentifier,"\n        streamId=").concat(this.stream.id," \n        trackId=").concat(this.trackId,"\n        saving ").concat(e,", source=").concat(this.source,"\n        Track does not have any sink")),t.abrupt("return");case 7:return t.next=9,this.requestLayer(e,"preferLayer");case 9:this.pushInHistory("uiPreferLayer-".concat(e));case 10:case"end":return t.stop()}},t,this)}))}},{key:"getSimulcastLayer",value:function(){return this.stream.getSimulcastLayer()}},{key:"getLayer",value:function(){return this.stream.getVideoLayer()}},{key:"getPreferredLayer",value:function(){return this.preferredLayer}},{key:"addSink",value:function(e){var t=this;return ne(this,null,w().mark(function r(){return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return(i="addSink",b(N(n.prototype),i,t)).call(this,e),r.next=3,this.updateLayer("addSink");case 3:this.pushInHistory("uiSetLayer-high");case 4:case"end":return r.stop()}var i},r,this)}))}},{key:"removeSink",value:function(e){var t=this;return ne(this,null,w().mark(function r(){return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return(i="removeSink",b(N(n.prototype),i,t)).call(this,e),r.next=3,this.updateLayer("removeSink");case 3:this._degraded=!1,this.pushInHistory("uiSetLayer-none");case 5:case"end":return r.stop()}var i},r,this)}))}},{key:"getSimulcastDefinitions",value:function(){return g(this._layerDefinitions)}},{key:"setSimulcastDefinitons",value:function(e){this._layerDefinitions=e}},{key:"setLayerFromServer",value:function(e){this._degraded=(e.publisher_degraded||e.subscriber_degraded)&&e.current_layer===ze.NONE,this._degradedAt=this._degraded?new Date:this._degradedAt;var t=e.current_layer;return me.d("[Remote Track] ".concat(this.logIdentifier," \n      streamId=").concat(this.stream.id," \n      trackId=").concat(this.trackId,"\n      layer update from sfu\n      currLayer=").concat(e.current_layer,"\n      preferredLayer=").concat(e.expected_layer,"\n      sub_degraded=").concat(e.subscriber_degraded,"\n      pub_degraded=").concat(e.publisher_degraded,"\n      isDegraded=").concat(this._degraded)),this.stream.setVideoLayerLocally(t,this.logIdentifier,"setLayerFromServer"),this.pushInHistory("sfuLayerUpdate-".concat(t)),this._degraded}},{key:"setDegradedFromSdk",value:function(e){this._degraded=e,this._degradedAt=e?new Date:this._degradedAt,this.updateLayer("sdkDegradation"),this.pushInHistory(e?"sdkDegraded-none":"sdkRecovered-high")}},{key:"updateLayer",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.degraded||!this.hasSinks()?ze.NONE:this.preferredLayer,t.t0=!this.shouldSendVideoLayer(n,e),t.t0){t.next=5;break}return t.next=5,this.requestLayer(n,e);case 5:case"end":return t.stop()}},t,this)}))}},{key:"pushInHistory",value:function(e){bn&&this.history.push({name:e,layer:this.getLayer(),degraded:this.degraded})}},{key:"requestLayer",value:function(e,t){return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.stream.setVideoLayer(e,this.trackId,this.logIdentifier,t);case 3:return r=n.sent,n.abrupt("return",(me.d("[Remote Track] ".concat(this.logIdentifier," \n      streamId=").concat(this.stream.id,"\n      trackId=").concat(this.trackId,"\n      Requested layer ").concat(e,", source=").concat(t)),r));case 7:throw n.prev=7,n.t0=n.catch(0),me.d("[Remote Track] ".concat(this.logIdentifier," \n      streamId=").concat(this.stream.id,"\n      trackId=").concat(this.trackId,"\n      Failed to set layer ").concat(e,", source=").concat(t,"\n      error=").concat(n.t0.message)),n.t0;case 10:case"end":return n.stop()}},n,this,[[0,7]])}))}},{key:"shouldSendVideoLayer",value:function(e,t){var n=this.getLayer();return!(!this.degraded||e!==ze.NONE)||(n!==e||(me.d("[Remote Track] ".concat(this.logIdentifier),"Not sending update, already on layer ".concat(e,", source=").concat(t)),!1))}}]),n}(),In=function(){function e(){M(this,e),this.history=[]}return G(e,[{key:"push",value:function(e){e.time=(new Date).toISOString().split("T")[1],this.history.push(e)}}]),e}();exports.HMSRemoteVideoTrack=An;var Cn,Pn,Rn=function(e){C(n,vt);var t=R(n);function n(){var e;return M(this,n),(e=t.apply(this,arguments)).TAG="[HMSLocalStream]",e.connection=null,e}return G(n,[{key:"setConnection",value:function(e){this.connection=e}},{key:"addTransceiver",value:function(e,t){var n=this.connection.addTransceiver(e.getTrackBeingSent(),{streams:[this.nativeStream],direction:"sendonly",sendEncodings:this.getTrackEncodings(e,t)});return this.setPreferredCodec(n,e.nativeTrack.kind),e.transceiver=n,n}},{key:"setMaxBitrateAndFramerate",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null==(n=this.connection)?void 0:n.setMaxBitrateAndFramerate(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"setPreferredCodec",value:function(e,t){}},{key:"replaceStreamTrack",value:function(e,t){this.nativeStream.addTrack(t),this.nativeStream.removeTrack(e),me.d(this.TAG,"Native stream tracks after replace",this.nativeStream.getAudioTracks().map(pt),"prev Track - ".concat(pt(e)),"new Track - ".concat(pt(t)))}},{key:"replaceSenderTrack",value:function(e,t){return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.connection&&"closed"!==this.connection.connectionState){n.next=3;break}return me.d(this.TAG,"publish connection is not initialised or closed"),n.abrupt("return");case 3:if(void 0!==(r=this.connection.getSenders().find(function(t){return t.track&&t.track.id===e.id}))){n.next=7;break}return me.w(this.TAG,"No sender found for trackId=".concat(e.id)),n.abrupt("return");case 7:return n.next=9,r.replaceTrack(t);case 9:case"end":return n.stop()}},n,this)}))}},{key:"removeSender",value:function(e){var t,n;if(this.connection&&"closed"!==this.connection.connectionState){var r=null==(t=e.transceiver)?void 0:t.sender;if(r){null==(n=this.connection)||n.removeTrack(r);var i=this.tracks.indexOf(e);-1!==i?this.tracks.splice(i,1):me.e(this.TAG,"Cannot find ".concat(e.trackId," in locally stored tracks"))}else me.e(this.TAG,"No sender found for trackId=".concat(e.trackId))}else me.d(this.TAG,"publish connection is not initialised or closed")}},{key:"getTrackEncodings",value:function(e,t){var n=[];if(e instanceof cn)if(t.length>0)me.v(this.TAG,"Simulcast enabled with layers",t),n.push.apply(n,g(t));else{var r={active:this.nativeStream.active};e.settings.maxBitrate&&!se&&(r.maxBitrate=e.settings.maxBitrate),n.push(r)}return n}}]),n}(),_n={isAudioMuted:!1,isVideoMuted:!1,audioInputDeviceId:"default",audioOutputDeviceId:"default",videoDeviceId:"default"},On=function(){function e(t,n,r,i,a){M(this,e),this.store=t,this.observer=n,this.deviceManager=r,this.eventBus=i,this.analyticsTimer=a,this.TAG="[LocalTrackManager]",this.setScreenCaptureHandleConfig()}return G(e,[{key:"getTracksToPublish",value:function(){return ne(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_n;return w().mark(function n(){var r,i,a,s,o,c,u,l,d,h,v;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.getAVTrackSettings(t)){n.next=3;break}return n.abrupt("return",[]);case 3:return i=!!r.audio,a=!!r.video,s=[],n.next=8,e.updateCurrentLocalTrackSettings(r);case 8:if(o=n.sent,c=o.videoTrack,u=o.audioTrack,l=(null==c?void 0:c.stream)||(null==u?void 0:u.stream),d=Boolean(c&&e.store.getTrackById(c.trackId)),h=Boolean(u&&e.store.getTrackById(u.trackId)),!d||!h){n.next=16;break}return n.abrupt("return",[]);case 16:return(v={audio:i&&!u&&(!t.isAudioMuted||"empty"),video:a&&!c&&(!t.isVideoMuted||"empty")}).audio&&e.analyticsTimer.start(Le.LOCAL_AUDIO_TRACK),v.video&&e.analyticsTimer.start(Le.LOCAL_VIDEO_TRACK),n.prev=18,me.d(e.TAG,"Init Local Tracks",{fetchTrackOptions:v}),n.next=22,e.getLocalTracks(v,r,l);case 22:s=n.sent,n.next=30;break;case 25:return n.prev=25,n.t0=n.catch(18),n.next=29,e.retryGetLocalTracks(n.t0,r,v,l);case 29:s=n.sent;case 30:return n.abrupt("return",(v.audio&&e.analyticsTimer.end(Le.LOCAL_AUDIO_TRACK),v.video&&e.analyticsTimer.end(Le.LOCAL_VIDEO_TRACK),c&&a&&!d&&s.push(c),u&&i&&!h&&s.push(u),s));case 31:case"end":return n.stop()}},n,null,[[18,25]])})()})}},{key:"getLocalTracks",value:function(){return ne(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;return w().mark(function i(){var a;return w().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,e.getNativeLocalTracks(t,n);case 3:return a=i.sent,i.abrupt("return",e.createHMSLocalTracks(a,n,r));case 7:throw i.prev=7,i.t0=i.catch(0),e.eventBus.analytics.publish(Ge.publish({devices:e.deviceManager.getDevices(),error:i.t0,settings:n})),i.t0;case 10:case"end":return i.stop()}},i,null,[[0,7]])})()})}},{key:"getNativeLocalTracks",value:function(){return ne(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{audio:!1,video:!1},n=arguments.length>1?arguments[1]:void 0;return w().mark(function r(){var i,a;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=new ht(!0===t.video?n.video:null,!0===t.audio?n.audio:null,n.simulcast),a=[],r.t0=i.audio||i.video,!r.t0){r.next=11;break}return r.t1=a.push,r.t2=a,r.t3=g,r.next=8,e.getAVTracks(i);case 8:r.t4=r.sent,r.t5=(0,r.t3)(r.t4),r.t1.apply.call(r.t1,r.t2,r.t5);case 11:return a.push.apply(a,g(e.getEmptyTracks(t))),r.abrupt("return",a);case 13:case"end":return r.stop()}},r)})()})}},{key:"getLocalScreen",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i,a,s,o,c,u,l,d,h,v,p,f;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getOrDefaultScreenshareConfig(e);case 2:return r=t.sent,i=this.getScreenshareSettings(r.videoOnly),a={video:$(X({},null==i?void 0:i.video.toConstraints(!0)),{displaySurface:r.displaySurface}),preferCurrentTab:r.preferCurrentTab,selfBrowserSurface:r.selfBrowserSurface,surfaceSwitching:r.surfaceSwitching,systemAudio:r.systemAudio},(null==i?void 0:i.audio)&&(delete(s=null==(n=null==i?void 0:i.audio)?void 0:n.toConstraints()).advanced,a.audio=$(X({},s),{autoGainControl:!1,noiseSuppression:!1,googAutoGainControl:!1,echoCancellation:!1})),t.prev=6,me.d("retrieving screenshare with ",{config:r},{constraints:a}),t.next=10,navigator.mediaDevices.getDisplayMedia(a);case 10:o=t.sent,t.next=18;break;case 13:throw t.prev=13,t.t0=t.catch(6),me.w(this.TAG,"error in getting screenshare - ",t.t0),c=$e(t.t0,je.SCREEN),this.eventBus.analytics.publish(Ge.publish({error:c,devices:this.deviceManager.getDevices(),settings:new ht(null==i?void 0:i.video,null==i?void 0:i.audio,!1)})),c;case 18:return u=[],l=new Rn(o),d=o.getVideoTracks()[0],(h=new cn(l,d,"screen",this.eventBus,null==i?void 0:i.video)).setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"screen")),t.prev=20,v=this.validateCurrentTabCapture(h,r.forceCurrentTab),h.isCurrentTab=v,t.next=25,h.cropTo(r.cropTarget);case 25:t.next=30;break;case 27:throw t.prev=27,t.t1=t.catch(20),o.getTracks().forEach(function(e){return e.stop()}),t.t1;case 30:return u.push(h),(p=o.getAudioTracks()[0])&&(f=new Vt(l,p,"screen",this.eventBus,null==i?void 0:i.audio),u.push(f)),t.abrupt("return",(me.v(this.TAG,"getLocalScreen",u),u));case 34:case"end":return t.stop()}},t,this,[[6,13],[20,27]])}))}},{key:"setScreenCaptureHandleConfig",value:function(e){var t;!(null==(t=navigator.mediaDevices)?void 0:t.setCaptureHandleConfig)||this.isInIframe()||(e=e||{},Object.assign(e,{handle:(0,s.v4)(),exposeOrigin:!1,permittedOrigins:[window.location.origin]}),me.d("setting capture handle - ",e.handle),navigator.mediaDevices.setCaptureHandleConfig(e),this.captureHandleIdentifier=e.handle)}},{key:"validateCurrentTabCapture",value:function(e,t){var n=e.getCaptureHandle(),r=!(!this.captureHandleIdentifier||(null==n?void 0:n.handle)!==this.captureHandleIdentifier);if(t&&!r)throw me.e(this.TAG,"current tab was not shared with forceCurrentTab as true"),Qe.TracksErrors.CurrentTabNotShared();return r}},{key:"requestPermissions",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 3:e.sent.getTracks().forEach(function(e){return e.stop()}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),me.e(this.TAG,e.t0);case 9:case"end":return e.stop()}},e,this,[[0,6]])}))}},{key:"getAVTracks",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i,a;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.mediaDevices.getUserMedia({audio:!!e.audio&&e.audio.toConstraints(),video:!!e.video&&e.video.toConstraints()});case 3:return n=t.sent,t.abrupt("return",n.getVideoTracks().concat(n.getAudioTracks()));case 7:return t.prev=7,t.t0=t.catch(0),t.next=11,this.deviceManager.init();case 11:throw r=!(this.deviceManager.hasWebcamPermission||!e.video),i=!(this.deviceManager.hasMicrophonePermission||!e.audio),a=this.getErrorType(r,i),$e(t.t0,a);case 13:case"end":return t.stop()}},t,this,[[0,7]])}))}},{key:"getAVTrackSettings",value:function(e){var t=this.getAudioSettings(e),n=this.getVideoSettings(e);return t||n?(new dt).video(n).audio(t).build():null}},{key:"isInIframe",value:function(){try{return window.self!==window.top}catch(e){return!0}}},{key:"retryGetLocalTracks",value:function(e,t,n,r){return ne(this,null,w().mark(function i(){var a,s,o,c,u,l,d;return w().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(e instanceof Me&&e.action===Fe.TRACK)){i.next=37;break}if(this.observer.onFailure(e),a=e.code===He.TracksErrors.OVER_CONSTRAINED,s=e.message.includes("audio"),o=e.message.includes("video"),!a){i.next=19;break}return c=(new dt).video(new lt).audio(new ct).build(),me.w(this.TAG,"Fetch AV Tracks failed with overconstrained error",{fetchTrackOptions:n},{error:e}),i.prev=6,i.next=9,this.getLocalTracks(n,c,r);case 9:return i.abrupt("return",i.sent);case 12:return i.prev=12,i.t0=i.catch(6),u=i.t0 instanceof Me?i.t0.nativeError:i.t0,l=i.t0,"OverconstrainedError"===(null==u?void 0:u.name)&&((d=Qe.TracksErrors.GenericTrack(Fe.TRACK,"Overconstrained error after dropping all constraints")).addNativeError(u),l=d),i.next=18,this.retryGetLocalTracks(l,t,n,r);case 18:return i.abrupt("return",i.sent);case 19:return n.audio=s?"empty":n.audio,n.video=o?"empty":n.video,me.w(this.TAG,"Fetch AV Tracks failed",{fetchTrackOptions:n},e),i.prev=20,i.next=23,this.getLocalTracks(n,t,r);case 23:return i.abrupt("return",i.sent);case 26:return i.prev=26,i.t1=i.catch(20),me.w(this.TAG,"Fetch empty tacks failed",i.t1),n.audio=n.audio&&"empty",n.video=n.video&&"empty",this.observer.onFailure(i.t1),i.next=34,this.getLocalTracks(n,t,r);case 34:return i.abrupt("return",i.sent);case 35:i.next=38;break;case 37:return i.abrupt("return",(me.w(this.TAG,"Fetch AV Tracks failed - unknown exception",e),this.observer.onFailure(e),[]));case 38:case"end":return i.stop()}},i,this,[[6,12],[20,26]])}))}},{key:"getErrorType",value:function(e,t){return e&&t?je.AV:e?je.VIDEO:t?je.AUDIO:je.UNKNOWN}},{key:"getEmptyTracks",value:function(t){var n=[];return"empty"===t.audio&&n.push(e.getEmptyAudioTrack()),"empty"===t.video&&n.push(e.getEmptyVideoTrack()),n}},{key:"updateCurrentLocalTrackSettings",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i,a,s;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.store.getLocalPeerTracks(),r=n.find(function(e){return e.type===st.VIDEO&&"regular"===e.source}),i=n.find(function(e){return e.type===st.AUDIO&&"regular"===e.source}),a=n.find(function(e){return e.type===st.VIDEO&&"screen"===e.source}),t.t0=null==e?void 0:e.video,!t.t0){t.next=5;break}return t.next=5,null==r?void 0:r.setSettings(e.video);case 5:if(t.t1=null==e?void 0:e.audio,!t.t1){t.next=9;break}return t.next=9,null==i?void 0:i.setSettings(e.audio);case 9:if(s=this.getScreenshareSettings(!0),t.t2=null==s?void 0:s.video,!t.t2){t.next=14;break}return t.next=14,null==a?void 0:a.setSettings(null==s?void 0:s.video);case 14:return t.abrupt("return",{videoTrack:r,audioTrack:i});case 15:case"end":return t.stop()}},t,this)}))}},{key:"getAudioSettings",value:function(e){var t,n=this.store.getPublishParams();if(!n||!(null==(t=n.allowed)?void 0:t.includes("audio")))return null;var r=this.store.getLocalPeer(),i=null==r?void 0:r.audioTrack,a=(null==i?void 0:i.settings.deviceId)||e.audioInputDeviceId;return(new ot).codec(n.audio.codec).maxBitrate(n.audio.bitRate).deviceId(a||_n.audioInputDeviceId).build()}},{key:"getVideoSettings",value:function(e){var t,n=this.store.getPublishParams();if(!n||!(null==(t=n.allowed)?void 0:t.includes("video")))return null;var r=this.store.getLocalPeer(),i=null==r?void 0:r.videoTrack,a=(null==i?void 0:i.settings.deviceId)||e.videoDeviceId,s=n.video;return(new ut).codec(s.codec).maxBitrate(s.bitRate).maxFramerate(s.frameRate).setWidth(s.width).setHeight(s.height).deviceId(a||_n.videoDeviceId).build()}},{key:"getScreenshareSettings",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.store.getPublishParams();if(!n||!(null==(e=n.allowed)?void 0:e.includes("screen")))return null;var r=n.screen;return{video:(new ut).maxBitrate(r.bitRate,!1).codec(r.codec).maxFramerate(r.frameRate).setWidth(r.width).setHeight(r.height).build(),audio:t?void 0:(new ot).build()}}},{key:"getOrDefaultScreenshareConfig",value:function(e){return ne(this,null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((r=Object.assign({videoOnly:!1,audioOnly:!1,forceCurrentTab:!1,preferCurrentTab:!1,selfBrowserSurface:"exclude",surfaceSwitching:"include",systemAudio:"exclude",displaySurface:"monitor"},e||{})).forceCurrentTab&&(r.videoOnly=!0,r.preferCurrentTab=!0,r.selfBrowserSurface="include",r.surfaceSwitching="exclude"),r.preferCurrentTab&&(r.selfBrowserSurface="include",r.displaySurface=void 0),t.t0=r.cropElement&&(null==(n=window.CropTarget)?void 0:n.fromElement),!t.t0){t.next=8;break}return t.next=7,window.CropTarget.fromElement(r.cropElement);case 7:r.cropTarget=t.sent;case 8:return t.abrupt("return",r);case 9:case"end":return t.stop()}},t)}))}},{key:"createHMSLocalTracks",value:function(e,t,n){var r=e.find(function(e){return"video"===e.kind}),i=e.find(function(e){return"audio"===e.kind});n?e.forEach(function(e){return null==n?void 0:n.nativeStream.addTrack(e)}):n=new Rn(new MediaStream(e));var a=[];if(i&&(null==t?void 0:t.audio)){var s=new Vt(n,i,"regular",this.eventBus,t.audio);a.push(s)}if(r&&(null==t?void 0:t.video)){var o=new cn(n,r,"regular",this.eventBus,t.video);o.setSimulcastDefinitons(this.store.getSimulcastDefinitionsForPeer(this.store.getLocalPeer(),"regular")),a.push(o)}return a}}],[{key:"getEmptyVideoTrack",value:function(e){var t,n,r,i=(null==(t=null==e?void 0:e.getSettings())?void 0:t.width)||320,a=(null==(n=null==e?void 0:e.getSettings())?void 0:n.height)||240;Cn||((Cn=document.createElement("canvas")).width=i,Cn.height=a,null==(r=Cn.getContext("2d",{willReadFrequently:!0}))||r.fillRect(0,0,i,a));var s=Cn.captureStream(10).getVideoTracks()[0],o=setInterval(function(){if("ended"!==s.readyState){var e=Cn.getContext("2d");if(e){var t=0===e.getImageData(0,0,1,1).data[0]?1:0;e.fillStyle="rgb(".concat(t,", 0, 0)"),e.fillRect(0,0,1,1)}}else clearInterval(o)},100);return s.onended=function(){clearInterval(o)},s.enabled=!1,s}},{key:"getEmptyAudioTrack",value:function(){var e=Dt.getAudioContext(),t=e.createOscillator(),n=e.createMediaStreamDestination();t.connect(n),t.start();var r=n.stream.getAudioTracks()[0];return r.enabled=!1,r}}]),e}(),Dn=function(){function e(t,n){var r=this;M(this,e),this.eventBus=t,this.listener=n,this.TAG="[NetworkTestManager]",this.controller=new AbortController,this.start=function(e){return ne(r,null,w().mark(function t(){var n,r,i,a,s,o,c,u,l,d,h=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return r=e.url,i=e.timeout,a=e.scoreMap,s=this.controller.signal,o=Date.now(),c=0,u=Mt(i).then(function(){h.controller.abort()}),t.prev=3,t.next=6,fetch("".concat(r,"?").concat(Date.now()),{signal:s});case 6:if(t.t0=n=t.sent.body,null!=t.t0){t.next=11;break}t.t1=void 0,t.next=12;break;case 11:t.t1=n.getReader();case 12:if(l=t.t1){t.next=15;break}throw Error("unable to process request");case 15:return d=function(){return ne(h,null,w().mark(function e(){var t,n,r,i;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=17;break}e.prev=1,t=!1;case 3:if(t){e.next=12;break}return e.next=6,l.read();case 6:n=e.sent,r=n.value,i=n.done,t=i,r&&(c+=r.byteLength,this.sendScore({scoreMap:a,downloadedSize:c,startTime:o}));case 10:e.next=3;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),"AbortError"!==e.t0.name&&me.d(this.TAG,e.t0);case 17:case"end":return e.stop()}},e,this,[[1,14]])}))},t.abrupt("return",Promise.race([d(),u]).then(function(){h.sendScore({scoreMap:a,downloadedSize:c,startTime:o,finished:!0})}).catch(function(e){me.e(h.TAG,e),h.updateScoreToListener(0),h.eventBus.analytics.publish(Ge.previewNetworkQuality({error:e.message}))}));case 19:t.prev=19,t.t2=t.catch(3),"AbortError"!==t.t2.name?(me.d(this.TAG,t.t2),this.updateScoreToListener(0),this.eventBus.analytics.publish(Ge.previewNetworkQuality({error:t.t2.message}))):me.d(this.TAG,t.t2);case 22:case"end":return t.stop()}},t,this,[[3,19]])}))},this.stop=function(){r.controller.signal.aborted||r.controller.abort()},this.sendScore=function(e){var t=e.scoreMap,n=e.downloadedSize,i=e.startTime,a=e.finished,s=void 0!==a&&a,o=n/1024/((Date.now()-i)/1e3)*8,c=-1;for(var u in t){var l=t[u];o>=l.low&&(!l.high||o<=l.high)&&(c=Number(u))}r.updateScoreToListener(c),s&&r.eventBus.analytics.publish(Ge.previewNetworkQuality({score:c,downLink:o.toFixed(2)}))}}return G(e,[{key:"updateScoreToListener",value:function(e){var t,n;e!==this.score&&(this.score=e,null==(n=null==(t=this.listener)?void 0:t.onNetworkQuality)||n.call(t,e))}}]),e}(),Nn=function(){function e(t,n,r,i,a){var s=this;M(this,e),this.store=t,this.transport=n,this.publish=r,this.removeAuxiliaryTrack=i,this.listener=a,this.handleLocalPeerRoleUpdate=function(e){return ne(s,[e],function(e){var t=this,n=e.oldRole,r=e.newRole;return w().mark(function e(){var i,a;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.store.getLocalPeer(),e.t0=!a,e.t0){e.next=6;break}return e.next=5,t.diffRolesAndPublishTracks({oldRole:n,newRole:r});case 5:null==(i=t.listener)||i.onPeerUpdate(Je.ROLE_UPDATED,a);case 6:case"end":return e.stop()}},e)})()})},this.diffRolesAndPublishTracks=function(e){return ne(s,[e],function(e){var t=this,n=e.oldRole,r=e.newRole;return w().mark(function e(){var i,a,s,o,c,u,l,d,h,v,p,f,k,g,m,T;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d=new Set(n.publishParams.allowed),h=new Set(r.publishParams.allowed),v=t.removeTrack(d,h,"video"),p=t.removeTrack(d,h,"audio"),f=t.removeTrack(d,h,"screen"),k=t.hasSimulcastDifference(null==(i=n.publishParams.simulcast)?void 0:i.video,null==(a=r.publishParams.simulcast)?void 0:a.video),g=t.hasSimulcastDifference(null==(s=n.publishParams.simulcast)?void 0:s.screen,null==(o=r.publishParams.simulcast)?void 0:o.screen),m=null==(u=null==(c=t.store.getLocalPeer())?void 0:c.videoTrack)?void 0:u.enabled,e.next=3,t.removeAudioTrack(p);case 3:return e.next=5,t.removeVideoTracks(v||k);case 5:return e.next=7,t.removeScreenTracks(f||g);case 7:return T=(null==(l=t.store.getConfig())?void 0:l.settings)||{isAudioMuted:!0,isVideoMuted:!0,audioInputDeviceId:"default",videoDeviceId:"default",audioOutputDeviceId:"default"},k&&(T.isVideoMuted=!m),e.next=11,t.publish(T);case 11:case"end":return e.stop()}},e)})()})}}return G(e,[{key:"removeVideoTracks",value:function(e){return ne(this,null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(r=this.store.getLocalPeer(),t.t0=null==r?void 0:r.videoTrack,!t.t0){t.next=14;break}if(!r.videoTrack.isPublished){t.next=10;break}return t.next=8,this.transport.unpublish([r.videoTrack]);case 8:t.next=12;break;case 10:return t.next=12,r.videoTrack.cleanup();case 12:null==(n=this.listener)||n.onTrackUpdate(qe.TRACK_REMOVED,r.videoTrack,r),r.videoTrack=void 0;case 14:return t.next=16,this.removeAuxTracks(function(e){return"screen"!==e.source&&"video"===e.type});case 16:case"end":return t.stop()}},t,this)}))}},{key:"removeAudioTrack",value:function(e){return ne(this,null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:if(r=this.store.getLocalPeer(),t.t0=null==r?void 0:r.audioTrack,!t.t0){t.next=14;break}if(!r.audioTrack.isPublished){t.next=10;break}return t.next=8,this.transport.unpublish([r.audioTrack]);case 8:t.next=12;break;case 10:return t.next=12,r.audioTrack.cleanup();case 12:null==(n=this.listener)||n.onTrackUpdate(qe.TRACK_REMOVED,r.audioTrack,r),r.audioTrack=void 0;case 14:return t.next=16,this.removeAuxTracks(function(e){return"screen"!==e.source&&"audio"===e.type});case 16:case"end":return t.stop()}},t,this)}))}},{key:"removeScreenTracks",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=!e,t.t0){t.next=4;break}return t.next=4,this.removeAuxTracks(function(e){return"screen"===e.source});case 4:case"end":return t.stop()}},t,this)}))}},{key:"removeAuxTracks",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i,a,s;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null==(n=this.store.getLocalPeer())?void 0:n.auxiliaryTracks)){t.next=22;break}r=g(n.auxiliaryTracks),i=B(r),t.prev=4,i.s();case 6:if((a=i.n()).done){t.next=14;break}if(s=a.value,t.t0=e(s),!t.t0){t.next=12;break}return t.next=12,this.removeAuxiliaryTrack(s.trackId);case 12:t.next=6;break;case 14:t.next=19;break;case 16:t.prev=16,t.t1=t.catch(4),i.e(t.t1);case 19:return t.prev=19,i.f(),t.finish(19);case 22:case"end":return t.stop()}},t,this,[[4,16,19,22]])}))}},{key:"removeTrack",value:function(e,t,n){return e.has(n)&&!t.has(n)}},{key:"hasSimulcastDifference",value:function(e,t){var n,r,i;return!(!e&&!t)&&((null==(n=null==e?void 0:e.layers)?void 0:n.length)!==(null==(r=null==t?void 0:t.layers)?void 0:r.length)||!!(null==(i=null==e?void 0:e.layers)?void 0:i.some(function(e){var n,r=null==(n=null==t?void 0:t.layers)?void 0:n.find(function(t){return t.rid===e.rid});return(null==r?void 0:r.maxBitrate)!==e.maxBitrate||(null==r?void 0:r.maxFramerate)!==e.maxFramerate})))}}]),e}(),Mn=function(){function e(){M(this,e),this.TAG="[HTTPAnalyticsTransport]",this.failedEvents=new ie("client-events"),this.isConnected=!0,this.env=null,this.websocketURL=""}return G(e,[{key:"setEnv",value:function(e){this.env=e,this.flushFailedEvents()}},{key:"setWebsocketEndpoint",value:function(e){this.websocketURL=e}},{key:"sendEvent",value:function(e){var t=this;if(this.env&&this.websocketURL){var n={event:e.name,payload:e.properties,event_id:String(e.timestamp),peer:e.metadata.peer,timestamp:e.timestamp,device_id:e.device_id,cluster:{websocket_url:this.websocketURL}},r=this.env===j.PROD?En:wn;fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.metadata.token),user_agent_v2:e.metadata.userAgent},body:JSON.stringify(n)}).then(function(n){if(401!==n.status){if(200!==n.status)throw Error(n.statusText);t.removeFromStorage(e)}else t.removeFromStorage(e)}).catch(function(n){me.v(t.TAG,"Failed to send event",n,e),t.addEventToStorage(e)})}else this.addEventToStorage(e)}},{key:"flushFailedEvents",value:function(){var e=this,t=this.failedEvents.get();null==t||t.forEach(function(t){return e.sendEvent(t)})}},{key:"addEventToStorage",value:function(e){var t=this.failedEvents.get()||[];t.find(function(t){return t.timestamp===e.timestamp})||(t.length===Sn&&t.shift(),t.push(e),this.failedEvents.set(t))}},{key:"removeFromStorage",value:function(e){var t=this.failedEvents.get()||[],n=t.findIndex(function(t){return t.timestamp===e.timestamp});n>-1&&(t.splice(n,1),this.failedEvents.set(t))}}]),e}(),Ln=new Mn,Gn=function(){function e(){M(this,e),this.knownRoles={},this.peers={},this.tracks=new Map,this.peerTrackStates={},this.speakers=[],this.roleDetailsArrived=!1,this.env=j.PROD,this.simulcastEnabled=!1,this.userAgent=Pe(this.env)}return G(e,[{key:"getConfig",value:function(){return this.config}},{key:"setSimulcastEnabled",value:function(e){this.simulcastEnabled=e}},{key:"getEnv",value:function(){return this.env}},{key:"getPublishParams",value:function(){var e=this.getLocalPeer(),t=(null==e?void 0:e.asRole)||(null==e?void 0:e.role);return null==t?void 0:t.publishParams}},{key:"getRoom",value:function(){return this.room}},{key:"getPolicyForRole",value:function(e){return this.knownRoles[e]}},{key:"getKnownRoles",value:function(){return this.knownRoles}},{key:"getTemplateAppData",value:function(){return this.templateAppData}},{key:"getLocalPeer",value:function(){if(this.localPeerId&&this.peers[this.localPeerId])return this.peers[this.localPeerId]}},{key:"getRemotePeers",value:function(){return Object.values(this.peers).filter(function(e){return!e.isLocal})}},{key:"getPeers",value:function(){return Object.values(this.peers)}},{key:"getPeerById",value:function(e){if(this.peers[e])return this.peers[e]}},{key:"getTracksMap",value:function(){return this.tracks}},{key:"getTracks",value:function(){return Array.from(this.tracks.values())}},{key:"getVideoTracks",value:function(){return this.getTracks().filter(function(e){return e.type===st.VIDEO})}},{key:"getRemoteVideoTracks",value:function(){return this.getTracks().filter(function(e){return e instanceof An})}},{key:"getAudioTracks",value:function(){return this.getTracks().filter(function(e){return e.type===st.AUDIO})}},{key:"getPeerTracks",value:function(e){var t=e?this.peers[e]:void 0,n=[];return(null==t?void 0:t.videoTrack)&&n.push(t.videoTrack),(null==t?void 0:t.audioTrack)&&n.push(t.audioTrack),n.concat((null==t?void 0:t.auxiliaryTracks)||[])}},{key:"getLocalPeerTracks",value:function(){return this.getPeerTracks(this.localPeerId)}},{key:"hasTrack",value:function(e){return this.tracks.has(e)}},{key:"getTrackById",value:function(e){var t,n,r=Array.from(this.tracks.values()).find(function(t){return t.trackId===e});if(r)return r;var i=this.getLocalPeer();if(i){if(null==(t=i.audioTrack)?void 0:t.isPublishedTrackId(e))return i.audioTrack;if(null==(n=i.videoTrack)?void 0:n.isPublishedTrackId(e))return i.videoTrack}}},{key:"getPeerByTrackId",value:function(e){var t=Array.from(this.tracks.values()).find(function(t){return t.trackId===e});return(null==t?void 0:t.peerId)?this.peers[t.peerId]:void 0}},{key:"getSpeakers",value:function(){return this.speakers}},{key:"getSpeakerPeers",value:function(){return this.speakers.map(function(e){return e.peer})}},{key:"getUserAgent",value:function(){return this.userAgent}},{key:"createAndSetUserAgent",value:function(e){this.userAgent=Pe(this.env,e)}},{key:"setRoom",value:function(e){this.room=e}},{key:"setKnownRoles",value:function(e){var t,n;if(this.knownRoles=e.known_roles,this.roleDetailsArrived=!0,this.templateAppData=e.app_data,this.simulcastEnabled){var r=null==(t=this.knownRoles[e.name])?void 0:t.publishParams;this.videoLayers=this.convertSimulcastLayers(null==(n=r.simulcast)?void 0:n.video),this.updatePeersPolicy()}}},{key:"hasRoleDetailsArrived",value:function(){return this.roleDetailsArrived}},{key:"setConfig",value:function(e){var t,n,r;if(bt.rememberDevices(Boolean(e.rememberDeviceSelection)),e.rememberDeviceSelection){var i=bt.getSelection();i&&(e.settings||(e.settings={}),(null==(t=i.audioInput)?void 0:t.deviceId)&&(e.settings.audioInputDeviceId=e.settings.audioInputDeviceId||i.audioInput.deviceId),(null==(n=i.audioOutput)?void 0:n.deviceId)&&(e.settings.audioOutputDeviceId=e.settings.audioOutputDeviceId||i.audioOutput.deviceId),(null==(r=i.videoInput)?void 0:r.deviceId)&&(e.settings.videoDeviceId=e.settings.videoDeviceId||i.videoInput.deviceId))}e.autoManageVideo=!1!==e.autoManageVideo,e.autoManageWakeLock=!1!==e.autoManageWakeLock,this.config=e,this.setEnv()}},{key:"addPeer",value:function(e){this.peers[e.peerId]=e,e.isLocal&&(this.localPeerId=e.peerId)}},{key:"addTrack",value:function(e){this.tracks.set(e,e)}},{key:"getTrackState",value:function(e){return this.peerTrackStates[e]}},{key:"setTrackState",value:function(e){this.peerTrackStates[e.trackInfo.track_id]=e}},{key:"removePeer",value:function(e){this.localPeerId===e&&(this.localPeerId=void 0),delete this.peers[e]}},{key:"removeTrack",value:function(e){this.tracks.delete(e)}},{key:"updateSpeakers",value:function(e){this.speakers=e}},{key:"updateAudioOutputVolume",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=B(this.getAudioTracks()),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=9;break}return i=r.value,t.next=7,i.setVolume(e);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),n.e(t.t0);case 14:return t.prev=14,n.f(),t.finish(14);case 17:case"end":return t.stop()}},t,this,[[1,11,14,17]])}))}},{key:"updateAudioOutputDevice",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],this.getAudioTracks().forEach(function(t){t instanceof Ht&&n.push(t.setOutputDevice(e))}),t.next=4,Promise.all(n);case 4:case"end":return t.stop()}},t,this)}))}},{key:"getSimulcastLayers",value:function(e){var t;return this.simulcastEnabled&&["screen","regular"].includes(e)?"screen"===e?[]:(null==(t=this.videoLayers)?void 0:t.layers)||[]:[]}},{key:"convertSimulcastLayers",value:function(e){if(e)return $(X({},e),{layers:(e.layers||[]).map(function(e){return $(X({},e),{maxBitrate:1e3*e.maxBitrate})})})}},{key:"getSimulcastDefinitionsForPeer",value:function(e,t){var n,r,i;if([!e||!e.role,"screen"===t,!this.simulcastEnabled].some(function(e){return!!e}))return[];var a,s,o,c=this.getPolicyForRole(e.role.name).publishParams;return"regular"===t?(a=null==(n=c.simulcast)?void 0:n.video,s=c.video.width,o=c.video.height):"screen"===t&&(a=null==(r=c.simulcast)?void 0:r.screen,s=c.screen.width,o=c.screen.height),(null==(i=null==a?void 0:a.layers)?void 0:i.map(function(e){return{layer:at[e.rid],resolution:{width:s/e.scaleResolutionDownBy,height:o/e.scaleResolutionDownBy}}}))||[]}},{key:"getErrorListener",value:function(){return this.errorListener}},{key:"cleanUp",value:function(){var e,t=B(this.getTracks());try{for(t.s();!(e=t.n()).done;){e.value.cleanup()}}catch(n){t.e(n)}finally{t.f()}this.room=void 0,this.config=void 0,this.localPeerId=void 0,this.roleDetailsArrived=!1}},{key:"setErrorListener",value:function(e){this.errorListener=e}},{key:"updatePeersPolicy",value:function(){var e=this;this.getPeers().forEach(function(t){var n;t.role?t.role=e.getPolicyForRole(t.role.name):null==(n=e.errorListener)||n.onError(Qe.GenericErrors.InvalidRole(Fe.VALIDATION,""))})}},{key:"setEnv",value:function(){var e,t=(null==(e=this.config)?void 0:e.initEndpoint).split("https://")[1],n=j.PROD;t.startsWith(j.PROD)?n=j.PROD:t.startsWith(j.QA)?n=j.QA:t.startsWith(j.DEV)&&(n=j.DEV),this.env=n,Ln.setEnv(n)}}]),e}(),Un=G(function e(){var t=this;M(this,e),this.TAG="[WakeLockManager]",this.wakeLock=null,this.acquireLock=function(){return ne(t,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.requestWakeLock();case 2:null==document||document.addEventListener("visibilitychange",this.visibilityHandler);case 3:case"end":return e.stop()}},e,this)}))},this.cleanup=function(){return ne(t,null,w().mark(function e(){var t;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.wakeLock||this.wakeLock.released){e.next=11;break}return e.prev=1,e.next=4,this.wakeLock.release();case 4:me.d(this.TAG,"Wake lock released"),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),t=e.t0,me.e(this.TAG,"Error while releasing wake lock","name=".concat(t.name,", message=").concat(t.message));case 11:this.wakeLock=null;case 12:case"end":return e.stop()}},e,this,[[1,7]])}))},this.visibilityHandler=function(){return ne(t,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="visible"===(null==document?void 0:document.visibilityState)&&(!this.wakeLock||this.wakeLock.released),!e.t0){e.next=5;break}return me.d(this.TAG,"Re-acquiring wake lock due to visibility change"),e.next=5,this.requestWakeLock();case 5:case"end":return e.stop()}},e,this)}))},this.requestWakeLock=function(){return ne(t,null,w().mark(function e(){var t;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"wakeLock"in navigator){e.next=4;break}return me.d(this.TAG,"Wake lock feature not supported"),e.abrupt("return");case 4:return e.next=6,navigator.wakeLock.request("screen");case 6:this.wakeLock=e.sent,me.d(this.TAG,"Wake lock acquired"),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),t=e.t0,me.e(this.TAG,"Error acquiring wake lock","name=".concat(t.name,", message=").concat(t.message));case 14:case"end":return e.stop()}},e,this,[[0,10]])}))}}),Fn=function(){function e(t){M(this,e),this.store=t,this.bufferSize=dn,this.TAG="[AnalyticsEventsService]",this.transport=null,this.pendingEvents=[],this.level=_e.INFO}return G(e,[{key:"setTransport",value:function(e){this.transport=e}},{key:"reset",value:function(){this.transport=null,this.pendingEvents=[]}},{key:"queue",value:function(e){if(e.level>=this.level&&(this.pendingEvents.push(e),this.pendingEvents.length>this.bufferSize)){var t=this.pendingEvents.shift();me.d(this.TAG,"Max buffer size reached","Removed event to accommodate new events",t)}return this}},{key:"flushFailedClientEvents",value:function(){Ln.flushFailedEvents()}},{key:"flush",value:function(){var e;try{for(;this.pendingEvents.length>0;){var t=this.pendingEvents.shift();t&&(t.metadata.peer.peer_id=null==(e=this.store.getLocalPeer())?void 0:e.peerId,t.metadata.userAgent=this.store.getUserAgent(),this.transport&&this.transport.transportProvider.isConnected?this.transport.sendEvent(t):this.sendClientEventOnHTTP(t))}}catch(n){me.w(this.TAG,"Flush Failed",n)}}},{key:"sendClientEventOnHTTP",value:function(e){var t,n,r,i,a=this.store.getRoom(),s=this.store.getLocalPeer();e.metadata.token=null==(t=this.store.getConfig())?void 0:t.authToken,e.metadata.peer={session_id:null==a?void 0:a.sessionId,room_id:null==a?void 0:a.id,room_name:null==a?void 0:a.name,template_id:null==a?void 0:a.templateId,joined_at:null==(n=null==a?void 0:a.joinedAt)?void 0:n.getTime(),session_started_at:null==(r=null==a?void 0:a.startedAt)?void 0:r.getTime(),role:null==(i=null==s?void 0:s.role)?void 0:i.name,user_name:null==s?void 0:s.name,user_data:null==s?void 0:s.metadata},Ln.sendEvent(e)}}]),e}(),Bn={autoplayFailed:void 0,initialized:!1,autoplayCheckPromise:void 0},Vn=function(){function e(t,n,r){var i=this;M(this,e),this.store=t,this.deviceManager=n,this.eventBus=r,this.autoPausedTracks=new Set,this.TAG="[AudioSinkManager]:",this.volume=100,this.state=X({},Bn),this.handleAudioPaused=function(e){return ne(i,null,w().mark(function t(){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null==(r=null==(n=e.target.srcObject)?void 0:n.getAudioTracks()[0])?void 0:r.enabled){t.next=3;break}return t.abrupt("return");case 3:if(me.d(this.TAG,"Audio Paused",e.target.id),i=this.store.getTrackById(e.target.id),t.t0=i,!t.t0){t.next=14;break}if(!le()){t.next=13;break}return t.next=10,Mt(500);case 10:this.playAudioFor(i),t.next=14;break;case 13:this.autoPausedTracks.add(i);case 14:case"end":return t.stop()}},t,this)}))},this.handleTrackUpdate=function(e){var t=e.track;me.d(i.TAG,"Track updated","".concat(t))},this.handleTrackAdd=function(e){return ne(i,[e],function(e){var t=this,n=e.track,r=e.peer,i=e.callListener,a=void 0===i||i;return w().mark(function e(){var i,s,o;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((o=document.createElement("audio")).style.display="none",o.id=n.trackId,o.addEventListener("pause",t.handleAudioPaused),o.onerror=function(){return ne(t,null,w().mark(function e(){var t,i,a;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(me.e(this.TAG,"error on audio element",o.error),a=Qe.TracksErrors.AudioPlaybackError("Audio playback error for track - ".concat(n.trackId," code - ").concat(null==(t=null==o?void 0:o.error)?void 0:t.code)),this.eventBus.analytics.publish(Ge.audioPlaybackError(a)),e.t0=(null==(i=null==o?void 0:o.error)?void 0:i.code)===MediaError.MEDIA_ERR_DECODE,!e.t0){e.next=10;break}return this.removeAudioElement(o,n),e.next=8,Mt(500);case 8:return e.next=10,this.handleTrackAdd({track:n,peer:r,callListener:!1});case 10:case"end":return e.stop()}},e,this)}))},n.setAudioElement(o),n.setVolume(t.volume),me.d(t.TAG,"Audio track added","".concat(n)),t.init(),null==(i=t.audioSink)||i.append(o),e.t0=t.outputDevice,!e.t0){e.next=14;break}return e.next=14,n.setOutputDevice(t.outputDevice);case 14:return o.srcObject=new MediaStream([n.nativeTrack]),a&&(null==(s=t.listener)||s.onTrackUpdate(qe.TRACK_ADDED,n,r)),e.next=18,t.handleAutoplayError(n);case 18:case"end":return e.stop()}},e)})()})},this.handleAutoplayError=function(e){return ne(i,null,w().mark(function t(){var n=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=void 0===this.state.autoplayFailed,!t.t0){t.next=5;break}return this.state.autoplayCheckPromise||(this.state.autoplayCheckPromise=new Promise(function(t){n.playAudioFor(e).then(t)})),t.next=5,this.state.autoplayCheckPromise;case 5:if(!this.state.autoplayFailed){t.next=8;break}return this.autoPausedTracks.add(e),t.abrupt("return");case 8:return t.next=10,this.playAudioFor(e);case 10:case"end":return t.stop()}},t,this)}))},this.handleAudioDeviceChange=function(e){e.error||!e.selection||"video"===e.type||i.unpauseAudioTracks()},this.handleTrackRemove=function(e){i.autoPausedTracks.delete(e);var t=document.getElementById(e.trackId);t&&i.removeAudioElement(t,e),i.audioSink&&0===i.audioSink.childElementCount&&(i.state.autoplayCheckPromise=void 0,i.state.autoplayFailed=void 0),me.d(i.TAG,"Audio track removed","".concat(e))},this.unpauseAudioTracks=function(){return ne(i,null,w().mark(function e(){var t,n=this;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],this.autoPausedTracks.forEach(function(e){t.push(n.playAudioFor(e))}),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}},e,this)}))},this.removeAudioElement=function(e,t){e&&(me.d(i.TAG,"removing audio element","".concat(t)),e.removeEventListener("pause",i.handleAudioPaused),e.srcObject=null,e.remove(),t.setAudioElement(null))},this.eventBus.audioTrackAdded.subscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.subscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.subscribe(this.handleTrackUpdate),this.eventBus.deviceChange.subscribe(this.handleAudioDeviceChange)}return G(e,[{key:"setListener",value:function(e){this.listener=e}},{key:"outputDevice",get:function(){return this.deviceManager.outputDevice}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.store.updateAudioOutputVolume(e);case 2:this.volume=e;case 3:case"end":return t.stop()}},t,this)}))}},{key:"unblockAutoplay",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.autoPausedTracks.size>0&&this.unpauseAudioTracks();case 1:case"end":return e.stop()}},e,this)}))}},{key:"init",value:function(e){if(!this.state.initialized&&!this.audioSink){this.state.initialized=!0;var t=document.createElement("div");t.id="HMS-SDK-audio-sink-".concat((0,s.v4)()),(e&&document.getElementById(e)||document.body).append(t),this.audioSink=t,me.d(this.TAG,"audio sink created",this.audioSink)}}},{key:"cleanUp",value:function(){var e;null==(e=this.audioSink)||e.remove(),this.audioSink=void 0,this.eventBus.audioTrackAdded.unsubscribe(this.handleTrackAdd),this.eventBus.audioTrackRemoved.unsubscribe(this.handleTrackRemove),this.eventBus.audioTrackUpdate.unsubscribe(this.handleTrackUpdate),this.eventBus.deviceChange.unsubscribe(this.handleAudioDeviceChange),this.autoPausedTracks=new Set,this.state=X({},Bn)}},{key:"playAudioFor",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.getAudioElement()){t.next=4;break}return me.w(this.TAG,"No audio element found on track",e.trackId),t.abrupt("return");case 4:return t.prev=4,t.next=7,n.play();case 7:this.state.autoplayFailed=!1,this.autoPausedTracks.delete(e),me.d(this.TAG,"Played track","".concat(e)),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),this.autoPausedTracks.add(e),me.e(this.TAG,"Failed to play track","".concat(e),t.t0),r=t.t0,this.state.autoplayFailed||"NotAllowedError"!==r.name||(this.state.autoplayFailed=!0,(i=Qe.TracksErrors.AutoplayBlocked(Fe.AUTOPLAY,"")).addNativeError(r),this.eventBus.analytics.publish(Ge.autoplayError()),this.eventBus.autoplayError.publish(i));case 17:case"end":return t.stop()}},t,this,[[4,12]])}))}}]),e}(),Hn=function(){function e(t,n){var r=this;M(this,e),this.store=t,this.eventBus=n,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.hasWebcamPermission=!1,this.hasMicrophonePermission=!1,this.TAG="[Device Manager]:",this.initialized=!1,this.videoInputChanged=!1,this.audioInputChanged=!1,this.updateOutputDevice=function(e){return ne(r,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.audioOutput.find(function(t){return t.deviceId===e}),t.t0=n,!t.t0){t.next=7;break}return this.outputDevice=n,t.next=6,this.store.updateAudioOutputDevice(n);case 6:bt.updateSelection("audioOutput",{deviceId:n.deviceId,groupId:n.groupId});case 7:return t.abrupt("return",n);case 8:case"end":return t.stop()}},t,this)}))},this.getCurrentSelection=function(){var e,t,n=r.store.getLocalPeer(),i=r.createIdentifier(null==(e=null==n?void 0:n.audioTrack)?void 0:e.getMediaTrackSettings()),a=r.createIdentifier(null==(t=null==n?void 0:n.videoTrack)?void 0:t.getMediaTrackSettings());return{audioInput:r.audioInput.find(function(e){return r.createIdentifier(e)===i}),videoInput:r.videoInput.find(function(e){return r.createIdentifier(e)===a}),audioOutput:r.outputDevice}},this.computeChange=function(e,t){return e.length!==t.length||t.some(function(t){return!e.includes(r.createIdentifier(t))})},this.enumerateDevices=function(){return ne(r,null,w().mark(function e(){var t,n,r,i=this;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:t=e.sent,n=this.videoInput.map(this.createIdentifier),r=this.audioInput.map(this.createIdentifier),this.audioInput=[],this.audioOutput=[],this.videoInput=[],t.forEach(function(e){"audioinput"===e.kind&&e.label?(i.hasMicrophonePermission=!0,i.audioInput.push(e)):"audiooutput"===e.kind?i.audioOutput.push(e):"videoinput"===e.kind&&e.label&&(i.hasWebcamPermission=!0,i.videoInput.push(e))}),this.videoInputChanged=this.computeChange(n,this.videoInput),this.audioInputChanged=this.computeChange(r,this.audioInput),bt.setDevices({videoInput:g(this.videoInput),audioInput:g(this.audioInput),audioOutput:g(this.audioOutput)}),this.logDevices("Enumerate Devices"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),me.e(this.TAG,"Failed enumerating devices",e.t0);case 12:case"end":return e.stop()}},e,this,[[0,9]])}))},this.handleDeviceChange=Lt(function(){return ne(r,null,w().mark(function e(){var t;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:return this.logDevices("After Device Change"),t=this.store.getLocalPeer(),e.next=6,this.setOutputDevice(!0);case 6:return e.next=8,this.handleAudioInputDeviceChange(null==t?void 0:t.audioTrack);case 8:return e.next=10,this.handleVideoInputDeviceChange(null==t?void 0:t.videoTrack);case 10:this.eventBus.analytics.publish(Ge.deviceChange({selection:this.getCurrentSelection(),type:"change",devices:this.getDevices()}));case 11:case"end":return e.stop()}},e,this)}))},500).bind(this),this.handleAudioInputDeviceChange=function(e){return ne(r,null,w().mark(function t(){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return me.d(this.TAG,"No Audio track on local peer"),t.abrupt("return");case 3:if(this.audioInputChanged){t.next=6;break}return me.d(this.TAG,"No Change in AudioInput Device"),t.abrupt("return");case 6:if((n=this.getNewAudioInputDevice())&&n.deviceId){t.next=10;break}return this.eventBus.analytics.publish(Ge.deviceChange({selection:{audioInput:n},error:new Error("Audio device not found"),devices:this.getDevices(),type:"audioInput"})),me.w(this.TAG,"Audio device not found"),t.abrupt("return");case 10:return r=e.settings,i=(new ot).codec(r.codec).maxBitrate(r.maxBitrate).deviceId(n.deviceId).build(),t.prev=11,t.next=14,e.setSettings(i,!0);case 14:this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"audioInput"}),this.logDevices("Audio Device Change Success"),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),me.e(this.TAG,"[Audio Device Change]",t.t0),this.eventBus.analytics.publish(Ge.deviceChange({selection:{audioInput:n},devices:this.getDevices(),type:"audioInput",error:t.t0})),this.eventBus.deviceChange.publish({error:t.t0,selection:n,type:"audioInput",devices:this.getDevices()});case 21:case"end":return t.stop()}},t,this,[[11,18]])}))},this.handleVideoInputDeviceChange=function(e){return ne(r,null,w().mark(function t(){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return me.d(this.TAG,"No video track on local peer"),t.abrupt("return");case 3:if(this.videoInputChanged){t.next=6;break}return me.d(this.TAG,"No Change in VideoInput Device"),t.abrupt("return");case 6:if((n=this.videoInput[0])&&n.deviceId){t.next=10;break}return this.eventBus.analytics.publish(Ge.deviceChange({selection:{videoInput:n},error:new Error("Video device not found"),devices:this.getDevices(),type:"video"})),me.w(this.TAG,"Video device not found"),t.abrupt("return");case 10:return r=e.settings,i=(new ut).codec(r.codec).maxBitrate(r.maxBitrate).maxFramerate(r.maxFramerate).setWidth(r.width).setHeight(r.height).deviceId(n.deviceId).build(),t.prev=11,t.next=14,e.setSettings(i,!0);case 14:this.eventBus.deviceChange.publish({devices:this.getDevices(),selection:n,type:"video"}),this.logDevices("Video Device Change Success"),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),me.e(this.TAG,"[Video Device Change]",t.t0),this.eventBus.analytics.publish(Ge.deviceChange({selection:{videoInput:n},devices:this.getDevices(),type:"video",error:t.t0})),this.eventBus.deviceChange.publish({error:t.t0,type:"video",selection:n,devices:this.getDevices()});case 21:case"end":return t.stop()}},t,this,[[11,18]])}))};var i=function(e){var t=e.enabled,n=e.track;return t&&"regular"===n.source};this.eventBus.localVideoEnabled.waitFor(i).then(function(){return ne(r,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:this.videoInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()});case 3:case"end":return e.stop()}},e,this)}))}),this.eventBus.localAudioEnabled.waitFor(i).then(function(){return ne(r,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:this.audioInputChanged&&this.eventBus.deviceChange.publish({devices:this.getDevices()});case 3:case"end":return e.stop()}},e,this)}))})}return G(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.initialized&&!e,t.t0){t.next=11;break}return!this.initialized&&navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange),this.initialized=!0,t.next=6,this.enumerateDevices();case 6:return this.logDevices("Init"),t.next=9,this.setOutputDevice();case 9:this.eventBus.deviceChange.publish({devices:this.getDevices()}),this.eventBus.analytics.publish(Ge.deviceChange({selection:this.getCurrentSelection(),type:"list",devices:this.getDevices()}));case 11:case"end":return t.stop()}},t,this)}))}},{key:"getDevices",value:function(){return{audioInput:this.audioInput,audioOutput:this.audioOutput,videoInput:this.videoInput}}},{key:"cleanUp",value:function(){this.initialized=!1,this.audioInput=[],this.audioOutput=[],this.videoInput=[],this.outputDevice=void 0,navigator.mediaDevices.removeEventListener("devicechange",this.handleDeviceChange)}},{key:"createIdentifier",value:function(e){return e?"".concat(e.deviceId).concat(e.groupId):""}},{key:"getNewAudioInputDevice",value:function(){var e=this.audioInput.find(function(e){return"default"===e.deviceId});return e?this.audioInput.find(function(t){return"default"!==t.deviceId&&e.label.includes(t.label)}):this.audioInput[0]}},{key:"setOutputDevice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ne(this,null,w().mark(function t(){var n,r,i=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.getNewAudioInputDevice(),r=this.createIdentifier(this.outputDevice),this.outputDevice=this.getAudioOutputDeviceMatchingInput(n),this.outputDevice||(this.outputDevice=this.audioOutput.find(function(e){return i.createIdentifier(e)===r}),this.outputDevice||(this.outputDevice=this.audioOutput.find(function(e){return"default"===e.deviceId})||this.audioOutput[0])),t.next=5,this.store.updateAudioOutputDevice(this.outputDevice);case 5:e&&r!==this.createIdentifier(this.outputDevice)&&(this.eventBus.analytics.publish(Ge.deviceChange({selection:{audioOutput:this.outputDevice},devices:this.getDevices(),type:"audioOutput"})),this.eventBus.deviceChange.publish({selection:this.outputDevice,type:"audioOutput",devices:this.getDevices()}));case 6:case"end":return t.stop()}},t,this)}))}},{key:"getAudioOutputDeviceMatchingInput",value:function(e){var t,n,r=(null==(n=null==(t=this.store.getConfig())?void 0:t.settings)?void 0:n.speakerAutoSelectionBlacklist)||[];if("all"!==r){var i=(null==e?void 0:e.label.toLowerCase())||"";return!r.some(function(e){return i.includes(e.toLowerCase())})&&(null==e?void 0:e.groupId)?this.audioOutput.find(function(t){return"default"!==e.deviceId&&t.label===e.label}):void 0}}},{key:"logDevices",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";me.d(this.TAG,e,JSON.stringify({videoInput:g(this.videoInput),audioInput:g(this.audioInput),audioOutput:g(this.audioOutput),selected:this.getCurrentSelection()},null,4))}}]),e}(),Wn=function(){function e(t,n){M(this,e),this.deviceManager=t,this.audioSinkManager=n}return G(e,[{key:"getVolume",value:function(){return this.audioSinkManager.getVolume()}},{key:"setVolume",value:function(e){if(e<0||e>100)throw Error("Please pass a valid number between 0-100");this.audioSinkManager.setVolume(e)}},{key:"getDevice",value:function(){return this.deviceManager.outputDevice}},{key:"setDevice",value:function(e){return this.deviceManager.updateOutputDevice(e)}},{key:"unblockAutoplay",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.audioSinkManager.unblockAutoplay();case 2:return e.next=4,Dt.resumeContext();case 4:case"end":return e.stop()}},e,this)}))}}]),e}(),jn=G(function e(t,n){var r=this;M(this,e),this.eventName=t,this.eventEmitter=n,this.publish=function(e){r.eventEmitter.emit(r.eventName,e)},this.subscribe=function(e){r.eventEmitter.on(r.eventName,e)},this.subscribeOnce=function(e){r.eventEmitter.once(r.eventName,e)},this.unsubscribe=function(e){r.eventEmitter.off(r.eventName,e)},this.waitFor=function(e){return r.eventEmitter.waitFor(r.eventName,{filter:e})},this.removeAllListeners=function(){r.eventEmitter.removeAllListeners(r.eventName)}}),Kn=G(function e(){M(this,e),this.eventEmitter=new o.EventEmitter2,this.deviceChange=new jn(xn.DEVICE_CHANGE,this.eventEmitter),this.localAudioEnabled=new jn(xn.LOCAL_AUDIO_ENABLED,this.eventEmitter),this.localVideoEnabled=new jn(xn.LOCAL_VIDEO_ENABLED,this.eventEmitter),this.statsUpdate=new jn(xn.STATS_UPDATE,this.eventEmitter),this.trackDegraded=new jn(xn.TRACK_DEGRADED,this.eventEmitter),this.trackRestored=new jn(xn.TRACK_RESTORED,this.eventEmitter),this.trackAudioLevelUpdate=new jn(xn.TRACK_AUDIO_LEVEL_UPDATE,this.eventEmitter),this.audioPluginFailed=new jn(xn.AUDIO_PLUGIN_FAILED,this.eventEmitter),this.localAudioSilence=new jn(xn.LOCAL_AUDIO_SILENCE,this.eventEmitter),this.analytics=new jn(xn.ANALYTICS,this.eventEmitter),this.policyChange=new jn(xn.POLICY_CHANGE,this.eventEmitter),this.localRoleUpdate=new jn(xn.LOCAL_ROLE_UPDATE,this.eventEmitter),this.audioTrackUpdate=new jn(xn.AUDIO_TRACK_UPDATE,this.eventEmitter),this.audioTrackAdded=new jn(xn.AUDIO_TRACK_ADDED,this.eventEmitter),this.audioTrackRemoved=new jn(xn.AUDIO_TRACK_REMOVED,this.eventEmitter),this.autoplayError=new jn(xn.AUTOPLAY_ERROR,this.eventEmitter),this.leave=new jn(xn.LEAVE,this.eventEmitter)}),Jn=function(){function e(t,n,r){M(this,e),this.store=t,this.listener=n,this.audioListener=r}return G(e,[{key:"handleActiveSpeakers",value:function(e){var t,n,r,i=this,a=e["speaker-list"],s=a.map(function(e){return{audioLevel:e.level,peer:i.store.getPeerById(e.peer_id),track:i.store.getTrackById(e.track_id)}});null==(t=this.audioListener)||t.onAudioLevelUpdate(s),this.store.updateSpeakers(s);var o=a[0];if(o){var c=this.store.getPeerById(o.peer_id);null==(n=this.listener)||n.onPeerUpdate(Je.BECAME_DOMINANT_SPEAKER,c)}else null==(r=this.listener)||r.onPeerUpdate(Je.RESIGNED_DOMINANT_SPEAKER,null)}}]),e}();!function(e){e.ROOM_STATE="room-state",e.PEER_JOIN="on-peer-join",e.PEER_LEAVE="on-peer-leave",e.PEER_LIST="peer-list",e.TRACK_METADATA_ADD="on-track-add",e.TRACK_UPDATE="on-track-update",e.CHANGE_TRACK_MUTE_STATE_UPDATE="on-change-track-mute-state-request",e.ACTIVE_SPEAKERS="active-speakers",e.CONNECTION_QUALITY="on-connection-quality-update",e.SFU_STATS="sfu-stats",e.ON_SFU_TRACK_LAYER_UPDATE="on-track-layer-update",e.BROADCAST="on-broadcast",e.ROLE_CHANGE="on-role-change",e.POLICY_CHANGE="on-policy-change",e.ROLE_CHANGE_REQUEST="on-role-change-request",e.TRACK_UPDATE_REQUEST="on-track-update-request",e.PEER_UPDATE="on-peer-update",e.PEER_LEAVE_REQUEST="on-peer-leave-request",e.UNSUPPORTED="unsupported",e.RTMP_START="on-rtmp-start",e.RTMP_STOP="on-rtmp-stop",e.RECORDING_START="on-record-start",e.RECORDING_STOP="on-record-stop",e.HLS_START="on-hls-start",e.HLS_STOP="on-hls-stop",e.METADATA_CHANGE="on-metadata-change"}(Pn||(Pn={}));var qn,zn=function(){function e(t,n){M(this,e),this.store=t,this.listener=n,this.TAG="[BroadcastManager]"}return G(e,[{key:"handleNotification",value:function(e,t){e===Pn.BROADCAST&&this.handleBroadcast(t)}},{key:"handleBroadcast",value:function(e){var t,n=e.peer,r=e.info,i=e.roles,a=this.getSender(n),s=e.private?this.store.getLocalPeer():void 0,o=[];if(null==i?void 0:i.length){var c,u=this.store.getKnownRoles(),l=B(i);try{for(l.s();!(c=l.n()).done;){var d=c.value;u[d]&&o.push(u[d])}}catch(v){l.e(v)}finally{l.f()}}var h=new Te($(X({},r),{sender:a,recipientRoles:o,recipientPeer:s,time:new Date(e.timestamp)}));me.d(this.TAG,"Received Message from sender=".concat(null==n?void 0:n.peer_id,": ").concat(h)),null==(t=this.listener)||t.onMessageReceived(h)}},{key:"getSender",value:function(e){var t=e?this.store.getPeerById(e.peer_id):void 0;return!t&&e&&(t=new be({peerId:e.peer_id,name:e.info.name,isLocal:!1,customerUserId:e.info.user_id,metadata:e.info.data})),t}}]),e}(),Yn=function(){function e(t){M(this,e),this.listener=t}return G(e,[{key:"handleQualityUpdate",value:function(e){var t,n=e.peers.map(function(e){return{peerID:e.peer_id,downlinkQuality:e.downlink_score}});null==(t=this.listener)||t.onConnectionQualityUpdate(n)}}]),e}(),Qn=function(){function e(t,n,r,i){var a=this;M(this,e),this.store=t,this.peerManager=n,this.trackManager=r,this.listener=i,this.TAG="[PeerListManager]",this.handleInitialPeerList=function(e){var t=Object.values(e.peers);a.peerManager.handlePeerList(t)},this.handleReconnectPeerList=function(e){a.handleRepeatedPeerList(e.peers)},this.handlePreviewRoomState=function(e){if(a.store.hasRoleDetailsArrived()){var t=e.peers;null!=t?(Object.keys(t).forEach(function(e){t[e].tracks={},t[e].is_from_room_state=!0}),a.handleRepeatedPeerList(t)):0===e.peer_count&&a.handleRepeatedPeerList({})}},this.handleRepeatedPeerList=function(e){var t=a.store.getRemotePeers(),n=Object.values(e),r=t.filter(function(t){return!e[t.peerId]});r.length>0&&me.d(a.TAG,"".concat(r)),r.forEach(function(e){var t,n={peer_id:e.peerId,role:(null==(t=e.role)?void 0:t.name)||"",info:{name:e.name,data:e.metadata||"",user_id:e.customerUserId||""},tracks:{}};a.peerManager.handlePeerLeave(n)});var i=[];n.forEach(function(e){var t=a.store.getPeerById(e.peer_id),n=Object.values(e.tracks);t&&(a.store.getPeerTracks(t.peerId).forEach(function(n){var r;e.tracks[n.trackId]||(a.removePeerTrack(t,n.trackId),null==(r=a.listener)||r.onTrackUpdate(qe.TRACK_REMOVED,n,t))}),n.forEach(function(e){a.store.getTrackById(e.track_id)||a.store.setTrackState({peerId:t.peerId,trackInfo:e})}),a.trackManager.handleTrackUpdate({peer:{info:e.info,peer_id:e.peer_id},tracks:e.tracks}),a.peerManager.handlePeerUpdate(e)),i.push(e)}),i.length>0&&a.peerManager.handlePeerList(i)}}return G(e,[{key:"handleNotification",value:function(e,t,n){if(e===Pn.PEER_LIST){var r=t;n?(me.d(this.TAG,"RECONNECT_PEER_LIST event",JSON.stringify(r,null,2)),this.handleReconnectPeerList(r)):(me.d(this.TAG,"PEER_LIST event",JSON.stringify(r,null,2)),this.handleInitialPeerList(r))}else if(e===Pn.ROOM_STATE){var i=t;this.handlePreviewRoomState(i)}}},{key:"removePeerTrack",value:function(e,t){var n,r;if(me.d(this.TAG,"removing track - ".concat(t," from ").concat(e)),(null==(n=e.audioTrack)?void 0:n.trackId)===t)e.audioTrack=void 0;else if((null==(r=e.videoTrack)?void 0:r.trackId)===t)e.videoTrack=void 0;else{var i=e.auxiliaryTracks.findIndex(function(e){return e.trackId===t});i>=0&&e.auxiliaryTracks.splice(i,1)}}}]),e}(),Zn=function(e){return e?new Date(e):void 0},Xn=function(){function e(t,n,r){var i=this;M(this,e),this.store=t,this.trackManager=n,this.listener=r,this.TAG="[PeerManager]",this.handlePeerList=function(e){var t,n;if(0!==e.length){var r=[],a=new Set(e.map(function(e){return e.peer_id}));i.store.getRemotePeers().forEach(function(e){var t=e.peerId,n=e.fromRoomState;!a.has(t)&&n&&i.store.removePeer(t)});var s,o=B(e);try{for(o.s();!(s=o.n()).done;){var c=s.value;r.push(i.makePeer(c))}}catch(u){o.e(u)}finally{o.f()}null==(n=i.listener)||n.onPeerUpdate(Je.PEER_LIST,r),i.trackManager.processPendingTracks()}else null==(t=i.listener)||t.onPeerUpdate(Je.PEER_LIST,[])},this.handlePeerJoin=function(e){var t,n=i.makePeer(e);null==(t=i.listener)||t.onPeerUpdate(Je.PEER_JOINED,n),i.trackManager.processPendingTracks()},this.handlePeerLeave=function(e){var t,n,r,a,s=i.store.getPeerById(e.peer_id);i.store.removePeer(e.peer_id),me.d(i.TAG,"PEER_LEAVE",e.peer_id,"remainingPeers=".concat(i.store.getPeers().length)),s&&(s.audioTrack&&(null==(t=i.listener)||t.onTrackUpdate(qe.TRACK_REMOVED,s.audioTrack,s)),s.videoTrack&&(null==(n=i.listener)||n.onTrackUpdate(qe.TRACK_REMOVED,s.videoTrack,s)),null==(r=s.auxiliaryTracks)||r.forEach(function(e){var t;null==(t=i.listener)||t.onTrackUpdate(qe.TRACK_REMOVED,e,s)}),null==(a=i.listener)||a.onPeerUpdate(Je.PEER_LEFT,s))}}return G(e,[{key:"handleNotification",value:function(e,t){switch(e){case Pn.PEER_JOIN:var n=t;this.handlePeerJoin(n);break;case Pn.PEER_LEAVE:var r=t;this.handlePeerLeave(r);break;case Pn.PEER_UPDATE:this.handlePeerUpdate(t)}}},{key:"handlePeerUpdate",value:function(e){var t,n=this.store.getPeerById(e.peer_id);if(n){if(n.role&&n.role.name!==e.role){var r=this.store.getPolicyForRole(e.role);n.updateRole(r),this.updateSimulcastLayersForPeer(n),null==(t=this.listener)||t.onPeerUpdate(Je.ROLE_UPDATED,n)}this.handlePeerInfoUpdate(X({peer:n},e.info))}}},{key:"handlePeerInfoUpdate",value:function(e){var t,n,r=e.peer,i=e.name,a=e.data;!r||(i&&r.name!==i&&(r.updateName(i),null==(t=this.listener)||t.onPeerUpdate(Je.NAME_UPDATED,r)),a&&r.metadata!==a&&(r.updateMetadata(a),null==(n=this.listener)||n.onPeerUpdate(Je.METADATA_UPDATED,r)))}},{key:"makePeer",value:function(e){var t=this.store.getPeerById(e.peer_id);for(var n in t||(t=new xe({peerId:e.peer_id,name:e.info.name,customerUserId:e.info.user_id,metadata:e.info.data,role:this.store.getPolicyForRole(e.role),joinedAt:Zn(e.joined_at),fromRoomState:!!e.is_from_room_state}),this.store.addPeer(t),me.d(this.TAG,"adding to the peerList","".concat(t))),e.tracks)this.store.setTrackState({peerId:e.peer_id,trackInfo:e.tracks[n]});return t}},{key:"updateSimulcastLayersForPeer",value:function(e){var t=this;this.store.getPeerTracks(e.peerId).forEach(function(n){if("video"===n.type&&["regular","screen"].includes(n.source)){var r=n,i=t.store.getSimulcastDefinitionsForPeer(e,r.source);r.setSimulcastDefinitons(i)}})}}]),e}(),$n=function(){function e(t,n){M(this,e),this.store=t,this.eventBus=n}return G(e,[{key:"handlePolicyChange",value:function(e){var t=this.store.getLocalPeer();if(t&&!t.role){var n=e.known_roles[e.name];t.updateRole(n)}this.store.setKnownRoles(e);var r=this.store.getRoom();if(r?r.templateId=e.template_id:me.w("[PolicyChangeManager]","on policy change - room not present"),(null==t?void 0:t.role)&&t.role.name!==e.name){var i=this.store.getPolicyForRole(e.name),a=t.role;t.updateRole(i),this.eventBus.localRoleUpdate.publish({oldRole:a,newRole:i})}this.eventBus.policyChange.publish(e)}}]),e}(),er=function(){function e(t,n){M(this,e),this.store=t,this.listener=n}return G(e,[{key:"handleNotification",value:function(e,t){switch(e){case Pn.ROLE_CHANGE_REQUEST:this.handleRoleChangeRequest(t);break;case Pn.TRACK_UPDATE_REQUEST:this.handleTrackUpdateRequest(t);break;case Pn.CHANGE_TRACK_MUTE_STATE_UPDATE:this.handleChangeTrackStateRequest(t);break;default:return}}},{key:"handleRoleChangeRequest",value:function(e){var t,n={requestedBy:e.requested_by?this.store.getPeerById(e.requested_by):void 0,role:this.store.getPolicyForRole(e.role),token:e.token};null==(t=this.listener)||t.onRoleChangeRequest(n)}},{key:"handleTrackUpdateRequest",value:function(e){var t=this,n=e.requested_by,r=e.track_id,i=e.mute,a=n?this.store.getPeerById(n):void 0,s=this.store.getLocalPeerTracks().find(function(e){return e.publishedTrackId===r});if(s){var o=function(){var e;null==(e=t.listener)||e.onChangeTrackStateRequest({requestedBy:a,track:s,enabled:!i})};if(i){if(s.enabled===!i)return;s.setEnabled(!i).then(o)}else o()}}},{key:"handleChangeTrackStateRequest",value:function(e){var t,n=this,r=e.type,i=e.source,a=e.value,s=e.requested_by,o=s?this.store.getPeerById(s):void 0,c=!a,u=this.getTracksToBeUpdated({type:r,source:i,enabled:c});if(0!==u.length)if(c)null==(t=this.listener)||t.onChangeMultiTrackStateRequest({requestedBy:o,tracks:u,type:r,source:i,enabled:!0});else{var l,d=[],h=B(u);try{for(h.s();!(l=h.n()).done;){var v=l.value;d.push(v.setEnabled(!1))}}catch(p){h.e(p)}finally{h.f()}Promise.all(d).then(function(){var e;null==(e=n.listener)||e.onChangeMultiTrackStateRequest({requestedBy:o,tracks:u,enabled:!1})})}}},{key:"getTracksToBeUpdated",value:function(e){var t=e.type,n=e.source,r=e.enabled,i=this.store.getLocalPeerTracks();return t&&(i=i.filter(function(e){return e.type===t})),n&&(i=i.filter(function(e){return e.source===n})),i.filter(function(e){return e.enabled!==r})}}]),e}(),tr=function(){function e(t,n){M(this,e),this.store=t,this.listener=n,this.TAG="[RoomUpdateManager]"}return G(e,[{key:"handleNotification",value:function(e,t){switch(e){case Pn.PEER_LIST:this.onRoomState(t.room);break;case Pn.RTMP_START:this.onRTMPStart(t);break;case Pn.RTMP_STOP:this.onRTMPStop(t);break;case Pn.RECORDING_START:this.onRecordingStart(t);break;case Pn.RECORDING_STOP:this.onRecordingStop(t);break;case Pn.ROOM_STATE:this.handlePreviewRoomState(t);break;default:this.onHLS(e,t)}}},{key:"handlePreviewRoomState",value:function(e){var t=e.room;this.onRoomState(t,e.peer_count)}},{key:"onRoomState",value:function(e,t){var n,r,i,a=e.recording,s=e.streaming,o=e.session_id,c=e.started_at,u=e.name,l=this.store.getRoom();l?(l.peerCount=t,l.name=u,l.recording.server.running=!!(null==a?void 0:a.sfu.enabled),l.recording.browser.running=!!(null==a?void 0:a.browser.enabled),l.rtmp.running=!!(null==(n=null==s?void 0:s.rtmp)?void 0:n.enabled),l.rtmp.startedAt=Zn(null==(r=null==s?void 0:s.rtmp)?void 0:r.started_at),l.recording.server.startedAt=Zn(null==a?void 0:a.sfu.started_at),l.recording.browser.startedAt=Zn(null==a?void 0:a.browser.started_at),l.recording.hls=this.getPeerListHLSRecording(a),l.hls=this.convertHls(null==s?void 0:s.hls),l.sessionId=o,l.startedAt=Zn(c),null==(i=this.listener)||i.onRoomUpdate(Ke.RECORDING_STATE_UPDATED,l)):me.w(this.TAG,"on room state - room not present")}},{key:"onRTMPStart",value:function(e){var t;this.setRTMPStatus(!(null==(t=e.error)?void 0:t.code),e)}},{key:"onRTMPStop",value:function(e){this.setRTMPStatus(!1,e)}},{key:"onRecordingStart",value:function(e){var t;this.setRecordingStatus(!(null==(t=e.error)?void 0:t.code),e)}},{key:"onRecordingStop",value:function(e){this.setRecordingStatus(!1,e)}},{key:"onHLS",value:function(e,t){var n,r;if([Pn.HLS_START,Pn.HLS_STOP].includes(e)){var i=this.store.getRoom();i?(t.enabled=e===Pn.HLS_START&&!(null==(n=t.error)?void 0:n.code),i.hls=this.convertHls(t),i.recording.hls=this.getHLSRecording(t),null==(r=this.listener)||r.onRoomUpdate(Ke.HLS_STREAMING_STATE_UPDATED,i)):me.w(this.TAG,"on hls - room not present")}}},{key:"convertHls",value:function(e){var t,n={running:!!(null==e?void 0:e.enabled),variants:[],error:this.toSdkError(null==e?void 0:e.error)};return null==(t=null==e?void 0:e.variants)||t.forEach(function(e){n.variants.push({meetingURL:e.meeting_url,url:e.url,metadata:e.metadata,startedAt:Zn(e.started_at)})}),n}},{key:"getHLSRecording",value:function(e){var t,n,r,i={running:!1};return(null==e?void 0:e.hls_recording)&&(i={running:!!(null==e?void 0:e.enabled),singleFilePerLayer:!!(null==(t=e.hls_recording)?void 0:t.single_file_per_layer),hlsVod:!!(null==(n=e.hls_recording)?void 0:n.hls_vod),startedAt:Zn(null==(r=null==e?void 0:e.variants)?void 0:r[0].started_at),error:this.toSdkError(e.error)}),i}},{key:"getPeerListHLSRecording",value:function(e){var t,n,r=null==e?void 0:e.hls;return{running:!!(null==r?void 0:r.enabled),startedAt:Zn(null==r?void 0:r.started_at),singleFilePerLayer:!!(null==(t=null==r?void 0:r.config)?void 0:t.single_file_per_layer),hlsVod:!!(null==(n=null==r?void 0:r.config)?void 0:n.hls_vod)}}},{key:"setRecordingStatus",value:function(e,t){var n,r,i=this.store.getRoom();i?("sfu"===t.type?(i.recording.server={running:e,startedAt:e?Zn(t.started_at):void 0,error:this.toSdkError(t.error)},r=Ke.SERVER_RECORDING_STATE_UPDATED):(i.recording.browser={running:e,startedAt:e?Zn(t.started_at):void 0,error:this.toSdkError(t.error)},r=Ke.BROWSER_RECORDING_STATE_UPDATED),null==(n=this.listener)||n.onRoomUpdate(r,i)):me.w(this.TAG,"set recording status running=".concat(e," - room not present"))}},{key:"setRTMPStatus",value:function(e,t){var n,r=this.store.getRoom();r?(r.rtmp={running:e,startedAt:e?Zn(t.started_at):void 0,error:this.toSdkError(t.error)},null==(n=this.listener)||n.onRoomUpdate(Ke.RTMP_STREAMING_STATE_UPDATED,r)):me.w(this.TAG,"on policy change - room not present")}},{key:"toSdkError",value:function(e){if(null==e?void 0:e.code){var t=e.message||"error in streaming/recording",n=new Me(e.code,"ServerErrors",Fe.NONE,t,t);return me.e(this.TAG,"error in streaming/recording",n),n}}}]),e}(),nr=function(){function e(t,n){M(this,e),this.store=t,this.listener=n}return G(e,[{key:"handleNotification",value:function(e,t){e===Pn.METADATA_CHANGE&&this.handleMetadataChange(t)}},{key:"handleMetadataChange",value:function(e){var t,n=this,r=e.values.map(function(e){return{key:e.key,value:e.data,updatedAt:Zn(e.updated_at),updatedBy:e.updated_by?n.store.getPeerById(e.updated_by):void 0}});null==(t=this.listener)||t.onSessionStoreUpdate(r)}}]),e}(),rr=function(){function e(t,n,r){var i=this;M(this,e),this.store=t,this.eventBus=n,this.listener=r,this.TAG="[TrackManager]",this.tracksToProcess=new Map,this.handleTrackAdd=function(e){me.d(i.TAG,"ONTRACKADD","".concat(e)),i.store.addTrack(e),i.tracksToProcess.set(e.trackId,e),i.processPendingTracks()},this.handleTrackRemove=function(e){var t;me.d(i.TAG,"ONTRACKREMOVE","".concat(e));var n=i.store.getTrackState(e.trackId);if(n)if(i.store.hasTrack(e)){e.type===st.AUDIO&&i.eventBus.audioTrackRemoved.publish(e),i.store.removeTrack(e);var r=i.store.getPeerById(n.peerId);!r||(i.removePeerTracks(r,e),null==(t=i.listener)||t.onTrackUpdate(qe.TRACK_REMOVED,e,r))}else me.d(i.TAG,"Track not found in store")},this.handleTrackLayerUpdate=function(e){for(var t in e.tracks){var n=e.tracks[t],r=i.store.getTrackById(t);!r||!i.store.getPeerByTrackId(t)||r instanceof An&&i.setLayer(r,n)}},this.handleTrackUpdate=function(e){var t,n,r=i.store.getPeerById(e.peer.peer_id);if(r)for(var a in e.tracks){var s=Object.assign({},null==(t=i.store.getTrackState(a))?void 0:t.trackInfo),o=e.tracks[a],c=i.store.getTrackById(a);if(i.store.setTrackState({peerId:e.peer.peer_id,trackInfo:X(X({},s),o)}),!c||i.tracksToProcess.has(a))i.processPendingTracks();else{c.setEnabled(!o.mute);var u=i.processTrackUpdate(c,s,o);u&&(null==(n=i.listener)||n.onTrackUpdate(u,c,r))}}else me.d(i.TAG,"Track Update ignored - Peer not added to store")}}return G(e,[{key:"handleTrackMetadataAdd",value:function(e){for(var t in me.d(this.TAG,"TRACK_METADATA_ADD",JSON.stringify(e,null,2)),e.tracks)this.store.setTrackState({peerId:e.peer.peer_id,trackInfo:e.tracks[t]});this.processPendingTracks()}},{key:"processPendingTracks",value:function(){var e=this;new Map(this.tracksToProcess).forEach(function(t){var n,r=e.store.getTrackState(t.trackId);if(r){var i=e.store.getPeerById(r.peerId);i?(t.source=r.trackInfo.source,t.peerId=i.peerId,t.logIdentifier=i.name,t.setEnabled(!r.trackInfo.mute),e.addAudioTrack(i,t),e.addVideoTrack(i,t),t.type===st.AUDIO?e.eventBus.audioTrackAdded.publish({track:t,peer:i}):null==(n=e.listener)||n.onTrackUpdate(qe.TRACK_ADDED,t,i),e.tracksToProcess.delete(t.trackId)):me.d(e.TAG,"Peer not added to store, peerId",r.peerId)}else me.d(e.TAG,"TrackState not added to store","peerId - ".concat(t.peerId),"trackId -".concat(t.trackId))})}},{key:"setLayer",value:function(e,t){var n,r,i=this.store.getPeerByTrackId(e.trackId);i&&(e.setLayerFromServer(t)?null==(n=this.listener)||n.onTrackUpdate(qe.TRACK_DEGRADED,e,i):null==(r=this.listener)||r.onTrackUpdate(qe.TRACK_RESTORED,e,i))}},{key:"removePeerTracks",value:function(e,t){var n=e.auxiliaryTracks.indexOf(t);n>-1?(e.auxiliaryTracks.splice(n,1),me.d(this.TAG,"auxiliary track removed","".concat(t))):t.type===st.AUDIO&&e.audioTrack===t?(e.audioTrack=void 0,me.d(this.TAG,"audio track removed","".concat(t))):t.type===st.VIDEO&&e.videoTrack===t&&(e.videoTrack=void 0,me.d(this.TAG,"video track removed","".concat(t)))}},{key:"addAudioTrack",value:function(e,t){var n;t.type===st.AUDIO&&("regular"!==t.source||e.audioTrack&&(null==(n=e.audioTrack)?void 0:n.trackId)!==t.trackId?e.auxiliaryTracks.push(t):e.audioTrack=t,me.d(this.TAG,"audio track added","".concat(t)))}},{key:"addVideoTrack",value:function(e,t){var n;if(t.type===st.VIDEO){var r=t,i=this.store.getSimulcastDefinitionsForPeer(e,r.source);r.setSimulcastDefinitons(i),"regular"!==t.source||e.videoTrack&&(null==(n=e.videoTrack)?void 0:n.trackId)!==t.trackId?e.auxiliaryTracks.push(r):e.videoTrack=r,me.d(this.TAG,"video track added","".concat(t))}}},{key:"processTrackUpdate",value:function(e,t,n){var r;return t.mute!==n.mute?(r=n.mute?qe.TRACK_MUTED:qe.TRACK_UNMUTED,e.type===st.AUDIO&&this.eventBus.audioTrackUpdate.publish({track:e,enabled:!n.mute})):t.description!==n.description&&(r=qe.TRACK_DESCRIPTION_CHANGED),r}}]),e}(),ir=function(){function e(t,n,r,i,a){var s=this;M(this,e),this.store=t,this.listener=r,this.audioListener=i,this.connectionQualityListener=a,this.TAG="[HMSNotificationManager]",this.hasConsistentRoomStateArrived=!1,this.ignoreNotification=function(e){if(e===Pn.PEER_LIST)s.hasConsistentRoomStateArrived=!0;else if(e===Pn.ROOM_STATE)return s.hasConsistentRoomStateArrived;return!1},this.handleTrackAdd=function(e){s.trackManager.handleTrackAdd(e)},this.handleTrackRemove=function(e){s.trackManager.handleTrackRemove(e)},this.updateLocalPeer=function(e){var t=e.name,n=e.metadata,r=s.store.getLocalPeer();s.peerManager.handlePeerInfoUpdate({peer:r,name:t,data:n})},this.trackManager=new rr(this.store,n,this.listener),this.peerManager=new Xn(this.store,this.trackManager,this.listener),this.peerListManager=new Qn(this.store,this.peerManager,this.trackManager,this.listener),this.broadcastManager=new zn(this.store,this.listener),this.policyChangeManager=new $n(this.store,n),this.requestManager=new er(this.store,this.listener),this.activeSpeakerManager=new Jn(this.store,this.listener,this.audioListener),this.connectionQualityManager=new Yn(this.connectionQualityListener),this.roomUpdateManager=new tr(this.store,this.listener),this.sessionMetadataManager=new nr(this.store,this.listener)}return G(e,[{key:"setListener",value:function(e){this.listener=e,this.trackManager.listener=e,this.peerManager.listener=e,this.peerListManager.listener=e,this.broadcastManager.listener=e,this.requestManager.listener=e,this.activeSpeakerManager.listener=e,this.roomUpdateManager.listener=e,this.sessionMetadataManager.listener=e}},{key:"setAudioListener",value:function(e){this.audioListener=e,this.activeSpeakerManager.audioListener=e}},{key:"setConnectionQualityListener",value:function(e){this.connectionQualityListener=e,this.connectionQualityManager.listener=e}},{key:"handleNotification",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.method,a=e.params;[Pn.ACTIVE_SPEAKERS,Pn.SFU_STATS,Pn.CONNECTION_QUALITY,void 0].includes(i)||me.d(this.TAG,"Received notification - ".concat(i),{notification:a}),i===Pn.SFU_STATS&&(null==(t=window.HMS)?void 0:t.ON_SFU_STATS)&&"function"==typeof(null==(n=window.HMS)?void 0:n.ON_SFU_STATS)&&window.HMS.ON_SFU_STATS(e.params),!this.ignoreNotification(i)&&(this.roomUpdateManager.handleNotification(i,a),this.peerManager.handleNotification(i,a),this.requestManager.handleNotification(i,a),this.peerListManager.handleNotification(i,a,r),this.broadcastManager.handleNotification(i,a),this.sessionMetadataManager.handleNotification(i,a),this.handleIsolatedMethods(i,a))}},{key:"handleIsolatedMethods",value:function(e,t){switch(e){case Pn.TRACK_METADATA_ADD:this.trackManager.handleTrackMetadataAdd(t);break;case Pn.TRACK_UPDATE:this.trackManager.handleTrackUpdate(t);break;case Pn.ON_SFU_TRACK_LAYER_UPDATE:this.trackManager.handleTrackLayerUpdate(t);break;case Pn.ACTIVE_SPEAKERS:this.activeSpeakerManager.handleActiveSpeakers(t);break;case Pn.CONNECTION_QUALITY:this.connectionQualityManager.handleQualityUpdate(t);break;case Pn.POLICY_CHANGE:this.policyChangeManager.handlePolicyChange(t)}}}]),e}(),ar=G(function e(t){M(this,e),this.type=t.type,this.source=t.source||"regular",this.description="",t instanceof ft?(this.mute=!t.enabled,this.track_id=t.publishedTrackId,this.stream_id=t.stream.id):(this.mute=t.mute,this.track_id=t.track_id,this.stream_id=t.stream_id)}),sr=function(){function e(t){M(this,e),this.TAG="[AudioContextManager]",this.audioContext=new AudioContext,this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination)}return G(e,[{key:"resumeContext",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="suspended"===this.audioContext.state,!e.t0){e.next=5;break}return e.next=4,this.audioContext.resume();case 4:me.d(this.TAG,"AudioContext is resumed");case 5:case"end":return e.stop()}},e,this)}))}},{key:"getAudioTrack",value:function(){return this.destinationNode&&this.source.disconnect(this.destinationNode),this.destinationNode=this.audioContext.createMediaStreamDestination(),this.source.connect(this.destinationNode),this.destinationNode.stream.getAudioTracks()[0]}},{key:"cleanup",value:function(){var e=this;"closed"!==this.audioContext.state&&this.audioContext.close().catch(function(t){me.d(e.TAG,"AudioContext close error",t.message)})}}]),e}(),or=function(e){C(n,o.EventEmitter2);var t=R(n);function n(){return M(this,n),t.apply(this,arguments)}return G(n,[{key:"on",value:function(e,t){return b(N(n.prototype),"on",this).call(this,e,t)}},{key:"off",value:function(e,t){return b(N(n.prototype),"off",this).call(this,e,t)}},{key:"emit",value:function(e,t){return b(N(n.prototype),"emit",this).call(this,e,t)}},{key:"listeners",value:function(e){return b(N(n.prototype),"listeners",this).call(this,e)}}]),n}(),cr=function(e){C(n,or);var t=R(n);function n(){var e;return M(this,n),(e=t.apply(this,arguments)).audioElement=null,e.TAG="[PlaylistAudioManager]",e.seeked=!1,e}return G(n,[{key:"play",value:function(e){return ne(this,null,w().mark(function t(){var n=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(this.audioElement=this.getAudioElement(),new Promise(function(t,r){n.audioElement=n.getAudioElement(),n.audioElement.src=e,n.seeked=!1,n.audioElement.onerror=function(){var t="Error loading ".concat(e);me.e(n.TAG,t),n.stop(),r(t)},n.audioElement.oncanplaythrough=function(){return ne(n,null,w().mark(function n(){var i;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,this.audioElement){n.next=3;break}return n.abrupt("return");case 3:if(this.audioContextManager.resumeContext(),!this.track){n.next=13;break}if(!this.seeked){n.next=8;break}this.seeked=!1,n.next=11;break;case 8:return n.next=10,this.audioElement.play();case 10:t([this.track]);case 11:n.next=17;break;case 13:return n.next=15,this.audioElement.play();case 15:i=this.audioContextManager.getAudioTrack(),this.track=i,t([i]);case 17:n.next=22;break;case 19:n.prev=19,n.t0=n.catch(0),me.e(this.TAG,"Error playing audio",e,n.t0.message),r(n.t0);case 22:case"end":return n.stop()}},n,this,[[0,19]])}))},n.audioElement.onseeked=function(){n.seeked=!0}})));case 1:case"end":return t.stop()}},t,this)}))}},{key:"getTracks",value:function(){return this.track?[this.track.id]:[]}},{key:"getElement",value:function(){return this.audioElement}},{key:"stop",value:function(){var e,t,n;null==(e=this.audioElement)||e.pause(),null==(t=this.audioElement)||t.removeAttribute("src"),this.audioElement=null,null==(n=this.audioContextManager)||n.cleanup(),this.track=void 0}},{key:"getAudioElement",value:function(){var e=this;if(this.audioElement)return this.audioElement;var t=document.createElement("audio");return t.crossOrigin="anonymous",t.addEventListener("timeupdate",function(t){return e.emit("progress",t)}),t.addEventListener("ended",function(){e.emit("ended",null)}),this.audioContextManager=new sr(t),t}}]),n}(),ur=function(e){C(n,or);var t=R(n);function n(){var e;return M(this,n),(e=t.apply(this,arguments)).TAG="[PlaylistVideoManager]",e.videoElement=null,e.canvasContext=null,e.tracks=[],e.DEFAUL_FPS=24,e.seeked=!1,e.drawImage=function(){var t,n,r;e.videoElement&&!e.videoElement.paused&&!e.videoElement.ended&&(null==(r=e.canvasContext)||r.drawImage(e.videoElement,0,0,null==(t=e.canvas)?void 0:t.width,null==(n=e.canvas)?void 0:n.height),e.timer=setTimeout(function(){e.drawImage()},1e3/e.DEFAUL_FPS))},e}return G(n,[{key:"play",value:function(e){var t=this;return this.videoElement=this.getVideoElement(),this.createCanvas(),new Promise(function(n,r){t.videoElement=t.getVideoElement(),t.videoElement.src=e,t.seeked=!1,t.videoElement.onerror=function(){var n="Error loading ".concat(e);me.e(t.TAG,n),t.stop(),r(n)},t.videoElement.oncanplaythrough=function(){return ne(t,null,w().mark(function t(){var i,a,s,o,c,u=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.videoElement){t.next=3;break}return t.abrupt("return");case 3:if(this.canvas.width=this.videoElement.videoWidth,this.canvas.height=this.videoElement.videoHeight,0!==this.tracks.length){t.next=18;break}if(this.clearCanvasAndTracks(),o=this.canvas.captureStream()){t.next=9;break}return me.e(this.TAG,"Browser does not support captureStream"),t.abrupt("return");case 9:return this.videoElement.onplay=this.drawImage,t.next=12,this.audioContextManager.resumeContext();case 12:return t.next=14,this.videoElement.play();case 14:c=this.audioContextManager.getAudioTrack(),o.addTrack(c),o.getTracks().forEach(function(e){u.tracks.push(e)}),n(this.tracks),t.next=25;break;case 18:if(!this.seeked){t.next=22;break}this.seeked=!1,null==(s=this.canvasContext)||s.drawImage(this.videoElement,0,0,null==(i=this.canvas)?void 0:i.width,null==(a=this.canvas)?void 0:a.height),t.next=25;break;case 22:return t.next=24,this.videoElement.play();case 24:n(this.tracks);case 25:t.next=30;break;case 27:t.prev=27,t.t0=t.catch(0),me.e(this.TAG,"Error playing video",e,t.t0.message),r(t.t0);case 30:case"end":return t.stop()}},t,this,[[0,27]])}))},t.videoElement.onseeked=function(){t.seeked=!0}})}},{key:"getTracks",value:function(){return this.tracks.map(function(e){return e.id})}},{key:"getElement",value:function(){return this.videoElement}},{key:"stop",value:function(){var e,t,n;null==(e=this.videoElement)||e.pause(),null==(t=this.videoElement)||t.removeAttribute("src"),this.videoElement=null,null==(n=this.audioContextManager)||n.cleanup(),this.clearCanvasAndTracks()}},{key:"clearCanvasAndTracks",value:function(){var e;this.tracks=[],null==(e=this.canvasContext)||e.clearRect(0,0,this.canvas.width,this.canvas.height),clearTimeout(this.timer)}},{key:"getVideoElement",value:function(){var e=this;if(this.videoElement)return this.videoElement;var t=document.createElement("video");return t.crossOrigin="anonymous",t.addEventListener("timeupdate",function(t){return e.emit("progress",t)}),t.addEventListener("ended",function(){e.emit("ended",null)}),this.audioContextManager=new sr(t),t}},{key:"createCanvas",value:function(){this.canvas||(this.canvas=document.createElement("canvas"),this.canvasContext=this.canvas.getContext("2d"))}}]),n}(),lr={audio:{list:[],currentIndex:-1,isAutoplayOn:!0},video:{list:[],currentIndex:-1,isAutoplayOn:!0}},dr=function(e){C(n,or);var t=R(n);function n(e,r){var i;return M(this,n),(i=t.call(this)).sdk=e,i.eventBus=r,i.state={audio:X({},lr.audio),video:X({},lr.video)},i.TAG="[PlaylistManager]",i.handlePausePlaylist=function(e){return ne(O(i),[e],function(e){var t=this,n=e.enabled,r=e.track;return w().mark(function e(){var i,a;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}return e.abrupt("return");case 2:"audioplaylist"===r.source&&(a=it.audio),"videoplaylist"===r.source&&(a=it.video),a&&(null==(i=t.getElement(a))||i.pause());case 3:case"end":return e.stop()}},e)})()})},i.addTrack=function(e,t){return ne(O(i),null,w().mark(function n(){return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sdk.addTrack(e,t);case 2:me.d(this.TAG,"Playlist track added",pt(e));case 3:case"end":return n.stop()}},n,this)}))},i.removeTrack=function(e){return ne(O(i),null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.removeTrack(e,!0);case 2:me.d(this.TAG,"Playlist track removed",e);case 3:case"end":return t.stop()}},t,this)}))},i.audioManager=new cr,i.videoManager=new ur,i.addListeners(),i}return G(n,[{key:"getList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio;return this.state[e].list}},{key:"setList",value:function(e){var t=this;e&&0!==e.length?e.forEach(function(e){t.state[e.type].list.includes(e)||t.state[e.type].list.push(e)}):me.w(this.TAG,"Please pass in a list of HMSPlaylistItem's")}},{key:"clearList",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.isPlaying(e),!t.t0){t.next=4;break}return t.next=4,this.stop(e);case 4:this.state[e].list=[];case 5:case"end":return t.stop()}},t,this)}))}},{key:"removeItem",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a,s;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.state[t],i=r.list,a=r.currentIndex,!((s=i.findIndex(function(t){return e===t.id}))>-1)){n.next=10;break}if(n.t1=a===s&&this.isPlaying(t),!n.t1){n.next=6;break}return n.next=6,this.stop(t);case 6:i.splice(s,1),n.t0=!0,n.next=11;break;case 10:n.t0=!1;case 11:return n.abrupt("return",n.t0);case 12:case"end":return n.stop()}},n,this)}))}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:it.audio;if(-1===this.state[t].currentIndex)throw Qe.PlaylistErrors.NoEntryToPlay(Fe.PLAYLIST,"No item is currently playing");var n=this.getElement(t);if(n){var r=Math.max(n.currentTime+e,0);n.currentTime=Math.min(r,n.duration)}}},{key:"seekTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:it.audio;if(-1===this.state[t].currentIndex)throw Qe.PlaylistErrors.NoEntryToPlay(Fe.PLAYLIST,"No item is currently playing");if(e<0)throw Error("value cannot be negative");var n=this.getElement(t);n&&(n.currentTime=Math.min(e,n.duration))}},{key:"setVolume",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:it.audio;if(e<0||e>100)throw Error("Please pass a valid number between 0-100");var n=this.getElement(t);n&&(n.volume=.01*e)}},{key:"getVolume",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio,t=this.getElement(e);return t?100*t.volume:0}},{key:"getCurrentTime",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio,t=this.getElement(e);return(null==t?void 0:t.currentTime)||0}},{key:"getCurrentIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio;return this.state[e].currentIndex}},{key:"getCurrentProgress",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio,n=this.state[t],r=null==(e=n.list[n.currentIndex])?void 0:e.url,i=this.getElement(t);return r&&i?Math.floor(i.currentTime/i.duration*100):0}},{key:"getCurrentSelection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio,t=this.state[e],n=t.list,r=t.currentIndex;if(-1!==r)return n[r]}},{key:"isPlaying",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio,t=this.getElement(e);return!!t&&!t.paused}},{key:"setIsAutoplayOn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio,t=arguments.length>1?arguments[1]:void 0;this.state[e].isAutoplayOn=t}},{key:"getPlaybackRate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio,t=this.getElement(e);return t?t.playbackRate:1}},{key:"setPlaybackRate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio,t=arguments.length>1?arguments[1]:void 0;if(t<.25||t>2)throw Error("Please pass a value between 0.25 and 2.0");var n=this.getElement(e);n&&(n.playbackRate=t)}},{key:"setEnabled",value:function(e,t){return ne(this,arguments,function(e,t){var n=this,r=t.id,i=t.type,a=void 0===i?it.audio:i;return w().mark(function t(){var i,s;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.state[a].list.findIndex(function(e){return e.id===r}),r&&-1!==i){t.next=4;break}return me.w(n.TAG,"Pass a valid id"),t.abrupt("return");case 4:if(s=n.state[a].list[i].url,!e){t.next=10;break}return t.next=8,n.play(s,a);case 8:t.next=12;break;case 10:return t.next=12,n.pause(s,a);case 12:n.state[a].currentIndex=i,n.setDuration(a);case 14:case"end":return t.stop()}},t)})()})}},{key:"playNext",value:function(){return ne(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio;return w().mark(function n(){var r,i,a;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.state[t],i=r.list,!((a=r.currentIndex)>=i.length-1)){n.next=3;break}throw Qe.PlaylistErrors.NoEntryToPlay(Fe.PLAYLIST,"Reached end of playlist");case 3:return n.next=5,e.play(i[a+1].url,t);case 5:e.state[t].currentIndex=a+1,e.setDuration(t);case 7:case"end":return n.stop()}},n)})()})}},{key:"playPrevious",value:function(){return ne(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio;return w().mark(function n(){var r,i,a;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.state[t],i=r.list,!((a=r.currentIndex)<=0)){n.next=3;break}throw Qe.PlaylistErrors.NoEntryToPlay(Fe.PLAYLIST,"Reached start of playlist");case 3:return n.next=5,e.play(i[a-1].url,t);case 5:e.state[t].currentIndex=a-1,e.setDuration(t);case 7:case"end":return n.stop()}},n)})()})}},{key:"stop",value:function(){return ne(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio;return w().mark(function n(){var r,i;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=t===it.audio?e.audioManager:e.videoManager,null==(r=i.getElement())||r.pause(),n.next=4,e.removeTracks(t);case 4:i.stop(),e.state[t].currentIndex=-1;case 6:case"end":return n.stop()}},n)})()})}},{key:"cleanup",value:function(){this.state={audio:X({},lr.audio),video:X({},lr.video)},this.eventBus.localAudioEnabled.unsubscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.unsubscribe(this.handlePausePlaylist),this.audioManager.stop(),this.videoManager.stop()}},{key:"onProgress",value:function(e){var t=this;this.videoManager.on("progress",function(){try{e({type:it.video,progress:t.getCurrentProgress(it.video)})}catch(n){me.e(t.TAG,"Error in onProgress callback")}}),this.audioManager.on("progress",function(){try{e({type:it.audio,progress:t.getCurrentProgress(it.audio)})}catch(n){me.e(t.TAG,"Error in onProgress callback")}})}},{key:"onNewTrackStart",value:function(e){this.on("newTrackStart",e)}},{key:"onPlaylistEnded",value:function(e){this.on("playlistEnded",e)}},{key:"onCurrentTrackEnded",value:function(e){this.on("currentTrackEnded",e)}},{key:"getElement",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio)===it.audio?this.audioManager.getElement():this.videoManager.getElement()}},{key:"removeTracks",value:function(){return ne(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio;return w().mark(function n(){var r,i,a,s;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r=(t===it.audio?e.audioManager:e.videoManager).getTracks(),i=B(r),n.prev=2,i.s();case 4:if((a=i.n()).done){n.next=10;break}return s=a.value,n.next=8,e.removeTrack(s);case 8:n.next=4;break;case 10:n.next=15;break;case 12:n.prev=12,n.t0=n.catch(2),i.e(n.t0);case 15:return n.prev=15,i.f(),n.finish(15);case 18:case"end":return n.stop()}},n,null,[[2,12,15,18]])})()})}},{key:"play",value:function(e){return ne(this,arguments,function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:it.audio;return w().mark(function r(){var i,a,s,o,c,u;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=n===it.audio?t.audioManager:t.videoManager,a=i.getElement(),!t.isItemCurrentlyPlaying(e,n)){r.next=4;break}return me.w(t.TAG,"The ".concat(n," is currently playing")),r.abrupt("return");case 4:if(!(null==a?void 0:a.src.includes(e))){r.next=9;break}return r.next=7,a.play();case 7:r.next=30;break;case 9:return null==a||a.pause(),r.next=12,i.play(e);case 12:s=r.sent,o=B(s),r.prev=14,o.s();case 16:if((c=o.n()).done){r.next=22;break}return u=c.value,r.next=20,t.addTrack(u,n===it.audio?"audioplaylist":"videoplaylist");case 20:r.next=16;break;case 22:r.next=27;break;case 24:r.prev=24,r.t0=r.catch(14),o.e(r.t0);case 27:return r.prev=27,o.f(),r.finish(27);case 30:case"end":return r.stop()}},r,null,[[14,24,27,30]])})()})}},{key:"isItemCurrentlyPlaying",value:function(e,t){var n=this.getElement(t);return!(!n||n.paused||!n.src.includes(e))}},{key:"setDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio,t=this.getElement(e),n=this.state[e],r=n.list,i=n.currentIndex;r[i]&&(r[i].duration=(null==t?void 0:t.duration)||0),this.emit("newTrackStart",r[i])}},{key:"pause",value:function(e){return ne(this,arguments,function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:it.audio;return w().mark(function r(){var i;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:(i=t.getElement(n))&&!i.paused&&i.src.includes(e)?(i.pause(),me.d(t.TAG,"paused url",e)):me.w(t.TAG,"The passed in url is not currently playing");case 2:case"end":return r.stop()}},r)})()})}},{key:"addListeners",value:function(){var e=this;this.audioManager.on("ended",function(){return e.handleEnded(it.audio)}),this.videoManager.on("ended",function(){return e.handleEnded(it.video)}),this.eventBus.localAudioEnabled.subscribe(this.handlePausePlaylist),this.eventBus.localVideoEnabled.subscribe(this.handlePausePlaylist)}},{key:"handleEnded",value:function(){return ne(this,arguments,function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:it.audio;return w().mark(function n(){var r,i,a,s;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.state[t],i=r.list,a=r.currentIndex,s=r.isAutoplayOn,a!==i.length-1){n.next=7;break}return n.next=4,e.stop(t);case 4:e.emit("playlistEnded",t),n.next=13;break;case 7:if(!s){n.next=11;break}e.playNext(t),n.next=13;break;case 11:return n.next=13,e.pause(i[a].url,t);case 13:e.emit("currentTrackEnded",i[a]);case 14:case"end":return n.stop()}},n)})()})}}]),n}(),hr=function(){function e(t){M(this,e),this.transport=t,this.observedKeys=new Set}return G(e,[{key:"get",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.transport.getSessionMetadata(e);case 2:return n=t.sent,r=n.data,i=n.updated_at,t.abrupt("return",{value:r,updatedAt:Zn(i)});case 6:case"end":return t.stop()}},t,this)}))}},{key:"set",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a,s;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.transport.setSessionMetadata({key:e,data:t});case 2:return r=n.sent,i=r.data,a=r.updated_at,s=Zn(a),n.abrupt("return",{value:i,updatedAt:s});case 7:case"end":return n.stop()}},n,this)}))}},{key:"observe",value:function(e){return ne(this,null,w().mark(function t(){var n,r=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=new Set(this.observedKeys),e.forEach(function(e){return r.observedKeys.add(e)}),this.observedKeys.size===n.size){t.next=10;break}return t.prev=2,t.next=5,this.transport.listenMetadataChange(Array.from(this.observedKeys));case 5:t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(2),this.observedKeys=n,t.t0;case 10:case"end":return t.stop()}},t,this,[[2,7]])}))}},{key:"unobserve",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=new Set(this.observedKeys),this.observedKeys=new Set(g(this.observedKeys).filter(function(t){return!e.includes(t)})),this.observedKeys.size===n.size){t.next=10;break}return t.prev=2,t.next=5,this.transport.listenMetadataChange(Array.from(this.observedKeys));case 5:t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(2),this.observedKeys=n,t.t0;case 10:case"end":return t.stop()}},t,this,[[2,7]])}))}}]),e}(),vr=G(function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"https://prod-init.100ms.live/init",s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];M(this,e),this.authToken=t,this.peerId=n,this.peerName=r,this.data=i,this.endpoint=a,this.autoSubscribeVideo=s});!function(e){e[e.ConnectFailed=0]="ConnectFailed",e[e.SignalDisconnect=1]="SignalDisconnect",e[e.JoinWSMessageFailed=2]="JoinWSMessageFailed",e[e.PublishIceConnectionFailed=3]="PublishIceConnectionFailed",e[e.SubscribeIceConnectionFailed=4]="SubscribeIceConnectionFailed"}(qn||(qn={}));var pr,fr=(S(r={},0,[]),S(r,1,[]),S(r,2,[1]),S(r,3,[1]),S(r,4,[1]),r);!function(e){e.Disconnected="Disconnected",e.Connecting="Connecting",e.Joined="Joined",e.Preview="Preview",e.Failed="Failed",e.Reconnecting="Reconnecting",e.Leaving="Leaving"}(pr||(pr={}));var kr,gr=G(function e(t){var n=this;M(this,e),this.promise=new Promise(function(e,r){n.resolve=e,n.reject=r,t(e,r)})}),mr=function(){function e(t,n){M(this,e),this.onStateChange=t,this.sendEvent=n,this.TAG="[RetryScheduler]",this.inProgress=new Map,this.retryTaskIds=[]}return G(e,[{key:"schedule",value:function(e){return ne(this,arguments,function(e){var t=this,n=e.category,r=e.error,i=e.task,a=e.originalState,s=e.maxFailedRetries,o=void 0===s?hn:s,c=e.changeState,u=void 0===c||c;return w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.scheduleTask({category:n,error:r,changeState:u,task:i,originalState:a,maxFailedRetries:o});case 2:case"end":return e.stop()}},e)})()})}},{key:"reset",value:function(){this.retryTaskIds.forEach(function(e){return clearTimeout(e)}),this.retryTaskIds=[],this.inProgress.clear()}},{key:"isTaskInProgress",value:function(e){return!!this.inProgress.get(e)}},{key:"scheduleTask",value:function(e){return ne(this,arguments,function(e){var t=this,n=e.category,r=e.error,i=e.changeState,a=e.task,s=e.originalState,o=e.maxFailedRetries,c=void 0===o?hn:o,u=e.failedRetryCount,l=void 0===u?0:u;return w().mark(function e(){var o,u,d,h,v,p,f,k,g,m;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(me.d(t.TAG,"schedule: ",{category:qn[n],error:r}),0!==l){e.next=9;break}if(!(o=t.inProgress.get(n))){e.next=7;break}return me.d(t.TAG,"schedule: Already a task for ".concat(qn[n]," scheduled, waiting for its completion")),e.next=6,o.promise;case 6:return e.abrupt("return");case 7:u=new gr(function(e,t){}),t.inProgress.set(n,u),t.sendEvent(r,n);case 9:d=!1,h=fr[n],e.t0=w().keys(h);case 11:if((e.t1=e.t0()).done){e.next=30;break}if(v=e.t1.value,p=h[parseInt(v)],e.prev=14,f=t.inProgress.get(p),e.t2=f,!e.t2){e.next=22;break}return me.d(t.TAG,"schedule: Suspending retry task of ".concat(qn[n],", waiting for ").concat(qn[p]," to recover")),e.next=21,f.promise;case 21:me.d(t.TAG,"schedule: Resuming retry task ".concat(qn[n]," as it's dependency ").concat(qn[p]," is recovered"));case 22:e.next=28;break;case 24:return e.prev=24,e.t3=e.catch(14),me.d(t.TAG,"schedule: Stopping retry task of ".concat(qn[n]," as it's dependency ").concat(qn[p]," failed to recover")),d=!0,e.abrupt("break",30);case 28:e.next=11;break;case 30:if(!(l>=c||d)){e.next=37;break}if(r.description+=". [".concat(qn[n],"] Could not recover after ").concat(l," tries"),d&&(r.description+=" Could not recover all of it's required dependencies - [".concat(h.map(function(e){return qn[e]}).toString(),"]")),r.isTerminal=!0,t.inProgress.delete(n),t.sendEvent(r,n),t.reset(),!i){e.next=35;break}t.onStateChange(pr.Failed,r),e.next=36;break;case 35:throw r;case 36:return e.abrupt("return");case 37:return i&&t.onStateChange(pr.Reconnecting,r),k=t.getDelayForRetryCount(n,l),me.i(t.TAG,"schedule: [".concat(qn[n],"] [failedRetryCount=").concat(l,"] Scheduling retry task in ").concat(k,"ms")),e.prev=40,e.next=43,t.setTimeoutPromise(a,k);case 43:g=e.sent,e.next=49;break;case 46:e.prev=46,e.t4=e.catch(40),g=!1,me.w(t.TAG,"[".concat(qn[n],"] Un-caught exception ").concat(e.t4.name," in retry-task, initiating retry"),e.t4);case 49:if(!g){e.next=54;break}m=t.inProgress.get(n),t.inProgress.delete(n),null==m||m.resolve(l),i&&0===t.inProgress.size&&t.onStateChange(s),me.i(t.TAG,"schedule: [".concat(qn[n],"] [failedRetryCount=").concat(l,"] Recovered ")),e.next=56;break;case 54:return e.next=56,t.scheduleTask({category:n,error:r,changeState:i,task:a,originalState:s,maxFailedRetries:c,failedRetryCount:l+1});case 56:case"end":return e.stop()}},e,null,[[14,24],[40,46]])})()})}},{key:"getBaseDelayForTask",value:function(e,t){return e===qn.JoinWSMessageFailed?2:Math.pow(2,t)}},{key:"getDelayForRetryCount",value:function(e,t){var n=this.getBaseDelayForTask(e,t),r=e===qn.JoinWSMessageFailed?2*Math.random():Math.random();return Math.round(1e3*Math.min(n+r,vn))}},{key:"setTimeoutPromise",value:function(e,t){return ne(this,null,w().mark(function n(){var r=this;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise(function(n,i){var a=window.setTimeout(function(){return ne(r,null,w().mark(function t(){var r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e();case 3:(r=t.sent)&&this.retryTaskIds.splice(this.retryTaskIds.indexOf(a),1),n(r),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i(t.t0);case 10:case"end":return t.stop()}},t,this,[[0,7]])}))},t);r.retryTaskIds.push(a)}));case 1:case"end":return n.stop()}},n)}))}}]),e}(),Tr=function(e){C(n,Nt);var t=R(n);function n(){var e;return M(this,n),(e=t.call(this,dn)).localStorage=new ie("hms-analytics"),e.localStorage.clear(),e.initLocalStorageQueue(),e}return G(n,[{key:"enqueue",value:function(e){b(N(n.prototype),"enqueue",this).call(this,e),this.localStorage.set(this.storage)}},{key:"dequeue",value:function(){var e=b(N(n.prototype),"dequeue",this).call(this);return this.localStorage.set(this.storage),e}},{key:"initLocalStorageQueue",value:function(){var e,t=this;null==(e=this.localStorage.get())||e.forEach(function(e){var r=new Ne(e);b(N(n.prototype),"enqueue",t).call(t,r)})}}]),n}(),yr=function(){function e(){M(this,e),this.TAG="[AnalyticsTransport]"}return G(e,[{key:"sendEvent",value:function(e){try{this.sendSingleEvent(e),this.flushFailedEvents()}catch(t){me.w(this.TAG,"sendEvent failed",t)}}},{key:"flushFailedEvents",value:function(e){var t;try{for(me.d(this.TAG,"Flushing failed events",this.failedEvents);this.failedEvents.size()>0;){var n=this.failedEvents.dequeue();n&&((null==(t=n.metadata)?void 0:t.peer.peer_id)!==e&&n.metadata.peer.peer_id?Ln.sendEvent(n):this.sendSingleEvent(n))}}catch(r){me.w(this.TAG,"flushFailedEvents failed",r)}}},{key:"sendSingleEvent",value:function(e){try{this.transportProvider.sendEvent(e),me.d(this.TAG,"Sent event",e.name,e)}catch(t){throw me.w(this.TAG,"".concat(this.transportProvider.TAG,".sendEvent failed, adding to local storage events"),{event:e,error:t}),this.failedEvents.enqueue(e),t}}}]),e}(),br=function(e){C(n,yr);var t=R(n);function n(e){var r;return M(this,n),(r=t.call(this)).transportProvider=e,r.failedEvents=new Tr,r}return G(n)}();!function(e){e[e.Publish=0]="Publish",e[e.Subscribe=1]="Subscribe"}(kr||(kr={}));var Er="[VALIDATIONS]";function wr(e){return null!=e}var Sr=function(){if(!wr(RTCPeerConnection)){var e=Qe.GenericErrors.MissingRTCPeerConnection();throw me.e(Er,e),e}},xr=function(){if(!wr(navigator.mediaDevices)){var e=Qe.GenericErrors.MissingMediaDevices();throw me.e(Er,e),e}};function Ar(e,t){var n,r=(0,c.parse)(e.sdp);if(!(null==(n=r.origin)?void 0:n.username.startsWith("mozilla")))return e;var i=t?Array.from(t.values()):[];return r.media.forEach(function(e){var t,n,r,a=null==(t=e.msid)?void 0:t.split(" ")[0],s=null==(n=i.find(function(t){return t.type===e.type&&t.stream_id===a}))?void 0:n.track_id;s&&(e.msid=null==(r=e.msid)?void 0:r.replace(/\s(.+)/," ".concat(s)))}),{type:e.type,sdp:(0,c.write)(r)}}function Ir(e,t){var n;if((null==e?void 0:e.sdp)&&t){var r=(0,c.parse)(e.sdp).media.find(function(e){return wr(e.mid)&&parseInt(e.mid)===parseInt(t)});return null==(n=null==r?void 0:r.msid)?void 0:n.split(" ")[1]}}function Cr(e){return e.sdp.includes("usedtx=1")?e:{type:e.type,sdp:e.sdp.replace("useinbandfec=1","useinbandfec=1;usedtx=1")}}var Pr="[HMSConnection]",Rr=function(){function e(t,n){M(this,e),this.candidates=new Array,this.role=t,this.signal=n}return G(e,[{key:"iceConnectionState",get:function(){return this.nativeConnection.iceConnectionState}},{key:"connectionState",get:function(){return this.nativeConnection.connectionState}},{key:"action",get:function(){return this.role===kr.Publish?Fe.PUBLISH:Fe.SUBSCRIBE}},{key:"addTransceiver",value:function(e,t){return this.nativeConnection.addTransceiver(e,t)}},{key:"createOffer",value:function(e,t){return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,this.nativeConnection.createOffer(t);case 3:return r=n.sent,n.abrupt("return",(me.d(Pr,"[role=".concat(this.role,"] createOffer offer=").concat(JSON.stringify(r,null,1))),Cr(Ar(r,e))));case 7:throw n.prev=7,n.t0=n.catch(0),Qe.WebrtcErrors.CreateOfferFailed(this.action,n.t0.message);case 10:case"end":return n.stop()}},n,this,[[0,7]])}))}},{key:"createAnswer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.nativeConnection.createAnswer(e);case 3:return n=t.sent,t.abrupt("return",(me.d(Pr,"[role=".concat(this.role,"] createAnswer answer=").concat(JSON.stringify(n,null,1))),n));case 7:throw t.prev=7,t.t0=t.catch(0),Qe.WebrtcErrors.CreateAnswerFailed(this.action,t.t0.message);case 10:case"end":return t.stop()}},t,this,[[0,7]])}))}},{key:"setLocalDescription",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,me.d(Pr,"[role=".concat(this.role,"] setLocalDescription description=").concat(JSON.stringify(e,null,1))),t.next=4,this.nativeConnection.setLocalDescription(e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),Qe.WebrtcErrors.SetLocalDescriptionFailed(this.action,t.t0.message);case 9:case"end":return t.stop()}},t,this,[[0,6]])}))}},{key:"setRemoteDescription",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,me.d(Pr,"[role=".concat(this.role,"] setRemoteDescription description=").concat(JSON.stringify(e,null,1))),t.next=4,this.nativeConnection.setRemoteDescription(e);case 4:t.next=9;break;case 6:throw t.prev=6,t.t0=t.catch(0),Qe.WebrtcErrors.SetRemoteDescriptionFailed(this.action,t.t0.message);case 9:case"end":return t.stop()}},t,this,[[0,6]])}))}},{key:"addIceCandidate",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("closed"!==this.nativeConnection.signalingState){t.next=3;break}return me.d(Pr,"[role=".concat(this.role,"] addIceCandidate signalling state closed")),t.abrupt("return");case 3:return me.d(Pr,"[role=".concat(this.role,"] addIceCandidate candidate=").concat(JSON.stringify(e,null,1))),t.next=6,this.nativeConnection.addIceCandidate(e);case 6:case"end":return t.stop()}},t,this)}))}},{key:"remoteDescription",get:function(){return this.nativeConnection.remoteDescription}},{key:"getSenders",value:function(){return this.nativeConnection.getSenders()}},{key:"logSelectedIceCandidatePairs",value:function(){var e=this;try{(this.role===kr.Publish?this.getSenders():this.getReceivers()).forEach(function(t){var n,r=null==(n=t.track)?void 0:n.kind;if(t.transport){var i=t.transport.iceTransport,a=function(){"function"==typeof i.getSelectedCandidatePair&&(e.selectedCandidatePair=i.getSelectedCandidatePair(),me.d(Pr,"".concat(kr[e.role]," connection"),"selected ".concat(r||"unknown"," candidate pair"),JSON.stringify(e.selectedCandidatePair,null,2)))};"function"==typeof i.onselectedcandidatepairchange&&(i.onselectedcandidatepairchange=a),a()}})}catch(t){me.w(Pr,"Error in logging selected ice candidate pair for ".concat(kr[this.role]," connection"),t)}}},{key:"removeTrack",value:function(e){"closed"!==this.nativeConnection.signalingState&&this.nativeConnection.removeTrack(e)}},{key:"setMaxBitrateAndFramerate",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i,a;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.settings.maxBitrate,r=e instanceof cn&&e.settings.maxFramerate,!(i=this.getSenders().find(function(t){var n;return(null==(n=null==t?void 0:t.track)?void 0:n.id)===e.getTrackIDBeingSent()}))){t.next=8;break}return(a=i.getParameters()).encodings.length>0&&(n&&(a.encodings[0].maxBitrate=1e3*n),r&&(a.encodings[0].maxFramerate=r)),t.next=6,i.setParameters(a);case 6:t.next=9;break;case 8:me.w(Pr,"no sender found to setMaxBitrate for track - ".concat(e.trackId,", sentTrackId - ").concat(e.getTrackIDBeingSent()));case 9:case"end":return t.stop()}},t,this)}))}},{key:"getStats",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.nativeConnection.getStats();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"close",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.nativeConnection.close();case 1:case"end":return e.stop()}},e,this)}))}},{key:"getReceivers",value:function(){return this.nativeConnection.getReceivers()}}]),e}(),_r=function(e){C(n,Rr);var t=R(n);function n(e,r,i){var a;return M(this,n),(a=t.call(this,kr.Publish,e)).TAG="[HMSPublishConnection]",a.observer=i,a.nativeConnection=new RTCPeerConnection(r),a.nativeConnection.createDataChannel(ln,{protocol:"SCTP"}),a.nativeConnection.onicecandidate=function(t){var n=t.candidate;n&&e.trickle(a.role,n)},a.nativeConnection.oniceconnectionstatechange=function(){a.observer.onIceConnectionChange(a.nativeConnection.iceConnectionState)},a.nativeConnection.onconnectionstatechange=function(){a.observer.onConnectionStateChange(a.nativeConnection.connectionState)},a}return G(n,[{key:"initAfterJoin",value:function(){var e=this;this.nativeConnection.onnegotiationneeded=function(){return ne(e,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return me.d(this.TAG,"onnegotiationneeded"),e.next=3,this.observer.onRenegotiationNeeded();case 3:case"end":return e.stop()}},e,this)}))}}}]),n}(),Or=function(){function e(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";M(this,e),this.TAG="[HMSDataChannel]",this.nativeChannel=t,this.observer=n,this.metadata=i,t.onmessage=function(e){r.observer.onMessage(e.data)}}return G(e,[{key:"id",get:function(){return this.nativeChannel.id}},{key:"label",get:function(){return this.nativeChannel.label}},{key:"readyState",get:function(){return this.nativeChannel.readyState}},{key:"send",value:function(e){me.d(this.TAG,"[".concat(this.metadata,"] Sending [size=").concat(e.length,"] message=").concat(e)),this.nativeChannel.send(e)}},{key:"close",value:function(){this.nativeChannel.close()}}]),e}(),Dr=function(e){C(n,Rr);var t=R(n);function n(e,r,i){var a;return M(this,n),(a=t.call(this,kr.Subscribe,e)).TAG="[HMSSubscribeConnection]",a.remoteStreams=new Map,a.MAX_RETRIES=3,a.pendingMessageQueue=[],a.eventEmitter=new o.default({maxListeners:60}),a.handlePendingApiMessages=function(){a.eventEmitter.emit("open",!0),a.pendingMessageQueue.length>0&&(me.d(a.TAG,"Found pending message queue, sending messages"),a.pendingMessageQueue.forEach(function(e){return a.sendOverApiDataChannel(e)}),a.pendingMessageQueue.length=0)},a.sendMessage=function(e,t){return ne(O(a),null,w().mark(function n(){var r,i,a,s,o;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0="open"!==(null==(r=this.apiChannel)?void 0:r.readyState),!n.t0){n.next=4;break}return n.next=4,this.eventEmitter.waitFor("open");case 4:a=0;case 5:if(!(a<this.MAX_RETRIES)){n.next=26;break}return this.apiChannel.send(e),n.next=9,this.waitForResponse(t);case 9:if(i=n.sent,!(s=i.error)){n.next=22;break}if(404!==s.code){n.next=15;break}return me.d(this.TAG,"Track not found ".concat(t),{request:e,try:a+1,error:s}),n.abrupt("break",26);case 15:if(me.e(this.TAG,"Failed sending ".concat(t),{request:e,try:a+1,error:s}),s.code/100==5||429===s.code){n.next=17;break}throw Error("code=".concat(s.code,", message=").concat(s.message));case 17:return o=1e3*(2+2*Math.random()),n.next=20,Mt(o);case 20:n.next=23;break;case 22:return n.abrupt("break",26);case 23:a++,n.next=5;break;case 26:return n.abrupt("return",i);case 27:case"end":return n.stop()}},n,this)}))},a.waitForResponse=function(e){return ne(O(a),null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.eventEmitter.waitFor("message",function(t){return t.includes(e)});case 2:return n=t.sent,r=JSON.parse(n[0]),t.abrupt("return",(me.d(this.TAG,"response for ".concat(e," -"),JSON.stringify(r,null,2)),r));case 5:case"end":return t.stop()}},t,this)}))},a.observer=i,a.nativeConnection=new RTCPeerConnection(r),a.initNativeConnectionCallbacks(),a}return G(n,[{key:"initNativeConnectionCallbacks",value:function(){var e=this;this.nativeConnection.oniceconnectionstatechange=function(){e.observer.onIceConnectionChange(e.nativeConnection.iceConnectionState)},this.nativeConnection.onconnectionstatechange=function(){e.observer.onConnectionStateChange(e.nativeConnection.connectionState)},this.nativeConnection.ondatachannel=function(t){t.channel.label===ln&&(e.apiChannel=new Or(t.channel,{onMessage:function(t){e.eventEmitter.emit("message",t),e.observer.onApiChannelMessage(t)}},"role=".concat(e.role)),t.channel.onopen=e.handlePendingApiMessages)},this.nativeConnection.onicecandidate=function(t){null!==t.candidate&&e.signal.trickle(e.role,t.candidate)},this.nativeConnection.ontrack=function(t){var n,r=t.streams[0],i=r.id;if(!e.remoteStreams.has(i)){var a=new kt(r,e);e.remoteStreams.set(i,a)}r.addEventListener("removetrack",function(n){if(n.track.id===t.track.id){var r=s.tracks.findIndex(function(e){var r;return e.nativeTrack.id===n.track.id&&t.transceiver.mid===(null==(r=e.transceiver)?void 0:r.mid)});if(r>=0){var a=s.tracks[r];e.observer.onTrackRemove(a),s.tracks.splice(r,1),0===s.tracks.length&&e.remoteStreams.delete(i)}}});var s=e.remoteStreams.get(i),o=new("audio"===t.track.kind?Ht:An)(s,t.track);o.transceiver=t.transceiver;var c=Ir(e.remoteDescription,null==(n=t.transceiver)?void 0:n.mid);c&&o.setSdpTrackId(c),s.tracks.push(o),e.observer.onTrackAdd(o)}}},{key:"sendOverApiDataChannel",value:function(e){this.apiChannel&&"open"===this.apiChannel.readyState?this.apiChannel.send(e):(me.w(this.TAG,"API Data channel not ".concat(this.apiChannel?"open":"present",", queueing"),e),this.pendingMessageQueue.push(e))}},{key:"sendOverApiDataChannelWithResponse",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=(0,s.v4)(),i=JSON.stringify(X({id:t||r,jsonrpc:"2.0"},e)),n.abrupt("return",this.sendMessage(i,r));case 2:case"end":return n.stop()}},n,this)}))}},{key:"close",value:function(){var e=this;return ne(this,null,w().mark(function t(){var r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(i="close",b(N(n.prototype),i,e)).call(this);case 2:null==(r=this.apiChannel)||r.close();case 3:case"end":return t.stop()}var i},t,this)}))}}]),n}(),Nr=function(e,t,n){return ne(void 0,null,w().mark(function r(){var i,a,s,o,c,u;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(s={},!(null==(i=e.transceiver)?void 0:i.sender.track)){r.next=14;break}return r.prev=2,r.next=5,e.transceiver.sender.getStats();case 5:a=r.sent,o={},c={},u={},null==a||a.forEach(function(e){switch(e.type){case"outbound-rtp":c[e.id]=e;break;case"remote-inbound-rtp":u[e.ssrc]=e;break;case"codec":o[e.id]=e.mimeType}}),Object.keys(X({},c)).forEach(function(r){var i,a,l=null==(i=c[r])?void 0:i.codecId,d=l?o[l]:void 0;d&&(a=d.substring(d.indexOf("/")+1));var h=c[r],v=u[h.ssrc];s[r]=$(X({},h),{bitrate:Vr("bytesSent",h,null==n?void 0:n[r]),packetsLost:null==v?void 0:v.packetsLost,jitter:null==v?void 0:v.jitter,roundTripTime:null==v?void 0:v.roundTripTime,totalRoundTripTime:null==v?void 0:v.totalRoundTripTime,peerName:t,peerID:e.peerId,codec:a})}),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(2),me.w("[HMSWebrtcStats]","Error in getting local track stats",e,r.t0,r.t0.name);case 13:return r.abrupt("return",s);case 14:case"end":return r.stop()}},r,null,[[2,10]])}))},Mr=function(e,t,n){return ne(void 0,null,w().mark(function r(){var i,a,s,o,c;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,null==(i=e.transceiver)?void 0:i.receiver.getStats();case 3:a=r.sent,r.next=9;break;case 6:r.prev=6,r.t0=r.catch(0),me.w("[HMSWebrtcStats]","Error in getting remote track stats",e,r.t0);case 9:return s=Lr(a),o=Vr("bytesReceived",s,n),c=Hr("packetsLost",s,n),r.abrupt("return",((null==s?void 0:s.remote)&&Object.assign(s.remote,{packetsLostRate:Hr("packetsLost",s.remote,null==n?void 0:n.remote)}),s&&Object.assign(s,{bitrate:o,packetsLostRate:c,peerId:e.peerId,peerName:t,codec:s.codec})));case 11:case"end":return r.stop()}},r,null,[[0,6]])}))},Lr=function(e){var t,n,r={};null==e||e.forEach(function(e){switch(e.type){case"inbound-rtp":case"outbound-rtp":t=e;break;case"remote-inbound-rtp":n=e;break;case"codec":r[e.id]=e.mimeType}});var i,a=(null==t?void 0:t.codecId)?r[t.codecId]:void 0;return a&&(i=a.substring(a.indexOf("/")+1)),t&&Object.assign(t,{remote:n,codec:i})},Gr=function(e,t,n){var r=Ur(t),i=Vr("publish"===e?"bytesSent":"bytesReceived",r,n&&n[e]);return r&&Object.assign(r,{bitrate:i})},Ur=function(e){var t;return e.forEach(function(n){"transport"===n.type&&(t=e.get(n.selectedCandidatePairId))}),t||e.forEach(function(e){"candidate-pair"===e.type&&e.selected&&(t=e)}),t},Fr=function(e){var t={packetsLost:0,jitter:0};return null==e||e.forEach(function(e){e.packetsLost&&(t.packetsLost+=e.packetsLost),e.jitter>t.jitter&&(t.jitter=e.jitter)}),t},Br=function(e,t){return Array.from(new Set(e.concat(t)))},Vr=function(e,t,n){return 8*Hr(e,t,n)},Hr=function(e,t,n){var r=t&&t[e],i=n?n[e]:null;return[t,n,wr(r),wr(i)].every(function(e){return!!e})?1e3*Wr(r,i,null==t?void 0:t.timestamp,null==n?void 0:n.timestamp):0},Wr=function(e,t,n,r){return wr(e)&&wr(t)&&n&&r?(e-t)/(n-r):0},jr=function(){function e(t,n){var r;M(this,e),this.getStats=t,this.store=n,this.TAG="[HMSWebrtcStats]",this.peerStats={},this.remoteTrackStats={},this.localTrackStats={},this.localPeerID=null==(r=this.store.getLocalPeer())?void 0:r.peerId}return G(e,[{key:"getLocalPeerStats",value:function(){return this.peerStats[this.localPeerID]}},{key:"getRemoteTrackStats",value:function(e){return this.remoteTrackStats[e]}},{key:"getLocalTrackStats",value:function(){return this.localTrackStats}},{key:"updateStats",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateLocalPeerStats();case 2:return e.next=4,this.updateLocalTrackStats();case 4:return e.next=6,this.updateRemoteTrackStats();case 6:case"end":return e.stop()}},e,this)}))}},{key:"updateLocalPeerStats",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i,a,s,o,c,u,l,d,h,v,p,f,k;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.getLocalPeerStats(),e.prev=1,e.next=4,null==(n=(t=this.getStats).publish)?void 0:n.call(t);case 4:c=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),me.w(this.TAG,"Error in getting publish stats",e.t0);case 10:return u=c&&Gr("publish",c,o),e.prev=11,e.next=14,null==(i=(r=this.getStats).subscribe)?void 0:i.call(r);case 14:l=e.sent,e.next=20;break;case 17:e.prev=17,e.t1=e.catch(11),me.w(this.TAG,"Error in getting subscribe stats",e.t1);case 20:d=l&&Gr("subscribe",l,o),h=Fr(l),v=h.packetsLost,p=h.jitter,f=Wr(v,null==(a=null==o?void 0:o.subscribe)?void 0:a.packetsLost,null==d?void 0:d.timestamp,null==(s=null==o?void 0:o.subscribe)?void 0:s.timestamp),k=d&&Object.assign(d,{packetsLostRate:f,jitter:p,packetsLost:v}),this.peerStats[this.localPeerID]={publish:u,subscribe:k};case 22:case"end":return e.stop()}},e,this,[[1,7],[11,17]])}))}},{key:"updateRemoteTrackStats",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i,a,s,o,c,u,l=this;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.from(this.store.getTracksMap().values()).filter(function(e){return e instanceof An||e instanceof Ht}),r=n.map(function(e){return e.trackId}),Object.keys(this.remoteTrackStats).forEach(function(e){r.includes(e)||delete l.remoteTrackStats[e]}),i=B(n),e.prev=3,i.s();case 5:if((a=i.n()).done){e.next=15;break}return s=a.value,o=s.peerId&&(null==(t=this.store.getPeerById(s.peerId))?void 0:t.name),c=this.getRemoteTrackStats(s.trackId),e.next=11,Mr(s,o,c);case 11:(u=e.sent)&&(this.remoteTrackStats[s.trackId]=u);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(3),i.e(e.t0);case 20:return e.prev=20,i.f(),e.finish(20);case 23:case"end":return e.stop()}},e,this,[[3,17,20,23]])}))}},{key:"updateLocalTrackStats",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i,a,s,o,c,u;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this.store.getLocalPeerTracks().reduce(function(e,t){return e[t.getTrackIDBeingSent()]=t,e},{}),r=Br(Object.keys(this.localTrackStats),Object.keys(n)),i=B(r),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=18;break}if(s=a.value,!(o=n[s])){e.next=15;break}return c=null==(t=this.store.getLocalPeer())?void 0:t.name,e.next=11,Nr(o,c,this.localTrackStats[s]);case 11:(u=e.sent)&&(this.localTrackStats[s]=u),e.next=16;break;case 15:delete this.localTrackStats[s];case 16:e.next=4;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(2),i.e(e.t0);case 23:return e.prev=23,i.f(),e.finish(23);case 26:case"end":return e.stop()}},e,this,[[2,20,23,26]])}))}}]),e}();exports.HMSWebrtcStats=jr;var Kr=function(){function e(t,n,r,i){var a=this;M(this,e),this.store=t,this.eventBus=n,this.publishConnection=r,this.subscribeConnection=i,this.TAG="[HMSWebrtcInternals]",this.interval=yn,this.isMonitored=!1,this.handleStatsUpdate=function(){return ne(a,null,w().mark(function e(){var t;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=this.hmsStats)?void 0:t.updateStats();case 2:this.eventBus.statsUpdate.publish(this.hmsStats);case 3:case"end":return e.stop()}},e,this)}))}}return G(e,[{key:"getPublishPeerConnection",value:function(){return this.publishConnection}},{key:"getSubscribePeerConnection",value:function(){return this.subscribeConnection}},{key:"getCurrentStats",value:function(){return this.hmsStats}},{key:"onStatsChange",value:function(e){var t=this;return this.eventBus.statsUpdate.subscribe(e),function(){t.eventBus.statsUpdate.unsubscribe(e)}}},{key:"setPeerConnections",value:function(e){var t,n,r=e.publish,i=e.subscribe;this.publishConnection=r,this.subscribeConnection=i,this.hmsStats=new jr({publish:null==(t=this.publishConnection)?void 0:t.getStats.bind(this.publishConnection),subscribe:null==(n=this.subscribeConnection)?void 0:n.getStats.bind(this.subscribeConnection)},this.store)}},{key:"start",value:function(){return ne(this,null,w().mark(function e(){var t=this;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMonitored){e.next=3;break}return me.d(this.TAG,"Already started"),e.abrupt("return");case 3:this.stop(),this.isMonitored=!0,me.d(this.TAG,"Starting Webrtc Stats Monitor"),this.startLoop().then(function(){return me.d(t.TAG,"Stopping Webrtc Stats Monitor")}).catch(function(e){return me.e(t.TAG,e.message)});case 4:case"end":return e.stop()}},e,this)}))}},{key:"stop",value:function(){this.isMonitored=!1}},{key:"startLoop",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isMonitored){e.next=7;break}return e.next=3,this.handleStatsUpdate();case 3:return e.next=5,Mt(this.interval);case 5:e.next=0;break;case 7:case"end":return e.stop()}},e,this)}))}},{key:"cleanUp",value:function(){this.stop(),this.eventBus.statsUpdate.removeAllListeners()}}]),e}();exports.HMSWebrtcInternals=Kr;var Jr,qr="[InitService]",zr=function(){function e(){M(this,e)}return G(e,null,[{key:"handleError",value:function(e,t){switch(e.status){case 404:throw Qe.APIErrors.EndpointUnreachable(Fe.INIT,t.message||e.statusText);case 200:break;default:throw Qe.APIErrors.ServerErrors(t.code||e.status,Fe.INIT,t.message||(null==e?void 0:e.statusText))}}},{key:"fetchInitConfig",value:function(e){return ne(this,arguments,function(e){var t=this,n=e.token,r=e.peerId,i=e.userAgent,a=e.initEndpoint,s=void 0===a?"https://prod-init.100ms.live":a,o=e.region,c=void 0===o?"":o;return w().mark(function e(){var a,o,u,l,d;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return me.d(qr,"fetchInitConfig: initEndpoint=".concat(s," token=").concat(n," peerId=").concat(r," region=").concat(c," ")),a=Yr(s,r,i,c),e.prev=2,e.next=5,fetch(a,{headers:{Authorization:"Bearer ".concat(n)}});case 5:return o=e.sent,e.prev=6,e.next=9,o.clone().json();case 9:return u=e.sent,e.abrupt("return",(t.handleError(o,u),me.d(qr,"config is ".concat(JSON.stringify(u,null,2))),Qr(u)));case 13:return e.prev=13,e.t0=e.catch(6),e.next=17,o.text();case 17:throw l=e.sent,me.e(qr,"json error",e.t0.message,l),Qe.APIErrors.ServerErrors(o.status,Fe.INIT,l);case 19:e.next=25;break;case 21:throw e.prev=21,e.t1=e.catch(2),d=e.t1,["Failed to fetch","NetworkError","ECONNRESET"].some(function(e){return d.message.includes(e)})?Qe.APIErrors.EndpointUnreachable(Fe.INIT,d.message):d;case 25:case"end":return e.stop()}},e,null,[[2,21],[6,13]])})()})}}]),e}();function Yr(e,t,n,r){try{var i=new URL("/init",e);return r&&r.trim().length>0&&i.searchParams.set("region",r.trim()),i.searchParams.set("peer_id",t),i.searchParams.set("user_agent_v2",n),i.toString()}catch(s){var a=s;throw me.e(qr,a.name,a.message),a}}function Qr(e){var t;return $(X({},e),{rtcConfiguration:$(X({},e.rtcConfiguration),{iceServers:null==(t=e.rtcConfiguration)?void 0:t.ice_servers})})}!function(e){e.FLAG_SERVER_SUB_DEGRADATION="subscribeDegradation",e.FLAG_SERVER_SIMULCAST="simulcast",e.FLAG_NON_WEBRTC_DISABLE_OFFER="nonWebRTCDisableOffer"}(Jr||(Jr={}));var Zr=function(){function e(t){var n=this;M(this,e),this.TAG="[SIGNAL]: ",this.pongResponseTimes=new Nt(kn),this.isJoinCompleted=!1,this.pendingTrickle=[],this.socket=null,this.callbacks=new Map,this._isConnected=!1,this.id=0,this.onCloseHandler=function(){},this.offlineListener=function(){me.d(n.TAG,"Window network offline"),n.setIsConnected(!1,"Window network offline")},this.onlineListener=function(){me.d(n.TAG,"Window network online"),n.observer.onNetworkOnline()},this.observer=t,window.addEventListener("offline",this.offlineListener),window.addEventListener("online",this.onlineListener),this.onMessageHandler=this.onMessageHandler.bind(this)}return G(e,[{key:"isConnected",get:function(){return this._isConnected}},{key:"setIsConnected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";me.d(this.TAG,"isConnected set id: ".concat(this.id,", oldValue: ").concat(this._isConnected,", newValue: ").concat(e)),this._isConnected!==e&&(this._isConnected&&!e?(this._isConnected=e,this.rejectPendingCalls(t),this.observer.onOffline(t)):!this._isConnected&&e&&(this._isConnected=e,this.observer.onOnline()))}},{key:"getPongResponseTimes",value:function(){return this.pongResponseTimes.toList()}},{key:"internalCall",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a,o,c=this;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=(0,s.v4)(),a={method:e,params:t,id:i,jsonrpc:"2.0"},null==(r=this.socket)||r.send(JSON.stringify(a)),n.prev=2,n.next=5,new Promise(function(t,n){c.callbacks.set(i,{resolve:t,reject:n,metadata:{method:e}})});case 5:return n.abrupt("return",n.sent);case 8:if(n.prev=8,n.t0=n.catch(2),!(n.t0 instanceof Me)){n.next=12;break}throw n.t0;case 12:throw o=n.t0,Qe.WebsocketMethodErrors.ServerErrors(Number(o.code),We(e),o.message);case 14:case"end":return n.stop()}},n,this,[[2,8]])}))}},{key:"notify",value:function(e,t){var n,r,i={method:e,params:t};(null==(n=this.socket)?void 0:n.readyState)===WebSocket.OPEN&&(null==(r=this.socket)||r.send(JSON.stringify(i)))}},{key:"open",value:function(e){var t=this;return new Promise(function(n,r){var i=!1;t.socket&&(t.socket.close(),t.socket.removeEventListener("close",t.onCloseHandler),t.socket.removeEventListener("message",t.onMessageHandler)),t.socket=new WebSocket(e);var a=function(e){me.e(t.TAG,"Error from websocket",e),i=!0,r(Qe.WebSocketConnectionErrors.FailedToConnect(Fe.JOIN,"Error opening websocket connection"))};t.onCloseHandler=function(e){me.e("Websocket closed code=".concat(e.code)),i?t.setIsConnected(!1,"code: ".concat(e.code).concat(1e3!==e.code?", unexpected websocket close":"")):(i=!0,r(Qe.WebSocketConnectionErrors.AbnormalClose(Fe.JOIN,"Error opening websocket connection - websocket closed unexpectedly with code=".concat(e.code))))},t.socket.addEventListener("error",a);t.socket.addEventListener("open",function e(){var r,s;i=!0,n(),t.setIsConnected(!0),t.id++,null==(r=t.socket)||r.removeEventListener("open",e),null==(s=t.socket)||s.removeEventListener("error",a),t.pingPongLoop(t.id)}),t.socket.addEventListener("close",t.onCloseHandler),t.socket.addEventListener("message",t.onMessageHandler)})}},{key:"close",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.removeEventListener("offline",this.offlineListener),window.removeEventListener("online",this.onlineListener),this.socket?(this.socket.close(1e3,"Normal Close"),this.setIsConnected(!1,"code: 1000, normal websocket close"),this.socket.removeEventListener("close",this.onCloseHandler),this.socket.removeEventListener("message",this.onMessageHandler)):this.setIsConnected(!1,"websocket not connected yet");case 1:case"end":return e.stop()}},e,this)}))}},{key:"join",value:function(e,t,n,r,i,a){return ne(this,null,w().mark(function s(){var o,c,u=this;return w().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(this.isConnected){s.next=2;break}throw Qe.WebSocketConnectionErrors.WebSocketConnectionLost(Fe.JOIN,"Failed to send join over WS connection");case 2:return o={name:e,disableVidAutoSub:n,data:t,offer:a,server_sub_degrade:r,simulcast:i},s.next=5,this.internalCall(Ue.JOIN,o);case 5:return c=s.sent,s.abrupt("return",(this.isJoinCompleted=!0,this.pendingTrickle.forEach(function(e){var t=e.target,n=e.candidate;return u.trickle(t,n)}),this.pendingTrickle.length=0,me.d(this.TAG,"join: response=".concat(JSON.stringify(c,null,1))),c));case 7:case"end":return s.stop()}},s,this)}))}},{key:"trickle",value:function(e,t){this.isJoinCompleted?this.notify(Ue.TRICKLE,{target:e,candidate:t}):this.pendingTrickle.push({target:e,candidate:t})}},{key:"offer",value:function(e,t){return ne(this,null,w().mark(function n(){return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.call(Ue.OFFER,{desc:e,tracks:Object.fromEntries(t)});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"answer",value:function(e){this.notify(Ue.ANSWER,{desc:e})}},{key:"trackUpdate",value:function(e){this.notify(Ue.TRACK_UPDATE,{version:"1.0",tracks:Object.fromEntries(e)})}},{key:"broadcast",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.BROADCAST,X({version:"1.0"},e.toSignalParams()));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"leave",value:function(){this.notify(Ue.LEAVE,{version:"1.0"})}},{key:"endRoom",value:function(e,t){return ne(this,null,w().mark(function n(){return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.call(Ue.END_ROOM,{lock:e,reason:t});case 2:case"end":return n.stop()}},n,this)}))}},{key:"sendEvent",value:function(e){if(!this.isConnected)throw Error("".concat(this.TAG," not connected. Could not send event ").concat(e));this.notify(Ue.ANALYTICS,e.toSignalParams())}},{key:"ping",value:function(e){var t=Date.now(),n=new Promise(function(n){setTimeout(function(){n(Date.now()-t)},e+1)}),r=this.internalCall(Ue.PING,{timestamp:t}).then(function(){return Date.now()-t}).catch(function(){return Date.now()-t});return Promise.race([n,r])}},{key:"requestRoleChange",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.ROLE_CHANGE_REQUEST,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"requestBulkRoleChange",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.ROLE_CHANGE_REQUEST,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"acceptRoleChangeRequest",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.ROLE_CHANGE,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"requestTrackStateChange",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.TRACK_UPDATE_REQUEST,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"requestMultiTrackStateChange",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.CHANGE_TRACK_MUTE_STATE_REQUEST,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"removePeer",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.PEER_LEAVE_REQUEST,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"startRTMPOrRecording",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.START_RTMP_OR_RECORDING_REQUEST,X({version:"1.0"},e));case 2:case"end":return t.stop()}},t,this)}))}},{key:"stopRTMPAndRecording",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.call(Ue.STOP_RTMP_AND_RECORDING_REQUEST,{version:"1.0"});case 2:case"end":return e.stop()}},e,this)}))}},{key:"startHLSStreaming",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.START_HLS_STREAMING,X({version:"1.0"},e));case 2:case"end":return t.stop()}},t,this)}))}},{key:"stopHLSStreaming",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.STOP_HLS_STREAMING,X({version:"1.0"},e));case 2:case"end":return t.stop()}},t,this)}))}},{key:"sendHLSTimedMetadata",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.HLS_TIMED_METADATA,X({version:"1.0"},e));case 2:case"end":return t.stop()}},t,this)}))}},{key:"updatePeer",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.call(Ue.UPDATE_PEER_METADATA,X({version:"1.0"},e));case 2:case"end":return t.stop()}},t,this)}))}},{key:"setSessionMetadata",value:function(e){if(!this.isConnected)throw Qe.WebSocketConnectionErrors.WebSocketConnectionLost(Fe.RECONNECT_SIGNAL,"Failed to set session store value due to network disconnection");return this.call(Ue.SET_METADATA,X({version:"1.1"},e))}},{key:"listenMetadataChange",value:function(e){if(!this.isConnected)throw Qe.WebSocketConnectionErrors.WebSocketConnectionLost(Fe.RECONNECT_SIGNAL,"Failed to observe session store key due to network disconnection");return this.call(Ue.LISTEN_METADATA_CHANGE,{version:"1.1",keys:e})}},{key:"getSessionMetadata",value:function(e){if(!this.isConnected)throw Qe.WebSocketConnectionErrors.WebSocketConnectionLost(Fe.RECONNECT_SIGNAL,"Failed to set session store value due to network disconnection");return this.call(Ue.GET_METADATA,{key:e,version:"1.1"})}},{key:"onMessageHandler",value:function(e){var t=e.data,n=JSON.parse(t);if(n.id)this.handleResponseWithId(n);else{if(!n.method)throw Error("WebSocket message has no 'method' or 'id' field, message=".concat(n));this.handleResponseWithMethod(n)}}},{key:"handleResponseWithId",value:function(e){var t=e,n=t.id;if(this.callbacks.has(n)){var r=this.callbacks.get(n);this.callbacks.delete(n),t.result?r.resolve(t.result):r.reject(t.error)}else this.observer.onNotification(t)}},{key:"handleResponseWithMethod",value:function(e){switch(e.method){case Ue.OFFER:this.observer.onOffer(e.params);break;case Ue.TRICKLE:this.observer.onTrickle(e.params);break;case Ue.SERVER_ERROR:this.observer.onServerError(Qe.WebsocketMethodErrors.ServerErrors(Number(e.params.code),Fe.NONE,e.params.message));break;case Ue.SERVER_WARNING:me.w(this.TAG,e.params);break;default:this.observer.onNotification(e)}}},{key:"rejectPendingCalls",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.callbacks.forEach(function(n,r){var i,a,s,o;(null==(i=n.metadata)?void 0:i.method)!==Ue.PING&&(me.e(e.TAG,"rejecting pending callback ".concat(null==(a=n.metadata)?void 0:a.method,", id=").concat(r)),n.reject(Qe.WebSocketConnectionErrors.WebSocketConnectionLost((null==(s=n.metadata)?void 0:s.method)?We(null==(o=n.metadata)?void 0:o.method):Fe.RECONNECT_SIGNAL,t)),e.callbacks.delete(r))})}},{key:"pingPongLoop",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i,a,s=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=(null==(n=window.HMS)?void 0:n.PING_TIMEOUT)||pn,!this.isConnected){t.next=6;break}return t.next=4,this.ping(i);case 4:a=t.sent,this.pongResponseTimes.enqueue(a),a>i?(me.d(this.TAG,"Pong timeout ".concat(e,", pageHidden=").concat(he())),this.id===e&&this.setIsConnected(!1,"ping pong failure")):setTimeout(function(){return s.pingPongLoop(e)},(null==(r=window.HMS)?void 0:r.PING_INTERVAL)||fn);case 6:case"end":return t.stop()}},t,this)}))}},{key:"call",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a,s;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:r=3,i=Qe.WebsocketMethodErrors.ServerErrors(500,e,"Default ".concat(e," error")),a=1;case 2:if(!(a<=r)){n.next=20;break}return n.prev=3,me.d(this.TAG,"Try number ".concat(a," sending ").concat(e),t),n.next=7,this.internalCall(e,t);case 7:return n.abrupt("return",n.sent);case 10:if(n.prev=10,n.t0=n.catch(3),i=n.t0,me.e(this.TAG,"Failed sending ".concat(e," try: ").concat(a),{method:e,params:t,error:i}),5===parseInt("".concat(i.code/100))||429===i.code){n.next=14;break}return n.abrupt("break",20);case 14:return s=1e3*(2+2*Math.random()),n.next=17,Mt(s);case 17:a++,n.next=2;break;case 20:throw me.e("Sending ".concat(e," over WS failed after ").concat(Math.min(a,r)," retries"),{method:e,params:t,error:i}),i;case 21:case"end":return n.stop()}},n,this,[[3,10]])}))}}]),e}(),Xr=function(){if(oe&&void 0!==navigator.connection){var e=navigator.connection;return{downlink:e.downlink,downlinkMax:e.downlinkMax,effectiveType:e.effectiveType,rtt:e.rtt,saveData:e.saveData,type:e.type}}},$r="[HMSTransport]:",ei=function(){function e(t,n,r,i,a,s){var o,c,u=this;M(this,e),this.observer=t,this.deviceManager=n,this.store=r,this.eventBus=i,this.analyticsEventsService=a,this.analyticsTimer=s,this.state=pr.Disconnected,this.trackStates=new Map,this.publishConnection=null,this.subscribeConnection=null,this.maxSubscribeBitrate=0,this.joinRetryCount=0,this.callbacks=new Map,this.signalObserver={onOffer:function(e){return ne(u,null,w().mark(function t(){var n,r,i,a,s;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.subscribeConnection){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.subscribeConnection.setRemoteDescription(e);case 5:me.d($r,"[SUBSCRIBE] Adding ".concat(this.subscribeConnection.candidates.length," ice-candidates"),this.subscribeConnection.candidates),n=B(this.subscribeConnection.candidates),t.prev=7,n.s();case 9:if((r=n.n()).done){t.next=15;break}return i=r.value,t.next=13,this.subscribeConnection.addIceCandidate(i);case 13:t.next=9;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(7),n.e(t.t0);case 20:return t.prev=20,n.f(),t.finish(20);case 23:return this.subscribeConnection.candidates.length=0,t.next=26,this.subscribeConnection.createAnswer();case 26:return a=t.sent,t.next=29,this.subscribeConnection.setLocalDescription(a);case 29:this.signal.answer(a),me.d($r,"[role=SUBSCRIBE] onOffer renegotiation DONE "),t.next=37;break;case 33:t.prev=33,t.t1=t.catch(0),me.d($r,"[role=SUBSCRIBE] onOffer renegotiation FAILED ",t.t1),this.state=pr.Failed,s=t.t1 instanceof Me?t.t1:Qe.GenericErrors.Unknown(Fe.PUBLISH,t.t1.message),this.observer.onFailure(s),this.eventBus.analytics.publish(Ge.subscribeFail(s));case 37:case"end":return t.stop()}},t,this,[[0,33],[7,17,20,23]])}))},onTrickle:function(e){return ne(u,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(null==(n=e.target===kr.Publish?this.publishConnection:this.subscribeConnection)?void 0:n.remoteDescription)){t.next=6;break}return t.next=4,n.addIceCandidate(e.candidate);case 4:t.next=7;break;case 6:null==n||n.candidates.push(e.candidate);case 7:case"end":return t.stop()}},t,this)}))},onNotification:function(e){return u.observer.onNotification(e)},onServerError:function(e){return ne(u,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.observer.onStateChange(pr.Failed,e);case 2:case"end":return t.stop()}},t,this)}))},onFailure:function(e){u.joinParameters&&u.retryScheduler.schedule({category:qn.SignalDisconnect,error:e,task:u.retrySignalDisconnectTask,originalState:u.state})},onOffline:function(e){return ne(u,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:me.d($r,"socket offline",pr[this.state]);try{this.state!==pr.Leaving&&this.joinParameters&&this.retryScheduler.schedule({category:qn.SignalDisconnect,error:Qe.WebSocketConnectionErrors.WebSocketConnectionLost(Fe.RECONNECT_SIGNAL,e),task:this.retrySignalDisconnectTask,originalState:this.state})}catch(n){console.error(n)}case 2:case"end":return t.stop()}},t,this)}))},onOnline:function(){var e;me.d($r,"socket online",pr[u.state]),u.analyticsSignalTransport.flushFailedEvents(null==(e=u.store.getLocalPeer())?void 0:e.peerId)},onNetworkOnline:function(){u.analyticsEventsService.flushFailedClientEvents()}},this.signal=new Zr(this.signalObserver),this.analyticsSignalTransport=new br(this.signal),this.publishConnectionObserver={onRenegotiationNeeded:function(){return ne(u,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.performPublishRenegotiation();case 2:case"end":return e.stop()}},e,this)}))},onIceConnectionChange:function(e){return ne(u,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:("disconnected"===e?me.w.bind(me):me.d.bind(me))($r,"Publish ice connection state change: ".concat(e));case 1:case"end":return t.stop()}},t)}))},onConnectionStateChange:function(e){return ne(u,null,w().mark(function t(){var n,r,i,a,s,o=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(("disconnected"===e?me.w.bind(me):me.d.bind(me))($r,"Publish connection state change: ".concat(e)),"connected"===e&&(null==(n=this.publishConnection)||n.logSelectedIceCandidatePairs()),"disconnected"===e&&setTimeout(function(){var e,t,n,r,i;"disconnected"===(null==(e=o.publishConnection)?void 0:e.connectionState)&&o.handleIceConnectionFailure(kr.Publish,Qe.WebrtcErrors.ICEDisconnected(Fe.PUBLISH,"local candidate - ".concat(null==(n=null==(t=o.publishConnection)?void 0:t.selectedCandidatePair)?void 0:n.local.candidate,"; remote candidate - ").concat(null==(i=null==(r=o.publishConnection)?void 0:r.selectedCandidatePair)?void 0:i.remote.candidate)))},Tn),t.t0="failed"===e,!t.t0){t.next=7;break}return t.next=7,this.handleIceConnectionFailure(kr.Publish,Qe.WebrtcErrors.ICEFailure(Fe.PUBLISH,"local candidate - ".concat(null==(i=null==(r=this.publishConnection)?void 0:r.selectedCandidatePair)?void 0:i.local.candidate,"; remote candidate - ").concat(null==(s=null==(a=this.publishConnection)?void 0:a.selectedCandidatePair)?void 0:s.remote.candidate)));case 7:case"end":return t.stop()}},t,this)}))}},this.subscribeConnectionObserver={onApiChannelMessage:function(e){u.observer.onNotification(JSON.parse(e))},onTrackAdd:function(e){me.d($r,"[Subscribe] onTrackAdd","".concat(e)),u.observer.onTrackAdd(e)},onTrackRemove:function(e){me.d($r,"[Subscribe] onTrackRemove","".concat(e)),u.observer.onTrackRemove(e)},onIceConnectionChange:function(e){return ne(u,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:("disconnected"===e?me.w.bind(me):me.d.bind(me))($r,"Subscribe ice connection state change: ".concat(e)),"connected"===e&&(n=this.callbacks.get(gn),this.callbacks.delete(gn),n&&n.promise.resolve(!0));case 1:case"end":return t.stop()}},t,this)}))},onConnectionStateChange:function(e){return ne(u,null,w().mark(function t(){var n,r,i,a,s=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(("disconnected"===e?me.w.bind(me):me.d.bind(me))($r,"Subscribe connection state change: ".concat(e)),t.t0="failed"===e,!t.t0){t.next=5;break}return t.next=5,this.handleIceConnectionFailure(kr.Subscribe,Qe.WebrtcErrors.ICEFailure(Fe.SUBSCRIBE,"local candidate - ".concat(null==(r=null==(n=this.subscribeConnection)?void 0:n.selectedCandidatePair)?void 0:r.local.candidate,"; remote candidate - ").concat(null==(a=null==(i=this.subscribeConnection)?void 0:i.selectedCandidatePair)?void 0:a.remote.candidate)));case 5:"disconnected"===e&&setTimeout(function(){var e,t,n,r,i;"disconnected"===(null==(e=s.subscribeConnection)?void 0:e.connectionState)&&s.handleIceConnectionFailure(kr.Subscribe,Qe.WebrtcErrors.ICEDisconnected(Fe.SUBSCRIBE,"local candidate - ".concat(null==(n=null==(t=s.subscribeConnection)?void 0:t.selectedCandidatePair)?void 0:n.local.candidate,"; remote candidate - ").concat(null==(i=null==(r=s.subscribeConnection)?void 0:r.selectedCandidatePair)?void 0:i.remote.candidate)))},Tn),"connected"===e&&this.handleSubscribeConnectionConnected();case 7:case"end":return t.stop()}},t,this)}))}},this.handleLocalRoleUpdate=function(e){return ne(u,[e],function(e){var t=this,n=e.oldRole,r=e.newRole;return w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!(!t.doesRoleNeedWebRTC(n)&&t.doesRoleNeedWebRTC(r)),e.t0){e.next=6;break}return me.d($r,"Local peer role updated to webrtc role, creating PeerConnections and performing inital publish negotiation "),t.createPeerConnections(),e.next=6,t.negotiateOnFirstPublish();case 6:case"end":return e.stop()}},e)})()})},this.retryPublishIceFailedTask=function(){return ne(u,null,w().mark(function e(){var t,n=this;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.publishConnection){e.next=6;break}return t=new Promise(function(e,t){n.callbacks.set(un,{promise:{resolve:e,reject:t},action:Fe.RESTART_ICE,extra:{}})}),e.next=4,this.performPublishRenegotiation({iceRestart:"connected"!==this.publishConnection.connectionState});case 4:return e.next=6,t;case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}},e,this)}))},this.retrySubscribeIceFailedTask=function(){return ne(u,null,w().mark(function e(){var t,n,r=this;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.subscribeConnection||"connected"===this.subscribeConnection.connectionState){e.next=3;break}return t=new Promise(function(e,t){r.callbacks.set(gn,{promise:{resolve:e,reject:t},action:Fe.RESTART_ICE,extra:{}})}),n=new Promise(function(e){setTimeout(e,mn,!1)}),e.abrupt("return",Promise.race([t,n]));case 3:return e.abrupt("return",!0);case 4:case"end":return e.stop()}},e,this)}))},this.retrySignalDisconnectTask=function(){return ne(u,null,w().mark(function e(){var t,n;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(me.d($r,"retrySignalDisconnectTask",{signalConnected:this.signal.isConnected}),e.t0=this.signal.isConnected,e.t0){e.next=5;break}return e.next=5,this.internalConnect(this.joinParameters.authToken,this.joinParameters.endpoint,this.joinParameters.peerId);case 5:if(!(null==(t=this.store.getRoom())?void 0:t.joinedAt)){e.next=14;break}if(e.t2=this.signal.isConnected,!e.t2){e.next=11;break}return e.next=10,this.retryPublishIceFailedTask();case 10:e.t2=e.sent;case 11:e.t1=e.t2,e.next=15;break;case 14:e.t1=this.signal.isConnected;case 15:return n=e.t1,e.abrupt("return",(this.signal.trackUpdate(this.trackStates),n));case 17:case"end":return e.stop()}},e,this)}))},this.webrtcInternals=new Kr(this.store,this.eventBus,null==(o=this.publishConnection)?void 0:o.nativeConnection,null==(c=this.subscribeConnection)?void 0:c.nativeConnection);this.retryScheduler=new mr(function(e,t){return ne(u,null,w().mark(function n(){return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=e!==this.state,!n.t0){n.next=5;break}return this.state=e,n.next=5,this.observer.onStateChange(this.state,t);case 5:case"end":return n.stop()}},n,this)}))},this.sendErrorAnalyticsEvent.bind(this)),this.eventBus.statsUpdate.subscribe(function(e){var t,n,r=(null==(n=null==(t=e.getLocalPeerStats())?void 0:t.subscribe)?void 0:n.bitrate)||0;u.maxSubscribeBitrate=Math.max(u.maxSubscribeBitrate,r)}),this.eventBus.localAudioEnabled.subscribe(function(e){var t=e.track;return u.trackUpdate(t)}),this.eventBus.localVideoEnabled.subscribe(function(e){var t=e.track;return u.trackUpdate(t)})}return G(e,[{key:"getWebrtcInternals",value:function(){return this.webrtcInternals}},{key:"isFlagEnabled",value:function(e){var t,n=null==(t=this.initConfig)?void 0:t.config;return((null==n?void 0:n.enabledFlags)||[]).includes(e)}},{key:"preview",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return ne(this,null,w().mark(function a(){var s;return w().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.connect(e,t,n,r,i);case 2:return s=a.sent,a.abrupt("return",(this.state=pr.Preview,this.observer.onStateChange(this.state),s));case 4:case"end":return a.stop()}},a,this)}))}},{key:"join",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return ne(this,null,w().mark(function a(){var s;return w().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(me.d($r,"join: started "),a.prev=1,a.t0=!this.signal.isConnected||!this.initConfig,!a.t0){a.next=6;break}return a.next=6,this.connect(e,r,t,n,i);case 6:if(this.validateNotDisconnected("connect"),a.t1=this.initConfig,!a.t1){a.next=16;break}return a.next=11,this.waitForLocalRoleAvailability();case 11:return a.next=13,this.createConnectionsAndNegotiateJoin(n,i);case 13:return a.next=15,this.initRtcStatsMonitor();case 15:me.d($r," join: Negotiated over PUBLISH connection");case 16:a.next=26;break;case 18:return a.prev=18,a.t2=a.catch(1),me.e($r,"join: failed  [token=".concat(e,"]"),a.t2),this.state=pr.Failed,(s=a.t2).isTerminal=s.isTerminal||500===s.code,a.next=25,this.observer.onStateChange(this.state,s);case 25:throw s;case 26:me.i($r," join: successful"),this.state=pr.Joined,this.observer.onStateChange(this.state);case 27:case"end":return a.stop()}},a,this,[[1,18]])}))}},{key:"connect",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return ne(this,null,w().mark(function a(){var s,o=this;return w().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.setTransportStateForConnect(),this.joinParameters=new vr(e,n,r.name,r.metaData,t,i),a.prev=1,a.next=4,this.internalConnect(e,t,n);case 4:return a.abrupt("return",a.sent);case 7:if(a.prev=7,a.t0=a.catch(1),!(a.t0 instanceof Me&&([He.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,He.WebSocketConnectionErrors.FAILED_TO_CONNECT,He.WebSocketConnectionErrors.ABNORMAL_CLOSE,He.APIErrors.ENDPOINT_UNREACHABLE].includes(a.t0.code)||a.t0.code.toString().startsWith("5")||a.t0.code.toString().startsWith("429")))){a.next=15;break}return s=function(){return ne(o,null,w().mark(function r(){return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.internalConnect(e,t,n);case 2:return r.abrupt("return",Boolean(this.initConfig&&this.initConfig.endpoint));case 3:case"end":return r.stop()}},r,this)}))},a.next=13,this.retryScheduler.schedule({category:qn.ConnectFailed,error:a.t0,task:s,originalState:this.state,maxFailedRetries:hn,changeState:!1});case 13:a.next=16;break;case 15:throw a.t0;case 16:case"end":return a.stop()}},a,this,[[1,7]])}))}},{key:"leave",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.retryScheduler.reset(),this.joinParameters=void 0,me.d($r,"leaving in transport"),t.prev=1,this.state=pr.Leaving,null==(n=this.webrtcInternals)||n.cleanUp(),t.next=6,null==(r=this.publishConnection)?void 0:r.close();case 6:return t.next=8,null==(i=this.subscribeConnection)?void 0:i.close();case 8:if(!e){t.next=10;break}try{this.signal.leave(),me.d($r,"signal leave done")}catch(a){me.w($r,"failed to send leave on websocket to server",a)}case 10:return this.analyticsEventsService.flushFailedClientEvents(),this.analyticsEventsService.reset(),t.next=14,this.signal.close();case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(1),this.eventBus.analytics.publish(Ge.disconnect(t.t0)),me.e($r,"leave: FAILED ",t.t0);case 19:return t.prev=19,this.state=pr.Disconnected,this.observer.onStateChange(this.state),t.finish(19);case 22:case"end":return t.stop()}},t,this,[[1,16,19,22]])}))}},{key:"publish",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=B(e),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=15;break}return i=r.value,t.prev=5,t.next=8,this.publishTrack(i);case 8:t.next=13;break;case 10:t.prev=10,t.t0=t.catch(5),this.eventBus.analytics.publish(Ge.publish({devices:this.deviceManager.getDevices(),error:t.t0}));case 13:t.next=3;break;case 15:t.next=20;break;case 17:t.prev=17,t.t1=t.catch(1),n.e(t.t1);case 20:return t.prev=20,n.f(),t.finish(20);case 23:case"end":return t.stop()}},t,this,[[1,17,20,23],[5,10]])}))}},{key:"unpublish",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=B(e),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=9;break}return i=r.value,t.next=7,this.unpublishTrack(i);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),n.e(t.t0);case 14:return t.prev=14,n.f(),t.finish(14);case 17:case"end":return t.stop()}},t,this,[[1,11,14,17]])}))}},{key:"sendMessage",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.broadcast(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"trackUpdate",value:function(e){var t=Array.from(this.trackStates.values()).find(function(t){return e.type===t.type&&e.source===t.source});if(t){var n=new ar($(X({},t),{mute:!e.enabled}));this.trackStates.set(t.track_id,n),me.d($r,"Track Update",this.trackStates,e),this.signal.trackUpdate(new Map([[t.track_id,n]]))}}},{key:"changeRole",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return ne(this,null,w().mark(function r(){return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.signal.requestRoleChange({requested_for:e.peerId,role:t,force:n});case 2:case"end":return r.stop()}},r,this)}))}},{key:"changeRoleOfPeer",value:function(e,t,n){return ne(this,null,w().mark(function r(){return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.signal.requestRoleChange({requested_for:e.peerId,role:t,force:n});case 2:case"end":return r.stop()}},r,this)}))}},{key:"changeRoleOfPeersWithRoles",value:function(e,t){return ne(this,null,w().mark(function n(){return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.signal.requestBulkRoleChange({roles:e.map(function(e){return e.name}),role:t,force:!0});case 2:case"end":return n.stop()}},n,this)}))}},{key:"acceptRoleChange",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.acceptRoleChangeRequest({requested_by:null==(n=e.requestedBy)?void 0:n.peerId,role:e.role.name,token:e.token});case 2:case"end":return t.stop()}},t,this)}))}},{key:"endRoom",value:function(e,t){return ne(this,null,w().mark(function n(){return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.signal.endRoom(e,t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"removePeer",value:function(e,t){return ne(this,null,w().mark(function n(){return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.signal.removePeer({requested_for:e,reason:t});case 2:case"end":return n.stop()}},n,this)}))}},{key:"startRTMPOrRecording",value:function(e){return ne(this,null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={meeting_url:e.meetingURL,record:e.record},(null==(n=e.rtmpURLs)?void 0:n.length)&&(r.rtmp_urls=e.rtmpURLs),e.resolution&&(r.resolution=e.resolution),t.next=5,this.signal.startRTMPOrRecording(r);case 5:case"end":return t.stop()}},t,this)}))}},{key:"stopRTMPOrRecording",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signal.stopRTMPAndRecording();case 2:case"end":return e.stop()}},e,this)}))}},{key:"startHLSStreaming",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={},e&&e.variants&&e.variants.length>0&&(n.variants=e.variants.map(function(e){var t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t})),(null==e?void 0:e.recording)&&(n.hls_recording={single_file_per_layer:e.recording.singleFilePerLayer,hls_vod:e.recording.hlsVod}),t.next=5,this.signal.startHLSStreaming(n);case 5:case"end":return t.stop()}},t,this)}))}},{key:"stopHLSStreaming",value:function(e){return ne(this,null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=4;break}return r={variants:null==(n=null==e?void 0:e.variants)?void 0:n.map(function(e){var t={meeting_url:e.meetingURL};return e.metadata&&(t.metadata=e.metadata),t})},t.next=4,this.signal.stopHLSStreaming(r);case 4:return t.next=6,this.signal.stopHLSStreaming();case 6:case"end":return t.stop()}},t,this)}))}},{key:"sendHLSTimedMetadata",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.length>0)){t.next=4;break}return n={metadata_objs:e},t.next=4,this.signal.sendHLSTimedMetadata(n);case 4:case"end":return t.stop()}},t,this)}))}},{key:"changeName",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.store.getLocalPeer(),t.t0=n&&n.name!==e,!t.t0){t.next=5;break}return t.next=5,this.signal.updatePeer({name:e});case 5:case"end":return t.stop()}},t,this)}))}},{key:"changeMetadata",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.updatePeer({data:e});case 2:case"end":return t.stop()}},t,this)}))}},{key:"getSessionMetadata",value:function(e){return this.signal.getSessionMetadata(e)}},{key:"setSessionMetadata",value:function(e){return this.signal.setSessionMetadata(e)}},{key:"listenMetadataChange",value:function(e){return this.signal.listenMetadataChange(e)}},{key:"changeTrackState",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.requestTrackStateChange(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"changeMultiTrackState",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.signal.requestMultiTrackStateChange(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"publishTrack",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i,a=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.publishedTrackId=e.getTrackIDBeingSent(),me.d($r," publishTrack: trackId=".concat(e.trackId,", toPublishTrackId=").concat(e.publishedTrackId),"".concat(e)),this.trackStates.set(e.publishedTrackId,new ar(e)),n=new Promise(function(e,t){a.callbacks.set(un,{promise:{resolve:e,reject:t},action:Fe.PUBLISH,extra:{}})}),(r=e.stream).setConnection(this.publishConnection),i=this.store.getSimulcastLayers(e.source),r.addTransceiver(e,i),me.time("publish-".concat(e.trackId,"-").concat(e.type)),t.next=8,n;case 8:return me.timeEnd("publish-".concat(e.trackId,"-").concat(e.type)),this.store.addTrack(e),t.next=12,r.setMaxBitrateAndFramerate(e).then(function(){me.d($r,"Setting maxBitrate=".concat(e.settings.maxBitrate," kpbs").concat(e instanceof cn?" and maxFramerate=".concat(e.settings.maxFramerate):""," for ").concat(e.source," ").concat(e.type," ").concat(e.trackId))}).catch(function(e){return me.w($r,"Failed setting maxBitrate and maxFramerate",e)});case 12:e.isPublished=!0,me.d($r," publishTrack: trackId=".concat(e.trackId),"".concat(e),this.callbacks);case 14:case"end":return t.stop()}},t,this)}))}},{key:"unpublishTrack",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return me.d($r," unpublishTrack: trackId=".concat(e.trackId),"".concat(e)),e.publishedTrackId&&this.trackStates.has(e.publishedTrackId)?this.trackStates.delete(e.publishedTrackId):(n=Array.from(this.trackStates.values()).find(function(t){return e.type===t.type&&e.source===t.source}))&&this.trackStates.delete(n.track_id),r=new Promise(function(e,t){i.callbacks.set(un,{promise:{resolve:e,reject:t},action:Fe.UNPUBLISH,extra:{}})}),e.stream.removeSender(e),t.next=5,r;case 5:return t.next=7,e.cleanup();case 7:this.store.removeTrack(e),me.d($r," unpublishTrack: trackId=".concat(e.trackId),this.callbacks);case 9:case"end":return t.stop()}},t,this)}))}},{key:"waitForLocalRoleAvailability",value:function(){var e=this;if(!this.store.hasRoleDetailsArrived())return new Promise(function(t){e.eventBus.policyChange.subscribeOnce(function(){return t()})})}},{key:"createConnectionsAndNegotiateJoin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(r=this.doesLocalPeerNeedWebRTC())&&this.createPeerConnections(),this.analyticsTimer.start(Le.JOIN_RESPONSE),n.next=5,this.negotiateJoinWithRetry({name:e.name,data:e.metaData,autoSubscribeVideo:t,isWebRTC:r});case 5:this.analyticsTimer.end(Le.JOIN_RESPONSE);case 6:case"end":return n.stop()}},n,this)}))}},{key:"createPeerConnections",value:function(){this.initConfig&&(this.publishConnection||(this.publishConnection=new _r(this.signal,this.initConfig.rtcConfiguration,this.publishConnectionObserver)),this.subscribeConnection||(this.subscribeConnection=new Dr(this.signal,this.initConfig.rtcConfiguration,this.subscribeConnectionObserver)))}},{key:"negotiateJoinWithRetry",value:function(e){return ne(this,arguments,function(e){var t=this,n=e.name,r=e.data,i=e.autoSubscribeVideo,a=e.isWebRTC,s=void 0===a||a;return w().mark(function e(){var a,o;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.negotiateJoin({name:n,data:r,autoSubscribeVideo:i,isWebRTC:s});case 3:e.next=17;break;case 5:if(e.prev=5,e.t0=e.catch(0),me.e($r,"Join negotiation failed ",e.t0),a=e.t0 instanceof Me?e.t0:Qe.WebsocketMethodErrors.ServerErrors(500,Fe.JOIN,"Websocket join error - ".concat(e.t0.message)),5!==parseInt("".concat(a.code/100))&&![He.WebSocketConnectionErrors.WEBSOCKET_CONNECTION_LOST,429].includes(a.code)){e.next=16;break}return t.joinRetryCount=0,a.isTerminal=!1,o=function(){return ne(t,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.joinRetryCount++,e.next=3,this.negotiateJoin({name:n,data:r,autoSubscribeVideo:i,isWebRTC:s});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}))},e.next=14,t.retryScheduler.schedule({category:qn.JoinWSMessageFailed,error:a,task:o,originalState:pr.Joined,maxFailedRetries:3,changeState:!1});case 14:e.next=17;break;case 16:throw e.t0;case 17:case"end":return e.stop()}},e,null,[[0,5]])})()})}},{key:"negotiateJoin",value:function(e){return ne(this,arguments,function(e){var t=this,n=e.name,r=e.data,i=e.autoSubscribeVideo,a=e.isWebRTC,s=void 0===a||a;return w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!s){e.next=6;break}return e.next=3,t.negotiateJoinWebRTC({name:n,data:r,autoSubscribeVideo:i});case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,t.negotiateJoinNonWebRTC({name:n,data:r,autoSubscribeVideo:i});case 8:e.t0=e.sent;case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}},e)})()})}},{key:"negotiateJoinWebRTC",value:function(e){return ne(this,arguments,function(e){var t=this,n=e.name,r=e.data,i=e.autoSubscribeVideo;return w().mark(function e(){var a,s,o,c,u,l,d;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(me.d($r," join: Negotiating over PUBLISH connection"),t.publishConnection){e.next=2;break}return e.abrupt("return",(me.e($r,"Publish peer connection not found, cannot negotiate"),!1));case 2:return e.next=4,t.publishConnection.createOffer();case 4:return a=e.sent,e.next=7,t.publishConnection.setLocalDescription(a);case 7:return s=t.isFlagEnabled(Jr.FLAG_SERVER_SUB_DEGRADATION),o=t.isFlagEnabled(Jr.FLAG_SERVER_SIMULCAST),e.next=11,t.signal.join(n,r,!i,s,o,a);case 11:return c=e.sent,e.next=14,t.publishConnection.setRemoteDescription(c);case 14:u=B(t.publishConnection.candidates),e.prev=15,u.s();case 17:if((l=u.n()).done){e.next=23;break}return d=l.value,e.next=21,t.publishConnection.addIceCandidate(d);case 21:e.next=17;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(15),u.e(e.t0);case 28:return e.prev=28,u.f(),e.finish(28);case 31:return e.abrupt("return",(t.publishConnection.initAfterJoin(),!!c));case 32:case"end":return e.stop()}},e,null,[[15,25,28,31]])})()})}},{key:"negotiateJoinNonWebRTC",value:function(e){return ne(this,arguments,function(e){var t=this,n=e.name,r=e.data,i=e.autoSubscribeVideo;return w().mark(function e(){var a,s;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return me.d($r," join: Negotiating Non-WebRTC"),a=t.isFlagEnabled(Jr.FLAG_SERVER_SUB_DEGRADATION),s=t.isFlagEnabled(Jr.FLAG_SERVER_SIMULCAST),e.next=4,t.signal.join(n,r,!i,a,s);case 4:return e.abrupt("return",!!e.sent);case 5:case"end":return e.stop()}},e)})()})}},{key:"negotiateOnFirstPublish",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i,a;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(me.d($r," Negotiating offer over PUBLISH connection"),this.publishConnection){e.next=2;break}return e.abrupt("return",(me.e($r,"Publish peer connection not found, cannot negotiate"),!1));case 2:return e.next=4,this.publishConnection.createOffer(this.trackStates);case 4:return t=e.sent,e.next=7,this.publishConnection.setLocalDescription(t);case 7:return e.next=9,this.signal.offer(t,this.trackStates);case 9:return n=e.sent,e.next=12,this.publishConnection.setRemoteDescription(n);case 12:r=B(this.publishConnection.candidates),e.prev=13,r.s();case 15:if((i=r.n()).done){e.next=21;break}return a=i.value,e.next=19,this.publishConnection.addIceCandidate(a);case 19:e.next=15;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(13),r.e(e.t0);case 26:return e.prev=26,r.f(),e.finish(26);case 29:return e.abrupt("return",(this.publishConnection.initAfterJoin(),!!n));case 30:case"end":return e.stop()}},e,this,[[13,23,26,29]])}))}},{key:"performPublishRenegotiation",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i,a;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(me.d($r," [role=PUBLISH] onRenegotiationNeeded START",this.trackStates),!(n=this.callbacks.get(un))){t.next=27;break}if(this.publishConnection){t.next=6;break}return me.e($r,"Publish peer connection not found, cannot renegotiate"),t.abrupt("return");case 6:return t.prev=6,t.next=9,this.publishConnection.createOffer(this.trackStates,e);case 9:return r=t.sent,t.next=12,this.publishConnection.setLocalDescription(r);case 12:return me.time("renegotiation-offer-exchange"),t.next=15,this.signal.offer(r,this.trackStates);case 15:return i=t.sent,this.callbacks.delete(un),me.timeEnd("renegotiation-offer-exchange"),t.next=20,this.publishConnection.setRemoteDescription(i);case 20:n.promise.resolve(!0),me.d($r,"[role=PUBLISH] onRenegotiationNeeded DONE "),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(6),a=t.t0 instanceof Me?t.t0:Qe.GenericErrors.Unknown(Fe.PUBLISH,t.t0.message),n.promise.reject(a),me.d($r,"[role=PUBLISH] onRenegotiationNeeded FAILED ");case 27:case"end":return t.stop()}},t,this,[[6,24]])}))}},{key:"handleIceConnectionFailure",value:function(e,t){return ne(this,null,w().mark(function n(){return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:this.retryScheduler.isTaskInProgress(kr.Publish?qn.PublishIceConnectionFailed:qn.SubscribeIceConnectionFailed)||(e===kr.Publish?this.retryScheduler.schedule({category:qn.PublishIceConnectionFailed,error:t,task:this.retryPublishIceFailedTask,originalState:pr.Joined}):this.retryScheduler.schedule({category:qn.SubscribeIceConnectionFailed,error:t,task:this.retrySubscribeIceFailedTask,originalState:pr.Joined,maxFailedRetries:1}));case 1:case"end":return n.stop()}},n,this)}))}},{key:"internalConnect",value:function(e,t,n){return ne(this,null,w().mark(function r(){var i;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return me.d($r,"connect: started "),i=new Date,r.prev=2,this.analyticsTimer.start(Le.INIT),r.next=6,zr.fetchInitConfig({token:e,peerId:n,userAgent:this.store.getUserAgent(),initEndpoint:t});case 6:return this.initConfig=r.sent,this.analyticsTimer.end(Le.INIT),Ln.setWebsocketEndpoint(this.initConfig.endpoint),this.validateNotDisconnected("post init"),r.next=12,this.openSignal(e,n);case 12:return this.store.setSimulcastEnabled(this.isFlagEnabled(Jr.FLAG_SERVER_SIMULCAST)),me.d($r,"Adding Analytics Transport: JsonRpcSignal"),this.analyticsEventsService.setTransport(this.analyticsSignalTransport),this.analyticsEventsService.flush(),r.abrupt("return",this.initConfig);case 19:throw r.prev=19,r.t0=r.catch(2),this.state!==pr.Reconnecting&&this.eventBus.analytics.publish(Ge.connect(r.t0,this.getAdditionalAnalyticsProperties(),i,new Date,t)),me.e($r," internal connect: failed",r.t0),r.t0;case 22:case"end":return r.stop()}},r,this,[[2,19]])}))}},{key:"validateNotDisconnected",value:function(e){if(this.state===pr.Disconnected)throw me.w($r,"aborting join as transport state is disconnected"),Qe.GenericErrors.ValidationFailed("leave called before join could complete - stage=".concat(e))}},{key:"openSignal",value:function(e,t){return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.initConfig){n.next=2;break}throw Qe.APIErrors.InitConfigNotAvailable(Fe.INIT,"Init Config not found");case 2:return me.d($r," internal connect: connecting to ws endpoint",this.initConfig.endpoint),(r=new URL(this.initConfig.endpoint)).searchParams.set("peer",t),r.searchParams.set("token",e),r.searchParams.set("user_agent_v2",this.store.getUserAgent()),this.endpoint=r.toString(),this.analyticsTimer.start(Le.WEBSOCKET_CONNECT),n.next=11,this.signal.open(this.endpoint);case 11:this.analyticsTimer.end(Le.WEBSOCKET_CONNECT),this.analyticsTimer.start(Le.ON_POLICY_CHANGE),this.analyticsTimer.start(Le.ROOM_STATE),me.d($r," internal connect: connected to ws endpoint");case 15:case"end":return n.stop()}},n,this)}))}},{key:"initRtcStatsMonitor",value:function(){return ne(this,null,w().mark(function e(){var t,n,r;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:null==(r=this.webrtcInternals)||r.setPeerConnections({publish:null==(t=this.publishConnection)?void 0:t.nativeConnection,subscribe:null==(n=this.subscribeConnection)?void 0:n.nativeConnection});case 1:case"end":return e.stop()}},e,this)}))}},{key:"doesRoleNeedWebRTC",value:function(e){var t,n;if(!this.isFlagEnabled(Jr.FLAG_NON_WEBRTC_DISABLE_OFFER))return!0;var r=Boolean(e.publishParams.allowed&&(null==(t=e.publishParams.allowed)?void 0:t.length)>0),i=Boolean(e.subscribeParams.subscribeToRoles&&(null==(n=e.subscribeParams.subscribeToRoles)?void 0:n.length)>0);return r||i}},{key:"doesLocalPeerNeedWebRTC",value:function(){var e,t=null==(e=this.store.getLocalPeer())?void 0:e.role;return!t||this.doesRoleNeedWebRTC(t)}},{key:"handleSubscribeConnectionConnected",value:function(){var e;null==(e=this.subscribeConnection)||e.logSelectedIceCandidatePairs();var t=this.callbacks.get(gn);this.callbacks.delete(gn),t&&t.promise.resolve(!0)}},{key:"setTransportStateForConnect",value:function(){if(this.state===pr.Failed&&(this.state=pr.Disconnected),this.state!==pr.Disconnected&&this.state!==pr.Reconnecting)throw Qe.WebsocketMethodErrors.AlreadyJoined(Fe.JOIN,"Cannot join a meeting in ".concat(this.state," state"));this.state===pr.Disconnected&&(this.state=pr.Connecting,this.observer.onStateChange(this.state))}},{key:"sendErrorAnalyticsEvent",value:function(e,t){var n,r=this.getAdditionalAnalyticsProperties();switch(t){case qn.ConnectFailed:n=Ge.connect(e,r);break;case qn.SignalDisconnect:n=Ge.disconnect(e,r);break;case qn.JoinWSMessageFailed:n=Ge.join({error:e,time:this.analyticsTimer.getTimeTaken(Le.JOIN),init_response_time:this.analyticsTimer.getTimeTaken(Le.INIT),ws_connect_time:this.analyticsTimer.getTimeTaken(Le.WEBSOCKET_CONNECT),on_policy_change_time:this.analyticsTimer.getTimeTaken(Le.ON_POLICY_CHANGE),local_audio_track_time:this.analyticsTimer.getTimeTaken(Le.LOCAL_AUDIO_TRACK),local_video_track_time:this.analyticsTimer.getTimeTaken(Le.LOCAL_VIDEO_TRACK),retries_join:this.joinRetryCount});break;case qn.PublishIceConnectionFailed:n=Ge.publish({error:e});break;case qn.SubscribeIceConnectionFailed:n=Ge.subscribeFail(e)}this.eventBus.analytics.publish(n)}},{key:"getAdditionalAnalyticsProperties",value:function(){var e,t,n,r,i,a,s,o;return{network_info:Xr(),document_hidden:"undefined"!=typeof document&&document.hidden,num_degraded_tracks:this.store.getRemoteVideoTracks().filter(function(e){return e.degraded}).length,bitrate:{publish:null==(r=null==(n=null==(t=null==(e=this.getWebrtcInternals())?void 0:e.getCurrentStats())?void 0:t.getLocalPeerStats())?void 0:n.publish)?void 0:r.bitrate,subscribe:null==(o=null==(s=null==(a=null==(i=this.getWebrtcInternals())?void 0:i.getCurrentStats())?void 0:a.getLocalPeerStats())?void 0:s.subscribe)?void 0:o.bitrate},max_sub_bitrate:this.maxSubscribeBitrate,recent_pong_response_times:this.signal.getPongResponseTimes(),transport_state:this.state}}}]),e}(),ti=function(e,t,n){return ne(void 0,null,w().mark(function r(){var i,a,s,o,c;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:i=4,a=Error("something went wrong during fetch"),s=0;case 2:if(!(s<i)){r.next=21;break}return r.prev=3,r.next=6,fetch(e,t);case 6:return o=r.sent,r.next=9,o.clone().json();case 9:if(c=r.sent,!n||!n.length||o.ok||!n.includes(c.code)){r.next=12;break}throw Qe.APIErrors.ServerErrors(c.code,Fe.GET_TOKEN,c.message,!1);case 12:return r.abrupt("return",o);case 15:r.prev=15,r.t0=r.catch(3),a=r.t0;case 18:s++,r.next=2;break;case 21:throw["Failed to fetch","NetworkError"].some(function(e){return a.message.includes(e)})?Qe.APIErrors.EndpointUnreachable(Fe.GET_TOKEN,a.message):a;case 22:case"end":return r.stop()}},r,null,[[3,15]])}))};function ni(e){if(!e||0===e.length)throw Qe.APIErrors.InvalidTokenFormat(Fe.INIT,"Token cannot be an empty string or undefined or null");var t=e.split(".");if(3!==t.length)throw Qe.APIErrors.InvalidTokenFormat(Fe.INIT,"Expected 3 '.' separate fields - header, payload and signature respectively");var n=atob(t[1]);try{var r=JSON.parse(n);return{roomId:r.room_id,userId:r.user_id,role:r.role}}catch(i){throw Qe.APIErrors.InvalidTokenFormat(Fe.INIT,"couldn't parse to json - ".concat(i.message))}}var ri={published:!1,isInitialised:!1,isReconnecting:!1,isPreviewInProgress:!1,isPreviewCalled:!1,isJoinInProgress:!1,deviceManagersInitialised:!1},ii=function(){function e(){var t=this;M(this,e),this.TAG="[HMSSdk]:",this.transportState=pr.Disconnected,this.analyticsTimer=new Ve,this.sdkState=X({},ri),this.handleAutoplayError=function(e){var n,r;null==(r=null==(n=t.errorListener)?void 0:n.onError)||r.call(n,e)},this.observer={onNotification:function(e){if(e.method!==Pn.PEER_LEAVE_REQUEST){switch(e.method){case Pn.POLICY_CHANGE:t.analyticsTimer.end(Le.ON_POLICY_CHANGE);break;case Pn.PEER_LIST:t.analyticsTimer.end(Le.PEER_LIST),t.sendJoinAnalyticsEvent(t.sdkState.isPreviewCalled);break;case Pn.ROOM_STATE:t.analyticsTimer.end(Le.ROOM_STATE)}t.notificationManager.handleNotification(e,t.sdkState.isReconnecting)}else t.handlePeerLeaveRequest(e.params)},onTrackAdd:function(e){t.notificationManager.handleTrackAdd(e)},onTrackRemove:function(e){t.notificationManager.handleTrackRemove(e)},onFailure:function(e){var n;null==(n=t.errorListener)||n.onError(e)},onStateChange:function(e,n){return ne(t,null,w().mark(function t(){var r,i,a,s=this;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=function(e){return ne(s,null,w().mark(function t(){var n,r;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.internalLeave(!0,e);case 2:!this.sdkState.isPreviewInProgress&&!this.sdkState.isJoinInProgress&&(null==(r=null==(n=this.errorListener)?void 0:n.onError)||r.call(n,e)),this.sdkState.isReconnecting=!1;case 4:case"end":return t.stop()}},t,this)}))},t.t0=e,t.next=t.t0===pr.Preview?4:t.t0===pr.Joined?4:t.t0===pr.Failed?6:t.t0===pr.Reconnecting?9:11;break;case 4:return this.transportState===pr.Reconnecting&&(null==(r=this.listener)||r.onReconnected()),t.abrupt("break",11);case 6:return t.next=8,a(n);case 8:return t.abrupt("break",11);case 9:return this.sdkState.isReconnecting=!0,null==(i=this.listener)||i.onReconnecting(n),t.abrupt("break",11);case 11:this.transportState=e,me.d(this.TAG,"Transport State Change",this.transportState);case 12:case"end":return t.stop()}},t,this)}))}},this.handlePeerLeaveRequest=function(e){var n,r=e.requested_by?t.store.getPeerById(e.requested_by):void 0,i={roomEnded:e.room_end,reason:e.reason,requestedBy:r};null==(n=t.listener)||n.onRemovedFromRoom(i),t.internalLeave(!1)},this.handleDeviceChange=function(e){var n,r,i,a,s,o;if(me.d(t.TAG,"Device Change event",e),null==(r=null==(n=t.deviceChangeListener)?void 0:n.onDeviceChange)||r.call(n,e),e.error&&e.type){var c=e.type.includes("audio")?null==(i=t.localPeer)?void 0:i.audioTrack:null==(a=t.localPeer)?void 0:a.videoTrack;null==(s=t.errorListener)||s.onError(e.error),[He.TracksErrors.CANT_ACCESS_CAPTURE_DEVICE,He.TracksErrors.DEVICE_IN_USE,He.TracksErrors.DEVICE_NOT_AVAILABLE].includes(e.error.code)&&c&&(c.setEnabled(!1),null==(o=t.listener)||o.onTrackUpdate(qe.TRACK_MUTED,c,t.localPeer))}},this.handleAudioPluginError=function(e){var n;me.e(t.TAG,"Audio Plugin Error event",e),null==(n=t.errorListener)||n.onError(e)},this.handleLocalRoleUpdate=function(e){return ne(t,[e],function(e){var t=this,n=e.oldRole,r=e.newRole;return w().mark(function e(){var i;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.transport.handleLocalRoleUpdate({oldRole:n,newRole:r});case 2:return e.next=4,null==(i=t.roleChangeManager)?void 0:i.handleLocalPeerRoleUpdate({oldRole:n,newRole:r});case 4:case"end":return e.stop()}},e)})()})},this.sendAudioPresenceFailed=function(){var e=Qe.TracksErrors.NoAudioDetected(Fe.PREVIEW);me.w(t.TAG,"Audio Presence Failure",t.transportState,e)},this.sendJoinAnalyticsEvent=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;t.eventBus.analytics.publish(Ge.join($(X({error:n},t.analyticsTimer.getTimes()),{time:t.analyticsTimer.getTimeTaken(Le.JOIN),is_preview_called:e,retries_join:t.transport.joinRetryCount})))},this.sendPreviewAnalyticsEvent=function(e){t.eventBus.analytics.publish(Ge.preview($(X({error:e},t.analyticsTimer.getTimes()),{time:t.analyticsTimer.getTimeTaken(Le.PREVIEW)})))},this.sendAnalyticsEvent=function(e){t.analyticsEventsService.queue(e).flush()}}return G(e,[{key:"initStoreAndManagers",value:function(){if(this.sdkState.isInitialised)return this.notificationManager.setListener(this.listener),void this.audioSinkManager.setListener(this.listener);this.sdkState.isInitialised=!0,this.store=new Gn,this.eventBus=new Kn,this.wakeLockManager=new Un,this.networkTestManager=new Dn(this.eventBus,this.listener),this.playlistManager=new dr(this,this.eventBus),this.notificationManager=new ir(this.store,this.eventBus,this.listener,this.audioListener),this.deviceManager=new Hn(this.store,this.eventBus),this.audioSinkManager=new Vn(this.store,this.deviceManager,this.eventBus),this.audioOutput=new Wn(this.deviceManager,this.audioSinkManager),this.audioSinkManager.setListener(this.listener),this.eventBus.autoplayError.subscribe(this.handleAutoplayError),this.localTrackManager=new On(this.store,this.observer,this.deviceManager,this.eventBus,this.analyticsTimer),this.analyticsEventsService=new Fn(this.store),this.transport=new ei(this.observer,this.deviceManager,this.store,this.eventBus,this.analyticsEventsService,this.analyticsTimer),this.sessionStore=new hr(this.transport),this.eventBus.analytics.subscribe(this.sendAnalyticsEvent),this.eventBus.deviceChange.subscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.subscribe(this.handleAudioPluginError)}},{key:"validateJoined",value:function(e){if(!this.localPeer)throw Qe.GenericErrors.NotConnected(Fe.VALIDATION,"Not connected - ".concat(e))}},{key:"sendHLSAnalytics",value:function(e){this.sendAnalyticsEvent(Ge.hlsPlayerError(e))}},{key:"refreshDevices",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateJoined("refreshDevices"),e.next=3,this.deviceManager.init(!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"getWebrtcInternals",value:function(){var e;return null==(e=this.transport)?void 0:e.getWebrtcInternals()}},{key:"getSessionStore",value:function(){return this.sessionStore}},{key:"getPlaylistManager",value:function(){return this.playlistManager}},{key:"getRecordingState",value:function(){var e;return null==(e=this.store.getRoom())?void 0:e.recording}},{key:"getRTMPState",value:function(){var e;return null==(e=this.store.getRoom())?void 0:e.rtmp}},{key:"getHLSState",value:function(){var e;return null==(e=this.store.getRoom())?void 0:e.hls}},{key:"getTemplateAppData",value:function(){return this.store.getTemplateAppData()}},{key:"localPeer",get:function(){var e;return null==(e=this.store)?void 0:e.getLocalPeer()}},{key:"preview",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a,s=this;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(xr(),Sr(),!this.sdkState.isPreviewInProgress){n.next=2;break}return n.abrupt("return",Promise.reject(Qe.GenericErrors.PreviewAlreadyInProgress(Fe.PREVIEW,"Preview already called")));case 2:return this.analyticsTimer.start(Le.PREVIEW),this.setUpPreview(e,t),e.alwaysRequestPermissions&&this.localTrackManager.requestPermissions().then(function(){return ne(s,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initDeviceManagers();case 2:case"end":return e.stop()}},e,this)}))}),r=!1,i=!1,a=setTimeout(function(){var e,t;(!r||!i)&&(null==(t=null==(e=s.listener)?void 0:e.onNetworkQuality)||t.call(e,-1))},3e3),n.abrupt("return",new Promise(function(n,o){var c=function(e){var t;s.analyticsTimer.end(Le.PREVIEW),e&&(null==(t=s.errorListener)||t.onError(e)),s.sendPreviewAnalyticsEvent(e),s.sdkState.isPreviewInProgress=!1,o(e)};s.eventBus.policyChange.subscribeOnce(function(){return ne(s,null,w().mark(function r(){var i,a,s,o,c=this;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return this.localPeer&&(a=e.asRole&&this.store.getPolicyForRole(e.asRole),this.localPeer.asRole=a||this.localPeer.role),r.next=3,this.localTrackManager.getTracksToPublish(e.settings);case 3:return(s=r.sent).forEach(function(e){return c.setLocalPeerTrack(e)}),(null==(i=this.localPeer)?void 0:i.audioTrack)&&this.initPreviewTrackAudioLevelMonitor(),r.next=8,this.initDeviceManagers();case 8:this.sdkState.isPreviewInProgress=!1,this.analyticsTimer.end(Le.PREVIEW),(o=this.store.getRoom())&&t.onPreview(o,s),this.sendPreviewAnalyticsEvent(),n();case 12:case"end":return r.stop()}},r,this)}))}),s.eventBus.leave.subscribeOnce(c),s.transport.preview(e.authToken,e.initEndpoint,s.localPeer.peerId,{name:e.userName,metaData:e.metaData||""},e.autoVideoSubscribe).then(function(t){var n;r=!0,clearTimeout(a),t&&e.captureNetworkQualityInPreview&&s.networkTestManager.start(null==(n=t.config)?void 0:n.networkHealth).then(function(){i=!0})}).catch(c)}));case 5:case"end":return n.stop()}},n,this)}))}},{key:"join",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a,s,o,c,u,l,d,h,v,p;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(xr(),Sr(),!this.sdkState.isPreviewInProgress){n.next=2;break}throw Qe.GenericErrors.NotReady(Fe.JOIN,"Preview is in progress, can't join");case 2:return this.analyticsTimer.start(Le.JOIN),this.sdkState.isJoinInProgress=!0,u=ni(e.authToken),l=u.roomId,d=u.userId,h=u.role,v=(null==(i=null==(r=this.localPeer)?void 0:r.asRole)?void 0:i.name)||(null==(s=null==(a=this.localPeer)?void 0:a.role)?void 0:s.name),null==(o=this.networkTestManager)||o.stop(),this.listener=t,this.commonSetup(e,l,t),this.removeDevicesFromConfig(e),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),Dt.resumeContext(),(null==(p=this.store.getConfig())?void 0:p.autoManageWakeLock)&&this.wakeLockManager.acquireLock(),this.localPeer?(this.localPeer.name=e.userName,this.localPeer.role=this.store.getPolicyForRole(h),this.localPeer.customerUserId=d,this.localPeer.metadata=e.metaData,delete this.localPeer.asRole):this.createAndAddLocalPeerToStore(e,h,d),this.roleChangeManager=new Nn(this.store,this.transport,this.getAndPublishTracks.bind(this),this.removeTrack.bind(this),this.listener),this.eventBus.localRoleUpdate.subscribe(this.handleLocalRoleUpdate),me.d(this.TAG,"SDK Store",this.store),me.d(this.TAG," Joining room ".concat(l)),me.time("join-room-".concat(l)),n.prev=7,n.next=10,this.transport.join(e.authToken,this.localPeer.peerId,{name:e.userName,metaData:e.metaData},e.initEndpoint,e.autoVideoSubscribe);case 10:return me.d(this.TAG," Joined room ".concat(l)),this.analyticsTimer.start(Le.PEER_LIST),n.next=14,this.notifyJoin();case 14:return this.sdkState.isJoinInProgress=!1,n.next=17,this.publish(e.settings,v);case 17:n.next=22;break;case 19:throw n.prev=19,n.t0=n.catch(7),this.analyticsTimer.end(Le.JOIN),this.sdkState.isJoinInProgress=!1,null==(c=this.listener)||c.onError(n.t0),this.sendJoinAnalyticsEvent(this.sdkState.isPreviewCalled,n.t0),me.e(this.TAG,"Unable to join room",n.t0),n.t0;case 22:me.timeEnd("join-room-".concat(l));case 23:case"end":return n.stop()}},n,this,[[7,19]])}))}},{key:"stringifyMetadata",value:function(e){e.metaData&&"string"!=typeof e.metaData?e.metaData=JSON.stringify(e.metaData):e.metaData||(e.metaData="")}},{key:"cleanUp",value:function(){var e,t,n;this.cleanDeviceManagers(),this.eventBus.analytics.unsubscribe(this.sendAnalyticsEvent),this.analyticsTimer.cleanUp(),bt.cleanup(),this.playlistManager.cleanup(),null==(e=this.wakeLockManager)||e.cleanup(),me.cleanUp(),this.sdkState=X({},ri),this.localPeer&&(null==(t=this.localPeer.audioTrack)||t.cleanup(),this.localPeer.audioTrack=void 0,null==(n=this.localPeer.videoTrack)||n.cleanup(),this.localPeer.videoTrack=void 0),this.store.cleanUp(),this.listener=void 0,this.roleChangeManager&&this.eventBus.localRoleUpdate.unsubscribe(this.handleLocalRoleUpdate)}},{key:"leave",value:function(e){return this.internalLeave(e)}},{key:"internalLeave",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;return ne(this,null,w().mark(function n(){var r,i,a,s;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(a=this.store.getRoom())){n.next=10;break}return s=a.id,null==(r=this.networkTestManager)||r.stop(),this.eventBus.leave.publish(t),me.d(this.TAG," Leaving room ".concat(s)),n.next=8,null==(i=this.transport)?void 0:i.leave(e);case 8:this.cleanUp(),me.d(this.TAG," Left room ".concat(s));case 10:case"end":return n.stop()}},n,this)}))}},{key:"getAuthTokenByRoomCode",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a,s;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=(t||{}).endpoint||"https://auth.100ms.live/v2/token",this.analyticsTimer.start(Le.GET_TOKEN),n.next=4,ti(r,{method:"POST",body:JSON.stringify({code:e.roomCode,user_id:e.userId})},[429,500,501,502,503,504,505,506,507,508,509,510,511]);case 4:return i=n.sent,n.next=7,i.json();case 7:if(a=n.sent,this.analyticsTimer.end(Le.GET_TOKEN),i.ok){n.next=10;break}throw Qe.APIErrors.ServerErrors(a.code,Fe.GET_TOKEN,a.message,!1);case 10:if(s=a.token){n.next=13;break}throw Error(a.message);case 13:return n.abrupt("return",s);case 14:case"end":return n.stop()}},n,this)}))}},{key:"getLocalPeer",value:function(){return this.store.getLocalPeer()}},{key:"getPeers",value:function(){return this.store.getPeers()}},{key:"getAudioOutput",value:function(){return this.audioOutput}},{key:"sendMessage",value:function(e,t){this.sendMessageInternal({message:t,type:e})}},{key:"sendBroadcastMessage",value:function(e,t){return ne(this,null,w().mark(function n(){return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.sendMessageInternal({message:e,type:t});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"sendGroupMessage",value:function(e,t,n){return ne(this,null,w().mark(function r(){var i;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(i=this.store.getKnownRoles(),0!==(t.filter(function(e){return i[e.name]})||[]).length){r.next=3;break}throw Qe.GenericErrors.ValidationFailed("No valid role is present",t);case 3:return r.next=5,this.sendMessageInternal({message:e,recipientRoles:t,type:n});case 5:return r.abrupt("return",r.sent);case 6:case"end":return r.stop()}},r,this)}))}},{key:"sendDirectMessage",value:function(e,t,n){return ne(this,null,w().mark(function r(){var i;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(this.store.getPeerById(t.peerId)){r.next=2;break}throw Qe.GenericErrors.ValidationFailed("Invalid peer - peer not present in the room",t);case 2:if((null==(i=this.localPeer)?void 0:i.peerId)!==t.peerId){r.next=4;break}throw Qe.GenericErrors.ValidationFailed("Cannot send message to self");case 4:return r.next=6,this.sendMessageInternal({message:e,recipientPeer:t,type:n});case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},r,this)}))}},{key:"sendMessageInternal",value:function(e){return ne(this,arguments,function(e){var t=this,n=e.recipientRoles,r=e.recipientPeer,i=e.type,a=void 0===i?"chat":i,s=e.message;return w().mark(function e(){var i,o;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==s.replace(/\u200b/g," ").trim()){e.next=2;break}throw me.w(t.TAG,"sendMessage","Ignoring empty message send"),Qe.GenericErrors.ValidationFailed("Empty message not allowed");case 2:return i=new Te({sender:t.localPeer,type:a,message:s,recipientPeer:r,recipientRoles:n,time:new Date}),me.d(t.TAG,"Sending Message: ",i),e.next=6,t.transport.sendMessage(i);case 6:return o=e.sent,e.abrupt("return",(i.time=new Date(o.timestamp),i));case 8:case"end":return e.stop()}},e)})()})}},{key:"startScreenShare",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a,s,o,c,u=this;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(s=this.store.getPublishParams()){n.next=3;break}return n.abrupt("return");case 3:if((o=s.allowed)&&o.includes("screen")){n.next=7;break}return me.e(this.TAG,"Role ".concat(null==(r=this.localPeer)?void 0:r.role," cannot share screen")),n.abrupt("return");case 7:if(!(null==(a=null==(i=this.localPeer)?void 0:i.auxiliaryTracks)?void 0:a.find(function(e){return"screen"===e.source}))){n.next=9;break}throw Error("Cannot share multiple screens");case 9:return n.next=11,this.getScreenshareTracks(e,t);case 11:if(c=n.sent,this.localPeer){n.next=15;break}return me.d(this.TAG,"Screenshared when not connected"),c.forEach(function(e){e.cleanup()}),n.abrupt("return");case 15:return n.next=17,this.transport.publish(c);case 17:c.forEach(function(e){var t,n,r;e.peerId=null==(t=u.localPeer)?void 0:t.peerId,null==(n=u.localPeer)||n.auxiliaryTracks.push(e),null==(r=u.listener)||r.onTrackUpdate(qe.TRACK_ADDED,e,u.localPeer)});case 18:case"end":return n.stop()}},n,this)}))}},{key:"stopEndedScreenshare",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return me.d(this.TAG," Screenshare ended natively"),t.next=3,this.stopScreenShare();case 3:e();case 4:case"end":return t.stop()}},t,this)}))}},{key:"stopScreenShare",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i,a;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(me.d(this.TAG," Screenshare ended from app"),!(n=null==(t=this.localPeer)?void 0:t.auxiliaryTracks.filter(function(e){return"screen"===e.source}))){e.next=20;break}r=B(n),e.prev=4,r.s();case 6:if((i=r.n()).done){e.next=12;break}return a=i.value,e.next=10,this.removeTrack(a.trackId);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:case"end":return e.stop()}},e,this,[[4,14,17,20]])}))}},{key:"addTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"regular";return ne(this,null,w().mark(function n(){var r,i,a,s,o,c,u,l;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=3;break}return me.w(this.TAG,"Please pass a valid MediaStreamTrack"),n.abrupt("return");case 3:if(this.localPeer){n.next=5;break}throw Qe.GenericErrors.NotConnected(Fe.VALIDATION,"No local peer present, cannot addTrack");case 5:if(!this.localPeer.auxiliaryTracks.find(function(t){return t.trackId===e.id})){n.next=7;break}return n.abrupt("return");case 7:return o=e.kind,c=new MediaStream([e]),u=new Rn(c),l=new("audio"===o?Vt:cn)(u,e,t,this.eventBus),this.setPlaylistSettings({track:e,hmsTrack:l,source:t}),n.next=11,null==(r=this.transport)?void 0:r.publish([l]);case 11:l.peerId=null==(i=this.localPeer)?void 0:i.peerId,null==(a=this.localPeer)||a.auxiliaryTracks.push(l),null==(s=this.listener)||s.onTrackUpdate(qe.TRACK_ADDED,l,this.localPeer);case 14:case"end":return n.stop()}},n,this)}))}},{key:"removeTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return ne(this,null,w().mark(function n(){var r,i,a;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.localPeer){n.next=2;break}throw Qe.GenericErrors.NotConnected(Fe.VALIDATION,"No local peer present, cannot removeTrack");case 2:if(!((i=this.localPeer.auxiliaryTracks.findIndex(function(t){return t.trackId===e}))>-1)){n.next=17;break}if(!(a=this.localPeer.auxiliaryTracks[i]).isPublished){n.next=10;break}return n.next=8,this.transport.unpublish([a]);case 8:n.next=12;break;case 10:return n.next=12,a.cleanup();case 12:t||this.stopPlaylist(a),this.localPeer.auxiliaryTracks.splice(i,1),null==(r=this.listener)||r.onTrackUpdate(qe.TRACK_REMOVED,a,this.localPeer),n.next=18;break;case 17:me.w(this.TAG,"No track found for ".concat(e));case 18:case"end":return n.stop()}},n,this)}))}},{key:"setAnalyticsLevel",value:function(e){this.analyticsEventsService.level=e}},{key:"setLogLevel",value:function(e){me.level=e}},{key:"addAudioListener",value:function(e){this.audioListener=e,this.notificationManager.setAudioListener(e)}},{key:"addConnectionQualityListener",value:function(e){this.notificationManager.setConnectionQualityListener(e)}},{key:"changeRole",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return ne(this,null,w().mark(function r(){var i;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=!e.role||e.role.name===t,r.t0){r.next=4;break}return r.next=4,null==(i=this.transport)?void 0:i.changeRoleOfPeer(e,t,n);case 4:case"end":return r.stop()}},r,this)}))}},{key:"changeRoleOfPeer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return ne(this,null,w().mark(function r(){var i;return w().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.t0=!e.role||e.role.name===t,r.t0){r.next=4;break}return r.next=4,null==(i=this.transport)?void 0:i.changeRoleOfPeer(e,t,n);case 4:case"end":return r.stop()}},r,this)}))}},{key:"changeRoleOfPeersWithRoles",value:function(e,t){return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=e.length<=0||!t,n.t0){n.next=4;break}return n.next=4,null==(r=this.transport)?void 0:r.changeRoleOfPeersWithRoles(e,t);case 4:case"end":return n.stop()}},n,this)}))}},{key:"acceptChangeRole",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null==(n=this.transport)?void 0:n.acceptRoleChange(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"endRoom",value:function(e,t){return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.localPeer){n.next=2;break}throw Qe.GenericErrors.NotConnected(Fe.VALIDATION,"No local peer present, cannot end room");case 2:return n.next=4,null==(r=this.transport)?void 0:r.endRoom(e,t);case 4:return n.next=6,this.leave();case 6:case"end":return n.stop()}},n,this)}))}},{key:"removePeer",value:function(e,t){return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(this.localPeer){n.next=2;break}throw Qe.GenericErrors.NotConnected(Fe.VALIDATION,"No local peer present, cannot remove peer");case 2:if(this.store.getPeerById(e.peerId)){n.next=4;break}throw Qe.GenericErrors.ValidationFailed("Invalid peer, given peer not present in room",e);case 4:return n.next=6,null==(r=this.transport)?void 0:r.removePeer(e.peerId,t);case 6:case"end":return n.stop()}},n,this)}))}},{key:"startRTMPOrRecording",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.localPeer){t.next=2;break}throw Qe.GenericErrors.NotConnected(Fe.VALIDATION,"No local peer present, cannot start streaming or recording");case 2:return t.next=4,null==(n=this.transport)?void 0:n.startRTMPOrRecording(e);case 4:case"end":return t.stop()}},t,this)}))}},{key:"stopRTMPAndRecording",value:function(){return ne(this,null,w().mark(function e(){var t;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.localPeer){e.next=2;break}throw Qe.GenericErrors.NotConnected(Fe.VALIDATION,"No local peer present, cannot stop streaming or recording");case 2:return e.next=4,null==(t=this.transport)?void 0:t.stopRTMPOrRecording();case 4:case"end":return e.stop()}},e,this)}))}},{key:"startHLSStreaming",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.localPeer){t.next=2;break}throw Qe.GenericErrors.NotConnected(Fe.VALIDATION,"No local peer present, cannot start HLS streaming");case 2:return t.next=4,null==(n=this.transport)?void 0:n.startHLSStreaming(e);case 4:case"end":return t.stop()}},t,this)}))}},{key:"stopHLSStreaming",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.localPeer){t.next=2;break}throw Qe.GenericErrors.NotConnected(Fe.VALIDATION,"No local peer present, cannot stop HLS streaming");case 2:return t.next=4,null==(n=this.transport)?void 0:n.stopHLSStreaming(e);case 4:case"end":return t.stop()}},t,this)}))}},{key:"sendHLSTimedMetadata",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.validateJoined("sendHLSTimedMetadata"),t.next=3,null==(n=this.transport)?void 0:n.sendHLSTimedMetadata(e);case 3:case"end":return t.stop()}},t,this)}))}},{key:"changeName",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.validateJoined("changeName"),t.next=3,null==(n=this.transport)?void 0:n.changeName(e);case 3:this.notificationManager.updateLocalPeer({name:e});case 4:case"end":return t.stop()}},t,this)}))}},{key:"changeMetadata",value:function(e){return ne(this,null,w().mark(function t(){var n;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.validateJoined("changeMetadata"),t.next=3,null==(n=this.transport)?void 0:n.changeMetadata(e);case 3:this.notificationManager.updateLocalPeer({metadata:e});case 4:case"end":return t.stop()}},t,this)}))}},{key:"setSessionMetadata",value:function(e){return ne(this,null,w().mark(function t(){return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.transport.setSessionMetadata({key:"default",data:e});case 2:case"end":return t.stop()}},t,this)}))}},{key:"getSessionMetadata",value:function(){return ne(this,null,w().mark(function e(){return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.transport.getSessionMetadata("default");case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}},e,this)}))}},{key:"getRoles",value:function(){return Object.values(this.store.getKnownRoles())}},{key:"changeTrackState",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e.type!==st.VIDEO||"regular"===e.source){n.next=3;break}return me.w(this.TAG,"Muting non-regular video tracks is currently not supported"),n.abrupt("return");case 3:if(e.enabled!==t){n.next=6;break}return me.w(this.TAG,"Aborting change track state, track already has enabled - ".concat(t),e),n.abrupt("return");case 6:if(this.store.getTrackById(e.trackId)){n.next=8;break}throw Qe.GenericErrors.ValidationFailed("No track found for change track state",e);case 8:if(i=this.store.getPeerByTrackId(e.trackId)){n.next=11;break}throw Qe.GenericErrors.ValidationFailed("No peer found for change track state",e);case 11:return n.next=13,null==(r=this.transport)?void 0:r.changeTrackState({requested_for:i.peerId,track_id:e.trackId,stream_id:e.stream.id,mute:!t});case 13:case"end":return n.stop()}},n,this)}))}},{key:"changeMultiTrackState",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i,a,s;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("boolean"==typeof e.enabled){t.next=2;break}throw Qe.GenericErrors.ValidationFailed("Pass a boolean for enabled");case 2:return r=e.enabled,i=e.roles,a=e.type,s=e.source,t.next=5,null==(n=this.transport)?void 0:n.changeMultiTrackState({value:!r,type:a,source:s,roles:null==i?void 0:i.map(function(e){return null==e?void 0:e.name})});case 5:case"end":return t.stop()}},t,this)}))}},{key:"setFrameworkInfo",value:function(e){this.frameworkInfo=e}},{key:"attachVideo",value:function(e,t){return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(null==(r=this.store.getConfig())?void 0:r.autoManageVideo)){n.next=5;break}e.attach(t),n.next=7;break;case 5:return n.next=7,e.addSink(t);case 7:case"end":return n.stop()}},n,this)}))}},{key:"detachVideo",value:function(e,t){return ne(this,null,w().mark(function n(){var r;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(null==(r=this.store.getConfig())?void 0:r.autoManageVideo)){n.next=5;break}e.detach(t),n.next=7;break;case 5:return n.next=7,e.removeSink(t);case 7:case"end":return n.stop()}},n,this)}))}},{key:"publish",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a,s,o=this;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(![this.store.getPublishParams(),!this.sdkState.published,!se].every(function(e){return!!e})){n.next=4;break}return s=t&&t!==(null==(i=null==(r=this.localPeer)?void 0:r.role)?void 0:i.name)?function(){var e;return null==(e=o.roleChangeManager)?void 0:e.diffRolesAndPublishTracks({oldRole:o.store.getPolicyForRole(t),newRole:o.localPeer.role})}:function(){return o.getAndPublishTracks(e)},n.next=4,null==(a=null==s?void 0:s())?void 0:a.catch(function(e){var t;me.e(o.TAG,"Error in publish",e),null==(t=o.listener)||t.onError(e)});case 4:case"end":return n.stop()}},n,this)}))}},{key:"getAndPublishTracks",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.localTrackManager.getTracksToPublish(e);case 2:return i=t.sent,t.next=5,this.setAndPublishTracks(i);case 5:null==(r=null==(n=this.localPeer)?void 0:n.audioTrack)||r.initAudioLevelMonitor(),this.sdkState.published=!0;case 7:case"end":return t.stop()}},t,this)}))}},{key:"setAndPublishTracks",value:function(e){return ne(this,null,w().mark(function t(){var n,r,i,a;return w().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=B(e),t.prev=1,r.s();case 3:if((i=r.n()).done){t.next=11;break}return a=i.value,t.next=7,this.transport.publish([a]);case 7:this.setLocalPeerTrack(a),null==(n=this.listener)||n.onTrackUpdate(qe.TRACK_ADDED,a,this.localPeer);case 9:t.next=3;break;case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(1),r.e(t.t0);case 16:return t.prev=16,r.f(),t.finish(16);case 19:return t.next=21,this.initDeviceManagers();case 21:case"end":return t.stop()}},t,this,[[1,13,16,19]])}))}},{key:"setLocalPeerTrack",value:function(e){var t;switch(e.peerId=null==(t=this.localPeer)?void 0:t.peerId,e.type){case st.AUDIO:this.localPeer.audioTrack=e;break;case st.VIDEO:this.localPeer.videoTrack=e}}},{key:"initDeviceManagers",value:function(){return ne(this,null,w().mark(function e(){var t,n,r,i,a;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.sdkState.deviceManagersInitialised,e.t0){e.next=12;break}return this.sdkState.deviceManagersInitialised=!0,e.next=5,this.deviceManager.init();case 5:return e.next=7,this.deviceManager.updateOutputDevice(null==(n=null==(t=this.store.getConfig())?void 0:t.settings)?void 0:n.audioOutputDeviceId);case 7:if(e.t1=e.sent,e.t1){e.next=11;break}return e.next=11,this.deviceManager.updateOutputDevice(null==(i=null==(r=bt.getSelection())?void 0:r.audioOutput)?void 0:i.deviceId);case 11:this.audioSinkManager.init(null==(a=this.store.getConfig())?void 0:a.audioSinkElementId);case 12:case"end":return e.stop()}},e,this)}))}},{key:"cleanDeviceManagers",value:function(){this.eventBus.deviceChange.unsubscribe(this.handleDeviceChange),this.eventBus.audioPluginFailed.unsubscribe(this.handleAudioPluginError),this.eventBus.autoplayError.unsubscribe(this.handleAutoplayError),this.deviceManager.cleanUp(),this.audioSinkManager.cleanUp()}},{key:"initPreviewTrackAudioLevelMonitor",value:function(){var e,t=this,n=null==(e=this.localPeer)?void 0:e.audioTrack;null==n||n.initAudioLevelMonitor(),this.eventBus.trackAudioLevelUpdate.subscribe(function(e){var r,i=e&&e.track.trackId===(null==n?void 0:n.trackId)?[{audioLevel:e.audioLevel,peer:t.localPeer,track:n}]:[];t.store.updateSpeakers(i),null==(r=t.audioListener)||r.onAudioLevelUpdate(i)}),this.eventBus.localAudioSilence.subscribe(this.sendAudioPresenceFailed)}},{key:"notifyJoin",value:function(){var e,t=this,n=this.store.getLocalPeer(),r=this.store.getRoom();if(r)return r.joinedAt=new Date,n&&(n.joinedAt=r.joinedAt),(null==n?void 0:n.role)?(this.analyticsTimer.end(Le.JOIN),void(null==(e=this.listener)||e.onJoin(r))):new Promise(function(e,n){t.eventBus.policyChange.subscribeOnce(function(){var n;t.analyticsTimer.end(Le.JOIN),null==(n=t.listener)||n.onJoin(r),e()}),t.eventBus.leave.subscribeOnce(function(e){n(e)})});me.w(this.TAG,"notify join - room not present")}},{key:"setUpPreview",value:function(e,t){this.listener=t,this.sdkState.isPreviewCalled=!0,this.sdkState.isPreviewInProgress=!0;var n=ni(e.authToken),r=n.roomId,i=n.userId,a=n.role;this.commonSetup(e,r,t),this.store.setConfig(e),this.store.createAndSetUserAgent(this.frameworkInfo),this.createAndAddLocalPeerToStore(e,a,i,e.asRole),me.d(this.TAG,"SDK Store",this.store)}},{key:"setPlaylistSettings",value:function(e){return ne(this,arguments,function(e){var t=e.track,n=e.hmsTrack,r=e.source;return w().mark(function e(){var i,a,s,o;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("videoplaylist"!==r){e.next=7;break}return i={},"audio"===t.kind?i.maxBitrate=64:(i.maxBitrate=1e3,a=t.getSettings(),s=a.width,o=a.height,i.width=s,i.height=o),e.next=5,n.setSettings(i);case 5:e.next=11;break;case 7:if(e.t0="audioplaylist"===r,!e.t0){e.next=11;break}return e.next=11,n.setSettings({maxBitrate:64});case 11:case"end":return e.stop()}},e)})()})}},{key:"createAndAddLocalPeerToStore",value:function(e,t,n,r){var i=this.store.getPolicyForRole(t),a=r?this.store.getPolicyForRole(r):void 0,s=new Se({name:e.userName||"",customerUserId:n,metadata:e.metaData||"",role:i,asRole:a||i});this.store.addPeer(s)}},{key:"commonSetup",value:function(e,t,n){this.stringifyMetadata(e),e.initEndpoint||(e.initEndpoint="https://prod-init.100ms.live"),this.errorListener=n,this.deviceChangeListener=n,this.initStoreAndManagers(),this.store.setErrorListener(this.errorListener),this.store.getRoom()||this.store.setRoom(new ye(t,this.store))}},{key:"removeDevicesFromConfig",value:function(e){this.store.getConfig()&&e.settings&&(delete e.settings.audioOutputDeviceId,delete e.settings.videoDeviceId,delete e.settings.audioInputDeviceId)}},{key:"getScreenshareTracks",value:function(e,t){return ne(this,null,w().mark(function n(){var r,i,a,s,o,c,u=this;return w().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.localTrackManager.getLocalScreen(t);case 2:if(r=n.sent,i=v(r,2),a=i[0],s=i[1],o=function(){u.stopEndedScreenshare(e)},c=[],!(null==t?void 0:t.audioOnly)){n.next=14;break}if(a.nativeTrack.stop(),s){n.next=11;break}throw Qe.TracksErrors.NothingToReturn(Fe.TRACK,"Select share audio when sharing screen","No audio found");case 11:c.push(s),s.nativeTrack.onended=o,n.next=15;break;case 14:c.push(a),a.nativeTrack.onended=o,s&&c.push(s);case 15:return n.abrupt("return",c);case 16:case"end":return n.stop()}},n,this)}))}},{key:"stopPlaylist",value:function(e){"audioplaylist"===e.source?this.playlistManager.stop(it.audio):"videoplaylist"===e.source&&this.playlistManager.stop(it.video)}}]),e}();function ai(){return ne(this,null,w().mark(function e(){var t,n;return w().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(new ut).build(),n=(new ot).build(),e.prev=1,e.next=4,It(n);case 4:e.sent.stop(),e.next=14;break;case 7:if(e.prev=7,e.t0=e.catch(1),!si(e.t0)){e.next=14;break}return e.next=12,Rt({audio:!1,video:!0});case 12:throw e.sent.getTracks().forEach(function(e){return e.stop()}),e.t0;case 14:return e.next=16,Ct(t);case 16:return e.sent.stop(),e.abrupt("return",!1);case 18:case"end":return e.stop()}},e,null,[[1,7]])}))}function si(e){return e instanceof Me&&e.action===Fe.TRACK}exports.HMSSdk=ii,me.i("adapter","".concat(i.default.browserDetails.browser," v").concat(i.default.browserDetails.version));
},{"webrtc-adapter":"WzOL","ua-parser-js":"Godu","uuid":"UeUD","eventemitter2":"x3aR","sdp-transform":"CfIM","process":"g5IB"}],"K9HF":[function(require,module,exports) {
"use strict";function e(e,r){return e===r}function r(e,r,t){if(null===r||null===t||r.length!==t.length)return!1;for(var n=r.length,o=0;o<n;o++)if(!e(r[o],t[o]))return!1;return!0}function t(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,o=null,u=null;return function(){return r(n,o,arguments)||(u=t.apply(null,arguments)),o=arguments,u}}function n(e){var r=Array.isArray(e[0])?e[0]:e;if(!r.every(function(e){return"function"==typeof e})){var t=r.map(function(e){return typeof e}).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+t+"]")}return r}function o(e){for(var r=arguments.length,t=Array(r>1?r-1:0),o=1;o<r;o++)t[o-1]=arguments[o];return function(){for(var r=arguments.length,o=Array(r),u=0;u<r;u++)o[u]=arguments[u];var c=0,l=o.pop(),a=n(o),i=e.apply(void 0,[function(){return c++,l.apply(null,arguments)}].concat(t)),f=e(function(){for(var e=[],r=a.length,t=0;t<r;t++)e.push(a[t].apply(null,arguments));return i.apply(null,e)});return f.resultFunc=l,f.dependencies=a,f.recomputations=function(){return c},f.resetRecomputations=function(){return c=0},f}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createSelector=void 0,exports.createSelectorCreator=o,exports.createStructuredSelector=c,exports.defaultMemoize=t;var u=o(t);function c(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;if("object"!=typeof e)throw new Error("createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof e);var t=Object.keys(e);return r(t.map(function(r){return e[r]}),function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];return r.reduce(function(e,r,n){return e[t[n]]=r,e},{})})}exports.createSelector=u;
},{}],"j5Na":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BeamControllerStore=void 0,Object.defineProperty(exports,"DeviceType",{enumerable:!0,get:function(){return i.DeviceType}}),Object.defineProperty(exports,"HMSAudioPluginType",{enumerable:!0,get:function(){return i.HMSAudioPluginType}}),Object.defineProperty(exports,"HMSLogLevel",{enumerable:!0,get:function(){return i.HMSLogLevel}}),exports.HMSRoomState=exports.HMSReactiveStore=exports.HMSPlaylistType=exports.HMSNotificationTypes=exports.HMSNotificationSeverity=exports.HMSMessageType=void 0,Object.defineProperty(exports,"HMSSimulcastLayer",{enumerable:!0,get:function(){return i.HMSSimulcastLayer}}),exports.HMSStats=void 0,Object.defineProperty(exports,"HMSVideoPluginCanvasContextType",{enumerable:!0,get:function(){return i.HMSVideoPluginCanvasContextType}}),Object.defineProperty(exports,"HMSVideoPluginType",{enumerable:!0,get:function(){return i.HMSVideoPluginType}}),exports.createDefaultStoreState=exports.createDefaultStatsStore=void 0,Object.defineProperty(exports,"parsedUserAgent",{enumerable:!0,get:function(){return i.parsedUserAgent}}),exports.selectRecordingState=exports.selectRecentError=exports.selectRTMPState=exports.selectPreviewRoleName=exports.selectPreviewRole=exports.selectPermissions=exports.selectPeersWithAudioStatus=exports.selectPeersScreenSharing=exports.selectPeersMap=exports.selectPeersByRoles=exports.selectPeersByRole=exports.selectPeersByCondition=exports.selectPeers=exports.selectPeerSharingVideoPlaylist=exports.selectPeerSharingAudioPlaylist=exports.selectPeerSharingAudio=exports.selectPeerScreenSharing=exports.selectPeerNameByID=exports.selectPeerName=exports.selectPeerMetadata=exports.selectPeerCount=exports.selectPeerByID=exports.selectPeerByCondition=exports.selectPeerAudioByID=exports.selectMessagesUnreadCountByRole=exports.selectMessagesUnreadCountByPeerID=exports.selectMessagesMap=exports.selectMessagesByRole=exports.selectMessagesByPeerID=exports.selectMessageIDsInOrder=exports.selectLocalVideoTrackID=exports.selectLocalTrackIDs=exports.selectLocalPeerRoleName=exports.selectLocalPeerRole=exports.selectLocalPeerName=exports.selectLocalPeerID=exports.selectLocalPeer=exports.selectLocalMediaSettings=exports.selectLocalAudioTrackID=exports.selectIsSomeoneScreenSharing=exports.selectIsScreenShareLocallyMutedByPeerID=exports.selectIsRoleAllowedToPublish=exports.selectIsPeerVideoEnabled=exports.selectIsPeerAudioEnabled=exports.selectIsLocallyMutedByPeerID=exports.selectIsLocalVideoPluginPresent=exports.selectIsLocalVideoEnabled=exports.selectIsLocalVideoDisplayEnabled=exports.selectIsLocalScreenShared=exports.selectIsLocalAudioPluginPresent=exports.selectIsLocalAudioEnabled=exports.selectIsInPreview=exports.selectIsConnectedToRoom=exports.selectIsAudioLocallyMuted=exports.selectIsAllowedToSubscribe=exports.selectIsAllowedToPublish=exports.selectIsAllowedToPreviewMedia=exports.selectHMSStats=exports.selectHMSMessagesCount=exports.selectHMSMessages=exports.selectHLSState=exports.selectFullAppData=exports.selectErrors=exports.selectDominantSpeaker=exports.selectDidIJoinWithin=exports.selectDevices=exports.selectDegradedTracks=exports.selectConnectionQualityByPeerID=exports.selectConnectionQualities=exports.selectCameraStreamByPeerID=exports.selectBroadcastMessagesUnreadCount=exports.selectBroadcastMessages=exports.selectAvailableRoleNames=exports.selectAuxiliaryTracksByPeerID=exports.selectAuxiliaryAudioByPeerID=exports.selectAudioVolumeByPeerID=exports.selectAudioTrackVolume=exports.selectAudioTrackByPeerID=exports.selectAudioTrackByID=exports.selectAudioPlaylistTrackByPeerID=exports.selectAudioPlaylist=exports.selectAppDataByPath=exports.selectAppData=void 0,exports.selectSessionMetadata=exports.selectSessionId=exports.selectScreenshareAudioVolumeByPeerID=exports.selectScreenVideoTrackByID=exports.selectScreenSharesByPeerId=exports.selectScreenShareByPeerID=exports.selectScreenShareAudioByPeerID=exports.selectScreenAudioTrackByID=exports.selectRoomState=exports.selectRoomStarted=exports.selectRoomStartTime=exports.selectRoomID=exports.selectRoom=exports.selectRolesMap=exports.selectRoleChangeRequest=exports.selectRoleByRoleName=exports.selectRemotePeers=void 0,exports.selectSessionStore=Ot,exports.selectVideoTrackByPeerID=exports.selectVideoTrackByID=exports.selectVideoPlaylistVideoTrackByPeerID=exports.selectVideoPlaylistAudioTrackByPeerID=exports.selectVideoPlaylist=exports.selectUnreadHMSMessagesCount=exports.selectTracksMap=exports.selectTrackByID=exports.selectTrackAudioByID=exports.selectTemplateAppData=exports.selectSpeakers=exports.selectSimulcastLayerByTrack=void 0,Object.defineProperty(exports,"simulcastMapping",{enumerable:!0,get:function(){return i.simulcastMapping}});var e,t,r=c(require("immer")),n=c(require("zustand/shallow")),o=c(require("zustand/vanilla")),i=require("@100mslive/hms-video"),s=require("eventemitter2"),a=require("reselect");function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){return p(e)||f(e,t)||w(e,t)||d()}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,s,a=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(l){u=!0,o=l}finally{try{if(!c&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}}function p(e){if(Array.isArray(e))return e}function h(){h=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(M){c=function(e,t,r){return e[t]=r}}function l(e,t,r,o){var i=t&&t.prototype instanceof p?t:p,s=Object.create(i.prototype),a=new D(o||[]);return n(s,"_invoke",{value:T(e,r,a)}),s}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(M){return{type:"throw",arg:M}}}e.wrap=l;var f={};function p(){}function v(){}function y(){}var S={};c(S,i,function(){return this});var k=Object.getPrototypeOf,g=k&&k(k(E([])));g&&g!==t&&r.call(g,i)&&(S=g);var m=y.prototype=p.prototype=Object.create(S);function x(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function b(e,t){var o;n(this,"_invoke",{value:function(n,i){function s(){return new t(function(o,s){!function n(o,i,s,a){var c=d(e[o],e,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==u(f)&&r.call(f,"__await")?t.resolve(f.__await).then(function(e){n("next",e,s,a)},function(e){n("throw",e,s,a)}):t.resolve(f).then(function(e){l.value=e,s(l)},function(e){return n("throw",e,s,a)})}a(c.arg)}(n,i,o,s)})}return o=o?o.then(s,s):s()}})}function T(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return I()}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var a=P(s,r);if(a){if(a===f)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=d(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function P(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,P(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=d(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,f;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function D(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function E(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=y,n(m,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:v,configurable:!0}),v.displayName=c(y,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},x(b.prototype),c(b.prototype,s,function(){return this}),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var s=new b(l(t,r,n,o),i);return e.isGeneratorFunction(r)?s:s.next().then(function(e){return e.done?e.value:s.next()})},x(m),c(m,a,"Generator"),c(m,i,function(){return this}),c(m,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=E,D.prototype={constructor:D,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var a=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),w(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;w(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,T(n.key),n)}}function S(e,t,r){return t&&y(e.prototype,t),r&&y(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function k(e){return x(e)||m(e)||w(e)||g()}function g(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function x(e){if(Array.isArray(e))return D(e)}function b(e,t,r){return(t=T(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e){var t=P(e,"string");return"symbol"===u(t)?t:String(t)}function P(e,t){if("object"!==u(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function R(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=w(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(a)throw i}}}}function w(e,t){if(e){if("string"==typeof e)return D(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?D(e,t):void 0}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var E,I=Object.defineProperty,M=Object.defineProperties,A=Object.getOwnPropertyDescriptors,L=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,N=function(e,t,r){return t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r},_=function(e,t){for(var r in t||(t={}))C.call(t,r)&&N(e,r,t[r]);if(L){var n,o=R(L(t));try{for(o.s();!(n=o.n()).done;){r=n.value;O.call(t,r)&&N(e,r,t[r])}}catch(i){o.e(i)}finally{o.f()}}return e},U=function(e,t){return M(e,A(t))},H=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},B=function(e,t,r){return new Promise(function(n,o){var i=function(e){try{a(r.next(e))}catch(t){o(t)}},s=function(e){try{a(r.throw(e))}catch(t){o(t)}},a=function(e){return e.done?n(e.value):Promise.resolve(e.value).then(i,s)};a((r=r.apply(e,t)).next())})},j=H(function(e,t){t.exports={version:"0.10.2",license:"MIT",main:"dist/index.cjs.js",module:"dist/index.js",typings:"dist/index.d.ts",files:["dist","src"],engines:{node:">=12"},exports:{".":{require:"./dist/index.cjs.js",import:"./dist/index.js",default:"./dist/index.js"}},scripts:{prestart:"rm -rf dist && yarn types:build",start:'concurrently "yarn dev" "yarn types"',dev:"node ../../scripts/dev","build:only":"node ../../scripts/build",build:"yarn build:only && yarn types:build",types:"tsc -w","types:build":"tsc -p tsconfig.json",format:"prettier --write src/**/*.ts",test:"jest --maxWorkers=1","test:watch":"jest --watch","test:coverage":"jest --coverage",lint:"eslint -c ../../.eslintrc .","lint:fix":"yarn lint --fix",prepare:"yarn build",size:"size-limit",analyze:"size-limit --why",docs:"rm -rf ./docs && typedoc && rm -f ./docs/README.md && mkdir ./docs/home &&mv ./docs/modules.md ./docs/home/content.md && node ../../scripts/docs-store && npx prettier --write './docs/**/*'"},name:"@100mslive/hms-video-store",author:"100ms",sideEffects:!1,dependencies:{"@100mslive/hms-video":"0.9.2",eventemitter2:"^6.4.7",immer:"^9.0.6",reselect:"4.0.0",zustand:"3.5.7"},devDependencies:{"ts-node":"^10.4.0",tslib:"^2.2.0"},description:"This is an addon to the core sdk provided by 100ms. It abstracts away the intricacies of data management and provides a flux based reactive data store where data flows in only one direction.",repository:{type:"git",url:"git+https://github.com/100mslive/hms-video-store.git"},keywords:["video","webrtc","conferencing","100ms"],bugs:{url:"https://github.com/100mslive/hms-video-store/issues"},homepage:"https://github.com/100mslive/hms-video-store#readme",gitHead:"4e000fbf8980a6815e2b0c50e0b287472ee22fd5"}});exports.HMSRoomState=E,function(e){e.Disconnected="Disconnected",e.Preview="Preview",e.Connecting="Connecting",e.Connected="Connected",e.Reconnecting="Reconnecting",e.Disconnecting="Disconnecting",e.Failed="Failed"}(E||(exports.HMSRoomState=E={}));var V,K,q,F,G=function(){return{room:{id:"",isConnected:!1,name:"",peers:[],localPeer:"",roomState:E.Disconnected,recording:{browser:{running:!1},server:{running:!1},hls:{running:!1}},rtmp:{running:!1},hls:{running:!1,variants:[]},sessionId:""},peers:{},tracks:{},playlist:{audio:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1},video:{list:{},selection:{id:"",hasPrevious:!1,hasNext:!1},progress:0,volume:0,currentTime:0,playbackRate:1}},messages:{byID:{},allIDs:[]},speakers:{},connectionQualities:{},settings:{audioInputDeviceId:"",audioOutputDeviceId:"",videoInputDeviceId:""},devices:{audioInput:[],audioOutput:[],videoInput:[]},roles:{},roleChangeRequests:[],errors:[],sessionStore:{},templateAppData:{}}},Q=function(){return{peerStats:{},remoteTrackStats:{},localTrackStats:{},localPeer:{id:""}}};exports.createDefaultStatsStore=Q,exports.createDefaultStoreState=G,exports.HMSMessageType=V,(V||(exports.HMSMessageType=V={})).CHAT="chat",exports.HMSNotificationSeverity=K,function(e){e.INFO="info",e.ERROR="error"}(K||(exports.HMSNotificationSeverity=K={})),exports.HMSNotificationTypes=q,function(e){e.PEER_JOINED="PEER_JOINED",e.PEER_LEFT="PEER_LEFT",e.PEER_LIST="PEER_LIST",e.NEW_MESSAGE="NEW_MESSAGE",e.ERROR="ERROR",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED",e.TRACK_ADDED="TRACK_ADDED",e.TRACK_REMOVED="TRACK_REMOVED",e.TRACK_MUTED="TRACK_MUTED",e.TRACK_UNMUTED="TRACK_UNMUTED",e.TRACK_DEGRADED="TRACK_DEGRADED",e.TRACK_RESTORED="TRACK_RESTORED",e.TRACK_DESCRIPTION_CHANGED="TRACK_DESCRIPTION_CHANGED",e.ROLE_UPDATED="ROLE_UPDATED",e.CHANGE_TRACK_STATE_REQUEST="CHANGE_TRACK_STATE_REQUEST",e.CHANGE_MULTI_TRACK_STATE_REQUEST="CHANGE_MULTI_TRACK_STATE_REQUEST",e.ROOM_ENDED="ROOM_ENDED",e.REMOVED_FROM_ROOM="REMOVED_FROM_ROOM",e.DEVICE_CHANGE_UPDATE="DEVICE_CHANGE_UPDATE",e.PLAYLIST_TRACK_ENDED="PLAYLIST_TRACK_ENDED",e.NAME_UPDATED="NAME_UPDATED",e.METADATA_UPDATED="METADATA_UPDATED"}(q||(exports.HMSNotificationTypes=q={})),exports.HMSPlaylistType=F,function(e){e.audio="audio",e.video="video"}(F||(exports.HMSPlaylistType=F={}));var J=(b(e={},i.HMSPeerUpdate.PEER_JOINED,q.PEER_JOINED),b(e,i.HMSPeerUpdate.PEER_LEFT,q.PEER_LEFT),b(e,i.HMSPeerUpdate.ROLE_UPDATED,q.ROLE_UPDATED),b(e,i.HMSPeerUpdate.NAME_UPDATED,q.NAME_UPDATED),b(e,i.HMSPeerUpdate.METADATA_UPDATED,q.METADATA_UPDATED),e),W=(b(t={},i.HMSTrackUpdate.TRACK_ADDED,q.TRACK_ADDED),b(t,i.HMSTrackUpdate.TRACK_REMOVED,q.TRACK_REMOVED),b(t,i.HMSTrackUpdate.TRACK_MUTED,q.TRACK_MUTED),b(t,i.HMSTrackUpdate.TRACK_UNMUTED,q.TRACK_UNMUTED),b(t,i.HMSTrackUpdate.TRACK_DEGRADED,q.TRACK_DEGRADED),b(t,i.HMSTrackUpdate.TRACK_RESTORED,q.TRACK_RESTORED),b(t,i.HMSTrackUpdate.TRACK_DESCRIPTION_CHANGED,q.TRACK_DESCRIPTION_CHANGED),t);function z(e,t){var r,n;if(t){var o,i=R(t.auxiliaryTracks);try{for(i.s();!(o=i.n()).done;){var s=e[o.value];$(s)&&(n=Y(s)?s:n,r=X(s)?s:r)}}catch(a){i.e(a)}finally{i.f()}}return{video:r,audio:n}}function Y(e){return e&&"audio"===e.type}function X(e){return e&&"video"===e.type}function $(e){return e&&"screen"===e.source}function Z(e){return e&&"audioplaylist"===e.source}function ee(e){return e&&"videoplaylist"===e.source}function te(e){return!!e&&Boolean(null==e?void 0:e.degraded)}function re(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].enabled}function ne(e,t){return!(!t||!e.tracks[t])&&e.tracks[t].displayEnabled}function oe(e){var t,r=!1,n=!1,o=!1;return(null==(t=null==e?void 0:e.publishParams)?void 0:t.allowed)&&(r=e.publishParams.allowed.includes("video"),n=e.publishParams.allowed.includes("audio"),o=e.publishParams.allowed.includes("screen")),{video:r,audio:n,screen:o}}var ie=function(e){return e.room},se=function(e){return e.errors},ae=(0,a.createSelector)(se,function(e){return 0===e.length?null:e.at(-1)}),ce=(0,a.createSelector)(ie,function(e){return e.id}),ue=function(e){return e.peers},le=function(e){return e.messages.byID},de=function(e){return e.messages.allIDs},fe=function(e){return e.tracks},pe=function(e){return e.settings},he=function(e){return e.appData},ve=function(e){return e.devices},ye=function(e){return e.speakers},Se=function(e){return e.connectionQualities},ke=(0,a.createSelector)([ie],function(e){return e&&e.isConnected}),ge=(0,a.createSelector)([ke,ie],function(e,t){return e?void 0!==t.peerCount?t.peerCount||1:t.peers.length:Math.max(void 0!==t.peerCount?t.peerCount:t.peers.length-1,0)}),me=(0,a.createSelector)([ie,ue],function(e,t){return e.peers.map(function(e){return t[e]})}),xe=(0,a.createSelector)(fe,function(e){return Object.values(e)}),be=(0,a.createSelector)(ie,ue,function(e,t){return t[e.localPeer]}),Te=(0,a.createSelector)(ie,function(e){return e.localPeer}),Pe=(0,a.createSelector)(be,function(e){return null==e?void 0:e.name}),Re=(0,a.createSelector)(be,function(e){return null==e?void 0:e.roleName}),we=(0,a.createSelector)(be,function(e){return null==e?void 0:e.audioTrack}),De=(0,a.createSelector)(be,function(e){return null==e?void 0:e.videoTrack}),Ee=(0,a.createSelector)(be,function(e){return null==e?void 0:e.auxiliaryTracks}),Ie=(0,a.createSelector)([we,De,Ee],function(e,t,r){var n=r?k(r):[];return e&&n.unshift(e),t&&n.unshift(t),n}),Me=(0,a.createSelector)(me,function(e){return e.filter(function(e){return!e.isLocal})}),Ae=(0,a.createSelector)(ue,ye,function(e,t){var r=Object.entries(t).sort(function(e,t){var r,n,o=(null==(r=e[1])?void 0:r.audioLevel)||0;return((null==(n=t[1])?void 0:n.audioLevel)||0)>o?1:-1});if(r.length>0&&r[0][1].audioLevel&&r[0][1].audioLevel>0){var n=r[0][1].peerID;if(n in e)return e[n]}return null}),Le=function(e){var t=be(e);return re(e,null==t?void 0:t.audioTrack)},Ce=function(e){var t=be(e);return re(e,null==t?void 0:t.videoTrack)},Oe=function(e){var t=be(e);return ne(e,null==t?void 0:t.videoTrack)},Ne=(0,a.createSelector)(be,fe,function(e,t){var r=z(t,e),n=r.video,o=r.audio;return!(!n&&!o)}),_e=(0,a.createSelector)(ue,fe,function(e,t){var r;for(var n in e){var o=e[n],i=z(t,o),s=i.video,a=i.audio;if(s)return o;a&&!r&&(r=o)}return r}),Ue=(0,a.createSelector)(_e,function(e){return!!e}),He=(0,a.createSelector)(ue,fe,function(e,t){for(var r in e){var n=e[r],o=z(t,n),i=o.audio;if(!o.video&&i)return n}}),Be=(0,a.createSelector)(ue,fe,function(e,t){var r=[],n=[];for(var o in e){var i=e[o],s=z(t,i),a=s.video,c=s.audio;a?r.push(i):c&&n.push(i)}return r.concat(n)}),je=(0,a.createSelector)(ue,fe,function(e,t){for(var r in t){var n=t[r];if(ee(n)&&X(n)&&n.peerId)return e[n.peerId]}}),Ve=(0,a.createSelector)(ue,fe,function(e,t){for(var r in t){var n=t[r];if(Z(n)&&n.peerId)return e[n.peerId]}}),Ke=(0,a.createSelector)(xe,function(e){return e.filter(te)}),qe=(0,a.createSelector)(de,function(e){return e.length}),Fe=(0,a.createSelector)(le,function(e){return Object.values(e).filter(function(e){return!e.read}).length}),Ge=(0,a.createSelector)(de,le,function(e,t){var r=[];return e.forEach(function(e){r.push(t[e])}),r}),Qe=(0,a.createSelector)([ie],function(e){return e&&e.roomState}),Je=(0,a.createSelector)(Qe,function(e){return e===E.Preview}),We=(0,a.createSelector)(ie,function(e){return e.roomState!==E.Disconnected}),ze=function(e){return e.roles},Ye=(0,a.createSelector)([ze],function(e){return Object.keys(e)}),Xe=(0,a.createSelector)([be,ze],function(e,t){return(null==e?void 0:e.roleName)?t[e.roleName]:null}),$e=function(e){var t;return null==(t=e.preview)?void 0:t.asRole},Ze=(0,a.createSelector)([$e,ze],function(e,t){return e?t[e]:null}),et=(0,a.createSelector)([Xe],function(e){var t;return!(null==(t=null==e?void 0:e.subscribeParams)||!t.subscribeToRoles)&&e.subscribeParams.subscribeToRoles.length>0}),tt=(0,a.createSelector)(Xe,function(e){return null==e?void 0:e.permissions}),rt=(0,a.createSelector)(ie,function(e){return e.recording}),nt=(0,a.createSelector)(ie,function(e){return e.rtmp}),ot=(0,a.createSelector)(ie,function(e){return e.hls}),it=(0,a.createSelector)(ie,function(e){return e.sessionId}),st=(0,a.createSelector)(ie,function(e){return e.startedAt}),at=function(e){return e.templateAppData},ct=function(e){return e.sessionMetadata};exports.selectSessionMetadata=ct,exports.selectTemplateAppData=at,exports.selectRoomStartTime=st,exports.selectSessionId=it,exports.selectHLSState=ot,exports.selectRTMPState=nt,exports.selectRecordingState=rt,exports.selectPermissions=tt,exports.selectIsAllowedToSubscribe=et,exports.selectPreviewRole=Ze,exports.selectPreviewRoleName=$e,exports.selectLocalPeerRole=Xe,exports.selectAvailableRoleNames=Ye,exports.selectRolesMap=ze,exports.selectRoomStarted=We,exports.selectIsInPreview=Je,exports.selectRoomState=Qe,exports.selectHMSMessages=Ge,exports.selectUnreadHMSMessagesCount=Fe,exports.selectHMSMessagesCount=qe,exports.selectDegradedTracks=Ke,exports.selectPeerSharingAudioPlaylist=Ve,exports.selectPeerSharingVideoPlaylist=je,exports.selectPeersScreenSharing=Be,exports.selectPeerSharingAudio=He,exports.selectIsSomeoneScreenSharing=Ue,exports.selectPeerScreenSharing=_e,exports.selectIsLocalScreenShared=Ne,exports.selectIsLocalVideoDisplayEnabled=Oe,exports.selectIsLocalVideoEnabled=Ce,exports.selectIsLocalAudioEnabled=Le,exports.selectDominantSpeaker=Ae,exports.selectRemotePeers=Me,exports.selectLocalTrackIDs=Ie,exports.selectLocalVideoTrackID=De,exports.selectLocalAudioTrackID=we,exports.selectLocalPeerRoleName=Re,exports.selectLocalPeerName=Pe,exports.selectLocalPeerID=Te,exports.selectLocalPeer=be,exports.selectPeers=me,exports.selectPeerCount=ge,exports.selectIsConnectedToRoom=ke,exports.selectConnectionQualities=Se,exports.selectSpeakers=ye,exports.selectDevices=ve,exports.selectFullAppData=he,exports.selectLocalMediaSettings=pe,exports.selectTracksMap=fe,exports.selectMessageIDsInOrder=de,exports.selectMessagesMap=le,exports.selectPeersMap=ue,exports.selectRoomID=ce,exports.selectRecentError=ae,exports.selectErrors=se,exports.selectRoom=ie;var ut=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].list}},lt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].selection}},dt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].progress}},ft=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].currentTime}},pt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].playbackRate}},ht=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return function(t){return t.playlist[e].volume}},vt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return(0,a.createSelector)(ut(e),function(e){return Object.values(e)})},yt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F.audio;return(0,a.createSelector)(ut(e),lt(e),function(e,t){if(t.id)return e[t.id]})},St={selection:lt(F.audio),progress:dt(F.audio),currentTime:ft(F.audio),playbackRate:pt(F.audio),volume:ht(F.audio),list:vt(F.audio),selectedItem:yt(F.audio)},kt={selection:lt(F.video),progress:dt(F.video),currentTime:ft(F.video),playbackRate:pt(F.video),volume:ht(F.video),list:vt(F.video),selectedItem:yt(F.video)};function gt(e){return function(t){return function(r){return e(r,t)}}}exports.selectVideoPlaylist=kt,exports.selectAudioPlaylist=St;var mt="HMS-Store:",xt=function(){function e(){v(this,e)}return S(e,null,[{key:"v",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.log.apply(this,[i.HMSLogLevel.VERBOSE,e].concat(r))}},{key:"d",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[i.HMSLogLevel.DEBUG].concat(t))}},{key:"i",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[i.HMSLogLevel.INFO].concat(t))}},{key:"w",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[i.HMSLogLevel.WARN].concat(t))}},{key:"e",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.log.apply(this,[i.HMSLogLevel.ERROR].concat(t))}},{key:"time",value:function(e){this.log(i.HMSLogLevel.TIME,"[HMSPerformanceTiming]",e)}},{key:"timeEnd",value:function(e){this.log(i.HMSLogLevel.TIMEEND,"[HMSPerformanceTiming]",e,e)}},{key:"cleanUp",value:function(){performance.clearMarks(),performance.clearMeasures()}},{key:"log",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(!(this.level.valueOf()>e.valueOf()))switch(e){case i.HMSLogLevel.VERBOSE:var o;(o=console).log.apply(o,[mt].concat(r));break;case i.HMSLogLevel.DEBUG:var s;(s=console).debug.apply(s,[mt].concat(r));break;case i.HMSLogLevel.INFO:var a;(a=console).info.apply(a,[mt].concat(r));break;case i.HMSLogLevel.WARN:var c;(c=console).warn.apply(c,[mt].concat(r));break;case i.HMSLogLevel.ERROR:var u;(u=console).error.apply(u,[mt].concat(r));break;case i.HMSLogLevel.TIME:performance.mark(r[1]);break;case i.HMSLogLevel.TIMEEND:var l=r[0],d=r[1];try{var f=performance.measure(d,d);this.log(i.HMSLogLevel.DEBUG,l,d,null==f?void 0:f.duration),performance.clearMarks(d),performance.clearMeasures(d)}catch(f){this.log(i.HMSLogLevel.DEBUG,l,d,f)}}}}]),e}();xt.level=i.HMSLogLevel.VERBOSE;var bt=function(e,t){return t},Tt=function(e,t){return t},Pt=function(e,t){return t},Rt=function(e,t){return t},wt=(0,a.createSelector)([ue,bt],function(e,t){return t?e[t]:null}),Dt=(0,a.createSelector)([fe,Tt],function(e,t){return t?e[t]:null}),Et=(0,a.createSelector)([fe,Tt],function(e,t){if(!t)return null;var r=e[t];return"video"===(null==r?void 0:r.type)?r:null}),It=(0,a.createSelector)([fe,Tt],function(e,t){if(!t)return null;var r=e[t];return"audio"===(null==r?void 0:r.type)?r:null}),Mt=(0,a.createSelector)([fe,Tt],function(e,t){if(!t)return null;var r=e[t];return"audio"===(null==r?void 0:r.type)&&"screen"===(null==r?void 0:r.source)?r:null}),At=(0,a.createSelector)([fe,Tt],function(e,t){if(!t)return null;var r=e[t];return"video"===(null==r?void 0:r.type)&&"screen"===(null==r?void 0:r.source)?r:null}),Lt=gt(wt),Ct=gt((0,a.createSelector)([he,Rt],function(e,t){if(e)return t?e[t]:e}));function Ot(e){return function(t){if(t.sessionStore)return e?t.sessionStore[e]:t.sessionStore}}exports.selectAppData=Ct,exports.selectPeerByID=Lt;var Nt=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.createSelector)([he],function(e){if(e){if(t&&t.length>0){for(var r=e,n=0,o=t;n<o.length;n++){var i=o[n];if(!i)return r;r=null==r?void 0:r[i]}return r}return e}})},_t=gt((0,a.createSelector)(wt,function(e){return null==e?void 0:e.name})),Ut=gt(Dt),Ht=gt(Et),Bt=gt(It),jt=gt(Mt),Vt=gt(At),Kt=gt(function(e,t){var r=wt(e,t);if(r&&r.videoTrack&&""!==r.videoTrack)return e.tracks[r.videoTrack]}),qt=gt(function(e,t){var r=wt(e,t);if(r&&r.audioTrack&&""!==r.audioTrack)return e.tracks[r.audioTrack]}),Ft=Kt,Gt=gt(function(e,t){var r=wt(e,t);return(null==r?void 0:r.auxiliaryTracks.map(function(t){return e.tracks[t]}))||[]}),Qt=function(e,t){return t?e.speakers[t]:null},Jt=gt((0,a.createSelector)(Qt,function(e){return(null==e?void 0:e.audioLevel)||0})),Wt=function(e,t){var r=qt(t)(e);return Qt(e,null==r?void 0:r.id)},zt=gt((0,a.createSelector)(Wt,function(e){return(null==e?void 0:e.audioLevel)||0})),Yt=gt(function(e,t){if(t)return e.connectionQualities[t]}),Xt=gt(function(e,t){var r=wt(e,t);if(r){var n=null==r?void 0:r.auxiliaryTracks.find(function(t){return Y(e.tracks[t])});return n?e.tracks[n]:void 0}}),$t=gt((0,a.createSelector)(fe,wt,function(e,t){var r=null==t?void 0:t.auxiliaryTracks.find(function(t){var r=e[t];return ee(r)&&X(r)});return r?e[r]:void 0})),Zt=gt((0,a.createSelector)(fe,wt,function(e,t){var r=null==t?void 0:t.auxiliaryTracks.find(function(t){var r=e[t];return ee(r)&&Y(r)});return r?e[r]:void 0})),er=gt((0,a.createSelector)(fe,wt,function(e,t){var r=null==t?void 0:t.auxiliaryTracks.find(function(t){var r=e[t];return Z(r)&&Y(r)});return r?e[r]:void 0})),tr=gt((0,a.createSelector)(fe,wt,function(e,t){return z(e,t)})),rr=function(e){return(0,a.createSelector)(tr(e),function(e){return e.video})},nr=function(e){return(0,a.createSelector)(tr(e),function(e){return e.audio})},or=gt(function(e,t){var r=wt(e,t);return re(e,null==r?void 0:r.audioTrack)}),ir=gt(function(e,t){var r=wt(e,t);return re(e,null==r?void 0:r.videoTrack)}),sr=gt(function(e,t){if(t&&e.tracks[t])return 0===e.tracks[t].volume}),ar=gt(function(e,t){var r=wt(e,t);return sr(null==r?void 0:r.audioTrack)(e)}),cr=gt(function(e,t){var r=nr(t)(e);return sr(null==r?void 0:r.id)(e)}),ur=gt(function(e,t){var r=Dt(e,t);if(r)return"audio"!==r.type?void xt.w("Please pass audio track here"):r.volume}),lr=gt(function(e,t){var r=wt(e,t);return ur(null==r?void 0:r.audioTrack)(e)}),dr=gt(function(e,t){var r=nr(t)(e);return ur(null==r?void 0:r.id)(e)}),fr=gt(function(e,t){var r=Dt(e,t);if(r)return"video"!==r.type?void xt.w("Please pass video track here"):r.layer}),pr=(0,a.createSelector)([Ge,Te,bt],function(e,t,r){if(r)return e.filter(function(e){var n;return!(!(e.recipientPeer||(null==(n=e.recipientRoles)?void 0:n.length))||e.sender&&![t,r].includes(e.sender))&&[t,r].includes(e.recipientPeer)})}),hr=(0,a.createSelector)([Ge,Pt],function(e,t){if(t)return e.filter(function(e){var r,n;return!(null==(r=e.recipientRoles)||!r.length)&&(null==(n=e.recipientRoles)?void 0:n.includes(t))})}),vr=(0,a.createSelector)(Ge,function(e){return e.filter(function(e){var t;return!e.recipientPeer&&!(null==(t=e.recipientRoles)?void 0:t.length)})}),yr=(0,a.createSelector)([hr,Pt],function(e){return e?e.filter(function(e){return!e.read}).length:0}),Sr=(0,a.createSelector)([pr,bt],function(e){return e?e.filter(function(e){return!e.read}).length:0}),kr=(0,a.createSelector)(vr,function(e){return e.filter(function(e){return!e.read}).length}),gr=gt(pr),mr=gt(hr),xr=gt(yr),br=gt(Sr),Tr=function(e){return(0,a.createSelector)([me],function(t){return t.filter(function(t){return t.roleName===e})})},Pr=function(e){return(0,a.createSelector)([me],function(t){return t.filter(function(t){return!!t.roleName&&e.includes(t.roleName)})})},Rr=function(e){return(0,a.createSelector)(Lt(e),function(e){try{return(null==e?void 0:e.metadata)&&""!==e.metadata?JSON.parse(e.metadata):{}}catch(t){return console.error("cannot parse peer metadata",t),{}}})},wr=function(e){return(0,a.createSelector)(Lt(e),function(e){return null==e?void 0:e.name})};exports.selectPeerName=wr,exports.selectPeerMetadata=Rr,exports.selectPeersByRoles=Pr,exports.selectPeersByRole=Tr,exports.selectMessagesUnreadCountByPeerID=br,exports.selectMessagesUnreadCountByRole=xr,exports.selectMessagesByRole=mr,exports.selectMessagesByPeerID=gr,exports.selectBroadcastMessagesUnreadCount=kr,exports.selectBroadcastMessages=vr,exports.selectSimulcastLayerByTrack=fr,exports.selectScreenshareAudioVolumeByPeerID=dr,exports.selectAudioVolumeByPeerID=lr,exports.selectAudioTrackVolume=ur,exports.selectIsScreenShareLocallyMutedByPeerID=cr,exports.selectIsLocallyMutedByPeerID=ar,exports.selectIsAudioLocallyMuted=sr,exports.selectIsPeerVideoEnabled=ir,exports.selectIsPeerAudioEnabled=or,exports.selectScreenShareAudioByPeerID=nr,exports.selectScreenShareByPeerID=rr,exports.selectScreenSharesByPeerId=tr,exports.selectAudioPlaylistTrackByPeerID=er,exports.selectVideoPlaylistAudioTrackByPeerID=Zt,exports.selectVideoPlaylistVideoTrackByPeerID=$t,exports.selectAuxiliaryAudioByPeerID=Xt,exports.selectConnectionQualityByPeerID=Yt,exports.selectPeerAudioByID=zt,exports.selectTrackAudioByID=Jt,exports.selectAuxiliaryTracksByPeerID=Gt,exports.selectCameraStreamByPeerID=Ft,exports.selectAudioTrackByPeerID=qt,exports.selectVideoTrackByPeerID=Kt,exports.selectScreenVideoTrackByID=Vt,exports.selectScreenAudioTrackByID=jt,exports.selectAudioTrackByID=Bt,exports.selectVideoTrackByID=Ht,exports.selectTrackByID=Ut,exports.selectPeerNameByID=_t,exports.selectAppDataByPath=Nt;var Dr=(0,a.createSelector)([ue,fe],function(e,t){return Object.values(e).map(function(e){var r;return{peer:e,isAudioEnabled:!!e.audioTrack&&(null==(r=t[e.audioTrack])?void 0:r.enabled)}})}),Er=function(e){return e.roleChangeRequests[0]||null},Ir=(0,a.createSelector)([Er,ue,ze],function(e,t,r){return e?{requestedBy:e.requestedBy?t[e.requestedBy]:void 0,role:r[e.roleName],token:e.token}:null}),Mr=(0,a.createSelector)([Xe],function(e){return oe(e)}),Ar=(0,a.createSelector)([Ze],function(e){return oe(e)});exports.selectIsAllowedToPreviewMedia=Ar,exports.selectIsAllowedToPublish=Mr,exports.selectRoleChangeRequest=Ir,exports.selectPeersWithAudioStatus=Dr;var Lr=function(e){return(0,a.createSelector)([ze],function(t){return t[e]})},Cr=function(e){return(0,a.createSelector)(Lr(e),function(e){return oe(e)})},Or=(0,a.createSelector)([De,fe],function(e,t){var r=null;return e&&(r=t[e]),(null==r?void 0:r.plugins)||[]}),Nr=(0,a.createSelector)([we,fe],function(e,t){var r=null;return e&&(r=t[e]),(null==r?void 0:r.plugins)||[]}),_r=function(e){return(0,a.createSelector)([Or],function(t){return t.includes(e)})},Ur=function(e){return(0,a.createSelector)([Nr],function(t){return t.includes(e)})},Hr=function(e){return(0,a.createSelector)(me,function(t){return t.find(e)})},Br=function(e){return(0,a.createSelector)(me,function(t){return t.filter(e)})},jr=function(e){return(0,a.createSelector)(ie,function(t){return t.joinedAt&&Date.now()-t.joinedAt.getTime()<=e})};exports.selectDidIJoinWithin=jr,exports.selectPeersByCondition=Br,exports.selectPeerByCondition=Hr,exports.selectIsLocalAudioPluginPresent=Ur,exports.selectIsLocalVideoPluginPresent=_r,exports.selectIsRoleAllowedToPublish=Cr,exports.selectRoleByRoleName=Lr;var Vr="hmsNotification",Kr=function(){function e(t){var r=this;v(this,e),this.id=0,this.onNotification=function(e,t){var n=function(r){if(t&&!(Array.isArray(t)?t.includes(r.type):t===r.type))return;e(r)};return r.eventEmitter.addListener(Vr,n),function(){r.eventEmitter.removeListener(Vr,n)}},this.store=t,this.eventEmitter=new s.EventEmitter2({maxListeners:Object.keys(q).length})}return S(e,[{key:"sendPlaylistTrackEnded",value:function(e){var t=this.createNotification(q.PLAYLIST_TRACK_ENDED,e,K.INFO);this.emitEvent(t)}},{key:"sendDeviceChange",value:function(e){var t,r=this.createNotification(q.DEVICE_CHANGE_UPDATE,e,e.error?K.ERROR:K.INFO,"Selected ".concat(e.type," device - ").concat(null==(t=e.selection)?void 0:t.label));this.emitEvent(r)}},{key:"sendLeaveRoom",value:function(e){var t,r=null==(t=e.requestedBy)?void 0:t.name,n=this.createNotification(e.roomEnded||!r?q.ROOM_ENDED:q.REMOVED_FROM_ROOM,e,K.INFO,"".concat(e.roomEnded?"Room ended":"Removed from room"," ").concat(r?"by ".concat(r):""));this.emitEvent(n)}},{key:"sendPeerList",value:function(e){var t=this.createNotification(q.PEER_LIST,e,K.INFO);this.emitEvent(t)}},{key:"sendPeerUpdate",value:function(e,t){var r=this.store.getState(Lt(null==t?void 0:t.id))||t,n=J[e];if(n){var o=this.createNotification(n,r,K.INFO);this.emitEvent(o)}}},{key:"sendTrackUpdate",value:function(e,t){var r=this.store.getState(Ut(t)),n=W[e];if(n){var o=this.createNotification(n,r,K.INFO);this.emitEvent(o)}}},{key:"sendMessageReceived",value:function(e){var t=this.createNotification(q.NEW_MESSAGE,e,K.INFO);this.emitEvent(t)}},{key:"sendError",value:function(e){var t=this.createNotification(q.ERROR,e,K.ERROR);this.emitEvent(t)}},{key:"sendReconnecting",value:function(e){var t=this.createNotification(q.RECONNECTING,e,K.ERROR);this.emitEvent(t)}},{key:"sendReconnected",value:function(){var e=this.createNotification(q.RECONNECTED,null,K.INFO);this.emitEvent(e)}},{key:"sendChangeTrackStateRequest",value:function(e){var t=this.createNotification(q.CHANGE_TRACK_STATE_REQUEST,e,K.INFO);this.emitEvent(t)}},{key:"sendChangeMultiTrackStateRequest",value:function(e){var t=this.createNotification(q.CHANGE_MULTI_TRACK_STATE_REQUEST,e,K.INFO);this.emitEvent(t)}},{key:"emitEvent",value:function(e){this.eventEmitter.emit(Vr,e)}},{key:"createNotification",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return this.id++,{id:this.id,type:e,message:n,data:t,severity:r}}}]),e}();function qr(e){return e instanceof i.HMSRemoteAudioTrack||e instanceof i.HMSRemoteVideoTrack}var Fr=function(e,t){var r,n=R(Zr(Object.keys(e),Object.keys(t)));try{for(n.s();!(r=n.n()).done;){var o=r.value,i=e[o],s=t[o];zr(i,s)?($r(i.auxiliaryTracks,s.auxiliaryTracks)&&(s.auxiliaryTracks=i.auxiliaryTracks),Object.assign(i,s)):Yr(i,s)?delete e[o]:Xr(i,s)&&(e[o]=s)}}catch(a){n.e(a)}finally{n.f()}},Gr=function(e,t){var r,n=R(Zr(Object.keys(e),Object.keys(t)));try{for(n.s();!(r=n.n()).done;){var o=r.value,i=e[o],s=t[o];zr(i,s)?(Wr(i,s),Object.assign(i,s)):Yr(i,s)?delete e[o]:Xr(i,s)&&(e[o]=s)}}catch(a){n.e(a)}finally{n.f()}},Qr=function(e,t){var r,n=R(Zr(Object.keys(e),Object.keys(t)));try{for(n.s();!(r=n.n()).done;){var o=r.value,i=e[o],s=t[o];zr(i,s)?Object.assign(i,s):Yr(i,s)?delete e[o]:Xr(i,s)&&(e[o]=s)}}catch(a){n.e(a)}finally{n.f()}},Jr=function(e,t,r){var n,o=r.reduce(function(e,r){return e[r.firstTrackId]=Object.values(t[r.getTrackIDBeingSent()]||{}).sort(function(e,t){return e.rid&&t.rid?e.rid<t.rid?-1:1:0}),e},{}),i=R(Zr(Object.keys(e),Object.keys(o)));try{for(i.s();!(n=i.n()).done;){var s=n.value;o[s]?e[s]=o[s]:delete e[s]}}catch(a){i.e(a)}finally{i.f()}},Wr=function(e,t){e.plugins&&$r(e.plugins,t.plugins)&&(t.plugins=e.plugins),"video"===e.type&&e.layerDefinitions&&$r(e.layerDefinitions,t.layerDefinitions)&&(t.layerDefinitions=e.layerDefinitions)},zr=function(e,t){return e&&t},Yr=function(e,t){return e&&!t},Xr=function(e,t){return!e&&t},$r=function(e,t){if(e===t||0===e.length&&0===(null==t?void 0:t.length))return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},Zr=function(e,t){var r,n=new Set,o=R(e);try{for(o.s();!(r=o.n()).done;){var i=r.value;n.add(i)}}catch(u){o.e(u)}finally{o.f()}var s,a=R(t);try{for(a.s();!(s=a.n()).done;){var c=s.value;n.add(c)}}catch(u){a.e(u)}finally{a.f()}return Array.from(n)},en=function(){function e(){v(this,e)}return S(e,null,[{key:"convertPeer",value:function(e){var t,r,n;return{id:e.peerId,name:e.name,roleName:null==(t=e.role)?void 0:t.name,isLocal:e.isLocal,videoTrack:null==(r=e.videoTrack)?void 0:r.trackId,audioTrack:null==(n=e.audioTrack)?void 0:n.trackId,auxiliaryTracks:e.auxiliaryTracks.map(function(e){return e.trackId}),customerUserId:e.customerUserId,metadata:e.metadata,joinedAt:e.joinedAt}}},{key:"convertTrack",value:function(e,t){var r={id:e.trackId,source:e.source,type:e.type,enabled:e.enabled,displayEnabled:e.enabled,peerId:e.peerId||t};return this.enrichTrack(r,e),r}},{key:"enrichTrack",value:function(t,r){var n=r.getMediaTrackSettings();r instanceof i.HMSRemoteAudioTrack&&(t.volume=r.getVolume()||0),e.updateDeviceID(t,r),e.enrichLocalTrack(t,r),"video"===t.type&&("screen"===t.source?(t.displaySurface=n.displaySurface,e.enrichScreenTrack(t,r)):"regular"===t.source&&(t.facingMode=n.facingMode),t.height=n.height,t.width=n.width,e.enrichVideoTrack(t,r)),e.enrichPluginsDetails(t,r)}},{key:"enrichLocalTrack",value:function(e,t){(t instanceof i.HMSLocalVideoTrack||t instanceof i.HMSLocalAudioTrack)&&(e.isPublished=t.isPublished)}},{key:"updateDeviceID",value:function(e,t){var r;t instanceof i.HMSLocalVideoTrack||t instanceof i.HMSLocalAudioTrack?e.deviceID=t.settings.deviceId:e.deviceID=null==(r=t.getMediaTrackSettings())?void 0:r.deviceId}},{key:"enrichVideoTrack",value:function(e,t){t instanceof i.HMSRemoteVideoTrack&&(e.layer=t.getLayer(),e.preferredLayer=t.getPreferredLayer(),e.degraded=t.degraded),(t instanceof i.HMSRemoteVideoTrack||t instanceof i.HMSLocalVideoTrack)&&($r(t.getSimulcastDefinitions(),e.layerDefinitions)||(e.layerDefinitions=t.getSimulcastDefinitions()))}},{key:"enrichScreenTrack",value:function(e,t){var r,n;if(t instanceof i.HMSLocalVideoTrack){var o=null==(r=t.getCaptureHandle)?void 0:r.call(t);(null==o?void 0:o.handle)!==(null==(n=e.captureHandle)?void 0:n.handle)&&(e.captureHandle=o),t.isCurrentTab&&(e.displaySurface="selfBrowser")}}},{key:"enrichPluginsDetails",value:function(e,t){(t instanceof i.HMSLocalVideoTrack||t instanceof i.HMSLocalAudioTrack)&&($r(t.getPlugins(),e.plugins)||(e.plugins=t.getPlugins()))}},{key:"convertRoom",value:function(t){var r,n,o=e.convertRecordingStreamingState(null==t?void 0:t.recording,null==t?void 0:t.rtmp,null==t?void 0:t.hls),i=o.recording,s=o.rtmp,a=o.hls;return{id:t.id,name:t.name,localPeer:null!=(n=null==(r=t.localPeer)?void 0:r.peerId)?n:"",recording:i,rtmp:s,hls:a,sessionId:t.sessionId,startedAt:t.startedAt,joinedAt:t.joinedAt,peerCount:t.peerCount}}},{key:"convertMessage",value:function(e){var t,r,n,o,i,s,a;return{sender:null==(t=e.sender)?void 0:t.peerId,senderName:null==(r=e.sender)?void 0:r.name,senderRole:null==(o=null==(n=e.sender)?void 0:n.role)?void 0:o.name,senderUserId:null==(i=e.sender)?void 0:i.customerUserId,recipientPeer:null==(s=e.recipientPeer)?void 0:s.peerId,recipientRoles:null==(a=e.recipientRoles)?void 0:a.map(function(e){return e.name}),time:e.time,type:e.type,message:e.message}}},{key:"convertRoles",value:function(e){var t={};return e&&e.forEach(function(e){t[e.name]=e}),t}},{key:"convertRoleChangeRequest",value:function(e){var t;return{requestedBy:null==(t=e.requestedBy)?void 0:t.peerId,roleName:e.role.name,token:e.token}}},{key:"convertException",value:function(e){return{code:e.code,action:e.action,name:e.name,message:e.message,description:e.description,isTerminal:e.isTerminal,nativeError:e.nativeError,timestamp:new Date}}},{key:"convertDeviceChangeUpdate",value:function(e){var t={devices:e.devices,selection:e.selection,type:e.type};return e.error&&(t.error=this.convertException(e.error)),t}},{key:"convertPlaylist",value:function(e){return{audio:this.getConvertedPlaylistType(e,F.audio),video:this.getConvertedPlaylistType(e,F.video)}}},{key:"convertPlaylistItem",value:function(e,t){var r=t.type,n=e.getCurrentSelection(r),o=e.isPlaying(r),i=t.url===(null==n?void 0:n.url);return U(_({},t),{type:t.type,selected:i,playing:i&&o})}},{key:"getConvertedPlaylistType",value:function(t,r){var n={},o=t.getCurrentSelection(r),i=t.getCurrentProgress(r),s=t.getVolume(r),a=t.getList(r),c=t.getCurrentIndex(r);return t.getList(r).forEach(function(r){n[r.id]=e.convertPlaylistItem(t,r)}),{list:n,selection:{id:null==o?void 0:o.id,hasPrevious:c>0,hasNext:c<a.length-1},progress:i,volume:s,currentTime:t.getCurrentTime(r),playbackRate:t.getPlaybackRate(r)}}},{key:"convertRecordingStreamingState",value:function(e,t,r){var n;return{recording:{browser:_({running:!1},null==e?void 0:e.browser),server:_({running:!1},null==e?void 0:e.server),hls:_({running:!1},null==e?void 0:e.hls)},rtmp:_({running:!1},t),hls:{variants:(null==(n=null==r?void 0:r.variants)?void 0:n.map(function(e){return e}))||[],running:!!(null==r?void 0:r.running),error:null==r?void 0:r.error}}}}]),e}(),tn=function(){function e(t,r,n,o){v(this,e),this.playlistManager=t,this.syncPlaylistState=n,this.store=o,this.type=r}return S(e,[{key:"play",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=3;break}return xt.w("Please pass id to play"),t.abrupt("return");case 3:return t.next=5,this.playlistManager.setEnabled(!0,{id:e,type:this.type});case 5:case"end":return t.stop()}},t,this)}))}},{key:"pause",value:function(){return B(this,null,h().mark(function e(){var t,r;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.type===F.audio?St:kt,(r=this.store.getState(t.selection)).id){e.next=4;break}return xt.w("No item is currently playing to pause"),e.abrupt("return");case 4:return e.next=6,this.playlistManager.setEnabled(!1,{id:r.id,type:this.type});case 6:case"end":return e.stop()}},e,this)}))}},{key:"playNext",value:function(){return B(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.playNext(this.type);case 2:case"end":return e.stop()}},e,this)}))}},{key:"playPrevious",value:function(){return B(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.playPrevious(this.type);case 2:case"end":return e.stop()}},e,this)}))}},{key:"seek",value:function(e){this.playlistManager.seek(e,this.type),this.syncPlaylistState("seekOn".concat(this.type,"Playlist"))}},{key:"seekTo",value:function(e){this.playlistManager.seekTo(e,this.type),this.syncPlaylistState("seekToOn".concat(this.type,"Playlist"))}},{key:"setVolume",value:function(e){this.playlistManager.setVolume(e,this.type),this.syncPlaylistState("setVolumeOn".concat(this.type,"Playlist"))}},{key:"setList",value:function(e){this.playlistManager.setList(e),this.syncPlaylistState("setListOn".concat(this.type,"Playlist"))}},{key:"stop",value:function(){return B(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.stop(this.type);case 2:this.syncPlaylistState("stop".concat(this.type,"Playlist"));case 3:case"end":return e.stop()}},e,this)}))}},{key:"setIsAutoplayOn",value:function(e){this.playlistManager.setIsAutoplayOn(this.type,e)}},{key:"setPlaybackRate",value:function(e){this.playlistManager.setPlaybackRate(this.type,e),this.syncPlaylistState("set".concat(this.type,"PlaybackRate"))}},{key:"removeItem",value:function(e){return B(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.playlistManager.removeItem(e,this.type);case 2:return r=t.sent,t.abrupt("return",(r&&this.syncPlaylistState("remove".concat(this.type,"PlaylistItem")),r));case 4:case"end":return t.stop()}},t,this)}))}},{key:"clearList",value:function(){return B(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlistManager.clearList(this.type);case 2:this.syncPlaylistState("clear".concat(this.type,"Playlist"));case 3:case"end":return e.stop()}},e,this)}))}}]),e}(),rn=function(){function e(t,r){v(this,e),this.sdk=t,this.setLocally=r}return S(e,[{key:"sdkSessionStore",get:function(){return this.sdk.getSessionStore()}},{key:"set",value:function(e,t){return B(this,null,h().mark(function r(){var n,o;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.sdkSessionStore.set(String(e),t);case 2:n=r.sent,o=n.value,this.setLocally({key:e,value:o});case 5:case"end":return r.stop()}},r,this)}))}},{key:"observe",value:function(e){return B(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=Array.isArray(e)?e.map(function(e){return String(e)}):[String(e)],t.next=3,this.sdkSessionStore.observe(r);case 3:case"end":return t.stop()}},t,this)}))}},{key:"unobserve",value:function(e){return B(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=Array.isArray(e)?e.map(function(e){return String(e)}):[String(e)],t.next=3,this.sdkSessionStore.unobserve(r);case 3:case"end":return t.stop()}},t,this)}))}}]),e}(),nn=function(){function e(t,r){v(this,e),this.intervalMs=100,this.shouldMonitor=!1,this.hasStarted=!1,this.unsubs=[],this.analysers={},this.store=t,this.actions=r}return S(e,[{key:"start",value:function(){return B(this,null,h().mark(function e(){var t,r;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasStarted){e.next=2;break}return e.abrupt("return");case 2:if(this.hasStarted=!0,xt.d("starting audio level monitor for remote peers",this.store),t=this.store.getState(ke),xt.d("starting audio levels is connected to room",t),e.t0=t,!e.t0){e.next=9;break}return e.next=9,this.monitorAudioLevels();case 9:r=this.store.subscribe(this.monitorAudioLevels.bind(this),ke),this.unsubs.push(r);case 11:case"end":return e.stop()}},e,this)}))}},{key:"stop",value:function(){return B(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:!this.hasStarted||(this.hasStarted=!1,this.shouldMonitor=!1,this.unsubs.forEach(function(e){return e()}),xt.d("stopped audio level monitor for remote peers"));case 1:case"end":return e.stop()}},e,this)}))}},{key:"monitorAudioLevels",value:function(){return B(this,null,h().mark(function e(){var t,r=this;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.store.getState(ke)){e.next=3;break}return this.shouldMonitor&&(xt.i("room no longer connected, stopping audio level monitoring for remote"),this.shouldMonitor=!1),e.abrupt("return");case 3:if(!this.shouldMonitor){e.next=5;break}return e.abrupt("return");case 5:xt.i("monitoring audio levels"),this.shouldMonitor=!0,t=function e(){r.shouldMonitor?(r.logAllPeersAudioLevels(),setTimeout(e,r.intervalMs)):xt.i("stopped monitoring audio levels")},setTimeout(t,1e3);case 8:case"end":return e.stop()}},e,this)}))}},{key:"logAllPeersAudioLevels",value:function(){return B(this,null,h().mark(function e(){var t,r,n,o,i,s,a,c,u,l;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.__triggerBeamEvent__){e.next=2;break}return e.abrupt("return");case 2:r=this.store.getState(me).filter(function(e){return!!e.audioTrack}),n=[],o=R(r),e.prev=4,o.s();case 6:if((i=o.n()).done){e.next=16;break}if(s=i.value,a=this.actions.hmsSDKTracks[s.audioTrack],c=null==(t=null==a?void 0:a.stream)?void 0:t.nativeStream,!s.joinedAt||!c){e.next=14;break}return e.next=12,this.getAudioLevel(s,c);case 12:(u=e.sent).level>0&&n.push(u);case 14:e.next=6;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(4),o.e(e.t0);case 21:return e.prev=21,o.f(),e.finish(21);case 24:n.length>0&&(l={event:"app-audio-level",data:n},window.__triggerBeamEvent__(JSON.stringify(l)));case 25:case"end":return e.stop()}},e,this,[[4,18,21,24]])}))}},{key:"getAudioLevel",value:function(e,t){return B(this,null,h().mark(function r(){var n,o;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return this.analysers[t.id]||(this.analysers[t.id]=this.createAnalyserNode(t)),n=this.analysers[t.id],o=this.calculateAudioLevel(n),r.abrupt("return",{peerId:e.id,peerName:e.name,level:o});case 3:case"end":return r.stop()}},r,this)}))}},{key:"createAnalyserNode",value:function(e){this.audioContext||(this.audioContext=new AudioContext);var t=this.audioContext.createAnalyser();return this.audioContext.createMediaStreamSource(e).connect(t),t}},{key:"calculateAudioLevel",value:function(e){var t=new Uint8Array(e.fftSize);e.getByteTimeDomainData(t);var r,n=.009,o=n,i=R(t);try{for(i.s();!(r=i.n()).done;){var s=r.value;o=Math.max(o,(s-128)/128)}}catch(c){i.e(c)}finally{i.f()}var a=(Math.log(n)-Math.log(o))/Math.log(n);return Math.ceil(Math.min(Math.max(100*a,0),100))}}]),e}(),on=function(){function e(t,r,n){var o=this;v(this,e),this.hmsSDKTracks={},this.hmsSDKPeers={},this.isRoomJoinCalled=!1,this.ignoredMessageTypes=[],this.setProgress=function(e){var t=e.type,r=e.progress;o.setState(function(e){e.playlist[t].progress=r,e.playlist[t].currentTime=o.sdk.getPlaylistManager().getCurrentTime(t)},"playlistProgress")},this.syncPlaylistState=function(e){o.setState(function(e){Object.assign(e.playlist,en.convertPlaylist(o.sdk.getPlaylistManager()))},e)},this.sendPeerUpdateNotification=function(e,t){var r=o.store.getState(Lt(t.peerId)),n=J[e]||"peerUpdate";o.syncRoomState(n),r||(r=o.store.getState(Lt(t.peerId))),o.hmsNotifications.sendPeerUpdate(e,r)},this.setState=function(e,t){return o.store.namedSetState(e,t)},this.store=t,this.sdk=r,this.hmsNotifications=n,this.sessionStore=new rn(this.sdk,this.setSessionStoreValueLocally.bind(this))}return S(e,[{key:"refreshDevices",value:function(){return B(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.refreshDevices();case 2:case"end":return e.stop()}},e,this)}))}},{key:"unblockAudio",value:function(){return B(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.getAudioOutput().unblockAutoplay();case 2:case"end":return e.stop()}},e,this)}))}},{key:"setVolume",value:function(e,t){return B(this,null,h().mark(function r(){return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!t){r.next=5;break}return r.next=3,this.setTrackVolume(e,t);case 3:r.next=8;break;case 5:return r.next=7,this.sdk.getAudioOutput().setVolume(e);case 7:this.syncRoomState("setOutputVolume");case 8:case"end":return r.stop()}},r,this)}))}},{key:"setAudioOutputDevice",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.getAudioOutput().setDevice(e);case 2:if(t.t0=t.sent,!t.t0){t.next=5;break}this.setState(function(t){t.settings.audioOutputDeviceId=e},"setAudioOutputDevice");case 5:case"end":return t.stop()}},t,this)}))}},{key:"setPreferredLayer",value:function(e,t){return B(this,null,h().mark(function r(){var n,o;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(o=this.hmsSDKTracks[e])){r.next=17;break}if(!(o instanceof i.HMSRemoteVideoTrack)){r.next=14;break}if(t!==i.HMSSimulcastLayer.NONE){r.next=6;break}return xt.d("layer ".concat(i.HMSSimulcastLayer.NONE," will be ignored")),r.abrupt("return");case 6:if((null==(n=this.store.getState(Ht(e)))?void 0:n.preferredLayer)!==t){r.next=9;break}return xt.d("preferred layer is already ".concat(t)),r.abrupt("return");case 9:return this.setState(function(r){var n=r.tracks[e];n&&(n.preferredLayer=t)},"setPreferredLayer"),r.next=12,o.setPreferredLayer(t);case 12:r.next=15;break;case 14:xt.d("track ".concat(e," is not a remote video track"));case 15:r.next=18;break;case 17:this.logPossibleInconsistency("track ".concat(e," not present, unable to set preffer layer"));case 18:case"end":return r.stop()}},r,this)}))}},{key:"getAuthTokenByRoomCode",value:function(e,t){return this.sdk.getAuthTokenByRoomCode(e,t)}},{key:"preview",value:function(e){return B(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isRoomJoinCalled){t.next=3;break}return this.logPossibleInconsistency("attempting to call preview after join was called"),t.abrupt("return");case 3:if((r=this.store.getState(Qe))!==E.Preview&&r!==E.Connecting){t.next=7;break}return this.logPossibleInconsistency("attempting to call preview while room is in preview/connecting"),t.abrupt("return");case 7:return t.prev=7,this.setState(function(e){e.room.roomState=E.Connecting},"connecting"),t.next=11,this.sdkPreviewWithListeners(e);case 11:t.next=16;break;case 13:throw t.prev=13,t.t0=t.catch(7),xt.e("Cannot show preview. Failed to connect to room - ",t.t0),t.t0;case 16:case"end":return t.stop()}},t,this,[[7,13]])}))}},{key:"join",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isRoomJoinCalled){t.next=3;break}return this.logPossibleInconsistency("room join is called again"),t.abrupt("return");case 3:return t.prev=3,this.isRoomJoinCalled=!0,this.setState(function(e){e.room.roomState=E.Connecting},"join"),t.next=8,this.sdkJoinWithListeners(e);case 8:t.next=13;break;case 10:throw t.prev=10,t.t0=t.catch(3),this.isRoomJoinCalled=!1,xt.e("Failed to connect to room - ",t.t0),t.t0;case 13:case"end":return t.stop()}},t,this,[[3,10]])}))}},{key:"leave",value:function(){return B(this,null,h().mark(function e(){var t,r,n,o=this;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.store.getState(ke),r=!0,t||(r=!1,this.logPossibleInconsistency("room leave is called when no room is connected")),n=this.store.getState(Qe),e.abrupt("return",(this.setState(function(e){e.room.roomState=E.Disconnecting},"leaving"),this.sdk.leave(r).then(function(){o.resetState("leave"),o.beamSpeakerLabelsLogger&&o.beamSpeakerLabelsLogger.stop().catch(xt.e),xt.i("left room")}).catch(function(e){xt.e("error in leaving room - ",e),o.setState(function(e){e.room.roomState=n},"revertLeave")})));case 4:case"end":return e.stop()}},e,this)}))}},{key:"setScreenShareEnabled",value:function(e,t){return B(this,null,h().mark(function r(){return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("boolean"==typeof t&&(t={audioOnly:t}),r.prev=1,!e){r.next=7;break}return r.next=5,this.startScreenShare(t);case 5:r.next=9;break;case 7:return r.next=9,this.stopScreenShare();case 9:r.next=14;break;case 11:throw r.prev=11,r.t0=r.catch(1),this.hmsNotifications.sendError(en.convertException(r.t0)),r.t0;case 14:case"end":return r.stop()}},r,this,[[1,11]])}))}},{key:"addTrack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"regular";return B(this,null,h().mark(function r(){return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.sdk.addTrack(e,t);case 2:this.syncRoomState("addTrack");case 3:case"end":return r.stop()}},r,this)}))}},{key:"removeTrack",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.removeTrack(e);case 2:this.syncRoomState("removeTrack");case 3:case"end":return t.stop()}},t,this)}))}},{key:"setLocalAudioEnabled",value:function(e){return B(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.store.getState(we),t.t0=r,!t.t0){t.next=5;break}return t.next=5,this.setEnabledTrack(r,e);case 5:case"end":return t.stop()}},t,this)}))}},{key:"setLocalVideoEnabled",value:function(e){return B(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.store.getState(De),t.t0=r,!t.t0){t.next=5;break}return t.next=5,this.setEnabledTrack(r,e);case 5:case"end":return t.stop()}},t,this)}))}},{key:"setEnabledTrack",value:function(e,t){return B(this,null,h().mark(function r(){var n,o,s=this;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if((null==(n=this.store.getState().tracks[e])?void 0:n.enabled)!==t){r.next=3;break}return this.logPossibleInconsistency("local track[".concat(e,"] enabled state - ").concat(t)),r.abrupt("return");case 3:return this.setState(function(r){r.tracks[e]?r.tracks[e].displayEnabled=t:s.logPossibleInconsistency("track id not found for setEnabled")},"displayEnabled"),r.prev=4,r.next=7,this.setEnabledSDKTrack(e,t);case 7:this.syncRoomState("setEnabled"),r.next=13;break;case 10:throw r.prev=10,r.t0=r.catch(4),this.setState(function(r){r.tracks[e].displayEnabled=!t},"rollbackDisplayEnabled"),this.hmsNotifications.sendError(en.convertException(r.t0)),r.t0;case 13:o=t?i.HMSTrackUpdate.TRACK_UNMUTED:i.HMSTrackUpdate.TRACK_MUTED,this.hmsNotifications.sendTrackUpdate(o,e);case 15:case"end":return r.stop()}},r,this,[[4,10]])}))}},{key:"setAudioSettings",value:function(e){return B(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.store.getState(we),t.t0=r,!t.t0){t.next=6;break}return t.next=5,this.setSDKLocalAudioTrackSettings(r,e);case 5:this.syncRoomState("setAudioSettings");case 6:case"end":return t.stop()}},t,this)}))}},{key:"setVideoSettings",value:function(e){return B(this,null,h().mark(function t(){var r;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.store.getState(De),t.t0=r,!t.t0){t.next=6;break}return t.next=5,this.setSDKLocalVideoTrackSettings(r,e);case 5:this.syncRoomState("setVideoSettings");case 6:case"end":return t.stop()}},t,this)}))}},{key:"switchCamera",value:function(){return B(this,null,h().mark(function e(){var t,r;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.store.getState(De))){e.next=8;break}if(r=this.hmsSDKTracks[t],e.t0=r,!e.t0){e.next=8;break}return e.next=7,r.switchCamera();case 7:this.syncRoomState("switchCamera");case 8:case"end":return e.stop()}},e,this)}))}},{key:"sendMessage",value:function(e){this.sendBroadcastMessage(e)}},{key:"sendBroadcastMessage",value:function(e,t){return B(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.sdk.sendBroadcastMessage(e,t);case 2:n=r.sent,this.updateMessageInStore(n,{message:e,type:t});case 4:case"end":return r.stop()}},r,this)}))}},{key:"sendGroupMessage",value:function(e,t,r){return B(this,null,h().mark(function n(){var o,i,s;return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=this.store.getState(ze),i=t.map(function(e){return o[e]}),n.next=4,this.sdk.sendGroupMessage(e,i,r);case 4:s=n.sent,this.updateMessageInStore(s,{message:e,recipientRoles:t,type:r});case 6:case"end":return n.stop()}},n,this)}))}},{key:"sendDirectMessage",value:function(e,t,r){return B(this,null,h().mark(function n(){var o,i;return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=this.hmsSDKPeers[t],n.next=3,this.sdk.sendDirectMessage(e,o,r);case 3:i=n.sent,this.updateMessageInStore(i,{message:e,recipientPeer:o.peerId,type:r});case 5:case"end":return n.stop()}},n,this)}))}},{key:"updateMessageInStore",value:function(e,t){if(!e)throw xt.w("sendMessage","Failed to send message",t),Error("sendMessage Failed - ".concat(JSON.stringify(t)));var r=en.convertMessage(e);return r.read=!0,r.senderName="You",r.ignored=this.ignoredMessageTypes.includes(r.type),this.putMessageInStore(r),r}},{key:"setMessageRead",value:function(e,t){var r=this;this.setState(function(n){t?n.messages.byID[t]?n.messages.byID[t].read=e:r.logPossibleInconsistency("no message with id is found"):n.messages.allIDs.forEach(function(t){n.messages.byID[t].read=e})},"setMessageRead")}},{key:"attachVideo",value:function(e,t){return B(this,null,h().mark(function r(){var n=this;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(xt.d("[HMSSDKAction] attaching the video element ".concat(e," ").concat(t)),!this.localAndVideoUnmuting(e)){r.next=2;break}return r.abrupt("return",new Promise(function(r){var o=n.store.subscribe(function(i){return B(n,null,h().mark(function n(){return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.t0=i,!n.t0){n.next=6;break}return n.next=4,this.attachVideoInternal(e,t);case 4:o(),r();case 6:case"end":return n.stop()}},n,this)}))},Ce)}));case 2:return r.next=4,this.attachVideoInternal(e,t);case 4:case"end":return r.stop()}},r,this)}))}},{key:"detachVideo",value:function(e,t){return B(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(xt.d("[HMSSDKAction] detaching the video element ".concat(e," ").concat(t)),"video"!==(null==(n=this.hmsSDKTracks[e])?void 0:n.type)){r.next=7;break}return r.next=5,this.sdk.detachVideo(n,t);case 5:r.next=8;break;case 7:t&&(t.srcObject=null),xt.d("possible inconsistency detected - no video track found to remove sink");case 8:case"end":return r.stop()}},r,this)}))}},{key:"addPluginToVideoTrack",value:function(e,t){return B(this,null,h().mark(function r(){return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.addRemoveVideoPlugin(e,"add",t));case 1:case"end":return r.stop()}},r,this)}))}},{key:"addPluginToAudioTrack",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.addRemoveAudioPlugin(e,"add"));case 1:case"end":return t.stop()}},t,this)}))}},{key:"validateVideoPluginSupport",value:function(e){var t={isSupported:!1};if(!e)return xt.w("no plugin passed in for checking support"),t.errMsg="no plugin passed in for checking support",t;var r=this.store.getState(De);if(!r)return xt.w("video Track not added to local peer yet"),t.errMsg="call this function only after local peer has video track",t;var n=this.hmsSDKTracks[r];return n?t=n.validatePlugin(e):(xt.w("track ".concat(r," not present, unable to validate plugin")),t.errMsg="track ".concat(r," not present, unable to validate plugin")),t}},{key:"validateAudioPluginSupport",value:function(e){var t={isSupported:!1};if(!e)return xt.w('no plugin passed in for checking support"'),t.errMsg='no plugin passed in for checking support"',t;var r=this.store.getState(we);if(!r)return xt.w("audio track not added to local peer yet"),t.errMsg="call this function only after local peer has audio track",t;var n=this.hmsSDKTracks[r];return n?t=n.validatePlugin(e):(xt.w("track ".concat(r," not present, unable to validate plugin")),t.errMsg="track ".concat(r," not present, unable to validate plugin")),t}},{key:"removePluginFromVideoTrack",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.addRemoveVideoPlugin(e,"remove"));case 1:case"end":return t.stop()}},t,this)}))}},{key:"removePluginFromAudioTrack",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.addRemoveAudioPlugin(e,"remove"));case 1:case"end":return t.stop()}},t,this)}))}},{key:"changeRole",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return B(this,null,h().mark(function n(){var o;return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(o=this.hmsSDKPeers[e]){n.next=4;break}return this.logPossibleInconsistency("Unknown peer ID given ".concat(e," for changerole")),n.abrupt("return");case 4:return n.next=6,this.sdk.changeRoleOfPeer(o,t,r);case 6:case"end":return n.stop()}},n,this)}))}},{key:"changeRoleOfPeer",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return B(this,null,h().mark(function n(){var o;return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(o=this.hmsSDKPeers[e]){n.next=4;break}return this.logPossibleInconsistency("Unknown peer ID given ".concat(e," for changerole")),n.abrupt("return");case 4:return n.next=6,this.sdk.changeRoleOfPeer(o,t,r);case 6:case"end":return n.stop()}},n,this)}))}},{key:"changeRoleOfPeersWithRoles",value:function(e,t){return B(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=this.sdk.getRoles().filter(function(t){return e.includes(t.name)}),r.next=3,this.sdk.changeRoleOfPeersWithRoles(n,t);case 3:case"end":return r.stop()}},r,this)}))}},{key:"acceptChangeRole",value:function(e){return B(this,null,h().mark(function t(){var r,n;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(r=e.requestedBy?this.hmsSDKPeers[e.requestedBy.id]:void 0)||xt.w("peer for which role change is requested no longer available - ".concat(e.requestedBy)),n={requestedBy:r,role:e.role,token:e.token},t.next=5,this.sdk.acceptChangeRole(n);case 5:this.removeRoleChangeRequest(e);case 6:case"end":return t.stop()}},t,this)}))}},{key:"initAppData",value:function(e){this.setState(function(t){t.appData=e},"initAppData")}},{key:"setAppData",value:function(e,t,r){var n="Object"===(null==t?void 0:t.constructor.name);this.setState(function(o){if(o.appData)r&&n?Object.assign(o.appData[e],t):o.appData[e]=t;else{var i=b({},e,t);o.appData=i}},"setAppData-".concat(e))}},{key:"rejectChangeRole",value:function(e){this.removeRoleChangeRequest(e)}},{key:"endRoom",value:function(e,t){return B(this,null,h().mark(function r(){var n,o;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null==(n=this.store.getState(tt))?void 0:n.endRoom){r.next=4;break}return xt.w("You are not allowed to perform this action - endRoom"),r.abrupt("return");case 4:return o=this.store.getState(Qe),this.setState(function(e){e.room.roomState=E.Disconnecting},"endingRoom"),r.prev=6,r.next=9,this.sdk.endRoom(e,t);case 9:this.resetState("endRoom"),r.next=15;break;case 12:r.prev=12,r.t0=r.catch(6),xt.e("error in ending room - ",r.t0),this.setState(function(e){e.room.roomState=o},"revertEndRoom");case 15:case"end":return r.stop()}},r,this,[[6,12]])}))}},{key:"removePeer",value:function(e,t){return B(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=this.hmsSDKPeers[e])||n.isLocal){r.next=6;break}return r.next=4,this.sdk.removePeer(n,t);case 4:r.next=8;break;case 6:return this.logPossibleInconsistency("No remote peer found for peerID - ".concat(e)),r.abrupt("return");case 8:case"end":return r.stop()}},r,this)}))}},{key:"startRTMPOrRecording",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.startRTMPOrRecording(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"stopRTMPAndRecording",value:function(){return B(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.stopRTMPAndRecording();case 2:case"end":return e.stop()}},e,this)}))}},{key:"startHLSStreaming",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.startHLSStreaming(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"stopHLSStreaming",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.stopHLSStreaming(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"sendHLSTimedMetadata",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.sendHLSTimedMetadata(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"changeName",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.changeName(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"changeMetadata",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return"string"!=typeof e&&(e=JSON.stringify(e)),t.next=3,this.sdk.changeMetadata(e);case 3:case"end":return t.stop()}},t,this)}))}},{key:"setSessionMetadata",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.setSessionMetadata(e);case 2:this.setState(function(t){t.sessionMetadata=e},"setSessionMetadata"),this.setSessionStoreValueLocally({key:"default",value:e},"setSessionMetadata");case 4:case"end":return t.stop()}},t,this)}))}},{key:"populateSessionMetadata",value:function(){return B(this,null,h().mark(function e(){var t;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sdk.getSessionMetadata();case 2:t=e.sent,this.setState(function(e){e.sessionMetadata=t},"populateSessionMetadata"),this.setSessionStoreValueLocally({key:"default",value:t},"populateSessionmetadata");case 4:case"end":return e.stop()}},e,this)}))}},{key:"setRemoteTrackEnabled",value:function(e,t){return B(this,null,h().mark(function r(){var n,o=this;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if("string"!=typeof e){r.next=10;break}if(!(n=this.hmsSDKTracks[e])||!qr(n)){r.next=7;break}return r.next=5,this.sdk.changeTrackState(n,t);case 5:r.next=8;break;case 7:this.logPossibleInconsistency("No remote track with ID ".concat(e," found for change track state"));case 8:r.next=11;break;case 10:Array.isArray(e)&&e.forEach(function(e){return o.setRemoteTrackEnabled(e,t)});case 11:case"end":return r.stop()}},r,this)}))}},{key:"setRemoteTracksEnabled",value:function(e){return B(this,null,h().mark(function t(){var r,n;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r={enabled:e.enabled,type:e.type,source:e.source},e.roles&&(n=this.store.getState(ze),r.roles=e.roles.map(function(e){return n[e]})),t.next=4,this.sdk.changeMultiTrackState(r);case 4:case"end":return t.stop()}},t,this)}))}},{key:"setLogLevel",value:function(e){xt.level=e,this.sdk.setLogLevel(e)}},{key:"setFrameworkInfo",value:function(e){this.sdk.setFrameworkInfo(e)}},{key:"ignoreMessageTypes",value:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])this.ignoredMessageTypes=e;else{var t,r=R(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.ignoredMessageTypes.includes(n)||this.ignoredMessageTypes.push(n)}}catch(o){r.e(o)}finally{r.f()}}}},{key:"enableBeamSpeakerLabelsLogging",value:function(){return B(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.beamSpeakerLabelsLogger,e.t0){e.next=6;break}return xt.i("enabling beam speaker labels logging"),this.beamSpeakerLabelsLogger=new nn(this.store,this),e.next=6,this.beamSpeakerLabelsLogger.start();case 6:case"end":return e.stop()}},e,this)}))}},{key:"resetState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"resetState";this.isRoomJoinCalled=!1,this.hmsSDKTracks={},xt.cleanUp(),this.setState(function(e){Object.assign(e,G())},e)}},{key:"sdkJoinWithListeners",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.join(e,{onJoin:this.onJoin.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onTrackUpdate:this.onTrackUpdate.bind(this),onMessageReceived:this.onMessageReceived.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onRoleChangeRequest:this.onRoleChangeRequest.bind(this),onRoleUpdate:this.onRoleUpdate.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onChangeTrackStateRequest:this.onChangeTrackStateRequest.bind(this),onChangeMultiTrackStateRequest:this.onChangeMultiTrackStateRequest.bind(this),onRemovedFromRoom:this.onRemovedFromRoom.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this),onSessionStoreUpdate:this.onSessionStoreUpdate.bind(this)});case 2:this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)}),this.sdk.addConnectionQualityListener({onConnectionQualityUpdate:this.onConnectionQualityUpdate.bind(this)});case 4:case"end":return t.stop()}},t,this)}))}},{key:"onRemovedFromRoom",value:function(e){var t,r=this.store.getState(Lt(null==(t=e.requestedBy)?void 0:t.peerId));this.hmsNotifications.sendLeaveRoom(U(_({},e),{requestedBy:r||void 0}));var n=e.roomEnded||!r?"roomEnded":"removedFromRoom";xt.i("resetting state after peer removed ".concat(n),e),this.resetState(n)}},{key:"onDeviceChange",value:function(e){var t=this,r=e.devices;if(r){var n=this.store.getState(be);if(this.setState(function(e){$r(e.devices.audioInput,r.audioInput)||(e.devices.audioInput=r.audioInput),$r(e.devices.videoInput,r.videoInput)||(e.devices.videoInput=r.videoInput),$r(e.devices.audioOutput,r.audioOutput)||(e.devices.audioOutput=r.audioOutput),(null==n?void 0:n.id)&&t.hmsSDKPeers[n.id]&&Object.assign(e.settings,t.getMediaSettings(t.hmsSDKPeers[n.id]))},"deviceChange"),e.selection){var o=en.convertDeviceChangeUpdate(e);this.hmsNotifications.sendDeviceChange(o)}}}},{key:"sdkPreviewWithListeners",value:function(e){return B(this,null,h().mark(function t(){return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sdk.preview(e,{onPreview:this.onPreview.bind(this),onError:this.onError.bind(this),onReconnected:this.onReconnected.bind(this),onReconnecting:this.onReconnecting.bind(this),onDeviceChange:this.onDeviceChange.bind(this),onRoomUpdate:this.onRoomUpdate.bind(this),onPeerUpdate:this.onPeerUpdate.bind(this),onNetworkQuality:this.onNetworkQuality.bind(this)});case 2:this.sdk.addAudioListener({onAudioLevelUpdate:this.onAudioLevelUpdate.bind(this)});case 3:case"end":return t.stop()}},t,this)}))}},{key:"onNetworkQuality",value:function(e){var t=this;this.setState(function(r){var n,o=r.room.localPeer||(null==(n=t.sdk.getLocalPeer())?void 0:n.peerId);o&&(r.connectionQualities[o]={peerID:o,downlinkQuality:e})},"ConnectionQuality")}},{key:"onSessionStoreUpdate",value:function(e){this.setSessionStoreValueLocally(e,"sessionStoreUpdate")}},{key:"startScreenShare",value:function(e){return B(this,null,h().mark(function t(){var r=this;return h().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.store.getState(Ne)){t.next=4;break}this.logPossibleInconsistency("start screenshare is called while it's on"),t.next=7;break;case 4:return t.next=6,this.sdk.startScreenShare(function(){return r.syncRoomState("screenshareStopped")},e);case 6:this.syncRoomState("startScreenShare");case 7:case"end":return t.stop()}},t,this)}))}},{key:"stopScreenShare",value:function(){return B(this,null,h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.store.getState(Ne)){e.next=6;break}return e.next=3,this.sdk.stopScreenShare();case 3:this.syncRoomState("stopScreenShare"),e.next=7;break;case 6:this.logPossibleInconsistency("stop screenshare is called while it's not on");case 7:case"end":return e.stop()}},e,this)}))}},{key:"attachVideoInternal",value:function(e,t){return B(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=this.hmsSDKTracks[e])||"video"!==n.type){r.next=6;break}return r.next=4,this.sdk.attachVideo(n,t);case 4:r.next=7;break;case 6:this.logPossibleInconsistency("no video track found to add sink");case 7:case"end":return r.stop()}},r,this)}))}},{key:"syncRoomState",value:function(e){var t=this;e="".concat(e,"_fullSync"),xt.time("store-sync-".concat(e));var r,n,o={},i=[],s={},a={},c={},u=R(this.sdk.getPeers());try{for(u.s();!(n=u.n()).done;){var l=n.value,d=en.convertPeer(l);o[d.id]=d,i.push(d.id),this.hmsSDKPeers[d.id]=l;var f,p=R([l.audioTrack,l.videoTrack].concat(k(l.auxiliaryTracks)));try{for(p.s();!(f=p.n()).done;){var h=f.value;if(h){var v=en.convertTrack(h);s[v.id]=v,a[h.trackId]=h}}}catch(x){p.e(x)}finally{p.f()}if(l.isLocal){var y=l;r=this.getPreviewFields(y),Object.assign(c,this.getMediaSettings(y))}}}catch(x){u.e(x)}finally{u.f()}var S=this.sdk.getRecordingState(),g=this.sdk.getRTMPState(),m=this.sdk.getHLSState();this.setState(function(e){var n;e.room.peers=i;var u=e.peers,l=e.tracks;Fr(u,o),Gr(l,s),Object.assign(e.settings,c),t.hmsSDKTracks=a,(null==(n=e.preview)?void 0:n.localPeer)&&(null==r?void 0:r.localPeer)?Object.assign(e.preview,r):e.preview=r,Object.assign(e.roles,en.convertRoles(t.sdk.getRoles())),Object.assign(e.playlist,en.convertPlaylist(t.sdk.getPlaylistManager())),Object.assign(e.room,en.convertRecordingStreamingState(S,g,m)),Object.assign(e.templateAppData,t.sdk.getTemplateAppData())},e),xt.timeEnd("store-sync-".concat(e))}},{key:"onPreview",value:function(e){this.setState(function(t){Object.assign(t.room,en.convertRoom(e)),t.room.roomState=E.Preview},"previewStart"),this.syncRoomState("previewSync")}},{key:"onJoin",value:function(e){var t=this,r=this.sdk.getPlaylistManager();this.audioPlaylist=new tn(r,F.audio,this.syncPlaylistState.bind(this),this.store),this.videoPlaylist=new tn(r,F.video,this.syncRoomState.bind(this),this.store),this.syncRoomState("joinSync"),this.setState(function(t){Object.assign(t.room,en.convertRoom(e)),t.room.isConnected=!0,t.room.roomState=E.Connected},"joined"),r.onProgress(this.setProgress),r.onNewTrackStart(function(e){t.syncPlaylistState("".concat(e.type,"PlaylistUpdate"))}),r.onPlaylistEnded(function(e){t.syncPlaylistState("".concat(e,"PlaylistEnded"))}),r.onCurrentTrackEnded(function(e){t.hmsNotifications.sendPlaylistTrackEnded(en.convertPlaylistItem(r,e)),t.syncPlaylistState("".concat(e.type,"PlaylistItemEnded"))})}},{key:"onRoomUpdate",value:function(e,t){this.setState(function(e){Object.assign(e.room,en.convertRoom(t))},e)}},{key:"onPeerUpdate",value:function(e,t){var r=this;if(![i.HMSPeerUpdate.BECAME_DOMINANT_SPEAKER,i.HMSPeerUpdate.RESIGNED_DOMINANT_SPEAKER].includes(e)){if(Array.isArray(t)){var n=this.store.getState(ue),o=t.filter(function(e){return!n[e.peerId]});if(this.syncRoomState("peersJoined"),this.store.getState(ke)){var s,a=[],c=R(t);try{for(c.s();!(s=c.n()).done;){var u=s.value,l=this.store.getState(Lt(u.peerId));l&&a.push(l)}}catch(d){c.e(d)}finally{c.f()}this.hmsNotifications.sendPeerList(a)}else o.forEach(function(e){var t=r.store.getState(Lt(e.peerId));t&&r.hmsNotifications.sendPeerUpdate(i.HMSPeerUpdate.PEER_JOINED,t)});return}this.sendPeerUpdateNotification(e,t)}}},{key:"onTrackUpdate",value:function(e,t,r){if(e===i.HMSTrackUpdate.TRACK_REMOVED)this.hmsNotifications.sendTrackUpdate(e,t.trackId),this.handleTrackRemove(t,r);else{var n=W[e]||"trackUpdate";this.syncRoomState(n),this.hmsNotifications.sendTrackUpdate(e,t.trackId)}}},{key:"onMessageReceived",value:function(e){var t=en.convertMessage(e);t.read=!1,t.ignored=this.ignoredMessageTypes.includes(t.type),this.putMessageInStore(t),this.hmsNotifications.sendMessageReceived(t)}},{key:"putMessageInStore",value:function(e){var t=this;e.ignored||this.setState(function(r){e.id=String(t.store.getState(qe)+1),r.messages.byID[e.id]=e,r.messages.allIDs.push(e.id)},"newMessage")}},{key:"onAudioLevelUpdate",value:function(e){this.setState(function(t){var r={};e.forEach(function(e){if(e.track&&e.peer){var n=e.track.trackId;r[n]=e.audioLevel,t.speakers[n]||(t.speakers[n]={audioLevel:e.audioLevel,peerID:e.peer.peerId,trackID:n})}});for(var n=0,o=Object.entries(t.speakers);n<o.length;n++){var i=l(o[n],2),s=i[0],a=i[1];a.audioLevel=r[s]||0,0===a.audioLevel&&delete t.speakers[s]}},"audioLevel")}},{key:"onConnectionQualityUpdate",value:function(e){this.setState(function(t){var r=new Set;e.forEach(function(e){var n=e.peerID;!n||(r.add(n),t.connectionQualities[n]?Object.assign(t.connectionQualities[n],e):t.connectionQualities[n]=e)});for(var n=0,o=Object.keys(t.connectionQualities);n<o.length;n++){var i=o[n];r.has(i)||delete t.connectionQualities[i]}},"connectionQuality")}},{key:"onChangeTrackStateRequest",value:function(e){var t,r=this.store.getState(Lt(null==(t=e.requestedBy)?void 0:t.peerId)),n=this.getStoreLocalTrackIDfromSDKTrack(e.track),o=this.store.getState(Ut(n));if(!o)return this.logPossibleInconsistency("Not found track for which track state change was requested, ".concat(e.track));e.enabled||this.syncRoomState("changeTrackStateRequest"),this.hmsNotifications.sendChangeTrackStateRequest({requestedBy:r||void 0,track:o,enabled:e.enabled})}},{key:"onChangeMultiTrackStateRequest",value:function(e){var t,r=this.store.getState(Lt(null==(t=e.requestedBy)?void 0:t.peerId));e.enabled||this.syncRoomState("changeMultiTrackStateRequest");var n,o=[],i=this.store.getState(fe),s=R(e.tracks);try{for(s.s();!(n=s.n()).done;){var a=n.value,c=this.getStoreLocalTrackIDfromSDKTrack(a);c&&i[c]&&o.push(i[c])}}catch(u){s.e(u)}finally{s.f()}this.hmsNotifications.sendChangeMultiTrackStateRequest({requestedBy:r||void 0,tracks:o,enabled:e.enabled,type:e.type,source:e.source})}},{key:"onReconnected",value:function(){this.syncRoomState("reconnectedSync"),this.hmsNotifications.sendReconnected(),this.setState(function(e){e.room.roomState=e.room.isConnected?E.Connected:E.Preview},"reconnected")}},{key:"onReconnecting",value:function(e){var t=en.convertException(e);xt.e("Reconnection: received error from sdk",t),this.hmsNotifications.sendReconnecting(t),this.setState(function(e){e.room.roomState=E.Reconnecting,e.errors.push(t)},"reconnecting")}},{key:"onError",value:function(e){var t=en.convertException(e);t.isTerminal?(this.leave().then(function(){return xt.e("error from SDK, left room.")}),this.setState(function(e){e.room.roomState=E.Failed,e.errors.push(t)},"errorTerminal")):this.store.getState().errors.length<50&&this.setState(function(e){e.errors.push(t)},"error"),this.syncRoomState("errorSync"),this.hmsNotifications.sendError(t),xt.e("received error from sdk",t instanceof i.HMSException?"".concat(t):t)}},{key:"handleTrackRemove",value:function(e,t){var r=this;this.setState(function(n){var o=n.peers[t.peerId],i=n.tracks,s=e.trackId;if(r.isSameStoreSDKTrack(s,null==o?void 0:o.audioTrack))null==o||delete o.audioTrack;else if(r.isSameStoreSDKTrack(s,null==o?void 0:o.videoTrack))null==o||delete o.videoTrack;else{var a=null==o?void 0:o.auxiliaryTracks.indexOf(s);a>-1&&r.isSameStoreSDKTrack(s,null==o?void 0:o.auxiliaryTracks[a])&&(null==o||o.auxiliaryTracks.splice(a,1))}delete i[s],delete r.hmsSDKTracks[s]},"trackRemoved")}},{key:"setEnabledSDKTrack",value:function(e,t){return B(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=this.hmsSDKTracks[e])){r.next=6;break}return r.next=4,n.setEnabled(t);case 4:r.next=7;break;case 6:this.logPossibleInconsistency("track ".concat(e," not present, unable to enabled/disable"));case 7:case"end":return r.stop()}},r,this)}))}},{key:"setSDKLocalVideoTrackSettings",value:function(e,t){return B(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=this.hmsSDKTracks[e])){r.next=6;break}return r.next=4,n.setSettings(t);case 4:r.next=7;break;case 6:this.logPossibleInconsistency("local track ".concat(e," not present, unable to set settings"));case 7:case"end":return r.stop()}},r,this)}))}},{key:"setSDKLocalAudioTrackSettings",value:function(e,t){return B(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=this.hmsSDKTracks[e])){r.next=6;break}return r.next=4,n.setSettings(t);case 4:r.next=7;break;case 6:this.logPossibleInconsistency("local track ".concat(e," not present, unable to set settings"));case 7:case"end":return r.stop()}},r,this)}))}},{key:"getMediaSettings",value:function(e){var t,r=this.store.getState(pe),n=e.audioTrack,o=e.videoTrack;return{audioInputDeviceId:(null==n?void 0:n.settings.deviceId)||r.audioInputDeviceId,videoInputDeviceId:(null==o?void 0:o.settings.deviceId)||r.videoInputDeviceId,audioOutputDeviceId:null==(t=this.sdk.getAudioOutput().getDevice())?void 0:t.deviceId}}},{key:"getPreviewFields",value:function(e){var t,r;if(e.isInPreview()){var n=en.convertPeer(e);return{localPeer:n.id,audioTrack:n.audioTrack,videoTrack:n.videoTrack,asRole:(null==(t=e.asRole)?void 0:t.name)||(null==(r=e.role)?void 0:r.name)}}}},{key:"setTrackVolume",value:function(e,t){return B(this,null,h().mark(function r(){var n;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=this.hmsSDKTracks[t])){r.next=11;break}if(!(n instanceof i.HMSAudioTrack)){r.next=8;break}return r.next=5,n.setVolume(e);case 5:this.setState(function(r){var n=r.tracks[t];n&&"audio"===n.type&&(n.volume=e)},"trackVolume"),r.next=9;break;case 8:xt.w("track ".concat(t," is not an audio track"));case 9:r.next=12;break;case 11:this.logPossibleInconsistency("track ".concat(t," not present, unable to set volume"));case 12:case"end":return r.stop()}},r,this)}))}},{key:"localAndVideoUnmuting",value:function(e){var t=this.store.getState(be);if((null==t?void 0:t.videoTrack)!==e)return!1;var r=this.store.getState(Oe),n=this.store.getState(Ce);return r&&!n}},{key:"logPossibleInconsistency",value:function(e){xt.w("possible inconsistency detected - ",e)}},{key:"addRemoveVideoPlugin",value:function(e,t,r){return B(this,null,h().mark(function n(){var o,i;return h().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=3;break}return xt.w("Invalid plugin received in store"),n.abrupt("return");case 3:if(!(o=this.store.getState(De))){n.next=20;break}if(!(i=this.hmsSDKTracks[o])){n.next=19;break}if("add"!==t){n.next=12;break}return n.next=10,i.addPlugin(e,r);case 10:n.next=16;break;case 12:if(n.t0="remove"===t,!n.t0){n.next=16;break}return n.next=16,i.removePlugin(e);case 16:this.syncRoomState("".concat(t,"VideoPlugin")),n.next=20;break;case 19:this.logPossibleInconsistency("track ".concat(o," not present, unable to remove plugin"));case 20:case"end":return n.stop()}},n,this)}))}},{key:"addRemoveAudioPlugin",value:function(e,t){return B(this,null,h().mark(function r(){var n,o;return h().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(e){r.next=3;break}return xt.w("Invalid plugin received in store"),r.abrupt("return");case 3:if(!(n=this.store.getState(we))){r.next=20;break}if(!(o=this.hmsSDKTracks[n])){r.next=19;break}if("add"!==t){r.next=12;break}return r.next=10,o.addPlugin(e);case 10:r.next=16;break;case 12:if(r.t0="remove"===t,!r.t0){r.next=16;break}return r.next=16,o.removePlugin(e);case 16:this.syncRoomState("".concat(t,"AudioPlugin")),r.next=20;break;case 19:this.logPossibleInconsistency("track ".concat(n," not present, unable to remove plugin"));case 20:case"end":return r.stop()}},r,this)}))}},{key:"isSameStoreSDKTrack",value:function(e,t){var r;return!!t&&(null==(r=this.hmsSDKTracks[t])?void 0:r.trackId)===e}},{key:"onRoleChangeRequest",value:function(e){this.setState(function(t){0===t.roleChangeRequests.length&&t.roleChangeRequests.push(en.convertRoleChangeRequest(e))},"roleChangeRequest")}},{key:"removeRoleChangeRequest",value:function(e){this.setState(function(t){var r=t.roleChangeRequests.findIndex(function(t){return t.token===e.token});-1!==r&&t.roleChangeRequests.splice(r,1)},"removeRoleChangeRequest")}},{key:"onRoleUpdate",value:function(){this.syncRoomState("roleUpdate")}},{key:"getStoreLocalTrackIDfromSDKTrack",value:function(e){var t=this;return this.store.getState(Ie).find(function(r){return t.hmsSDKTracks[r].trackId===e.trackId})}},{key:"setSessionStoreValueLocally",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"setSessionStore",r=Array.isArray(e)?e:[e];this.setState(function(e){r.forEach(function(t){e.sessionStore[t.key]=t.value})},t)}}]),e}(),sn=function(e){return i.isBrowser?"".concat(e," ").concat(document.title):e},an=function(){function e(t,r,n){v(this,e),this.store=t,this.actions=r,this.notifications=n}return S(e,[{key:"getStore",value:function(){return this.store}},{key:"getActions",value:function(){return this.actions}},{key:"getNotifications",value:function(){return{onNotification:this.notifications.onNotification}}}]),e}();exports.BeamControllerStore=an;var cn=function(e,t,r){var n;r.getState(Qe)===E.Connected&&(n=un(e,t,r)),r.subscribe(function(o){[E.Connected,E.Reconnecting].includes(o)?n||(n=un(e,t,r)):[E.Disconnected,E.Failed].includes(o)&&n&&(fn(t,o),n(),n=void 0)},Qe)},un=function(e,t,r){var n,o,i=ln(r,t);null==(n=e.getWebrtcInternals())||n.start();var s=null==(o=e.getWebrtcInternals())?void 0:o.onStatsChange(function(n){return dn(t,n,r,e)});return function(){i(),s&&s()}},ln=function(e,t){var r,n,o;return e.getState(Te)?t.namedSetState(function(t){t.localPeer.id=e.getState(Te)},"localpeer-id"):r=e.subscribe(function(e){e&&t.namedSetState(function(t){t.localPeer.id=e},"localpeer-id")},Te),e.getState(De)?t.namedSetState(function(t){t.localPeer.videoTrack=e.getState(De)},"localpeer-videotrack-id"):n=e.subscribe(function(e){e&&t.namedSetState(function(t){t.localPeer.videoTrack=e},"localpeer-videotrack-id")},De),e.getState(we)?t.namedSetState(function(t){t.localPeer.audioTrack=e.getState(we)},"localpeer-audiotrack-id"):o=e.subscribe(function(e){e&&t.namedSetState(function(t){t.localPeer.audioTrack=e},"localpeer-audiotrack-id")},we),function(){null==r||r(),null==n||n(),null==o||o()}},dn=function(e,t,r,n){var o=r.getState(fe);e.namedSetState(function(e){var i,s=r.getState(Te),a={},c=R(Object.keys(o).filter(function(e){return o[e].peerId!==s}));try{for(c.s();!(i=c.n()).done;){var u=i.value,l=t.getRemoteTrackStats(u);l&&(a[u]=l)}}catch(f){c.e(f)}finally{c.f()}Qr(e.remoteTrackStats,a);var d=b({},s,t.getLocalPeerStats());Qr(e.peerStats,d),Jr(e.localTrackStats,t.getLocalTrackStats(),n.store.getLocalPeerTracks())},"webrtc-stats")},fn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"resetState";e.namedSetState(function(e){Object.assign(e,Q())},t)},pn=S(function e(t,r){var n=this;v(this,e),this.hmsStore=t,this.sdk=r,this.store=Kn.createNewHMSStore(sn("HMSStatsStore"),Q),this.getState=this.store.getState,this.subscribe=this.store.subscribe,this.getPublishPeerConnection=function(){return new Promise(function(e){var t,r;"Connected"===n.hmsStore.getState(Qe)?e(null==(r=null==(t=n.sdk)?void 0:t.getWebrtcInternals())?void 0:r.getPublishPeerConnection()):n.hmsStore.subscribe(function(t){var r,o;"Connected"===t&&e(null==(o=null==(r=n.sdk)?void 0:r.getWebrtcInternals())?void 0:o.getPublishPeerConnection())},Qe)})},this.getSubscribePeerConnection=function(){return new Promise(function(e){var t,r;"Connected"===n.hmsStore.getState(Qe)?e(null==(r=null==(t=n.sdk)?void 0:t.getWebrtcInternals())?void 0:r.getSubscribePeerConnection()):n.hmsStore.subscribe(function(t){var r,o;"Connected"===t&&e(null==(o=null==(r=n.sdk)?void 0:r.getWebrtcInternals())?void 0:o.getSubscribePeerConnection())},Qe)})},this.sdk&&cn(this.sdk,this.store,this.hmsStore)});exports.HMSStats=pn;var hn=function(e){return e.localPeer.id},vn=function(e){return e.localPeer.audioTrack},yn=function(e){return e.localPeer.videoTrack},Sn=function(e,t){return t},kn=function(e,t){return t},gn=function(e){return e.remoteTrackStats},mn=function(e){return e.peerStats},xn=function(e){return e.localTrackStats},bn=(0,a.createSelector)([mn,hn],function(e,t){return e[t]}),Tn=(0,a.createSelector)(bn,function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.packetsLost}),Pn=(0,a.createSelector)(bn,function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.jitter}),Rn=(0,a.createSelector)(bn,function(e){var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bitrate}),wn=(0,a.createSelector)(bn,function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bitrate}),Dn=(0,a.createSelector)(bn,function(e){var t;return null==(t=null==e?void 0:e.publish)?void 0:t.availableOutgoingBitrate}),En=(0,a.createSelector)(bn,function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.availableIncomingBitrate}),In=(0,a.createSelector)(bn,function(e){var t;return null==(t=null==e?void 0:e.publish)?void 0:t.bytesSent}),Mn=(0,a.createSelector)(bn,function(e){var t;return null==(t=null==e?void 0:e.subscribe)?void 0:t.bytesReceived}),An=(0,a.createSelector)([mn,Sn],function(e,t){return t?e[t]:void 0}),Ln=(0,a.createSelector)([gn,kn],function(e,t){return t?e[t]:void 0}),Cn=(0,a.createSelector)([xn,kn],function(e,t){return t?e[t]:void 0}),On=gt(An),Nn=gt(Ln),_n=(0,a.createSelector)([xn,vn],function(e,t){var r;return t?null==(r=e[t])?void 0:r[0]:void 0}),Un=gt((0,a.createSelector)(Cn,function(e){return null==e?void 0:e[0]})),Hn=(0,a.createSelector)([xn,yn],function(e,t){var r;return t?null==(r=e[t])?void 0:r[0]:void 0}),Bn=gt((0,a.createSelector)(Cn,function(e){return e})),jn=function(e){return gt((0,a.createSelector)(Cn,function(t){var r=Object.keys(i.simulcastMapping).find(function(t){return i.simulcastMapping[t]===e});return e&&(null==t?void 0:t.find(function(e){return e.rid===r}))||(null==t?void 0:t[0])}))},Vn={localPeerStats:bn,packetsLost:Tn,jitter:Pn,publishBitrate:Rn,subscribeBitrate:wn,availablePublishBitrate:Dn,availableSubscribeBitrate:En,totalBytesSent:In,totalBytesReceived:Mn,peerStatsByID:On,trackStatsByID:Nn,localAudioTrackStatsByID:Un,localVideoTrackStatsByID:Bn,localVideoTrackStatsByLayer:jn,localAudioTrackStats:_n,localVideoTrackStats:Hn};exports.selectHMSStats=Vn;var Kn=function(){function e(t,r,n){var o=this;v(this,e),this.getStats=function(){return o.stats||(o.stats=new pn(o.store,o.sdk)),o.stats},this.store=t||e.createNewHMSStore(sn("HMSStore"),G),this.notifications=n||new Kr(this.store),r?this.actions=r:(this.sdk=new i.HMSSdk,this.actions=new on(this.store,this.sdk,this.notifications)),this.actions.setFrameworkInfo({type:"js",sdkVersion:j().version}),this.initialTriggerOnSubscribe=!1,i.isBrowser&&(window.__hms=this,window.__beam=new an(this.store,this.actions,this.notifications))}return S(e,[{key:"triggerOnSubscribe",value:function(){this.initialTriggerOnSubscribe||(e.makeStoreTriggerOnSubscribe(this.store),this.initialTriggerOnSubscribe=!0)}},{key:"getStore",value:function(){return this.store}},{key:"getHMSActions",value:function(){return this.actions}},{key:"getActions",value:function(){return this.actions}},{key:"getNotifications",value:function(){return{onNotification:this.notifications.onNotification}}}],[{key:"createNewHMSStore",value:function(t,n){var i=(0,o.default)(function(){return n()}),s=i.setState;i.setState=function(e){var t="function"==typeof e?(0,r.default)(e):e;s(t)};var a=i.getState;i.getState=function(e){return e?e(a()):a()},e.compareWithShallowCheckInSubscribe(i);var c=e.setUpDevtools(i,t);return U(_({},i),{namedSetState:c})}},{key:"makeStoreTriggerOnSubscribe",value:function(e){var t=e.subscribe;e.subscribe=function(r,n,o){return r(e.getState(n),void 0),t(r,n,o)}}},{key:"compareWithShallowCheckInSubscribe",value:function(e){var t=e.subscribe;e.subscribe=function(e,r,o){return r||(r=function(e){return e}),o=o||n.default,t(e,r,o)}}},{key:"setUpDevtools",value:function(t,r){var n;try{n=window.__REDUX_DEVTOOLS_EXTENSION__||window.top.__REDUX_DEVTOOLS_EXTENSION__}catch(s){}if(!n)return function(e){t.setState(e)};var o=n.connect(e.devtoolsOptions(r));o.prefix=r?"".concat(r," > "):"";var i=t.setState;return t.setState=function(e){i(e),o.send("".concat(o.prefix,"setState"),t.getState())},o.subscribe(e.devtoolsSubscribe(o,t,i)),o.send("setUpStore",t.getState()),function(e,r){i(e);var n=r||"".concat(o.prefix,"action");o.send(n,t.getState())}}},{key:"devtoolsOptions",value:function(e){return{name:e,actionsBlacklist:["audioLevel","playlistProgress","connectionQuality"]}}},{key:"devtoolsSubscribe",value:function(e,t,r){return function(n){var o,i,s,a;if("DISPATCH"===n.type&&n.state)["JUMP_TO_ACTION","JUMP_TO_STATE"].includes(n.payload.type)?r(JSON.parse(n.state)):t.setState(JSON.parse(n.state));else if("DISPATCH"===n.type&&"COMMIT"===(null==(o=n.payload)?void 0:o.type))e.init(t.getState());else if("DISPATCH"===n.type&&"IMPORT_STATE"===(null==(i=n.payload)?void 0:i.type)){var c=null==(s=n.payload.nextLiftedState)?void 0:s.actionsById;((null==(a=n.payload.nextLiftedState)?void 0:a.computedStates)||[]).forEach(function(n,o){var i=n.state,s=c[o]||"".concat(e.prefix,"setState");0===o?e.init(i):(r(i),e.send(s,t.getState()))})}}}}]),e}();exports.HMSReactiveStore=Kn;
},{"immer":"mkVv","zustand/shallow":"J5wV","zustand/vanilla":"UWKb","@100mslive/hms-video":"ZYu2","eventemitter2":"x3aR","reselect":"K9HF"}],"HlZQ":[function(require,module,exports) {
var global = arguments[3];
var process = require("process");
var define;
var e,t=arguments[3],n=require("process");!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(t,n){"use strict";var r=[],i=Object.getPrototypeOf,o=r.slice,a=r.flat?function(e){return r.flat.call(e)}:function(e){return r.concat.apply([],e)},s=r.push,u=r.indexOf,l={},c=l.toString,f=l.hasOwnProperty,p=f.toString,d=p.call(Object),h={},g=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType&&"function"!=typeof e.item},v=function(e){return null!=e&&e===e.window},y=t.document,m={type:!0,src:!0,nonce:!0,noModule:!0};function x(e,t,n){var r,i,o=(n=n||y).createElement("script");if(o.text=e,t)for(r in m)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function b(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[c.call(e)]||"object":typeof e}var w=function(e,t){return new w.fn.init(e,t)};function T(e){var t=!!e&&"length"in e&&e.length,n=b(e);return!g(e)&&!v(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}w.fn=w.prototype={jquery:"3.6.4",constructor:w,length:0,toArray:function(){return o.call(this)},get:function(e){return null==e?o.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return w.each(this,e)},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(w.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(w.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:r.sort,splice:r.splice},w.extend=w.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||g(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(w.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||w.isPlainObject(n)?n:{},i=!1,a[t]=w.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},w.extend({expando:"jQuery"+("3.6.4"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==c.call(e))&&(!(t=i(e))||"function"==typeof(n=f.call(t,"constructor")&&t.constructor)&&p.call(n)===d)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){x(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(T(e))for(n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var n=t||[];return null!=e&&(T(Object(e))?w.merge(n,"string"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:u.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,s=[];if(T(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&s.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&s.push(i);return a(s)},guid:1,support:h}),"function"==typeof Symbol&&(w.fn[Symbol.iterator]=r[Symbol.iterator]),w.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});var C=function(e){var t,n,r,i,o,a,s,u,l,c,f,p,d,h,g,v,y,m,x,b="sizzle"+1*new Date,w=e.document,T=0,C=0,E=ue(),S=ue(),k=ue(),A=ue(),N=function(e,t){return e===t&&(f=!0),0},j={}.hasOwnProperty,D=[],q=D.pop,L=D.push,H=D.push,O=D.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",F=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",$=new RegExp(M+"+","g"),B=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp(F),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+F),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+M+"?|\\\\([^\\r\\n\\f])","g"),ne=function(e,t){var n="0x"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){p()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(D=O.call(w.childNodes),w.childNodes),D[w.childNodes.length].nodeType}catch(Se){H={apply:D.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}function se(e,t,r,i){var o,s,l,c,f,h,y,m=t&&t.ownerDocument,w=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==w&&9!==w&&11!==w)return r;if(!i&&(p(t),t=t||d,g)){if(11!==w&&(f=Z.exec(e)))if(o=f[1]){if(9===w){if(!(l=t.getElementById(o)))return r;if(l.id===o)return r.push(l),r}else if(m&&(l=m.getElementById(o))&&x(t,l)&&l.id===o)return r.push(l),r}else{if(f[2])return H.apply(r,t.getElementsByTagName(e)),r;if((o=f[3])&&n.getElementsByClassName&&t.getElementsByClassName)return H.apply(r,t.getElementsByClassName(o)),r}if(n.qsa&&!A[e+" "]&&(!v||!v.test(e))&&(1!==w||"object"!==t.nodeName.toLowerCase())){if(y=e,m=t,1===w&&(U.test(e)||z.test(e))){for((m=ee.test(e)&&ye(t.parentNode)||t)===t&&n.scope||((c=t.getAttribute("id"))?c=c.replace(re,ie):t.setAttribute("id",c=b)),s=(h=a(e)).length;s--;)h[s]=(c?"#"+c:":scope")+" "+xe(h[s]);y=h.join(",")}try{return H.apply(r,m.querySelectorAll(y)),r}catch(T){A(e,!0)}finally{c===b&&t.removeAttribute("id")}}}return u(e.replace(B,"$1"),t,r,i)}function ue(){var e=[];return function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}}function le(e){return e[b]=!0,e}function ce(e){var t=d.createElement("fieldset");try{return!!e(t)}catch(Se){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){for(var n=e.split("|"),i=n.length;i--;)r.attrHandle[n[i]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function de(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function he(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ge(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&ae(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ve(e){return le(function(t){return t=+t,le(function(n,r){for(var i,o=e([],n.length,t),a=o.length;a--;)n[i=o[a]]&&(n[i]=!(r[i]=n[i]))})})}function ye(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in n=se.support={},o=se.isXML=function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},p=se.setDocument=function(e){var t,i,a=e?e.ownerDocument||e:w;return a!=d&&9===a.nodeType&&a.documentElement?(h=(d=a).documentElement,g=!o(d),w!=d&&(i=d.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",oe,!1):i.attachEvent&&i.attachEvent("onunload",oe)),n.scope=ce(function(e){return h.appendChild(e).appendChild(d.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length}),n.cssHas=ce(function(){try{return d.querySelector(":has(*,:jqfake)"),!1}catch(Se){return!0}}),n.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ce(function(e){return e.appendChild(d.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=K.test(d.getElementsByClassName),n.getById=ce(function(e){return h.appendChild(e).id=b,!d.getElementsByName||!d.getElementsByName(b).length}),n.getById?(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n=t.getElementById(e);return n?[n]:[]}}):(r.filter.ID=function(e){var t=e.replace(te,ne);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];for(i=t.getElementsByName(e),r=0;o=i[r++];)if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),r.find.TAG=n.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},y=[],v=[],(n.qsa=K.test(d.querySelectorAll))&&(ce(function(e){var t;h.appendChild(e).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+b+"-]").length||v.push("~="),(t=d.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||v.push("\\["+M+"*name"+M+"*="+M+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+b+"+*").length||v.push(".#.+[+~]"),e.querySelectorAll("\\\f"),v.push("[\\r\\n\\f]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=d.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),h.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(n.matchesSelector=K.test(m=h.matches||h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ce(function(e){n.disconnectedMatch=m.call(e,"*"),m.call(e,"[s!='']:x"),y.push("!=",F)}),n.cssHas||v.push(":has"),v=v.length&&new RegExp(v.join("|")),y=y.length&&new RegExp(y.join("|")),t=K.test(h.compareDocumentPosition),x=t||K.test(h.contains)?function(e,t){var n=9===e.nodeType&&e.documentElement||e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},N=t?function(e,t){if(e===t)return f=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!n.sortDetached&&t.compareDocumentPosition(e)===r?e==d||e.ownerDocument==w&&x(w,e)?-1:t==d||t.ownerDocument==w&&x(w,t)?1:c?P(c,e)-P(c,t):0:4&r?-1:1)}:function(e,t){if(e===t)return f=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e==d?-1:t==d?1:i?-1:o?1:c?P(c,e)-P(c,t):0;if(i===o)return pe(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)s.unshift(n);for(;a[r]===s[r];)r++;return r?pe(a[r],s[r]):a[r]==w?-1:s[r]==w?1:0},d):d},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if(p(e),n.matchesSelector&&g&&!A[t+" "]&&(!y||!y.test(t))&&(!v||!v.test(t)))try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(Se){A(t,!0)}return se(t,d,null,[e]).length>0},se.contains=function(e,t){return(e.ownerDocument||e)!=d&&p(e),x(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!=d&&p(e);var i=r.attrHandle[t.toLowerCase()],o=i&&j.call(r.attrHandle,t.toLowerCase())?i(e,t,!g):void 0;return void 0!==o?o:n.attributes||!g?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,r=[],i=0,o=0;if(f=!n.detectDuplicates,c=!n.sortStable&&e.slice(0),e.sort(N),f){for(;t=e[o++];)t===e[o]&&(i=r.push(o));for(;i--;)e.splice(r[i],1)}return c=null,e},i=se.getText=function(e){var t,n="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)n+=i(t);return n},(r=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=a(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&E(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=se.attr(r,e);return null==i?"!="===t:!t||(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace($," ")+" ").indexOf(n)>-1:"|="===t&&(i===n||i.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,f,p,d,h,g=o!==a?"nextSibling":"previousSibling",v=t.parentNode,y=s&&t.nodeName.toLowerCase(),m=!u&&!s,x=!1;if(v){if(o){for(;g;){for(p=t;p=p[g];)if(s?p.nodeName.toLowerCase()===y:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[a?v.firstChild:v.lastChild],a&&m){for(x=(d=(l=(c=(f=(p=v)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1])&&l[2],p=d&&v.childNodes[d];p=++d&&p&&p[g]||(x=d=0)||h.pop();)if(1===p.nodeType&&++x&&p===t){c[e]=[T,d,x];break}}else if(m&&(x=d=(l=(c=(f=(p=t)[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]||[])[0]===T&&l[1]),!1===x)for(;(p=++d&&p&&p[g]||(x=d=0)||h.pop())&&((s?p.nodeName.toLowerCase()!==y:1!==p.nodeType)||!++x||(m&&((c=(f=p[b]||(p[b]={}))[p.uniqueID]||(f[p.uniqueID]={}))[e]=[T,x]),p!==t)););return(x-=i)===r||x%r==0&&x/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return i[b]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,n){for(var r,o=i(e,t),a=o.length;a--;)e[r=P(e,o[a])]=!(n[r]=o[a])}):function(e){return i(e,0,n)}):i}},pseudos:{not:le(function(e){var t=[],n=[],r=s(e.replace(B,"$1"));return r[b]?le(function(e,t,n,i){for(var o,a=r(e,null,i,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,r(t,null,o,n),t[0]=null,!n.pop()}}),has:le(function(e){return function(t){return se(e,t).length>0}}),contains:le(function(e){return e=e.replace(te,ne),function(t){return(t.textContent||i(t)).indexOf(e)>-1}}),lang:le(function(e){return V.test(e||"")||se.error("unsupported lang: "+e),e=e.replace(te,ne).toLowerCase(),function(t){var n;do{if(n=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:n>t?t:n;--r>=0;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=de(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=he(t);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(e,t,n){var r=t.dir,i=t.next,o=i||r,a=n&&"parentNode"===o,s=C++;return t.first?function(t,n,i){for(;t=t[r];)if(1===t.nodeType||a)return e(t,n,i);return!1}:function(t,n,u){var l,c,f,p=[T,s];if(u){for(;t=t[r];)if((1===t.nodeType||a)&&e(t,n,u))return!0}else for(;t=t[r];)if(1===t.nodeType||a)if(c=(f=t[b]||(t[b]={}))[t.uniqueID]||(f[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[r]||t;else{if((l=c[o])&&l[0]===T&&l[1]===s)return p[2]=l[2];if(c[o]=p,p[2]=e(t,n,u))return!0}return!1}}function we(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(e,t,n,r,i,o){return r&&!r[b]&&(r=Ce(r)),i&&!i[b]&&(i=Ce(i,o)),le(function(o,a,s,u){var l,c,f,p=[],d=[],h=a.length,g=o||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(t||"*",s.nodeType?[s]:s,[]),v=!e||!o&&t?g:Te(g,p,e,s,u),y=n?i||(o?e:h||r)?[]:a:v;if(n&&n(v,y,s,u),r)for(l=Te(y,d),r(l,[],s,u),c=l.length;c--;)(f=l[c])&&(y[d[c]]=!(v[d[c]]=f));if(o){if(i||e){if(i){for(l=[],c=y.length;c--;)(f=y[c])&&l.push(v[c]=f);i(null,y=[],l,u)}for(c=y.length;c--;)(f=y[c])&&(l=i?P(o,f):p[c])>-1&&(o[l]=!(a[l]=f))}}else y=Te(y===a?y.splice(h,y.length):y),i?i(null,a,y,u):H.apply(a,y)})}function Ee(e){for(var t,n,i,o=e.length,a=r.relative[e[0].type],s=a||r.relative[" "],u=a?1:0,c=be(function(e){return e===t},s,!0),f=be(function(e){return P(t,e)>-1},s,!0),p=[function(e,n,r){var i=!a&&(r||n!==l)||((t=n).nodeType?c(e,n,r):f(e,n,r));return t=null,i}];u<o;u++)if(n=r.relative[e[u].type])p=[be(we(p),n)];else{if((n=r.filter[e[u].type].apply(null,e[u].matches))[b]){for(i=++u;i<o&&!r.relative[e[i].type];i++);return Ce(u>1&&we(p),u>1&&xe(e.slice(0,u-1).concat({value:" "===e[u-2].type?"*":""})).replace(B,"$1"),n,u<i&&Ee(e.slice(u,i)),i<o&&Ee(e=e.slice(i)),i<o&&xe(e))}p.push(n)}return we(p)}return me.prototype=r.filters=r.pseudos,r.setFilters=new me,a=se.tokenize=function(e,t){var n,i,o,a,s,u,l,c=S[e+" "];if(c)return t?0:c.slice(0);for(s=e,u=[],l=r.preFilter;s;){for(a in n&&!(i=_.exec(s))||(i&&(s=s.slice(i[0].length)||s),u.push(o=[])),n=!1,(i=z.exec(s))&&(n=i.shift(),o.push({value:n,type:i[0].replace(B," ")}),s=s.slice(n.length)),r.filter)!(i=G[a].exec(s))||l[a]&&!(i=l[a](i))||(n=i.shift(),o.push({value:n,type:a,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?se.error(e):S(e,u).slice(0)},s=se.compile=function(e,t){var n,i=[],o=[],s=k[e+" "];if(!s){for(t||(t=a(e)),n=t.length;n--;)(s=Ee(t[n]))[b]?i.push(s):o.push(s);(s=k(e,function(e,t){var n=t.length>0,i=e.length>0,o=function(o,a,s,u,c){var f,h,v,y=0,m="0",x=o&&[],b=[],w=l,C=o||i&&r.find.TAG("*",c),E=T+=null==w?1:Math.random()||.1,S=C.length;for(c&&(l=a==d||a||c);m!==S&&null!=(f=C[m]);m++){if(i&&f){for(h=0,a||f.ownerDocument==d||(p(f),s=!g);v=e[h++];)if(v(f,a||d,s)){u.push(f);break}c&&(T=E)}n&&((f=!v&&f)&&y--,o&&x.push(f))}if(y+=m,n&&m!==y){for(h=0;v=t[h++];)v(x,b,a,s);if(o){if(y>0)for(;m--;)x[m]||b[m]||(b[m]=q.call(u));b=Te(b)}H.apply(u,b),c&&!o&&b.length>0&&y+t.length>1&&se.uniqueSort(u)}return c&&(T=E,l=w),x};return n?le(o):o}(o,i))).selector=e}return s},u=se.select=function(e,t,n,i){var o,u,l,c,f,p="function"==typeof e&&e,d=!i&&a(e=p.selector||e);if(n=n||[],1===d.length){if((u=d[0]=d[0].slice(0)).length>2&&"ID"===(l=u[0]).type&&9===t.nodeType&&g&&r.relative[u[1].type]){if(!(t=(r.find.ID(l.matches[0].replace(te,ne),t)||[])[0]))return n;p&&(t=t.parentNode),e=e.slice(u.shift().value.length)}for(o=G.needsContext.test(e)?0:u.length;o--&&(l=u[o],!r.relative[c=l.type]);)if((f=r.find[c])&&(i=f(l.matches[0].replace(te,ne),ee.test(u[0].type)&&ye(t.parentNode)||t))){if(u.splice(o,1),!(e=i.length&&xe(u)))return H.apply(n,i),n;break}}return(p||s(e,d))(i,t,!g,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},n.sortStable=b.split("").sort(N).join("")===b,n.detectDuplicates=!!f,p(),n.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(d.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(t);w.find=C,w.expr=C.selectors,w.expr[":"]=w.expr.pseudos,w.uniqueSort=w.unique=C.uniqueSort,w.text=C.getText,w.isXMLDoc=C.isXML,w.contains=C.contains,w.escapeSelector=C.escape;var E=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&w(e).is(n))break;r.push(e)}return r},S=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},k=w.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var N=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,t,n){return g(t)?w.grep(e,function(e,r){return!!t.call(e,r,e)!==n}):t.nodeType?w.grep(e,function(e){return e===t!==n}):"string"!=typeof t?w.grep(e,function(e){return u.call(t,e)>-1!==n}):w.filter(t,e,n)}w.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?w.find.matchesSelector(r,e)?[r]:[]:w.find.matches(e,w.grep(t,function(e){return 1===e.nodeType}))},w.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(w(e).filter(function(){for(t=0;t<r;t++)if(w.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)w.find(e,i[t],n);return r>1?w.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&k.test(e)?w(e):e||[],!1).length}});var D,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(w.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||D,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:q.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof w?t[0]:t,w.merge(this,w.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:y,!0)),N.test(r[1])&&w.isPlainObject(t))for(r in t)g(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=y.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):g(e)?void 0!==n.ready?n.ready(e):e(w):w.makeArray(e,this)}).prototype=w.fn,D=w(y);var L=/^(?:parents|prev(?:Until|All))/,H={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}w.fn.extend({has:function(e){var t=w(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(w.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&w(e);if(!k.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?a.index(n)>-1:1===n.nodeType&&w.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?w.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?u.call(w(e),this[0]):u.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(w.uniqueSort(w.merge(this.get(),w(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),w.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return E(e,"parentNode")},parentsUntil:function(e,t,n){return E(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return E(e,"nextSibling")},prevAll:function(e){return E(e,"previousSibling")},nextUntil:function(e,t,n){return E(e,"nextSibling",n)},prevUntil:function(e,t,n){return E(e,"previousSibling",n)},siblings:function(e){return S((e.parentNode||{}).firstChild,e)},children:function(e){return S(e.firstChild)},contents:function(e){return null!=e.contentDocument&&i(e.contentDocument)?e.contentDocument:(A(e,"template")&&(e=e.content||e),w.merge([],e.childNodes))}},function(e,t){w.fn[e]=function(n,r){var i=w.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=w.filter(r,i)),this.length>1&&(H[e]||w.uniqueSort(i),L.test(e)&&i.reverse()),this.pushStack(i)}});var P=/[^\x20\t\r\n\f]+/g;function R(e){return e}function M(e){throw e}function I(e,t,n,r){var i;try{e&&g(i=e.promise)?i.call(e).done(t).fail(n):e&&g(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}w.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return w.each(e.match(P)||[],function(e,n){t[n]=!0}),t}(e):w.extend({},e);var t,n,r,i,o=[],a=[],s=-1,u=function(){for(i=i||e.once,r=t=!0;a.length;s=-1)for(n=a.shift();++s<o.length;)!1===o[s].apply(n[0],n[1])&&e.stopOnFalse&&(s=o.length,n=!1);e.memory||(n=!1),t=!1,i&&(o=n?[]:"")},l={add:function(){return o&&(n&&!t&&(s=o.length-1,a.push(n)),function t(n){w.each(n,function(n,r){g(r)?e.unique&&l.has(r)||o.push(r):r&&r.length&&"string"!==b(r)&&t(r)})}(arguments),n&&!t&&u()),this},remove:function(){return w.each(arguments,function(e,t){for(var n;(n=w.inArray(t,o,n))>-1;)o.splice(n,1),n<=s&&s--}),this},has:function(e){return e?w.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return i=a=[],o=n="",this},disabled:function(){return!o},lock:function(){return i=a=[],n||t||(o=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=[e,(n=n||[]).slice?n.slice():n],a.push(n),t||u()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},w.extend({Deferred:function(e){var n=[["notify","progress",w.Callbacks("memory"),w.Callbacks("memory"),2],["resolve","done",w.Callbacks("once memory"),w.Callbacks("once memory"),0,"resolved"],["reject","fail",w.Callbacks("once memory"),w.Callbacks("once memory"),1,"rejected"]],r="pending",i={state:function(){return r},always:function(){return o.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return w.Deferred(function(t){w.each(n,function(n,r){var i=g(e[r[4]])&&e[r[4]];o[r[1]](function(){var e=i&&i.apply(this,arguments);e&&g(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[r[0]+"With"](this,i?[e]:arguments)})}),e=null}).promise()},then:function(e,r,i){var o=0;function a(e,n,r,i){return function(){var s=this,u=arguments,l=function(){var t,l;if(!(e<o)){if((t=r.apply(s,u))===n.promise())throw new TypeError("Thenable self-resolution");l=t&&("object"==typeof t||"function"==typeof t)&&t.then,g(l)?i?l.call(t,a(o,n,R,i),a(o,n,M,i)):(o++,l.call(t,a(o,n,R,i),a(o,n,M,i),a(o,n,R,n.notifyWith))):(r!==R&&(s=void 0,u=[t]),(i||n.resolveWith)(s,u))}},c=i?l:function(){try{l()}catch(t){w.Deferred.exceptionHook&&w.Deferred.exceptionHook(t,c.stackTrace),e+1>=o&&(r!==M&&(s=void 0,u=[t]),n.rejectWith(s,u))}};e?c():(w.Deferred.getStackHook&&(c.stackTrace=w.Deferred.getStackHook()),t.setTimeout(c))}}return w.Deferred(function(t){n[0][3].add(a(0,t,g(i)?i:R,t.notifyWith)),n[1][3].add(a(0,t,g(e)?e:R)),n[2][3].add(a(0,t,g(r)?r:M))}).promise()},promise:function(e){return null!=e?w.extend(e,i):i}},o={};return w.each(n,function(e,t){var a=t[2],s=t[5];i[t[1]]=a.add,s&&a.add(function(){r=s},n[3-e][2].disable,n[3-e][3].disable,n[0][2].lock,n[0][3].lock),a.add(t[3].fire),o[t[0]]=function(){return o[t[0]+"With"](this===o?void 0:this,arguments),this},o[t[0]+"With"]=a.fireWith}),i.promise(o),e&&e.call(o,o),o},when:function(e){var t=arguments.length,n=t,r=Array(n),i=o.call(arguments),a=w.Deferred(),s=function(e){return function(n){r[e]=this,i[e]=arguments.length>1?o.call(arguments):n,--t||a.resolveWith(r,i)}};if(t<=1&&(I(e,a.done(s(n)).resolve,a.reject,!t),"pending"===a.state()||g(i[n]&&i[n].then)))return a.then();for(;n--;)I(i[n],s(n),a.reject);return a.promise()}});var W=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;w.Deferred.exceptionHook=function(e,n){t.console&&t.console.warn&&e&&W.test(e.name)&&t.console.warn("jQuery.Deferred exception: "+e.message,e.stack,n)},w.readyException=function(e){t.setTimeout(function(){throw e})};var F=w.Deferred();function $(){y.removeEventListener("DOMContentLoaded",$),t.removeEventListener("load",$),w.ready()}w.fn.ready=function(e){return F.then(e).catch(function(e){w.readyException(e)}),this},w.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--w.readyWait:w.isReady)||(w.isReady=!0,!0!==e&&--w.readyWait>0||F.resolveWith(y,[w]))}}),w.ready.then=F.then,"complete"===y.readyState||"loading"!==y.readyState&&!y.documentElement.doScroll?t.setTimeout(w.ready):(y.addEventListener("DOMContentLoaded",$),t.addEventListener("load",$));var B=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===b(n))for(s in i=!0,n)B(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,g(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(w(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},_=/^-ms-/,z=/-([a-z])/g;function U(e,t){return t.toUpperCase()}function X(e){return e.replace(_,"ms-").replace(z,U)}var V=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function G(){this.expando=w.expando+G.uid++}G.uid=1,G.prototype={cache:function(e){var t=e[this.expando];return t||(t={},V(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[X(t)]=n;else for(r in t)i[X(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][X(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(X):(t=X(t))in r?[t]:t.match(P)||[]).length;for(;n--;)delete r[t[n]]}(void 0===t||w.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!w.isEmptyObject(t)}};var Y=new G,Q=new G,J=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,K=/[A-Z]/g;function Z(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(K,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:J.test(e)?JSON.parse(e):e)}(n)}catch(i){}Q.set(e,t,n)}else n=void 0;return n}w.extend({hasData:function(e){return Q.hasData(e)||Y.hasData(e)},data:function(e,t,n){return Q.access(e,t,n)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,n){return Y.access(e,t,n)},_removeData:function(e,t){Y.remove(e,t)}}),w.fn.extend({data:function(e,t){var n,r,i,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(i=Q.get(o),1===o.nodeType&&!Y.get(o,"hasDataAttrs"))){for(n=a.length;n--;)a[n]&&0===(r=a[n].name).indexOf("data-")&&(r=X(r.slice(5)),Z(o,r,i[r]));Y.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each(function(){Q.set(this,e)}):B(this,function(t){var n;if(o&&void 0===t)return void 0!==(n=Q.get(o,e))?n:void 0!==(n=Z(o,e))?n:void 0;this.each(function(){Q.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){Q.remove(this,e)})}}),w.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Y.get(e,t),n&&(!r||Array.isArray(n)?r=Y.access(e,t,w.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=w.queue(e,t),r=n.length,i=n.shift(),o=w._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){w.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Y.get(e,n)||Y.access(e,n,{empty:w.Callbacks("once memory").add(function(){Y.remove(e,[t+"queue",n])})})}}),w.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?w.queue(this[0],e):void 0===t?this:this.each(function(){var n=w.queue(this,e,t);w._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&w.dequeue(this,e)})},dequeue:function(e){return this.each(function(){w.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=w.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)(n=Y.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var ee=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,te=new RegExp("^(?:([+-])=|)("+ee+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],re=y.documentElement,ie=function(e){return w.contains(e.ownerDocument,e)},oe={composed:!0};re.getRootNode&&(ie=function(e){return w.contains(e.ownerDocument,e)||e.getRootNode(oe)===e.ownerDocument});var ae=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&ie(e)&&"none"===w.css(e,"display")};function se(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return w.css(e,t,"")},u=s(),l=n&&n[3]||(w.cssNumber[t]?"":"px"),c=e.nodeType&&(w.cssNumber[t]||"px"!==l&&+u)&&te.exec(w.css(e,t));if(c&&c[3]!==l){for(u/=2,l=l||c[3],c=+u||1;a--;)w.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,w.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ue={};function le(e){var t,n=e.ownerDocument,r=e.nodeName,i=ue[r];return i||(t=n.body.appendChild(n.createElement(r)),i=w.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),ue[r]=i,i)}function ce(e,t){for(var n,r,i=[],o=0,a=e.length;o<a;o++)(r=e[o]).style&&(n=r.style.display,t?("none"===n&&(i[o]=Y.get(r,"display")||null,i[o]||(r.style.display="")),""===r.style.display&&ae(r)&&(i[o]=le(r))):"none"!==n&&(i[o]="none",Y.set(r,"display",n)));for(o=0;o<a;o++)null!=i[o]&&(e[o].style.display=i[o]);return e}w.fn.extend({show:function(){return ce(this,!0)},hide:function(){return ce(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){ae(this)?w(this).show():w(this).hide()})}});var fe,pe,de=/^(?:checkbox|radio)$/i,he=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ge=/^$|^module$|\/(?:java|ecma)script/i;fe=y.createDocumentFragment().appendChild(y.createElement("div")),(pe=y.createElement("input")).setAttribute("type","radio"),pe.setAttribute("checked","checked"),pe.setAttribute("name","t"),fe.appendChild(pe),h.checkClone=fe.cloneNode(!0).cloneNode(!0).lastChild.checked,fe.innerHTML="<textarea>x</textarea>",h.noCloneChecked=!!fe.cloneNode(!0).lastChild.defaultValue,fe.innerHTML="<option></option>",h.option=!!fe.lastChild;var ve={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ye(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?w.merge([e],n):n}function me(e,t){for(var n=0,r=e.length;n<r;n++)Y.set(e[n],"globalEval",!t||Y.get(t[n],"globalEval"))}ve.tbody=ve.tfoot=ve.colgroup=ve.caption=ve.thead,ve.th=ve.td,h.option||(ve.optgroup=ve.option=[1,"<select multiple='multiple'>","</select>"]);var xe=/<|&#?\w+;/;function be(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===b(o))w.merge(p,o.nodeType?[o]:o);else if(xe.test(o)){for(a=a||f.appendChild(t.createElement("div")),s=(he.exec(o)||["",""])[1].toLowerCase(),u=ve[s]||ve._default,a.innerHTML=u[1]+w.htmlPrefilter(o)+u[2],c=u[0];c--;)a=a.lastChild;w.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));for(f.textContent="",d=0;o=p[d++];)if(r&&w.inArray(o,r)>-1)i&&i.push(o);else if(l=ie(o),a=ye(f.appendChild(o),"script"),l&&me(a),n)for(c=0;o=a[c++];)ge.test(o.type||"")&&n.push(o);return f}var we=/^([^.]*)(?:\.(.+)|)/;function Te(){return!0}function Ce(){return!1}function Ee(e,t){return e===function(){try{return y.activeElement}catch(e){}}()==("focus"===t)}function Se(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Se(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Ce;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return w().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=w.guid++)),e.each(function(){w.event.add(this,t,i,r,n)})}function ke(e,t,n){n?(Y.set(e,t,!1),w.event.add(e,t,{namespace:!1,handler:function(e){var r,i,a=Y.get(this,t);if(1&e.isTrigger&&this[t]){if(a.length)(w.event.special[t]||{}).delegateType&&e.stopPropagation();else if(a=o.call(arguments),Y.set(this,t,a),r=n(this,t),this[t](),a!==(i=Y.get(this,t))||r?Y.set(this,t,!1):i={},a!==i)return e.stopImmediatePropagation(),e.preventDefault(),i&&i.value}else a.length&&(Y.set(this,t,{value:w.event.trigger(w.extend(a[0],w.Event.prototype),a.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Y.get(e,t)&&w.event.add(e,t,Te)}w.event={global:{},add:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.get(e);if(V(e))for(n.handler&&(n=(o=n).handler,i=o.selector),i&&w.find.matchesSelector(re,i),n.guid||(n.guid=w.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(t){return void 0!==w&&w.event.triggered!==t.type?w.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(P)||[""]).length;l--;)d=g=(s=we.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=w.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=w.event.special[d]||{},c=w.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&w.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(e,r,h,a)||e.addEventListener&&e.addEventListener(d,a)),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),w.event.global[d]=!0)},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Y.hasData(e)&&Y.get(e);if(v&&(u=v.events)){for(l=(t=(t||"").match(P)||[""]).length;l--;)if(d=g=(s=we.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){for(f=w.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;o--;)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||w.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)w.event.remove(e,d+t[l],n,r,!0);w.isEmptyObject(u)&&Y.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=w.event.fix(e),l=(Y.get(this,"events")||Object.create(null))[u.type]||[],c=w.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){for(a=w.event.handlers.call(this,u,l),t=0;(i=a[t++])&&!u.isPropagationStopped();)for(u.currentTarget=i.elem,n=0;(o=i.handlers[n++])&&!u.isImmediatePropagationStopped();)u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((w.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?w(i,this).index(l)>-1:w.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(e,t){Object.defineProperty(w.Event.prototype,e,{enumerable:!0,configurable:!0,get:g(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[w.expando]?e:new w.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return de.test(t.type)&&t.click&&A(t,"input")&&ke(t,"click",Te),!1},trigger:function(e){var t=this||e;return de.test(t.type)&&t.click&&A(t,"input")&&ke(t,"click"),!0},_default:function(e){var t=e.target;return de.test(t.type)&&t.click&&A(t,"input")&&Y.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},w.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},w.Event=function(e,t){if(!(this instanceof w.Event))return new w.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Te:Ce,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&w.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[w.expando]=!0},w.Event.prototype={constructor:w.Event,isDefaultPrevented:Ce,isPropagationStopped:Ce,isImmediatePropagationStopped:Ce,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Te,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Te,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Te,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},w.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},w.event.addProp),w.each({focus:"focusin",blur:"focusout"},function(e,t){w.event.special[e]={setup:function(){return ke(this,e,Ee),!1},trigger:function(){return ke(this,e),!0},_default:function(t){return Y.get(t.target,e)},delegateType:t}}),w.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){w.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=e.relatedTarget,i=e.handleObj;return r&&(r===this||w.contains(this,r))||(e.type=i.origType,n=i.handler.apply(this,arguments),e.type=t),n}}}),w.fn.extend({on:function(e,t,n,r){return Se(this,e,t,n,r)},one:function(e,t,n,r){return Se(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,w(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Ce),this.each(function(){w.event.remove(this,e,n,t)})}});var Ae=/<script|<style|<link/i,Ne=/checked\s*(?:[^=]|=\s*.checked.)/i,je=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function De(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&w(e).children("tbody")[0]||e}function qe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Le(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function He(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(Y.hasData(e)&&(s=Y.get(e).events))for(i in Y.remove(t,"handle events"),s)for(n=0,r=s[i].length;n<r;n++)w.event.add(t,i,s[i][n]);Q.hasData(e)&&(o=Q.access(e),a=w.extend({},o),Q.set(t,a))}}function Oe(e,t,n,r){t=a(t);var i,o,s,u,l,c,f=0,p=e.length,d=p-1,v=t[0],y=g(v);if(y||p>1&&"string"==typeof v&&!h.checkClone&&Ne.test(v))return e.each(function(i){var o=e.eq(i);y&&(t[0]=v.call(this,i,o.html())),Oe(o,t,n,r)});if(p&&(o=(i=be(t,e[0].ownerDocument,!1,e,r)).firstChild,1===i.childNodes.length&&(i=o),o||r)){for(u=(s=w.map(ye(i,"script"),qe)).length;f<p;f++)l=i,f!==d&&(l=w.clone(l,!0,!0),u&&w.merge(s,ye(l,"script"))),n.call(e[f],l,f);if(u)for(c=s[s.length-1].ownerDocument,w.map(s,Le),f=0;f<u;f++)l=s[f],ge.test(l.type||"")&&!Y.access(l,"globalEval")&&w.contains(c,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?w._evalUrl&&!l.noModule&&w._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},c):x(l.textContent.replace(je,""),l,c))}return e}function Pe(e,t,n){for(var r,i=t?w.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||w.cleanData(ye(r)),r.parentNode&&(n&&ie(r)&&me(ye(r,"script")),r.parentNode.removeChild(r));return e}w.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=ie(e);if(!(h.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||w.isXMLDoc(e)))for(a=ye(c),r=0,i=(o=ye(e)).length;r<i;r++)s=o[r],u=a[r],l=void 0,"input"===(l=u.nodeName.toLowerCase())&&de.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ye(e),a=a||ye(c),r=0,i=o.length;r<i;r++)He(o[r],a[r]);else He(e,c);return(a=ye(c,"script")).length>0&&me(a,!f&&ye(e,"script")),c},cleanData:function(e){for(var t,n,r,i=w.event.special,o=0;void 0!==(n=e[o]);o++)if(V(n)){if(t=n[Y.expando]){if(t.events)for(r in t.events)i[r]?w.event.remove(n,r):w.removeEvent(n,r,t.handle);n[Y.expando]=void 0}n[Q.expando]&&(n[Q.expando]=void 0)}}}),w.fn.extend({detach:function(e){return Pe(this,e,!0)},remove:function(e){return Pe(this,e)},text:function(e){return B(this,function(e){return void 0===e?w.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Oe(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||De(this,e).appendChild(e)})},prepend:function(){return Oe(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=De(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Oe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Oe(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(w.cleanData(ye(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return w.clone(this,e,t)})},html:function(e){return B(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ae.test(e)&&!ve[(he.exec(e)||["",""])[1].toLowerCase()]){e=w.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(w.cleanData(ye(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return Oe(this,arguments,function(t){var n=this.parentNode;w.inArray(this,e)<0&&(w.cleanData(ye(this)),n&&n.replaceChild(t,this))},e)}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){w.fn[e]=function(e){for(var n,r=[],i=w(e),o=i.length-1,a=0;a<=o;a++)n=a===o?this:this.clone(!0),w(i[a])[t](n),s.apply(r,n.get());return this.pushStack(r)}});var Re=new RegExp("^("+ee+")(?!px)[a-z%]+$","i"),Me=/^--/,Ie=function(e){var n=e.ownerDocument.defaultView;return n&&n.opener||(n=t),n.getComputedStyle(e)},We=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Fe=new RegExp(ne.join("|"),"i"),$e=new RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g");function Be(e,t,n){var r,i,o,a,s=Me.test(t),u=e.style;return(n=n||Ie(e))&&(a=n.getPropertyValue(t)||n[t],s&&a&&(a=a.replace($e,"$1")||void 0),""!==a||ie(e)||(a=w.style(e,t)),!h.pixelBoxStyles()&&Re.test(a)&&Fe.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=n.width,u.width=r,u.minWidth=i,u.maxWidth=o)),void 0!==a?a+"":a}function _e(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(c){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",c.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",re.appendChild(l).appendChild(c);var e=t.getComputedStyle(c);r="1%"!==e.top,u=12===n(e.marginLeft),c.style.right="60%",a=36===n(e.right),i=36===n(e.width),c.style.position="absolute",o=12===n(c.offsetWidth/3),re.removeChild(l),c=null}}function n(e){return Math.round(parseFloat(e))}var r,i,o,a,s,u,l=y.createElement("div"),c=y.createElement("div");c.style&&(c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",h.clearCloneStyle="content-box"===c.style.backgroundClip,w.extend(h,{boxSizingReliable:function(){return e(),i},pixelBoxStyles:function(){return e(),a},pixelPosition:function(){return e(),r},reliableMarginLeft:function(){return e(),u},scrollboxSize:function(){return e(),o},reliableTrDimensions:function(){var e,n,r,i;return null==s&&(e=y.createElement("table"),n=y.createElement("tr"),r=y.createElement("div"),e.style.cssText="position:absolute;left:-11111px;border-collapse:separate",n.style.cssText="border:1px solid",n.style.height="1px",r.style.height="9px",r.style.display="block",re.appendChild(e).appendChild(n).appendChild(r),i=t.getComputedStyle(n),s=parseInt(i.height,10)+parseInt(i.borderTopWidth,10)+parseInt(i.borderBottomWidth,10)===n.offsetHeight,re.removeChild(e)),s}}))}();var ze=["Webkit","Moz","ms"],Ue=y.createElement("div").style,Xe={};function Ve(e){var t=w.cssProps[e]||Xe[e];return t||(e in Ue?e:Xe[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),n=ze.length;n--;)if((e=ze[n]+t)in Ue)return e}(e)||e)}var Ge=/^(none|table(?!-c[ea]).+)/,Ye={position:"absolute",visibility:"hidden",display:"block"},Qe={letterSpacing:"0",fontWeight:"400"};function Je(e,t,n){var r=te.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function Ke(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=w.css(e,n+ne[a],!0,i)),r?("content"===n&&(u-=w.css(e,"padding"+ne[a],!0,i)),"margin"!==n&&(u-=w.css(e,"border"+ne[a]+"Width",!0,i))):(u+=w.css(e,"padding"+ne[a],!0,i),"padding"!==n?u+=w.css(e,"border"+ne[a]+"Width",!0,i):s+=w.css(e,"border"+ne[a]+"Width",!0,i));return!r&&o>=0&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function Ze(e,t,n){var r=Ie(e),i=(!h.boxSizingReliable()||n)&&"border-box"===w.css(e,"boxSizing",!1,r),o=i,a=Be(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if(Re.test(a)){if(!n)return a;a="auto"}return(!h.boxSizingReliable()&&i||!h.reliableTrDimensions()&&A(e,"tr")||"auto"===a||!parseFloat(a)&&"inline"===w.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===w.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+Ke(e,t,n||(i?"border":"content"),o,r,a)+"px"}function et(e,t,n,r,i){return new et.prototype.init(e,t,n,r,i)}w.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Be(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=X(t),u=Me.test(t),l=e.style;if(u||(t=Ve(s)),a=w.cssHooks[t]||w.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=te.exec(n))&&i[1]&&(n=se(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(w.cssNumber[s]?"":"px")),h.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=X(t);return Me.test(t)||(t=Ve(s)),(a=w.cssHooks[t]||w.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Be(e,t,r)),"normal"===i&&t in Qe&&(i=Qe[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),w.each(["height","width"],function(e,t){w.cssHooks[t]={get:function(e,n,r){if(n)return!Ge.test(w.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?Ze(e,t,r):We(e,Ye,function(){return Ze(e,t,r)})},set:function(e,n,r){var i,o=Ie(e),a=!h.scrollboxSize()&&"absolute"===o.position,s=(a||r)&&"border-box"===w.css(e,"boxSizing",!1,o),u=r?Ke(e,t,r,s,o):0;return s&&a&&(u-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(o[t])-Ke(e,t,"border",!1,o)-.5)),u&&(i=te.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=w.css(e,t)),Je(0,n,u)}}}),w.cssHooks.marginLeft=_e(h.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Be(e,"marginLeft"))||e.getBoundingClientRect().left-We(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),w.each({margin:"",padding:"",border:"Width"},function(e,t){w.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+ne[r]+t]=o[r]||o[r-2]||o[0];return i}},"margin"!==e&&(w.cssHooks[e+t].set=Je)}),w.fn.extend({css:function(e,t){return B(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Ie(e),i=t.length;a<i;a++)o[t[a]]=w.css(e,t[a],!1,r);return o}return void 0!==n?w.style(e,t,n):w.css(e,t)},e,t,arguments.length>1)}}),w.Tween=et,et.prototype={constructor:et,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||w.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(w.cssNumber[n]?"":"px")},cur:function(){var e=et.propHooks[this.prop];return e&&e.get?e.get(this):et.propHooks._default.get(this)},run:function(e){var t,n=et.propHooks[this.prop];return this.options.duration?this.pos=t=w.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):et.propHooks._default.set(this),this}},et.prototype.init.prototype=et.prototype,et.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=w.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){w.fx.step[e.prop]?w.fx.step[e.prop](e):1!==e.elem.nodeType||!w.cssHooks[e.prop]&&null==e.elem.style[Ve(e.prop)]?e.elem[e.prop]=e.now:w.style(e.elem,e.prop,e.now+e.unit)}}},et.propHooks.scrollTop=et.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},w.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},w.fx=et.prototype.init,w.fx.step={};var tt,nt,rt=/^(?:toggle|show|hide)$/,it=/queueHooks$/;function ot(){nt&&(!1===y.hidden&&t.requestAnimationFrame?t.requestAnimationFrame(ot):t.setTimeout(ot,w.fx.interval),w.fx.tick())}function at(){return t.setTimeout(function(){tt=void 0}),tt=Date.now()}function st(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=ne[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function ut(e,t,n){for(var r,i=(lt.tweeners[t]||[]).concat(lt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function lt(e,t,n){var r,i,o=0,a=lt.prefilters.length,s=w.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=tt||at(),n=Math.max(0,l.startTime+l.duration-t),r=1-(n/l.duration||0),o=0,a=l.tweens.length;o<a;o++)l.tweens[o].run(r);return s.notifyWith(e,[l,r,n]),r<1&&a?n:(a||s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:w.extend({},t),opts:w.extend(!0,{specialEasing:{},easing:w.easing._default},n),originalProperties:t,originalOptions:n,startTime:tt||at(),duration:n.duration,tweens:[],createTween:function(t,n){var r=w.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)l.tweens[n].run(1);return t?(s.notifyWith(e,[l,1,0]),s.resolveWith(e,[l,t])):s.rejectWith(e,[l,t]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=X(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=w.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);o<a;o++)if(r=lt.prefilters[o].call(l,e,c,l.opts))return g(r.stop)&&(w._queueHooks(l.elem,l.opts.queue).stop=r.stop.bind(r)),r;return w.map(c,ut,l),g(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),w.fx.timer(w.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l}w.Animation=w.extend(lt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return se(n.elem,e,te.exec(t),n),n}]},tweener:function(e,t){g(e)?(t=e,e=["*"]):e=e.match(P);for(var n,r=0,i=e.length;r<i;r++)n=e[r],lt.tweeners[n]=lt.tweeners[n]||[],lt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&ae(e),v=Y.get(e,"fxshow");for(r in n.queue||(null==(a=w._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,w.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],rt.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||w.style(e,r)}if((u=!w.isEmptyObject(t))||!w.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Y.get(e,"display")),"none"===(c=w.css(e,"display"))&&(l?c=l:(ce([e],!0),l=e.style.display||l,c=w.css(e,"display"),ce([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===w.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Y.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&ce([e],!0),p.done(function(){for(r in g||ce([e]),Y.remove(e,"fxshow"),d)w.style(e,r,d[r])})),u=ut(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?lt.prefilters.unshift(e):lt.prefilters.push(e)}}),w.speed=function(e,t,n){var r=e&&"object"==typeof e?w.extend({},e):{complete:n||!n&&t||g(e)&&e,duration:e,easing:n&&t||t&&!g(t)&&t};return w.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in w.fx.speeds?r.duration=w.fx.speeds[r.duration]:r.duration=w.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){g(r.old)&&r.old.call(this),r.queue&&w.dequeue(this,r.queue)},r},w.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=w.isEmptyObject(e),o=w.speed(t,n,r),a=function(){var t=lt(this,w.extend({},e),o);(i||Y.get(this,"finish"))&&t.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=w.timers,a=Y.get(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&it.test(i)&&r(a[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||w.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=Y.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=w.timers,a=r?r.length:0;for(n.finish=!0,w.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<a;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),w.each(["toggle","show","hide"],function(e,t){var n=w.fn[t];w.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(st(t,!0),e,r,i)}}),w.each({slideDown:st("show"),slideUp:st("hide"),slideToggle:st("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){w.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),w.timers=[],w.fx.tick=function(){var e,t=0,n=w.timers;for(tt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||w.fx.stop(),tt=void 0},w.fx.timer=function(e){w.timers.push(e),w.fx.start()},w.fx.interval=13,w.fx.start=function(){nt||(nt=!0,ot())},w.fx.stop=function(){nt=null},w.fx.speeds={slow:600,fast:200,_default:400},w.fn.delay=function(e,n){return e=w.fx&&w.fx.speeds[e]||e,n=n||"fx",this.queue(n,function(n,r){var i=t.setTimeout(n,e);r.stop=function(){t.clearTimeout(i)}})},function(){var e=y.createElement("input"),t=y.createElement("select").appendChild(y.createElement("option"));e.type="checkbox",h.checkOn=""!==e.value,h.optSelected=t.selected,(e=y.createElement("input")).value="t",e.type="radio",h.radioValue="t"===e.value}();var ct,ft=w.expr.attrHandle;w.fn.extend({attr:function(e,t){return B(this,w.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){w.removeAttr(this,e)})}}),w.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?w.prop(e,t,n):(1===o&&w.isXMLDoc(e)||(i=w.attrHooks[t.toLowerCase()]||(w.expr.match.bool.test(t)?ct:void 0)),void 0!==n?null===n?void w.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=w.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!h.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(P);if(i&&1===e.nodeType)for(;n=i[r++];)e.removeAttribute(n)}}),ct={set:function(e,t,n){return!1===t?w.removeAttr(e,n):e.setAttribute(n,n),n}},w.each(w.expr.match.bool.source.match(/\w+/g),function(e,t){var n=ft[t]||w.find.attr;ft[t]=function(e,t,r){var i,o,a=t.toLowerCase();return r||(o=ft[a],ft[a]=i,i=null!=n(e,t,r)?a:null,ft[a]=o),i}});var pt=/^(?:input|select|textarea|button)$/i,dt=/^(?:a|area)$/i;function ht(e){return(e.match(P)||[]).join(" ")}function gt(e){return e.getAttribute&&e.getAttribute("class")||""}function vt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(P)||[]}w.fn.extend({prop:function(e,t){return B(this,w.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[w.propFix[e]||e]})}}),w.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&w.isXMLDoc(e)||(t=w.propFix[t]||t,i=w.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=w.find.attr(e,"tabindex");return t?parseInt(t,10):pt.test(e.nodeName)||dt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),h.optSelected||(w.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){w.propFix[this.toLowerCase()]=this}),w.fn.extend({addClass:function(e){var t,n,r,i,o,a;return g(e)?this.each(function(t){w(this).addClass(e.call(this,t,gt(this)))}):(t=vt(e)).length?this.each(function(){if(r=gt(this),n=1===this.nodeType&&" "+ht(r)+" "){for(o=0;o<t.length;o++)i=t[o],n.indexOf(" "+i+" ")<0&&(n+=i+" ");a=ht(n),r!==a&&this.setAttribute("class",a)}}):this},removeClass:function(e){var t,n,r,i,o,a;return g(e)?this.each(function(t){w(this).removeClass(e.call(this,t,gt(this)))}):arguments.length?(t=vt(e)).length?this.each(function(){if(r=gt(this),n=1===this.nodeType&&" "+ht(r)+" "){for(o=0;o<t.length;o++)for(i=t[o];n.indexOf(" "+i+" ")>-1;)n=n.replace(" "+i+" "," ");a=ht(n),r!==a&&this.setAttribute("class",a)}}):this:this.attr("class","")},toggleClass:function(e,t){var n,r,i,o,a=typeof e,s="string"===a||Array.isArray(e);return g(e)?this.each(function(n){w(this).toggleClass(e.call(this,n,gt(this),t),t)}):"boolean"==typeof t&&s?t?this.addClass(e):this.removeClass(e):(n=vt(e),this.each(function(){if(s)for(o=w(this),i=0;i<n.length;i++)r=n[i],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==e&&"boolean"!==a||((r=gt(this))&&Y.set(this,"__className__",r),this.setAttribute&&this.setAttribute("class",r||!1===e?"":Y.get(this,"__className__")||""))}))},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+ht(gt(n))+" ").indexOf(t)>-1)return!0;return!1}});var yt=/\r/g;w.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=g(e),this.each(function(n){var i;1===this.nodeType&&(null==(i=r?e.call(this,n,w(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=w.map(i,function(e){return null==e?"":e+""})),(t=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))})):i?(t=w.valHooks[i.type]||w.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:"string"==typeof(n=i.value)?n.replace(yt,""):null==n?"":n:void 0}}),w.extend({valHooks:{option:{get:function(e){var t=w.find.attr(e,"value");return null!=t?t:ht(w.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=w(n).val(),a)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,o=w.makeArray(t),a=i.length;a--;)((r=i[a]).selected=w.inArray(w.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),w.each(["radio","checkbox"],function(){w.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=w.inArray(w(e).val(),t)>-1}},h.checkOn||(w.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),h.focusin="onfocusin"in t;var mt=/^(?:focusinfocus|focusoutblur)$/,xt=function(e){e.stopPropagation()};w.extend(w.event,{trigger:function(e,n,r,i){var o,a,s,u,l,c,p,d,h=[r||y],m=f.call(e,"type")?e.type:e,x=f.call(e,"namespace")?e.namespace.split("."):[];if(a=d=s=r=r||y,3!==r.nodeType&&8!==r.nodeType&&!mt.test(m+w.event.triggered)&&(m.indexOf(".")>-1&&(x=m.split("."),m=x.shift(),x.sort()),l=m.indexOf(":")<0&&"on"+m,(e=e[w.expando]?e:new w.Event(m,"object"==typeof e&&e)).isTrigger=i?2:3,e.namespace=x.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+x.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),n=null==n?[e]:w.makeArray(n,[e]),p=w.event.special[m]||{},i||!p.trigger||!1!==p.trigger.apply(r,n))){if(!i&&!p.noBubble&&!v(r)){for(u=p.delegateType||m,mt.test(u+m)||(a=a.parentNode);a;a=a.parentNode)h.push(a),s=a;s===(r.ownerDocument||y)&&h.push(s.defaultView||s.parentWindow||t)}for(o=0;(a=h[o++])&&!e.isPropagationStopped();)d=a,e.type=o>1?u:p.bindType||m,(c=(Y.get(a,"events")||Object.create(null))[e.type]&&Y.get(a,"handle"))&&c.apply(a,n),(c=l&&a[l])&&c.apply&&V(a)&&(e.result=c.apply(a,n),!1===e.result&&e.preventDefault());return e.type=m,i||e.isDefaultPrevented()||p._default&&!1!==p._default.apply(h.pop(),n)||!V(r)||l&&g(r[m])&&!v(r)&&((s=r[l])&&(r[l]=null),w.event.triggered=m,e.isPropagationStopped()&&d.addEventListener(m,xt),r[m](),e.isPropagationStopped()&&d.removeEventListener(m,xt),w.event.triggered=void 0,s&&(r[l]=s)),e.result}},simulate:function(e,t,n){var r=w.extend(new w.Event,n,{type:e,isSimulated:!0});w.event.trigger(r,null,t)}}),w.fn.extend({trigger:function(e,t){return this.each(function(){w.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return w.event.trigger(e,t,n,!0)}}),h.focusin||w.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){w.event.simulate(t,e.target,w.event.fix(e))};w.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,i=Y.access(r,t);i||r.addEventListener(e,n,!0),Y.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,i=Y.access(r,t)-1;i?Y.access(r,t,i):(r.removeEventListener(e,n,!0),Y.remove(r,t))}}});var bt=t.location,wt={guid:Date.now()},Tt=/\?/;w.parseXML=function(e){var n,r;if(!e||"string"!=typeof e)return null;try{n=(new t.DOMParser).parseFromString(e,"text/xml")}catch(i){}return r=n&&n.getElementsByTagName("parsererror")[0],n&&!r||w.error("Invalid XML: "+(r?w.map(r.childNodes,function(e){return e.textContent}).join("\n"):e)),n};var Ct=/\[\]$/,Et=/\r?\n/g,St=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function At(e,t,n,r){var i;if(Array.isArray(t))w.each(t,function(t,i){n||Ct.test(e)?r(e,i):At(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==b(t))r(e,t);else for(i in t)At(e+"["+i+"]",t[i],n,r)}w.param=function(e,t){var n,r=[],i=function(e,t){var n=g(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!w.isPlainObject(e))w.each(e,function(){i(this.name,this.value)});else for(n in e)At(n,e[n],t,i);return r.join("&")},w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=w.prop(this,"elements");return e?w.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!w(this).is(":disabled")&&kt.test(this.nodeName)&&!St.test(e)&&(this.checked||!de.test(e))}).map(function(e,t){var n=w(this).val();return null==n?null:Array.isArray(n)?w.map(n,function(e){return{name:t.name,value:e.replace(Et,"\r\n")}}):{name:t.name,value:n.replace(Et,"\r\n")}}).get()}});var Nt=/%20/g,jt=/#.*$/,Dt=/([?&])_=[^&]*/,qt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Lt=/^(?:GET|HEAD)$/,Ht=/^\/\//,Ot={},Pt={},Rt="*/".concat("*"),Mt=y.createElement("a");function It(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(P)||[];if(g(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Wt(e,t,n,r){var i={},o=e===Pt;function a(s){var u;return i[s]=!0,w.each(e[s]||[],function(e,s){var l=s(t,n,r);return"string"!=typeof l||o||i[l]?o?!(u=l):void 0:(t.dataTypes.unshift(l),a(l),!1)}),u}return a(t.dataTypes[0])||!i["*"]&&a("*")}function Ft(e,t){var n,r,i=w.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&w.extend(!0,e,r),e}Mt.href=bt.href,w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(bt.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Rt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,w.ajaxSettings),t):Ft(w.ajaxSettings,e)},ajaxPrefilter:It(Ot),ajaxTransport:It(Pt),ajax:function(e,n){"object"==typeof e&&(n=e,e=void 0),n=n||{};var r,i,o,a,s,u,l,c,f,p,d=w.ajaxSetup({},n),h=d.context||d,g=d.context&&(h.nodeType||h.jquery)?w(h):w.event,v=w.Deferred(),m=w.Callbacks("once memory"),x=d.statusCode||{},b={},T={},C="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(l){if(!a)for(a={};t=qt.exec(o);)a[t[1].toLowerCase()+" "]=(a[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=a[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return l?o:null},setRequestHeader:function(e,t){return null==l&&(e=T[e.toLowerCase()]=T[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==l&&(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(l)E.always(e[E.status]);else for(t in e)x[t]=[x[t],e[t]];return this},abort:function(e){var t=e||C;return r&&r.abort(t),S(0,t),this}};if(v.promise(E),d.url=((e||d.url||bt.href)+"").replace(Ht,bt.protocol+"//"),d.type=n.method||n.type||d.method||d.type,d.dataTypes=(d.dataType||"*").toLowerCase().match(P)||[""],null==d.crossDomain){u=y.createElement("a");try{u.href=d.url,u.href=u.href,d.crossDomain=Mt.protocol+"//"+Mt.host!=u.protocol+"//"+u.host}catch(k){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=w.param(d.data,d.traditional)),Wt(Ot,d,n,E),l)return E;for(f in(c=w.event&&d.global)&&0==w.active++&&w.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!Lt.test(d.type),i=d.url.replace(jt,""),d.hasContent?d.data&&d.processData&&0===(d.contentType||"").indexOf("application/x-www-form-urlencoded")&&(d.data=d.data.replace(Nt,"+")):(p=d.url.slice(i.length),d.data&&(d.processData||"string"==typeof d.data)&&(i+=(Tt.test(i)?"&":"?")+d.data,delete d.data),!1===d.cache&&(i=i.replace(Dt,"$1"),p=(Tt.test(i)?"&":"?")+"_="+wt.guid+++p),d.url=i+p),d.ifModified&&(w.lastModified[i]&&E.setRequestHeader("If-Modified-Since",w.lastModified[i]),w.etag[i]&&E.setRequestHeader("If-None-Match",w.etag[i])),(d.data&&d.hasContent&&!1!==d.contentType||n.contentType)&&E.setRequestHeader("Content-Type",d.contentType),E.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Rt+"; q=0.01":""):d.accepts["*"]),d.headers)E.setRequestHeader(f,d.headers[f]);if(d.beforeSend&&(!1===d.beforeSend.call(h,E,d)||l))return E.abort();if(C="abort",m.add(d.complete),E.done(d.success),E.fail(d.error),r=Wt(Pt,d,n,E)){if(E.readyState=1,c&&g.trigger("ajaxSend",[E,d]),l)return E;d.async&&d.timeout>0&&(s=t.setTimeout(function(){E.abort("timeout")},d.timeout));try{l=!1,r.send(b,S)}catch(k){if(l)throw k;S(-1,k)}}else S(-1,"No Transport");function S(e,n,a,u){var f,p,y,b,T,C=n;l||(l=!0,s&&t.clearTimeout(s),r=void 0,o=u||"",E.readyState=e>0?4:0,f=e>=200&&e<300||304===e,a&&(b=function(e,t,n){for(var r,i,o,a,s=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(d,E,a)),!f&&w.inArray("script",d.dataTypes)>-1&&w.inArray("json",d.dataTypes)<0&&(d.converters["text script"]=function(){}),b=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(k){return{state:"parsererror",error:a?k:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(d,b,E,f),f?(d.ifModified&&((T=E.getResponseHeader("Last-Modified"))&&(w.lastModified[i]=T),(T=E.getResponseHeader("etag"))&&(w.etag[i]=T)),204===e||"HEAD"===d.type?C="nocontent":304===e?C="notmodified":(C=b.state,p=b.data,f=!(y=b.error))):(y=C,!e&&C||(C="error",e<0&&(e=0))),E.status=e,E.statusText=(n||C)+"",f?v.resolveWith(h,[p,C,E]):v.rejectWith(h,[E,C,y]),E.statusCode(x),x=void 0,c&&g.trigger(f?"ajaxSuccess":"ajaxError",[E,d,f?p:y]),m.fireWith(h,[E,C]),c&&(g.trigger("ajaxComplete",[E,d]),--w.active||w.event.trigger("ajaxStop")))}return E},getJSON:function(e,t,n){return w.get(e,t,n,"json")},getScript:function(e,t){return w.get(e,void 0,t,"script")}}),w.each(["get","post"],function(e,t){w[t]=function(e,n,r,i){return g(n)&&(i=i||r,r=n,n=void 0),w.ajax(w.extend({url:e,type:t,dataType:i,data:n,success:r},w.isPlainObject(e)&&e))}}),w.ajaxPrefilter(function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")}),w._evalUrl=function(e,t,n){return w.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){w.globalEval(e,t,n)}})},w.fn.extend({wrapAll:function(e){var t;return this[0]&&(g(e)&&(e=e.call(this[0])),t=w(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return g(e)?this.each(function(t){w(this).wrapInner(e.call(this,t))}):this.each(function(){var t=w(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=g(e);return this.each(function(n){w(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){w(this).replaceWith(this.childNodes)}),this}}),w.expr.pseudos.hidden=function(e){return!w.expr.pseudos.visible(e)},w.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},w.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch(e){}};var $t={0:200,1223:204},Bt=w.ajaxSettings.xhr();h.cors=!!Bt&&"withCredentials"in Bt,h.ajax=Bt=!!Bt,w.ajaxTransport(function(e){var n,r;if(h.cors||Bt&&!e.crossDomain)return{send:function(i,o){var a,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)s[a]=e.xhrFields[a];for(a in e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),i)s.setRequestHeader(a,i[a]);n=function(e){return function(){n&&(n=r=s.onload=s.onerror=s.onabort=s.ontimeout=s.onreadystatechange=null,"abort"===e?s.abort():"error"===e?"number"!=typeof s.status?o(0,"error"):o(s.status,s.statusText):o($t[s.status]||s.status,s.statusText,"text"!==(s.responseType||"text")||"string"!=typeof s.responseText?{binary:s.response}:{text:s.responseText},s.getAllResponseHeaders()))}},s.onload=n(),r=s.onerror=s.ontimeout=n("error"),void 0!==s.onabort?s.onabort=r:s.onreadystatechange=function(){4===s.readyState&&t.setTimeout(function(){n&&r()})},n=n("abort");try{s.send(e.hasContent&&e.data||null)}catch(u){if(n)throw u}},abort:function(){n&&n()}}}),w.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return w.globalEval(e),e}}}),w.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),w.ajaxTransport("script",function(e){var t,n;if(e.crossDomain||e.scriptAttrs)return{send:function(r,i){t=w("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),y.head.appendChild(t[0])},abort:function(){n&&n()}}});var _t,zt=[],Ut=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=zt.pop()||w.expando+"_"+wt.guid++;return this[e]=!0,e}}),w.ajaxPrefilter("json jsonp",function(e,n,r){var i,o,a,s=!1!==e.jsonp&&(Ut.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(e.data)&&"data");if(s||"jsonp"===e.dataTypes[0])return i=e.jsonpCallback=g(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,s?e[s]=e[s].replace(Ut,"$1"+i):!1!==e.jsonp&&(e.url+=(Tt.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return a||w.error(i+" was not called"),a[0]},e.dataTypes[0]="json",o=t[i],t[i]=function(){a=arguments},r.always(function(){void 0===o?w(t).removeProp(i):t[i]=o,e[i]&&(e.jsonpCallback=n.jsonpCallback,zt.push(i)),a&&g(o)&&o(a[0]),a=o=void 0}),"script"}),h.createHTMLDocument=((_t=y.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===_t.childNodes.length),w.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(h.createHTMLDocument?((r=(t=y.implementation.createHTMLDocument("")).createElement("base")).href=y.location.href,t.head.appendChild(r)):t=y),o=!n&&[],(i=N.exec(e))?[t.createElement(i[1])]:(i=be([e],t,o),o&&o.length&&w(o).remove(),w.merge([],i.childNodes)));var r,i,o},w.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return s>-1&&(r=ht(e.slice(s)),e=e.slice(0,s)),g(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),a.length>0&&w.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?w("<div>").append(w.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},w.expr.pseudos.animated=function(e){return w.grep(w.timers,function(t){return e===t.elem}).length},w.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=w.css(e,"position"),c=w(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=w.css(e,"top"),u=w.css(e,"left"),("absolute"===l||"fixed"===l)&&(o+u).indexOf("auto")>-1?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),g(t)&&(t=t.call(e,n,w.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},w.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){w.offset.setOffset(this,e,t)});var t,n,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===w.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;e&&(e===n.body||e===n.documentElement)&&"static"===w.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=w(e).offset()).top+=w.css(e,"borderTopWidth",!0),i.left+=w.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-w.css(r,"marginTop",!0),left:t.left-i.left-w.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===w.css(e,"position");)e=e.offsetParent;return e||re})}}),w.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;w.fn[e]=function(r){return B(this,function(e,r,i){var o;if(v(e)?o=e:9===e.nodeType&&(o=e.defaultView),void 0===i)return o?o[t]:e[r];o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i},e,r,arguments.length)}}),w.each(["top","left"],function(e,t){w.cssHooks[t]=_e(h.pixelPosition,function(e,n){if(n)return n=Be(e,t),Re.test(n)?w(e).position()[t]+"px":n})}),w.each({Height:"height",Width:"width"},function(e,t){w.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){w.fn[r]=function(i,o){var a=arguments.length&&(n||"boolean"!=typeof i),s=n||(!0===i||!0===o?"margin":"border");return B(this,function(t,n,i){var o;return v(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(o=t.documentElement,Math.max(t.body["scroll"+e],o["scroll"+e],t.body["offset"+e],o["offset"+e],o["client"+e])):void 0===i?w.css(t,n,s):w.style(t,n,i,s)},t,a?i:void 0,a)}})}),w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){w.fn[t]=function(e){return this.on(t,e)}}),w.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),w.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){w.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}});var Xt=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;w.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),g(e))return r=o.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(o.call(arguments)))}).guid=e.guid=e.guid||w.guid++,i},w.holdReady=function(e){e?w.readyWait++:w.ready(!0)},w.isArray=Array.isArray,w.parseJSON=JSON.parse,w.nodeName=A,w.isFunction=g,w.isWindow=v,w.camelCase=X,w.type=b,w.now=Date.now,w.isNumeric=function(e){var t=w.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},w.trim=function(e){return null==e?"":(e+"").replace(Xt,"$1")},"function"==typeof e&&e.amd&&e("jquery",[],function(){return w});var Vt=t.jQuery,Gt=t.$;return w.noConflict=function(e){return t.$===w&&(t.$=Gt),e&&t.jQuery===w&&(t.jQuery=Vt),w},void 0===n&&(t.jQuery=t.$=w),w});
},{"process":"g5IB"}],"De0C":[function(require,module,exports) {
"use strict";var e=require("../node_modules/@100mslive/hms-video-store"),t=n(require("../node_modules/jquery"));function n(e){return e&&e.__esModule?e:{default:e}}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){o=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(_){l=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),c=new I(r||[]);return i(a,"_invoke",{value:L(e,n,c)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(_){return{type:"throw",arg:_}}}e.wrap=f;var h={};function p(){}function v(){}function y(){}var m={};l(m,c,function(){return this});var g=Object.getPrototypeOf,w=g&&g(g(j([])));w&&w!==t&&n.call(w,c)&&(m=w);var b=y.prototype=p.prototype=Object.create(m);function x(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function S(e,t){var o;i(this,"_invoke",{value:function(i,a){function c(){return new t(function(o,c){!function o(i,a,c,s){var u=d(e[i],e,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==r(f)&&n.call(f,"__await")?t.resolve(f.__await).then(function(e){o("next",e,c,s)},function(e){o("throw",e,c,s)}):t.resolve(f).then(function(e){l.value=e,c(l)},function(e){return o("throw",e,c,s)})}s(u.arg)}(i,a,o,c)})}return o=o?o.then(c,c):c()}})}function L(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return T()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var c=k(a,n);if(c){if(c===h)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=d(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}function k(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var o=d(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,h;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function E(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function j(e){if(e){var t=e[c];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return v.prototype=y,i(b,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:v,configurable:!0}),v.displayName=l(y,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,l(e,u,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},x(S.prototype),l(S.prototype,s,function(){return this}),e.AsyncIterator=S,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new S(f(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},x(b),l(b,u,"Generator"),l(b,c,function(){return this}),l(b,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=j,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(E),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),E(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;E(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:j(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function i(e,t,n,r,o,i,a){try{var c=e[i](a),s=c.value}catch(u){return void n(u)}c.done?t(s):Promise.resolve(s).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function c(e){i(a,r,o,c,s,"next",e)}function s(e){i(a,r,o,c,s,"throw",e)}c(void 0)})}}var c=new e.HMSReactiveStore;c.triggerOnSubscribe();var s=c.getStore(),u=c.getActions(),l=document.querySelector(".conference"),f=document.querySelector(".peers-container"),d=document.getElementById("leave-btn"),h=document.querySelector(".screen-share-video"),p=document.querySelector(".btn-share-screen"),v=document.querySelector(".screen-share-status"),y=document.querySelector(".presenter-controller"),m=document.getElementById("load-test"),g=new Proxy(new URLSearchParams(window.location.search),{get:function(e,t){return e.get(t)}}),w=document.getElementById("msgInput"),b=document.getElementById("messages"),x=new Set,S={0:"Reconnecting",1:"Very Bad Connection",2:"Bad Connection",3:"Moderate Connection",4:"Good Connection",5:"Excellent Connection"};function L(e){return S[e]}function k(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#FFFFFF61";return e<=t?t>=4?"#37F28D":t>=3?"#FAC919":t>=1?"#ED4C5A":n:n}function C(e){return 0==e?'<span title="'+L(e)+'"><svg class="connection-network" width="12" height="12" viewBox="2 0 20 20" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule: evenodd; clip-rule: evenodd; stroke-linejoin: round; stroke-miterlimit: 2;"><path d="M3.046 3.046a.75.75 0 0 0 0 1.06l16.847 16.848a.75.75 0 1 0 1.06-1.06L4.108 3.045a.75.75 0 0 0-1.06 0Zm.256 6.303a13.888 13.888 0 0 1 2.175-1.432l1.356 1.356c-.847.401-1.65.902-2.391 1.497a.91.91 0 0 1-1.14-1.42Zm2.066 3.625A9.79 9.79 0 0 1 8.57 11.01l1.451 1.451a7.969 7.969 0 0 0-3.42 1.854.91.91 0 1 1-1.233-1.34Zm7.503-2.543 2.563 2.563a7.968 7.968 0 0 1 1.927 1.297.91.91 0 1 0 1.227-1.346 9.79 9.79 0 0 0-5.717-2.514Zm2.391 7.271L12.05 14.49h-.057a5.698 5.698 0 0 0-1.752.277c-.852.276-1.63.75-2.267 1.386a.91.91 0 1 0 1.286 1.29 3.878 3.878 0 0 1 3.66-1.019c.683.17 1.308.521 1.807 1.019.15.15.34.236.535.259ZM9.048 6.608l1.582 1.583a12.07 12.07 0 0 1 8.928 2.584.91.91 0 0 0 1.14-1.42 13.89 13.89 0 0 0-11.65-2.747Z" fill="#FFFFFF61" transform="translate(-.333)"></path></svg></span>':'<span title="'+L(e)+'"><svg class="connection-network" width="12" height="12" viewBox="0 0 14 12" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule: evenodd; clip-rule: evenodd; stroke-linejoin: round; stroke-miterlimit: 2;"><path d="M6.875 0c2.549.035 4.679.902 6.445 2.648.366.362.45.796.216 1.096-.239.306-.714.34-1.142.072a2.28 2.28 0 0 1-.341-.271C9.24.862 4.924.775 1.992 3.346c-.284.249-.594.419-.983.393-.272-.019-.49-.135-.613-.388-.125-.261-.05-.498.114-.713.073-.092.156-.177.245-.254C2.516.804 4.591.039 6.875 0Z" fill="'+k(4,e)+'" transform="translate(-.333)"></path><path d="M7.056 2.964c1.756.035 3.208.7 4.499 1.763.162.134.277.315.354.512.098.251.114.503-.075.72-.193.222-.452.259-.725.198-.293-.066-.518-.247-.738-.443a4.859 4.859 0 0 0-6.198-.26c-.166.127-.318.271-.475.409-.242.211-.513.343-.843.317-.43-.034-.679-.397-.561-.81.062-.211.181-.4.345-.546 1.265-1.162 2.733-1.836 4.417-1.86Z" fill="'+k(3,e)+'" transform="translate(-.333)"></path><path d="M7.384,6.052C8.293,6.068 9.157,6.449 9.783,7.108C10.005,7.339 10.157,7.6 10.07,7.942C9.959,8.377 9.435,8.581 9.071,8.243C7.935,7.191 6.356,7.183 5.152,8.183C4.816,8.462 4.6,8.485 4.332,8.27C4.063,8.055 3.998,7.691 4.177,7.358C4.273,7.179 4.414,7.038 4.57,6.911C5.26,6.349 6.149,6.05 7.384,6.052L7.384,6.052Z" fill="'+k(2,e)+'"></path><path d="M8.214,9.941C8.214,10.234 8.097,10.515 7.888,10.721C7.68,10.928 7.398,11.042 7.104,11.039C6.471,11.036 5.982,10.541 5.993,9.912C6.004,9.259 6.499,8.766 7.133,8.779C7.744,8.791 8.22,9.301 8.214,9.941Z" fill="'+k(1,e)+'"></path></svg></span>'}function E(){return"/Test"}function I(){if(null!=document.getElementById("InjectTest")){var e=E()+"/LoadTest?Id="+g.OfferingId;console.log(e),t.default.ajax({url:e,type:"GET",dataType:"html",data:{},crossDomain:!0,cache:!1,beforeSend:function(){},success:function(e){var n=e;(0,t.default)("#InjectTest").replaceWith(n)},complete:function(){},error:function(){}}),"undefined"!=typeof syncChatMessage&&syncChatMessage()}}function j(e,t){return T.apply(this,arguments)}function T(){return(T=a(o().mark(function e(t,n){var r;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.getAuthTokenByRoomCode({roomCode:n});case 2:r=e.sent,u.join({userName:t,authToken:r,metaData:"candidate",settings:{isAudioMuted:!1,isVideoMuted:!1}});case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function _(e,t){var n=document.createElement(e);return n.className=t,n}function F(t){var n=_("div","peer-tile"),r=_("video","peer-video"),o=_("div","peer-video-tile"),i=_("div","peer-network"),a=_("div","peer-name");r.autoplay=!0,r.muted=!0,r.playsinline=!0,a.textContent=t.name,s.subscribe(function(e){e&&(i.innerHTML=C(e.downlinkQuality))},(0,e.selectConnectionQualityByPeerID)(t.id));var c='<div data-testid="preview_avatar_tile" class="tile-short shape-circle shape-color">'+t.name.substr(0,2).toUpperCase()+"</div>";return o.innerHTML=c,s.subscribe(function(e){e&&(console.log(e),e.enabled?(u.attachVideo(e.id,r),r.style.display="",o.style.display="none"):(u.detachVideo(e.id,r),r.style.display="none",o.style.display=""))},(0,e.selectVideoTrackByID)(t.videoTrack)),n.append(r),n.append(o),n.append(a),n.append(i),x.add(t.id),n}function M(){s.getState(e.selectPeers).forEach(function(e){!x.has(e.id)&&null!=e&&e.videoTrack&&null!=e&&e.isLocal&&f.append(F(e))})}function P(e){e.style.display="none"}function O(e){e.style.display=""}function B(){u.leave(),f.innerHTML=""}function N(){return"candidate"==g.Name}function G(e){e?(O(l),O(d),O(y)):(P(l),P(d),P(y))}function Z(){return q.apply(this,arguments)}function q(){return(q=a(o().mark(function t(){var n;return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=!s.getState(e.selectIsSomeoneScreenSharing),t.next=3,u.setScreenShareEnabled(n);case 3:p.textContent=n?"Stop":"Share",m.style.display=n?"":"none",A();case 6:case"end":return t.stop()}},t)}))).apply(this,arguments)}function A(){return D.apply(this,arguments)}function D(){return(D=a(o().mark(function t(){var n,r,i;return o().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!s.getState(e.selectIsSomeoneScreenSharing)){t.next=15;break}if(n=s.getState(e.selectIsLocalScreenShared),r=s.getState(e.selectPeerScreenSharing),i=s.getState((0,e.selectScreenShareByPeerID)(null==r?void 0:r.id)),!n){t.next=10;break}v.textContent="Screen share started!!!",m.style.display="",t.next=13;break;case 10:return P(v),t.next=13,u.attachVideo(null==i?void 0:i.id,h);case 13:t.next=17;break;case 15:v.textContent="Welcome! Sit back and relax till streaming start.",O(v);case 17:case"end":return t.stop()}},t)}))).apply(this,arguments)}function R(e){if(0!==e.length){var t="";e.forEach(function(e){t+="\n".concat(e.senderName,": ").concat(e.message)}),console.log("new messages - ",t);b&&(b.textContent=t)}}function V(){if(s.getState(e.selectIsConnectedToRoom)){var t=w.value;t&&""!==t.trim()?u.sendBroadcastMessage(t):console.warn("Invalid message")}else console.warn("can't send message when not conneted to room")}S[-1]="Network Unknown",d.onclick=B,m.onclick=I,p.onclick=Z,window.onunload=window.onbeforeunload=B,w.onkeypress=function(e){13===e.keyCode&&(V(),w.value="")},s.subscribe(G,e.selectIsConnectedToRoom),s.subscribe(A,e.selectPeers),s.subscribe(M,e.selectPeers),s.subscribe(R,e.selectHMSMessages),j(g.Name,"ivn-wwwk-jnx");
},{"../node_modules/@100mslive/hms-video-store":"j5Na","../node_modules/jquery":"HlZQ"}]},{},["De0C"], null)
//# sourceMappingURL=/candidate.6b3b5986.js.map